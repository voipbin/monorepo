<!DOCTYPE html>
<html class="no-js" lang="en" data-content_root="./">
<head>
    <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
        <title>Real-Time Communication (RTC) &mdash; voipbin  documentation</title>
    
    <link rel="stylesheet" type="text/css" href="_static/dist/fontawesome.css" />
      <link rel="stylesheet" type="text/css" href="_static/dist/theme.css?v=310cf088" />
      <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
            <link rel="index" title="Index" href="genindex.html" />
            <link rel="search" title="Search" href="search.html" />
            <link rel="top" title="voipbin  documentation" href="#" />
    </head>
<body>
    <script type="text/javascript" src="_static/dist/blocking.js"></script>
    <header class="container-fluid bg-primary">
        <a class="btn btn-sm btn-light skip-to-content-link" href="#main">Skip to content</a>
        <div class="container-fluid">
            <div class="navbar navbar-expand-lg navbar-dark font-weight-bold">
                    <a href="intro.html"
                        title="voipbin"
                        class="logo navbar-brand"
                    >
                        <img src="_static/images/voipbin-high-resolution-logo-white-transparent.png" width="45" height="80" alt="voipbin"
                            class="logo-img"
                        />
                        VoIPBin Documentation
                    </a>
                
                
                    <div class="collapse navbar-collapse justify-content-end">
                        <ul class="navbar-nav">
                            
                                
                                
                                <li class="nav-item"><a class="nav-link"  href="http://voipbin.net">Project</a></li>
                            
                                
                                
                                <li class="nav-item"><a class="nav-link"  href="https://admin.voipbin.net">Admin</a></li>
                            
                        </ul>
                    </div>
                
                <button class="navbar-toggler btn btn-primary d-lg-none" type="button" data-toggle="collapse" data-target="#collapseSidebar" aria-expanded="false" aria-controls="collapseExample">
                    <span class="navbar-toggler-icon"></span>
                    <span class="sr-only">menu</span>
                </button>
            </div>
        </div>
    </header>
    <div class="container-fluid">
        <div class="row">
            <aside class="col-12 col-lg-3 sidebar-container">
                <div id="collapseSidebar" class="collapse sticky-top d-lg-block pt-5 pr-lg-4">
<div id="searchbox" class="searchbox mb-6 px-1" role="search">
    <form id="search-form" action="search.html" autocomplete="off" method="get" role="search">
        <div class="input-group">
            <div class="input-group-prepend">
                <div class="input-group-text border-right-0 bg-white py-3 pl-3 pr-2"><span class="fas fa-search"></span></div>
            </div>
            <input class="form-control py-3 pr-3 pl-1 h-100 border-left-0" type="search" name="q" placeholder="Search documentation" aria-label="Search documentation" id="searchinput" />
        </div>
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
    </form>
</div><div class="site-toc">
    <nav class="toc mt-3" aria-label="Main menu">
        <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="accesskey.html">Accesskey</a></li>
<li class="toctree-l1"><a class="reference internal" href="sdk.html">SDK(Software Development Kit)</a></li>
<li class="toctree-l1"><a class="reference internal" href="restful_api.html">RESTful API(Application Programming Interface)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Core Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="flow.html">Flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="flow.html#activeflow">Activeflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="variable.html">Variable</a></li>
<li class="toctree-l1"><a class="reference internal" href="webhook.html">Webhook</a></li>
<li class="toctree-l1"><a class="reference internal" href="common.html">Common</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Voice &amp; Real-Time</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="call.html">Call</a></li>
<li class="toctree-l1"><a class="reference internal" href="conference.html">Conference</a></li>
<li class="toctree-l1"><a class="reference internal" href="queue.html">Queue</a></li>
<li class="toctree-l1"><a class="reference internal" href="recording.html">Recording</a></li>
<li class="toctree-l1"><a class="reference internal" href="transcribe.html">Transcribe</a></li>
<li class="toctree-l1"><a class="reference internal" href="mediastream.html">Mediastream</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Messaging</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="message.html">Message</a></li>
<li class="toctree-l1"><a class="reference internal" href="email.html">Email</a></li>
<li class="toctree-l1"><a class="reference internal" href="talk.html">Talk</a></li>
<li class="toctree-l1"><a class="reference internal" href="conversation.html">Conversation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">AI &amp; Automation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="ai.html">AI</a></li>
<li class="toctree-l1"><a class="reference internal" href="campaign.html">Campaign</a></li>
<li class="toctree-l1"><a class="reference internal" href="outdial.html">Outdial</a></li>
<li class="toctree-l1"><a class="reference internal" href="outplan.html">Outplan</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Resources &amp; Management</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="number.html">Number</a></li>
<li class="toctree-l1"><a class="reference internal" href="agent.html">Agent</a></li>
<li class="toctree-l1"><a class="reference internal" href="contact.html">Contact</a></li>
<li class="toctree-l1"><a class="reference internal" href="customer.html">Customer</a></li>
<li class="toctree-l1"><a class="reference internal" href="billing_account.html">Billing Account</a></li>
<li class="toctree-l1"><a class="reference internal" href="storage.html">Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="tag.html">Tag</a></li>
<li class="toctree-l1"><a class="reference internal" href="provider.html">Provider</a></li>
<li class="toctree-l1"><a class="reference internal" href="route.html">Route</a></li>
<li class="toctree-l1"><a class="reference internal" href="extension.html">Extension</a></li>
<li class="toctree-l1"><a class="reference internal" href="trunk.html">Trunk</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Architecture (Deep Dive)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="websocket.html">Websocket</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Help &amp; Support</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="support.html">Support</a></li>
</ul>

    </nav>
    <template data-toggle-item-template>
        <button class="btn btn-sm btn-link toctree-expand" type="button">
            <span class="sr-only">Toggle menu contents</span>
        </button>
    </template>
</div>
                    <div class="d-lg-none border-bottom">
                        
                    </div>
                </div>
            </aside>
            <div class="col-12 col-lg-9 pt-5">
                <header class="row align-items-baseline">
                    <div class="col">
                        <nav aria-label="breadcrumb">
    <ol class="breadcrumb m-0 p-0 bg-transparent">
        <li class="breadcrumb-item"><a href="index.html">Docs</a></li>
        <li class="breadcrumb-item active" aria-current="page">Real-Time Communication (RTC)</li>
    </ol>
</nav>
                    </div>
                    <div class="col-sm-12 col-lg-auto mt-3 mt-lg-3">
                        <noscript>
                            <p>JavaScript is required to toggle light/dark mode..</p>
                        </noscript>
                        <button id="wagtail-theme" class="btn btn-sm btn-light text-decoration-none" type="button">
                            <span class="dark-only"><i class="fas fa-sun"></i> Light mode</span>
                            <span class="light-only"><i class="fas fa-moon"></i> Dark mode</span>
                        </button>
    <a class="btn btn-sm btn-light text-decoration-none" href="_sources/architecture_rtc.rst.txt" rel="nofollow">
        <span class="btn-icon"><span class="fas fa-code"></span></span>
        <span class="btn-text">View source</span>
    </a>
                        
                    </div>
                </header>
                <div class="row" >
                    <div class="col-12">
                        <hr class="w-100 my-4">
                    </div>
                </div>
                <div class="row">
                    <div class="col-12 col-lg-9 order-last order-lg-first rst-content">
                        <main role="main" id="main">
    <section id="real-time-communication-rtc">
<span id="architecture-rtc"></span><h1>Real-Time Communication (RTC)<a class="headerlink" href="#real-time-communication-rtc" title="Link to this heading"></a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>AI Context</strong></p>
<p>This page describes VoIPBIN’s real-time communication stack: Kamailio (stateless SIP edge routing), Asterisk (three specialized farms for calls, conferences, and registration), RTPEngine (media proxy and codec transcoding), conference architecture, and SIP session recovery after Asterisk crashes. Relevant when an AI agent needs to understand VoIP call flow mechanics, media handling, codec strategies, or high-availability features.</p>
</div>
<p>VoIPBIN’s RTC architecture handles all real-time voice and video communication through a distributed stack of specialized components. The architecture separates signaling (SIP) from media (RTP) processing, enabling independent scaling and fault tolerance.</p>
<section id="voip-stack-overview">
<h2>VoIP Stack Overview<a class="headerlink" href="#voip-stack-overview" title="Link to this heading"></a></h2>
<p>VoIPBIN’s VoIP stack consists of three main components working together:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SIP</span> <span class="n">Traffic</span> <span class="n">Flow</span><span class="p">:</span>

<span class="n">External</span> <span class="n">Client</span>                                      <span class="n">Internal</span> <span class="n">Services</span>
     <span class="o">|</span>                                                      <span class="o">|</span>
     <span class="o">|</span> <span class="n">SIP</span> <span class="p">(</span><span class="n">INVITE</span><span class="p">,</span> <span class="n">etc</span><span class="o">.</span><span class="p">)</span>                                   <span class="o">|</span>
     <span class="n">v</span>                                                      <span class="n">v</span>
<span class="o">+----------+</span>         <span class="o">+----------+</span>         <span class="o">+------------------+</span>
<span class="o">|</span>   <span class="n">Load</span>   <span class="o">|</span>  <span class="n">SIP</span>    <span class="o">|</span> <span class="n">Kamailio</span> <span class="o">|</span>  <span class="n">SIP</span>    <span class="o">|</span>    <span class="n">Asterisk</span>      <span class="o">|</span>
<span class="o">|</span> <span class="n">Balancer</span> <span class="o">|&lt;-------&gt;|</span>   <span class="n">Farm</span>   <span class="o">|&lt;-------&gt;|</span>     <span class="p">(</span><span class="n">Call</span><span class="p">)</span>       <span class="o">|</span>
<span class="o">+----------+</span>         <span class="o">+-----+----+</span>         <span class="o">+--------+---------+</span>
                           <span class="o">|</span>                       <span class="o">|</span>
                           <span class="o">|</span> <span class="n">RTP</span> <span class="n">Control</span>           <span class="o">|</span> <span class="n">RTP</span> <span class="n">Control</span>
                           <span class="n">v</span>                       <span class="o">|</span>
                     <span class="o">+----------+</span>                  <span class="o">|</span>
                     <span class="o">|</span> <span class="n">RTPEngine</span><span class="o">|</span>                  <span class="o">|</span>
                     <span class="o">|</span>   <span class="n">Farm</span>   <span class="o">|&lt;-----------------+</span>
                     <span class="o">+-----+----+</span>  <span class="n">Media</span>
                           <span class="o">|</span>
                           <span class="o">|</span> <span class="n">RTP</span> <span class="p">(</span><span class="n">Audio</span><span class="o">/</span><span class="n">Video</span><span class="p">)</span>
                           <span class="n">v</span>
                     <span class="n">External</span> <span class="n">Client</span>
</pre></div>
</div>
<img alt="Architecture VoIP" src="_images/architecture_rtc_voip.png" />
<p><strong>Key Characteristics:</strong></p>
<ul class="simple">
<li><p><strong>Stateless SIP Proxies</strong>: Kamailio instances maintain no state, enabling dynamic scaling</p></li>
<li><p><strong>Distributed Media Processing</strong>: RTPEngine handles all media transcoding and routing</p></li>
<li><p><strong>Separated Concerns</strong>: Signaling (Kamailio) and media (RTPEngine, Asterisk) are independent</p></li>
<li><p><strong>Zero-Downtime</strong>: Load balancer redirects traffic when instances fail</p></li>
<li><p><strong>Horizontal Scaling</strong>: Add more instances of any component to handle increased load</p></li>
</ul>
<p><strong>Traffic Flow:</strong></p>
<ol class="arabic simple">
<li><p><strong>SIP Signaling</strong>: Load balancer distributes SIP traffic to Kamailio instances</p></li>
<li><p><strong>Call Routing</strong>: Kamailio routes signaling to appropriate Asterisk instance</p></li>
<li><p><strong>Media Setup</strong>: RTPEngine handles RTP media streams and transcoding</p></li>
<li><p><strong>Call Control</strong>: Asterisk manages call state and conference bridges</p></li>
</ol>
<p>This modular design ensures VoIPBIN can provide reliable, scalable VoIP services while accommodating high traffic loads.</p>
</section>
<section id="kamailio-sip-edge-router">
<h2>Kamailio - SIP Edge Router<a class="headerlink" href="#kamailio-sip-edge-router" title="Link to this heading"></a></h2>
<p>Kamailio is an open-source SIP server providing the edge routing layer for all SIP traffic.</p>
<ul class="simple">
<li><p><strong>Official Site</strong>: <a class="reference external" href="https://www.kamailio.org/">https://www.kamailio.org/</a></p></li>
</ul>
<p><strong>Role in VoIPBIN:</strong></p>
<p>Kamailio acts as the stateless SIP proxy and edge router, responsible for:</p>
<ul class="simple">
<li><p><strong>SIP Routing</strong>: Forwarding SIP messages to appropriate backend services</p></li>
<li><p><strong>Load Distribution</strong>: Balancing traffic across Asterisk instances</p></li>
<li><p><strong>Authentication</strong>: Validating SIP registration credentials</p></li>
<li><p><strong>Protocol Handling</strong>: Managing SIP message parsing and routing</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Stateless</span> <span class="n">Operation</span><span class="p">:</span>

<span class="n">Client</span>          <span class="n">Kamailio</span><span class="o">-</span><span class="mi">1</span>        <span class="n">Kamailio</span><span class="o">-</span><span class="mi">2</span>        <span class="n">Asterisk</span>
  <span class="o">|</span>                 <span class="o">|</span>                 <span class="o">|</span>                 <span class="o">|</span>
  <span class="o">|</span> <span class="n">INVITE</span>          <span class="o">|</span>                 <span class="o">|</span>                 <span class="o">|</span>
  <span class="o">+----------------&gt;|</span>                 <span class="o">|</span>                 <span class="o">|</span>
  <span class="o">|</span>                 <span class="o">|</span> <span class="n">Forward</span>         <span class="o">|</span>                 <span class="o">|</span>
  <span class="o">|</span>                 <span class="o">+----------------------------------&gt;|</span>
  <span class="o">|</span>                 <span class="o">|</span>                 <span class="o">|</span>                 <span class="o">|</span>
  <span class="o">|</span>                 <span class="o">|</span>                 <span class="o">|</span>                 <span class="o">|</span>
  <span class="o">|</span> <span class="mi">200</span> <span class="n">OK</span>          <span class="o">|</span>                 <span class="o">|</span>                 <span class="o">|</span>
  <span class="o">|&lt;----------------+-----------------------------------+</span>
  <span class="o">|</span>                 <span class="o">|</span>                 <span class="o">|</span>                 <span class="o">|</span>
  <span class="o">|</span> <span class="n">ACK</span>             <span class="o">|</span>                 <span class="o">|</span>                 <span class="o">|</span>
  <span class="o">+----------------------------------&gt;|</span>                 <span class="o">|</span>
  <span class="o">|</span>                 <span class="o">|</span>                 <span class="o">|</span> <span class="n">Forward</span>         <span class="o">|</span>
  <span class="o">|</span>                 <span class="o">|</span>                 <span class="o">+----------------&gt;|</span>
  <span class="o">|</span>                 <span class="o">|</span>                 <span class="o">|</span>                 <span class="o">|</span>

<span class="n">Note</span><span class="p">:</span> <span class="n">Different</span> <span class="n">Kamailio</span> <span class="n">instances</span> <span class="n">handle</span> <span class="n">different</span> <span class="n">messages</span>
      <span class="ow">in</span> <span class="n">the</span> <span class="n">same</span> <span class="n">call</span> <span class="p">(</span><span class="n">stateless</span> <span class="n">operation</span><span class="p">)</span>
</pre></div>
</div>
<img alt="Architecture Kamailio" src="_images/architecture_rtc_kamailio.png" />
<p><strong>Key Features:</strong></p>
<ul class="simple">
<li><p><strong>Load Balancing</strong>: Distributes incoming SIP traffic across multiple instances</p></li>
<li><p><strong>Stateless Operation</strong>: No state maintained, enabling dynamic scaling and failover</p></li>
<li><p><strong>High Availability</strong>: Instances can be added or removed without affecting ongoing calls</p></li>
<li><p><strong>Fast Performance</strong>: C-based implementation with minimal overhead</p></li>
</ul>
<p><strong>Stateless Benefits:</strong></p>
<p>In the diagram above, Kamailio receives initial SIP traffic from the client and forwards it to Asterisk. However, subsequent SIP messages in the same call may go to different Kamailio instances. This stateless design allows for:</p>
<ul class="simple">
<li><p>Instant failover without session loss</p></li>
<li><p>Dynamic scaling without coordination</p></li>
<li><p>Simplified operations and deployment</p></li>
</ul>
</section>
<section id="asterisk-media-and-call-processing">
<h2>Asterisk - Media and Call Processing<a class="headerlink" href="#asterisk-media-and-call-processing" title="Link to this heading"></a></h2>
<p>Asterisk is an open-source communications platform providing comprehensive telephony services.</p>
<img alt="Architecture Asterisk" src="_images/architecture_rtc_asterisk.png" />
<p><strong>VoIPBIN’s Three Asterisk Farms:</strong></p>
<p>VoIPBIN employs three specialized Asterisk farms for optimized scalability and fault isolation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Asterisk</span> <span class="n">Farm</span> <span class="n">Architecture</span><span class="p">:</span>

<span class="o">+---------------------------------------------------------+</span>
<span class="o">|</span>                  <span class="n">Kamailio</span> <span class="n">Farm</span>                          <span class="o">|</span>
<span class="o">+------+-------------------------------------+------------+</span>
       <span class="o">|</span>                                     <span class="o">|</span>
       <span class="o">|</span> <span class="n">All</span> <span class="n">Calls</span>                           <span class="o">|</span> <span class="n">Registrations</span>
       <span class="n">v</span>                 <span class="n">Conferences</span>         <span class="n">v</span>
<span class="o">+-------------+</span>    <span class="o">+-------------+</span>    <span class="o">+-------------+</span>
<span class="o">|</span>  <span class="n">Asterisk</span>   <span class="o">|</span>    <span class="o">|</span>  <span class="n">Asterisk</span>   <span class="o">|</span>    <span class="o">|</span>  <span class="n">Asterisk</span>   <span class="o">|</span>
<span class="o">|</span>    <span class="n">Call</span>     <span class="o">|</span>    <span class="o">|</span> <span class="n">Conference</span>  <span class="o">|</span>    <span class="o">|</span>  <span class="n">Registrar</span>  <span class="o">|</span>
<span class="o">|</span>   <span class="n">Farm</span>      <span class="o">|</span>    <span class="o">|</span>    <span class="n">Farm</span>     <span class="o">|</span>    <span class="o">|</span>    <span class="n">Farm</span>     <span class="o">|</span>
<span class="o">|</span>             <span class="o">|---&gt;|</span>             <span class="o">|</span>    <span class="o">|</span>             <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span> <span class="n">calls</span> <span class="o">|</span>    <span class="o">|</span> <span class="n">o</span> <span class="n">N</span><span class="o">-</span><span class="n">way</span>     <span class="o">|</span>    <span class="o">|</span> <span class="n">o</span> <span class="n">SIP</span>       <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Call</span>      <span class="o">|</span>    <span class="o">|</span>   <span class="n">conference</span><span class="o">|</span>    <span class="o">|</span>   <span class="n">REGISTER</span>  <span class="o">|</span>
<span class="o">|</span>   <span class="n">bridging</span>  <span class="o">|</span>    <span class="o">|</span> <span class="n">o</span> <span class="n">Mixing</span>    <span class="o">|</span>    <span class="o">|</span> <span class="n">o</span> <span class="n">Auth</span>      <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Transfers</span> <span class="o">|</span>    <span class="o">|</span> <span class="n">o</span> <span class="n">Recording</span> <span class="o">|</span>    <span class="o">|</span> <span class="n">o</span> <span class="n">Presence</span>  <span class="o">|</span>
<span class="o">+-------------+</span>    <span class="o">+-------------+</span>    <span class="o">+-------------+</span>
</pre></div>
</div>
<p><strong>1. Asterisk-Call Farm</strong></p>
<p>Handles 1:1 call processing:</p>
<ul class="simple">
<li><p>Call setup and teardown</p></li>
<li><p>Media bridging between two parties</p></li>
<li><p>Call transfers and forwarding</p></li>
<li><p>DTMF processing</p></li>
<li><p>Call recording</p></li>
</ul>
<p><strong>2. Asterisk-Conference Farm</strong></p>
<p>Manages multi-party conference calls:</p>
<ul class="simple">
<li><p>Conference bridge creation and management</p></li>
<li><p>Participant mixing (up to hundreds of participants)</p></li>
<li><p>Conference recording</p></li>
<li><p>Participant management (mute, kick, etc.)</p></li>
<li><p>Audio/video conferencing</p></li>
</ul>
<p><strong>3. Asterisk-Registrar Farm</strong></p>
<p>Handles SIP registration:</p>
<ul class="simple">
<li><p>User authentication</p></li>
<li><p>Registration lifecycle management</p></li>
<li><p>Presence information</p></li>
<li><p>Contact database</p></li>
</ul>
<p><strong>Farm Benefits:</strong></p>
<ul class="simple">
<li><p><strong>Independent Scaling</strong>: Scale each farm based on specific load patterns</p></li>
<li><p><strong>Fault Isolation</strong>: Issues in one farm don’t affect others</p></li>
<li><p><strong>Optimized Configuration</strong>: Each farm can be tuned for its specific workload</p></li>
<li><p><strong>Targeted Upgrades</strong>: Update farms independently without full system downtime</p></li>
</ul>
<p><strong>Inter-Farm Communication:</strong></p>
<p>While farms operate independently, Asterisk-Call and Asterisk-Conference communicate when bridging calls into conference sessions, enabling seamless transitions from 1:1 calls to conferences.</p>
</section>
<section id="rtpengine-media-proxy-and-transcoding">
<h2>RTPEngine - Media Proxy and Transcoding<a class="headerlink" href="#rtpengine-media-proxy-and-transcoding" title="Link to this heading"></a></h2>
<p>RTPEngine is an open-source media proxy providing RTP processing and transcoding capabilities.</p>
<img alt="Architecture RTPEngine" src="_images/architecture_rtc_rtpengine.png" />
<p><strong>Role in VoIPBIN:</strong></p>
<p>RTPEngine serves as the codec edge server and media proxy:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Codec</span> <span class="n">Transcoding</span><span class="p">:</span>

<span class="n">External</span> <span class="n">Client</span>                      <span class="n">VoIPBIN</span> <span class="n">Internal</span>
<span class="p">(</span><span class="n">Various</span> <span class="n">Codecs</span><span class="p">)</span>                     <span class="p">(</span><span class="n">ulaw</span> <span class="n">only</span><span class="p">)</span>
     <span class="o">|</span>                                     <span class="o">|</span>
     <span class="o">|</span> <span class="n">RTP</span> <span class="p">(</span><span class="n">G</span><span class="mf">.722</span><span class="p">,</span> <span class="n">Opus</span><span class="p">,</span> <span class="n">etc</span><span class="o">.</span><span class="p">)</span>             <span class="o">|</span>
     <span class="n">v</span>                                     <span class="n">v</span>
<span class="o">+---------------------------------------------+</span>
<span class="o">|</span>            <span class="n">RTPEngine</span> <span class="n">Farm</span>                   <span class="o">|</span>
<span class="o">|</span>                                             <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="n">Transcode</span> <span class="n">external</span> <span class="o">-&gt;</span> <span class="n">ulaw</span> <span class="p">(</span><span class="n">internal</span><span class="p">)</span>    <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="n">Transcode</span> <span class="n">ulaw</span> <span class="p">(</span><span class="n">internal</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">external</span>    <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="n">NAT</span> <span class="n">traversal</span>                            <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="n">Packet</span> <span class="n">switching</span>                         <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="n">SRTP</span><span class="o">/</span><span class="n">RTP</span> <span class="n">conversion</span>                      <span class="o">|</span>
<span class="o">+------------------+--------------------------+</span>
                   <span class="o">|</span>
                   <span class="o">|</span> <span class="n">RTP</span> <span class="p">(</span><span class="n">ulaw</span><span class="p">)</span>
                   <span class="n">v</span>
               <span class="n">Asterisk</span> <span class="n">Farm</span>
</pre></div>
</div>
<p><strong>Responsibilities:</strong></p>
<ul class="simple">
<li><p><strong>Codec Transcoding</strong>: Convert between external codecs and internal ulaw</p></li>
<li><p><strong>NAT Traversal</strong>: Handle media through NAT and firewalls</p></li>
<li><p><strong>SRTP Support</strong>: Encrypt/decrypt media streams</p></li>
<li><p><strong>Packet Routing</strong>: Efficient RTP packet switching</p></li>
<li><p><strong>Load Distribution</strong>: Distribute media processing across instances</p></li>
</ul>
<p><strong>Internal Codec Strategy:</strong></p>
<ul class="simple">
<li><p><strong>Internal</strong>: VoIPBIN uses ulaw codec exclusively for all internal communication</p></li>
<li><p><strong>External</strong>: Clients can use any supported codec (G.711, G.722, Opus, etc.)</p></li>
<li><p><strong>Edge Transcoding</strong>: RTPEngine performs all transcoding at the edge</p></li>
<li><p><strong>Performance</strong>: Internal ulaw ensures minimal CPU overhead for media processing</p></li>
</ul>
<p>This edge transcoding strategy ensures optimal internal performance while supporting diverse client codecs.</p>
</section>
<section id="conference-architecture">
<h2>Conference Architecture<a class="headerlink" href="#conference-architecture" title="Link to this heading"></a></h2>
<p>VoIPBIN’s conference functionality is powered by the dedicated Asterisk-Conference farm.</p>
<img alt="Architecture Conference" src="_images/architecture_rtc_conference.png" />
<p><strong>Conference Design:</strong></p>
<p>VoIPBIN leverages a dedicated Asterisk-Conference component for all conference calls:</p>
<p><strong>Advantages:</strong></p>
<ul class="simple">
<li><p><strong>Isolation and Scalability</strong>: Conference processing separated from regular calls ensures stable service</p></li>
<li><p><strong>Independent Scaling</strong>: Conference farm scales based on conferencing usage patterns</p></li>
<li><p><strong>Centralized Management</strong>: All conference operations managed in one place</p></li>
<li><p><strong>Fault Isolation</strong>: Conference issues don’t impact regular call processing</p></li>
</ul>
<section id="conference-flow">
<h3>Conference Flow<a class="headerlink" href="#conference-flow" title="Link to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Conference</span> <span class="n">Lifecycle</span><span class="p">:</span>

<span class="n">Flow</span> <span class="n">Manager</span>       <span class="n">Asterisk</span><span class="o">-</span><span class="n">Conf</span>      <span class="n">Conference</span> <span class="n">Bridge</span>
     <span class="o">|</span>                  <span class="o">|</span>                    <span class="o">|</span>
     <span class="o">|</span> <span class="mf">1.</span> <span class="n">Create</span> <span class="n">Conf</span>   <span class="o">|</span>                    <span class="o">|</span>
     <span class="o">+-----------------&gt;|</span>                    <span class="o">|</span>
     <span class="o">|</span>                  <span class="o">|</span> <span class="mf">2.</span> <span class="n">Create</span> <span class="n">Bridge</span>   <span class="o">|</span>
     <span class="o">|</span>                  <span class="o">+-------------------&gt;|</span>
     <span class="o">|</span>                  <span class="o">|</span>                    <span class="o">|</span>
     <span class="o">|</span> <span class="mf">3.</span> <span class="n">Add</span> <span class="n">Part</span><span class="o">.</span> <span class="mi">1</span>   <span class="o">|</span>                    <span class="o">|</span>
     <span class="o">+-----------------&gt;|</span> <span class="mf">4.</span> <span class="n">Join</span> <span class="n">Bridge</span>     <span class="o">|</span>
     <span class="o">|</span>                  <span class="o">+-------------------&gt;|</span>
     <span class="o">|</span>                  <span class="o">|</span>                    <span class="o">|</span>
     <span class="o">|</span> <span class="mf">5.</span> <span class="n">Add</span> <span class="n">Part</span><span class="o">.</span> <span class="mi">2</span>   <span class="o">|</span>                    <span class="o">|</span>
     <span class="o">+-----------------&gt;|</span> <span class="mf">6.</span> <span class="n">Join</span> <span class="n">Bridge</span>     <span class="o">|</span>
     <span class="o">|</span>                  <span class="o">+-------------------&gt;|</span>
     <span class="o">|</span>                  <span class="o">|</span>                    <span class="o">|</span>
     <span class="o">|</span>                  <span class="o">|</span>  <span class="p">[</span><span class="n">Audio</span> <span class="n">Mixing</span><span class="p">]</span>    <span class="o">|</span>
     <span class="o">|</span>                  <span class="o">|&lt;------------------&gt;|</span>
     <span class="o">|</span>                  <span class="o">|</span>                    <span class="o">|</span>
     <span class="o">|</span> <span class="mf">7.</span> <span class="n">End</span> <span class="n">Conf</span>      <span class="o">|</span>                    <span class="o">|</span>
     <span class="o">+-----------------&gt;|</span> <span class="mf">8.</span> <span class="n">Destroy</span> <span class="n">Bridge</span>  <span class="o">|</span>
     <span class="o">|</span>                  <span class="o">+-------------------&gt;|</span>
     <span class="o">|</span>                  <span class="o">|</span>                    <span class="o">|</span>
</pre></div>
</div>
<p><strong>Conference Steps:</strong></p>
<ol class="arabic simple">
<li><p><strong>Call Initiation</strong>: Flow Manager requests conference creation (via “connect” or “conference_join” action)</p></li>
<li><p><strong>Conference Establishment</strong>: Asterisk-Conference creates dedicated bridge for participants</p></li>
<li><p><strong>Participant Joining</strong>: Participants added to bridge sequentially or simultaneously</p></li>
<li><p><strong>Conference Interaction</strong>: Participants communicate with voice/video, screen sharing, etc.</p></li>
<li><p><strong>Conference Termination</strong>: Bridge destroyed when conference ends or all participants leave</p></li>
</ol>
<p><strong>Conference Features:</strong></p>
<ul class="simple">
<li><p>Audio and video mixing</p></li>
<li><p>Recording capabilities</p></li>
<li><p>Dynamic participant management</p></li>
<li><p>Mute/unmute controls</p></li>
<li><p>Moderator capabilities</p></li>
<li><p>Entry/exit tones</p></li>
</ul>
</section>
<section id="calls-as-conferences">
<h3>1:1 Calls as Conferences<a class="headerlink" href="#calls-as-conferences" title="Link to this heading"></a></h3>
<p>VoIPBIN treats 1:1 calls as special cases of conferencing with only two participants:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span> <span class="n">Call</span> <span class="o">=</span> <span class="n">Conference</span> <span class="k">with</span> <span class="mi">2</span> <span class="n">Participants</span>

<span class="o">+--------------+</span>         <span class="o">+--------------+</span>
<span class="o">|</span> <span class="n">Participant</span> <span class="n">A</span><span class="o">|</span>         <span class="o">|</span> <span class="n">Participant</span> <span class="n">B</span><span class="o">|</span>
<span class="o">+------+-------+</span>         <span class="o">+------+-------+</span>
       <span class="o">|</span>                        <span class="o">|</span>
       <span class="o">|</span>    <span class="n">Conference</span> <span class="n">Bridge</span>   <span class="o">|</span>
       <span class="o">|</span>    <span class="p">(</span><span class="mi">2</span> <span class="n">participants</span><span class="p">)</span>    <span class="o">|</span>
       <span class="o">+-----------+------------+</span>
                   <span class="o">|</span>
              <span class="n">Asterisk</span><span class="o">-</span><span class="n">Call</span>
              <span class="p">(</span><span class="n">manages</span> <span class="n">bridge</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Benefits of Unified Approach:</strong></p>
<ul class="simple">
<li><p><strong>Simplified Development</strong>: Same infrastructure for 1:1 calls and conferences</p></li>
<li><p><strong>Enhanced Flexibility</strong>: Seamless transitions from 1:1 to multi-party conferences</p></li>
<li><p><strong>Improved Resource Utilization</strong>: Optimized resource allocation across all call types</p></li>
<li><p><strong>Consistent Features</strong>: Same feature set available for all call types</p></li>
<li><p><strong>Easier Maintenance</strong>: Single codebase for all call scenarios</p></li>
</ul>
<p><strong>Example Transition:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span> <span class="n">Call</span> <span class="o">-&gt;</span> <span class="n">Multi</span><span class="o">-</span><span class="n">Party</span> <span class="n">Conference</span><span class="p">:</span>

<span class="n">Initial</span> <span class="n">State</span><span class="p">:</span>         <span class="n">Add</span> <span class="mi">3</span><span class="n">rd</span> <span class="n">Party</span><span class="p">:</span>          <span class="n">Result</span><span class="p">:</span>
<span class="o">+-----+</span>  <span class="o">+-----+</span>      <span class="o">+-----+</span>  <span class="o">+-----+</span>      <span class="o">+-----+</span>  <span class="o">+-----+</span>
<span class="o">|</span>  <span class="n">A</span>  <span class="o">|--|</span>  <span class="n">B</span>  <span class="o">|</span>      <span class="o">|</span>  <span class="n">A</span>  <span class="o">|--|</span>  <span class="n">B</span>  <span class="o">|</span>      <span class="o">|</span>  <span class="n">A</span>  <span class="o">|--|</span>  <span class="n">B</span>  <span class="o">|</span>
<span class="o">+-----+</span>  <span class="o">+-----+</span>      <span class="o">+-----+</span>  <span class="o">+-----+</span>      <span class="o">+-----+</span>  <span class="o">+-----+</span>
                             <span class="o">|</span>                     <span class="o">|</span>
                             <span class="o">|</span>                     <span class="o">|</span>
                             <span class="n">v</span>                     <span class="n">v</span>
                          <span class="o">+-----+</span>               <span class="o">+-----+</span>
                          <span class="o">|</span>  <span class="n">C</span>  <span class="o">|</span>               <span class="o">|</span>  <span class="n">C</span>  <span class="o">|</span>
                          <span class="o">+-----+</span>               <span class="o">+-----+</span>

<span class="mi">2</span><span class="o">-</span><span class="n">participant</span> <span class="n">bridge</span>   <span class="n">Add</span> <span class="n">participant</span>      <span class="mi">3</span><span class="o">-</span><span class="n">participant</span> <span class="n">bridge</span>
<span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span> <span class="n">call</span><span class="p">)</span>            <span class="n">without</span> <span class="n">disruption</span>    <span class="p">(</span><span class="n">conference</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="sip-session-recovery">
<h2>SIP Session Recovery<a class="headerlink" href="#sip-session-recovery" title="Link to this heading"></a></h2>
<p>VoIPBIN provides <strong>SIP session recovery</strong> to maintain active SIP sessions even when an Asterisk instance crashes unexpectedly. This feature prevents call drops, conference exits, and media failures by making the client perceive the session as uninterrupted.</p>
<div class="video_wrapper" style="">
<iframe allowfullscreen="true" src="https://www.youtube.com/embed/GMd-pOwyrtA" style="border: 0; height: 345px; width: 560px">
</iframe></div><section id="how-it-works">
<h3>How It Works<a class="headerlink" href="#how-it-works" title="Link to this heading"></a></h3>
<p>When an Asterisk instance crashes, all SIP sessions managed by that instance disappear immediately. Without a BYE message, clients experience unexpected termination. VoIPBIN recovers sessions through an automated process:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Session</span> <span class="n">Recovery</span> <span class="n">Flow</span><span class="p">:</span>

<span class="n">Asterisk</span><span class="o">-</span><span class="mi">1</span>     <span class="n">Client</span>       <span class="n">Sentinel</span>    <span class="n">Call</span><span class="o">-</span><span class="n">manager</span>  <span class="n">HOMER</span> <span class="n">DB</span>    <span class="n">Asterisk</span><span class="o">-</span><span class="mi">2</span>
    <span class="o">|</span>             <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span>         <span class="o">|</span>            <span class="o">|</span>
    <span class="o">|</span>   <span class="n">Active</span>    <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span>         <span class="o">|</span>            <span class="o">|</span>
    <span class="o">|</span>   <span class="n">Session</span>   <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span>         <span class="o">|</span>            <span class="o">|</span>
    <span class="o">|&lt;-----------&gt;|</span>             <span class="o">|</span>              <span class="o">|</span>         <span class="o">|</span>            <span class="o">|</span>
    <span class="o">|</span>             <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span>         <span class="o">|</span>            <span class="o">|</span>
    <span class="n">X</span>  <span class="n">CRASH</span>      <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span>         <span class="o">|</span>            <span class="o">|</span>
                  <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span>         <span class="o">|</span>            <span class="o">|</span>
                  <span class="o">|</span>          <span class="n">Detect</span> <span class="n">Crash</span>      <span class="o">|</span>         <span class="o">|</span>            <span class="o">|</span>
                  <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span>         <span class="o">|</span>            <span class="o">|</span>
                  <span class="o">|</span>     <span class="n">Publish</span> <span class="n">Crash</span> <span class="n">event</span>    <span class="o">|</span>         <span class="o">|</span>            <span class="o">|</span>
                  <span class="o">|</span>             <span class="o">+-------------&gt;|</span>         <span class="o">|</span>            <span class="o">|</span>
                  <span class="o">|</span>                       <span class="n">Query</span> <span class="n">Sessions</span> <span class="o">|</span>            <span class="o">|</span>
                  <span class="o">|</span>                      <span class="n">Get</span> <span class="n">SIP</span> <span class="n">Headers</span> <span class="o">|</span>            <span class="o">|</span>
                  <span class="o">|</span>                            <span class="o">|&lt;--------+</span>            <span class="o">|</span>
                  <span class="o">|</span>                            <span class="o">|</span>                      <span class="o">|</span>
                  <span class="o">|</span>                   <span class="n">Create</span> <span class="n">Channels</span>                 <span class="o">|</span>
                  <span class="o">|</span>                            <span class="o">+---------------------&gt;|</span>
                  <span class="o">|</span>                                                   <span class="o">|</span>
                  <span class="o">|</span>                                                   <span class="o">|</span>
                  <span class="o">|</span>                                                   <span class="o">|</span>
                  <span class="o">|</span>          <span class="n">Send</span> <span class="n">Recovery</span> <span class="n">INVITE</span>                     <span class="o">|</span>
                  <span class="o">|&lt;--------------------------------------------------+</span>
                  <span class="o">|</span>                                                   <span class="o">|</span>
                  <span class="o">|</span>   <span class="mi">200</span> <span class="n">OK</span> <span class="p">(</span><span class="n">same</span> <span class="n">Call</span><span class="o">-</span><span class="n">ID</span><span class="p">)</span>                           <span class="o">|</span>
                  <span class="o">+--------------------------------------------------&gt;|</span>
                  <span class="o">|</span>                                                   <span class="o">|</span>
        <span class="n">Session</span>   <span class="o">|</span>                                                   <span class="o">|</span>
       <span class="n">Recovered</span>  <span class="o">|</span>                                                   <span class="o">|</span>
                  <span class="o">|&lt;-------------------------------------------------&gt;|</span>
</pre></div>
</div>
<img alt="SIP Session Recovery Flow" src="_images/architecture_rtc_sip_session_recovery_flow.png" />
</section>
<section id="detailed-steps">
<h3>Detailed Steps<a class="headerlink" href="#detailed-steps" title="Link to this heading"></a></h3>
<p><strong>1. Crash Detection</strong></p>
<p>The <cite>sentinel-manager</cite> quickly detects abnormal termination of an Asterisk instance.</p>
<p><strong>2. Session Lookup</strong></p>
<p>The internal database is queried to retrieve all active sessions from the failed instance.</p>
<p><strong>3. SIP Field Collection (via HOMER)</strong></p>
<p>The HOMER SIP capture API provides SIP header information:</p>
<ul class="simple">
<li><p>Call-ID</p></li>
<li><p>From/To headers and tags</p></li>
<li><p>Route headers</p></li>
<li><p>CSeq values</p></li>
<li><p>Other SIP state information</p></li>
</ul>
<p><strong>4. Create SIP Channels on Another Asterisk</strong></p>
<p>A healthy Asterisk instance is selected and new SIP channels are created with original session information.</p>
<p><strong>5. Set Recovery Channel Variables</strong></p>
<p>Channel variables are set to ensure the new INVITE appears as continuation:</p>
<ul class="simple">
<li><p>PJSIP_RECOVERY_FROM_DISPLAY</p></li>
<li><p>PJSIP_RECOVERY_FROM_URI</p></li>
<li><p>PJSIP_RECOVERY_FROM_TAG</p></li>
<li><p>PJSIP_RECOVERY_TO_DISPLAY</p></li>
<li><p>PJSIP_RECOVERY_TO_URI</p></li>
<li><p>PJSIP_RECOVERY_TO_TAG</p></li>
<li><p>Call-ID, CSeq, Routes (preserved from original session)</p></li>
</ul>
<p><strong>6. Send Recovery INVITE</strong></p>
<p>The INVITE reuses the original Call-ID and tags, so the client interprets it as a re-INVITE within the existing session.</p>
<p><strong>7. Restore RTP and SIP Sessions</strong></p>
<p>Signaling and media are fully re-established, restoring the call to its previous state.</p>
<p><strong>8. Resume Flow Execution</strong></p>
<p>The recovered session resumes Flow execution from before the crash:</p>
<ul class="simple">
<li><p><strong>Active Calls</strong>: Conversation continues without interruption</p></li>
<li><p><strong>Conferences</strong>: User reconnected to same conference bridge</p></li>
<li><p><strong>Call State</strong>: All call variables and state restored</p></li>
</ul>
</section>
<section id="asterisk-patch-for-recovery">
<h3>Asterisk Patch for Recovery<a class="headerlink" href="#asterisk-patch-for-recovery" title="Link to this heading"></a></h3>
<p>VoIPBIN patches Asterisk’s PJSIP stack to override SIP header fields based on channel variables:</p>
<img alt="SIP Session Recovery Diagram" src="_images/architecture_rtc_sip_session_recovery_diagram.png" />
<p><strong>Patch Implementation:</strong></p>
<p>This patch allows a newly created SIP channel to impersonate the original one, making the recovery INVITE appear as a legitimate continuation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Extract</span> <span class="n">recovery</span> <span class="n">variables</span> <span class="kn">from</span> <span class="nn">channel</span>
<span class="n">val_from_display_c_str</span> <span class="o">=</span> <span class="n">pbx_builtin_getvar_helper</span><span class="p">(</span><span class="n">session</span><span class="o">-&gt;</span><span class="n">channel</span><span class="p">,</span> <span class="s2">&quot;PJSIP_RECOVERY_FROM_DISPLAY&quot;</span><span class="p">);</span>
<span class="n">val_from_uri_c_str</span>     <span class="o">=</span> <span class="n">pbx_builtin_getvar_helper</span><span class="p">(</span><span class="n">session</span><span class="o">-&gt;</span><span class="n">channel</span><span class="p">,</span> <span class="s2">&quot;PJSIP_RECOVERY_FROM_URI&quot;</span><span class="p">);</span>
<span class="n">val_from_tag_c_str</span>     <span class="o">=</span> <span class="n">pbx_builtin_getvar_helper</span><span class="p">(</span><span class="n">session</span><span class="o">-&gt;</span><span class="n">channel</span><span class="p">,</span> <span class="s2">&quot;PJSIP_RECOVERY_FROM_TAG&quot;</span><span class="p">);</span>

<span class="n">val_to_display_c_str</span>   <span class="o">=</span> <span class="n">pbx_builtin_getvar_helper</span><span class="p">(</span><span class="n">session</span><span class="o">-&gt;</span><span class="n">channel</span><span class="p">,</span> <span class="s2">&quot;PJSIP_RECOVERY_TO_DISPLAY&quot;</span><span class="p">);</span>
<span class="n">val_to_uri_c_str</span>       <span class="o">=</span> <span class="n">pbx_builtin_getvar_helper</span><span class="p">(</span><span class="n">session</span><span class="o">-&gt;</span><span class="n">channel</span><span class="p">,</span> <span class="s2">&quot;PJSIP_RECOVERY_TO_URI&quot;</span><span class="p">);</span>
<span class="n">val_to_tag_c_str</span>       <span class="o">=</span> <span class="n">pbx_builtin_getvar_helper</span><span class="p">(</span><span class="n">session</span><span class="o">-&gt;</span><span class="n">channel</span><span class="p">,</span> <span class="s2">&quot;PJSIP_RECOVERY_TO_TAG&quot;</span><span class="p">);</span>

<span class="o">//</span> <span class="n">Call</span><span class="o">-</span><span class="n">ID</span><span class="p">,</span> <span class="n">CSeq</span><span class="p">,</span> <span class="n">Routes</span><span class="p">,</span> <span class="ow">and</span> <span class="n">other</span> <span class="n">headers</span> <span class="n">are</span> <span class="n">handled</span> <span class="n">similarly</span>
<span class="o">//</span> <span class="n">Override</span> <span class="n">PJSIP</span> <span class="n">headers</span> <span class="k">with</span> <span class="n">recovery</span> <span class="n">values</span>
</pre></div>
</div>
<p><strong>Full Patch:</strong></p>
<p>The complete implementation is available on GitHub:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/voipbin/etc/blob/main/asterisk/add_pjsip_recovery.patch">https://github.com/voipbin/etc/blob/main/asterisk/add_pjsip_recovery.patch</a></p></li>
</ul>
<p><strong>Recovery Guarantees:</strong></p>
<ul class="simple">
<li><p><strong>Transparent to Client</strong>: Client sees normal re-INVITE, no indication of crash</p></li>
<li><p><strong>State Preservation</strong>: All call state and variables restored</p></li>
<li><p><strong>Media Continuity</strong>: Audio/video streams resume without gaps</p></li>
<li><p><strong>Flow Continuity</strong>: Call flow resumes at exact point before crash</p></li>
</ul>
</section>
</section>
</section>

</main>
                        
                    </div>
                    
                    <nav class="col-12 col-lg-3 pb-4">
                        <div class="sticky-top toc page-toc" aria-labelledby="page-toc-heading">
                            <p class="font-weight-bold" id="page-toc-heading">Page contents</p>
                            <ul>
<li><a class="reference internal" href="#">Real-Time Communication (RTC)</a><ul>
<li><a class="reference internal" href="#voip-stack-overview">VoIP Stack Overview</a></li>
<li><a class="reference internal" href="#kamailio-sip-edge-router">Kamailio - SIP Edge Router</a></li>
<li><a class="reference internal" href="#asterisk-media-and-call-processing">Asterisk - Media and Call Processing</a></li>
<li><a class="reference internal" href="#rtpengine-media-proxy-and-transcoding">RTPEngine - Media Proxy and Transcoding</a></li>
<li><a class="reference internal" href="#conference-architecture">Conference Architecture</a><ul>
<li><a class="reference internal" href="#conference-flow">Conference Flow</a></li>
<li><a class="reference internal" href="#calls-as-conferences">1:1 Calls as Conferences</a></li>
</ul>
</li>
<li><a class="reference internal" href="#sip-session-recovery">SIP Session Recovery</a><ul>
<li><a class="reference internal" href="#how-it-works">How It Works</a></li>
<li><a class="reference internal" href="#detailed-steps">Detailed Steps</a></li>
<li><a class="reference internal" href="#asterisk-patch-for-recovery">Asterisk Patch for Recovery</a></li>
</ul>
</li>
</ul>
</li>
</ul>

                        </div>
                    </nav>
                    
                </div>
            </div>
        </div>
    </div>
    <footer class="container-fluid bg-primary text-light">
        <div class="container">
            <div class="row">
        <div class="col p-4">
            
                <nav aria-label="Footer">
                    <ul class="nav justify-content-center mb-2">
                        
                            
                            
                            <li class="nav-item"><a class="nav-link text-light"  href="http://voipbin.net">About Us</a></li>
                        
                            
                            
                            <li class="nav-item"><a class="nav-link text-light"  href="http://voipbin.net">Contact</a></li>
                        
                    </ul>
                </nav>
            
            <div class="text-center">
                    &copy; Copyright 2026, VoIPBIN
            </div>
            <div class="text-center text-white-50 font-italic mt-3">
                <small>
                    Created using
                    <a class="text-white" href="https://github.com/wagtail/sphinx_wagtail_theme" rel="nofollow" target="_blank">
                        Sphinx Wagtail Theme 6.5.0
                    </a>
                    and
                    <a class="text-white" href="https://www.sphinx-doc.org/" rel="nofollow" target="_blank">
                        Sphinx 7.2.6
                    </a>
                </small>
            </div>
        </div>
    </div>
        </div>
    </footer>
        <script src="_static/jquery.js?v=8dae8fb0"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=5929fcd5"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="_static/copybutton.js?v=f281be69"></script>
        <script type="text/javascript" src="_static/dist/theme.js"></script>
        <script type="text/javascript" src="_static/dist/vendor.js"></script>
        <script type="text/javascript" src="_static/searchtools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script type="text/javascript">
            document.addEventListener('DOMContentLoaded', function() { Search.loadIndex("searchindex.js"); });
        </script>
        <script type="text/javascript" id="searchindexloader"></script>
    </body>
</html>