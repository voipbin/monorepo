<!DOCTYPE html>
<html class="no-js" lang="en" data-content_root="./">
<head>
    <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
        <title>Architecture &mdash; voipbin  documentation</title>
    
    <link rel="stylesheet" type="text/css" href="_static/dist/fontawesome.css" />
      <link rel="stylesheet" type="text/css" href="_static/dist/theme.css?v=310cf088" />
      <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
            <link rel="index" title="Index" href="genindex.html" />
            <link rel="search" title="Search" href="search.html" />
            <link rel="top" title="voipbin  documentation" href="#" />
            <link rel="next" title="Websocket" href="websocket.html" />
            <link rel="prev" title="Trunk" href="trunk.html" />
    </head>
<body>
    <script type="text/javascript" src="_static/dist/blocking.js"></script>
    <header class="container-fluid bg-primary">
        <a class="btn btn-sm btn-light skip-to-content-link" href="#main">Skip to content</a>
        <div class="container-fluid">
            <div class="navbar navbar-expand-lg navbar-dark font-weight-bold">
                    <a href="intro.html"
                        title="voipbin"
                        class="logo navbar-brand"
                    >
                        <img src="_static/images/voipbin-high-resolution-logo-white-transparent.png" width="45" height="80" alt="voipbin"
                            class="logo-img"
                        />
                        VoIPBin Documentation
                    </a>
                
                
                    <div class="collapse navbar-collapse justify-content-end">
                        <ul class="navbar-nav">
                            
                                
                                
                                <li class="nav-item"><a class="nav-link"  href="http://voipbin.net">Project</a></li>
                            
                                
                                
                                <li class="nav-item"><a class="nav-link"  href="https://admin.voipbin.net">Admin</a></li>
                            
                        </ul>
                    </div>
                
                <button class="navbar-toggler btn btn-primary d-lg-none" type="button" data-toggle="collapse" data-target="#collapseSidebar" aria-expanded="false" aria-controls="collapseExample">
                    <span class="navbar-toggler-icon"></span>
                    <span class="sr-only">menu</span>
                </button>
            </div>
        </div>
    </header>
    <div class="container-fluid">
        <div class="row">
            <aside class="col-12 col-lg-3 sidebar-container">
                <div id="collapseSidebar" class="collapse sticky-top d-lg-block pt-5 pr-lg-4">
<div id="searchbox" class="searchbox mb-6 px-1" role="search">
    <form id="search-form" action="search.html" autocomplete="off" method="get" role="search">
        <div class="input-group">
            <div class="input-group-prepend">
                <div class="input-group-text border-right-0 bg-white py-3 pl-3 pr-2"><span class="fas fa-search"></span></div>
            </div>
            <input class="form-control py-3 pr-3 pl-1 h-100 border-left-0" type="search" name="q" placeholder="Search documentation" aria-label="Search documentation" id="searchinput" />
        </div>
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
    </form>
</div><div class="site-toc">
    <nav class="toc mt-3" aria-label="Main menu">
        <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="accesskey.html">Accesskey</a></li>
<li class="toctree-l1"><a class="reference internal" href="sdk.html">SDK(Software Development Kit)</a></li>
<li class="toctree-l1"><a class="reference internal" href="restful_api.html">RESTful API(Application Programming Interface)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Core Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="flow.html">Flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="flow.html#activeflow">Activeflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="variable.html">Variable</a></li>
<li class="toctree-l1"><a class="reference internal" href="webhook.html">Webhook</a></li>
<li class="toctree-l1"><a class="reference internal" href="common.html">Common</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Voice &amp; Real-Time</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="call.html">Call</a></li>
<li class="toctree-l1"><a class="reference internal" href="conference.html">Conference</a></li>
<li class="toctree-l1"><a class="reference internal" href="queue.html">Queue</a></li>
<li class="toctree-l1"><a class="reference internal" href="recording.html">Recording</a></li>
<li class="toctree-l1"><a class="reference internal" href="transcribe.html">Transcribe</a></li>
<li class="toctree-l1"><a class="reference internal" href="mediastream.html">Mediastream</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Messaging</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="message.html">Message</a></li>
<li class="toctree-l1"><a class="reference internal" href="email.html">Email</a></li>
<li class="toctree-l1"><a class="reference internal" href="talk.html">Talk</a></li>
<li class="toctree-l1"><a class="reference internal" href="conversation.html">Conversation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">AI &amp; Automation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="ai.html">AI</a></li>
<li class="toctree-l1"><a class="reference internal" href="campaign.html">Campaign</a></li>
<li class="toctree-l1"><a class="reference internal" href="outdial.html">Outdial</a></li>
<li class="toctree-l1"><a class="reference internal" href="outplan.html">Outplan</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Resources &amp; Management</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="number.html">Number</a></li>
<li class="toctree-l1"><a class="reference internal" href="agent.html">Agent</a></li>
<li class="toctree-l1"><a class="reference internal" href="customer.html">Customer</a></li>
<li class="toctree-l1"><a class="reference internal" href="billing_account.html">Billing Account</a></li>
<li class="toctree-l1"><a class="reference internal" href="storage.html">Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="tag.html">Tag</a></li>
<li class="toctree-l1"><a class="reference internal" href="provider.html">Provider</a></li>
<li class="toctree-l1"><a class="reference internal" href="route.html">Route</a></li>
<li class="toctree-l1"><a class="reference internal" href="extension.html">Extension</a></li>
<li class="toctree-l1"><a class="reference internal" href="trunk.html">Trunk</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Architecture (Deep Dive)</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="websocket.html">Websocket</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Help &amp; Support</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="support.html">Support</a></li>
</ul>

    </nav>
    <template data-toggle-item-template>
        <button class="btn btn-sm btn-link toctree-expand" type="button">
            <span class="sr-only">Toggle menu contents</span>
        </button>
    </template>
</div>
                    <div class="d-lg-none border-bottom">
                        
                    </div>
                </div>
            </aside>
            <div class="col-12 col-lg-9 pt-5">
                <header class="row align-items-baseline">
                    <div class="col">
                        <nav aria-label="breadcrumb">
    <ol class="breadcrumb m-0 p-0 bg-transparent">
        <li class="breadcrumb-item"><a href="index.html">Docs</a></li>
        <li class="breadcrumb-item active" aria-current="page">Architecture</li>
    </ol>
</nav>
                    </div>
                    <div class="col-sm-12 col-lg-auto mt-3 mt-lg-3">
                        <noscript>
                            <p>JavaScript is required to toggle light/dark mode..</p>
                        </noscript>
                        <button id="wagtail-theme" class="btn btn-sm btn-light text-decoration-none" type="button">
                            <span class="dark-only"><i class="fas fa-sun"></i> Light mode</span>
                            <span class="light-only"><i class="fas fa-moon"></i> Dark mode</span>
                        </button>
    <a class="btn btn-sm btn-light text-decoration-none" href="_sources/architecture.rst.txt" rel="nofollow">
        <span class="btn-icon"><span class="fas fa-code"></span></span>
        <span class="btn-text">View source</span>
    </a>
                        
                    </div>
                </header>
                <div class="row" >
                    <div class="col-12">
                        <hr class="w-100 my-4">
                    </div>
                </div>
                <div class="row">
                    <div class="col-12 col-lg-9 order-last order-lg-first rst-content">
                        <main role="main" id="main">
    <section id="architecture">
<span id="architecture-main"></span><h1>Architecture<a class="headerlink" href="#architecture" title="Link to this heading"></a></h1>
<section id="overview">
<span id="architecture-overview"></span><h2>Overview<a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<p>VoIPBIN is a cloud-native Communication Platform as a Service (CPaaS) built on modern microservices architecture. The platform provides comprehensive communication capabilities including PSTN calls, WebRTC, SMS, conferencing, AI-powered features, and workflow orchestration.</p>
<p>VoIPBIN is designed from the ground up for scalability, reliability, and developer productivity, enabling businesses to build sophisticated communication solutions through simple API calls.</p>
<img alt="_images/architecture_overview_all.png" src="_images/architecture_overview_all.png" />
<section id="high-level-system-architecture">
<h3>High-Level System Architecture<a class="headerlink" href="#high-level-system-architecture" title="Link to this heading"></a></h3>
<p>VoIPBIN consists of three major architectural layers:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+----------------------------------------------------------------------+</span>
<span class="o">|</span>                      <span class="n">Client</span> <span class="n">Applications</span>                             <span class="o">|</span>
<span class="o">|</span>  <span class="p">(</span><span class="n">Web</span> <span class="n">Apps</span><span class="p">,</span> <span class="n">Mobile</span> <span class="n">Apps</span><span class="p">,</span> <span class="n">Server</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">Server</span> <span class="n">Integrations</span><span class="p">)</span>              <span class="o">|</span>
<span class="o">+------------------------+---------------------------------------------+</span>
                         <span class="o">|</span> <span class="n">HTTPS</span><span class="o">/</span><span class="n">REST</span> <span class="n">API</span>
                         <span class="n">v</span>
<span class="o">+----------------------------------------------------------------------+</span>
<span class="o">|</span>                     <span class="n">API</span> <span class="n">Gateway</span> <span class="n">Layer</span>                                <span class="o">|</span>
<span class="o">|</span>                    <span class="p">(</span><span class="nb">bin</span><span class="o">-</span><span class="n">api</span><span class="o">-</span><span class="n">manager</span><span class="p">)</span>                                 <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="n">Authentication</span> <span class="o">&amp;</span> <span class="n">Authorization</span>                                    <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="n">Rate</span> <span class="n">Limiting</span> <span class="o">&amp;</span> <span class="n">Throttling</span>                                        <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="n">Request</span> <span class="n">Routing</span> <span class="o">&amp;</span> <span class="n">Load</span> <span class="n">Balancing</span>                                  <span class="o">|</span>
<span class="o">+------------------------+---------------------------------------------+</span>
                         <span class="o">|</span> <span class="n">RabbitMQ</span> <span class="n">RPC</span>
                         <span class="n">v</span>
<span class="o">+----------------------------------------------------------------------+</span>
<span class="o">|</span>                  <span class="n">Microservices</span> <span class="n">Layer</span>                                 <span class="o">|</span>
<span class="o">|</span>  <span class="o">+--------------+</span>  <span class="o">+--------------+</span>  <span class="o">+--------------+</span>                <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span> <span class="n">Call</span> <span class="n">Manager</span> <span class="o">|</span>  <span class="o">|</span> <span class="n">Flow</span> <span class="n">Manager</span> <span class="o">|</span>  <span class="o">|</span>  <span class="n">AI</span> <span class="n">Manager</span>  <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span>  <span class="o">+--------------+</span>  <span class="o">+--------------+</span>  <span class="o">+--------------+</span>                <span class="o">|</span>
<span class="o">|</span>  <span class="o">+--------------+</span>  <span class="o">+--------------+</span>  <span class="o">+--------------+</span>                <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span><span class="n">Chat</span> <span class="n">Manager</span>  <span class="o">|</span>  <span class="o">|</span> <span class="n">SMS</span> <span class="n">Manager</span>  <span class="o">|</span>  <span class="o">|</span><span class="n">Queue</span> <span class="n">Manager</span> <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span>  <span class="o">+--------------+</span>  <span class="o">+--------------+</span>  <span class="o">+--------------+</span>                <span class="o">|</span>
<span class="o">|</span>  <span class="o">+--------------+</span>  <span class="o">+--------------+</span>  <span class="o">+--------------+</span>                <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span><span class="n">Agent</span> <span class="n">Manager</span> <span class="o">|</span>  <span class="o">|</span> <span class="n">Billing</span> <span class="n">Mgr</span>  <span class="o">|</span>  <span class="o">|</span><span class="n">Webhook</span> <span class="n">Mgr</span>   <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span>  <span class="o">+--------------+</span>  <span class="o">+--------------+</span>  <span class="o">+--------------+</span>                <span class="o">|</span>
<span class="o">|</span>                    <span class="o">...</span> <span class="mi">30</span><span class="o">+</span> <span class="n">services</span>                                  <span class="o">|</span>
<span class="o">+------------------------+---------------------------------------------+</span>
                         <span class="o">|</span>
                         <span class="n">v</span>
<span class="o">+----------------------------------------------------------------------+</span>
<span class="o">|</span>              <span class="n">Real</span><span class="o">-</span><span class="n">Time</span> <span class="n">Communication</span> <span class="n">Layer</span>                           <span class="o">|</span>
<span class="o">|</span>  <span class="o">+--------------+</span>  <span class="o">+--------------+</span>  <span class="o">+--------------+</span>                <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="n">Kamailio</span>    <span class="o">|</span>  <span class="o">|</span>   <span class="n">Asterisk</span>   <span class="o">|</span>  <span class="o">|</span>  <span class="n">RTPEngine</span>   <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span> <span class="p">(</span><span class="n">SIP</span> <span class="n">Proxy</span><span class="p">)</span>  <span class="o">|</span>  <span class="o">|</span><span class="p">(</span><span class="n">Media</span> <span class="n">Server</span><span class="p">)</span><span class="o">|</span>  <span class="o">|</span><span class="p">(</span><span class="n">Media</span> <span class="n">Proxy</span><span class="p">)</span> <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span>  <span class="o">+--------------+</span>  <span class="o">+--------------+</span>  <span class="o">+--------------+</span>                <span class="o">|</span>
<span class="o">+----------------------------------------------------------------------+</span>

<span class="o">+----------------------------------------------------------------------+</span>
<span class="o">|</span>                  <span class="n">Shared</span> <span class="n">Infrastructure</span>                               <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="n">MySQL</span> <span class="n">Database</span>  <span class="n">o</span> <span class="n">Redis</span> <span class="n">Cache</span>  <span class="n">o</span> <span class="n">RabbitMQ</span>  <span class="n">o</span> <span class="n">Kubernetes</span>           <span class="o">|</span>
<span class="o">+----------------------------------------------------------------------+</span>
</pre></div>
</div>
</section>
<section id="architectural-layers">
<h3>Architectural Layers<a class="headerlink" href="#architectural-layers" title="Link to this heading"></a></h3>
<p><strong>1. API Gateway Layer</strong></p>
<p>The API Gateway (bin-api-manager) serves as the single entry point for all external requests:</p>
<ul class="simple">
<li><p><strong>Authentication</strong>: JWT-based authentication for all API requests</p></li>
<li><p><strong>Authorization</strong>: Permission checks based on customer and agent roles</p></li>
<li><p><strong>Request Routing</strong>: Routes authenticated requests to appropriate backend services via RabbitMQ RPC</p></li>
<li><p><strong>Protocol Translation</strong>: Converts HTTP/REST to internal RabbitMQ messaging</p></li>
<li><p><strong>Response Aggregation</strong>: Collects responses from backend services and returns to clients</p></li>
</ul>
<p><strong>2. Microservices Layer</strong></p>
<p>VoIPBIN consists of 30+ specialized Go microservices, organized by domain:</p>
<p><strong>Communication Services:</strong>
* bin-call-manager: Call lifecycle and routing
* bin-conference-manager: Conference bridge management
* bin-sms-manager: SMS messaging
* bin-talk-manager: Real-time chat</p>
<p><strong>AI Services:</strong>
* bin-ai-manager: AI assistant, transcription, summarization
* bin-transcribe-manager: Speech-to-text processing
* bin-tts-manager: Text-to-speech synthesis</p>
<p><strong>Workflow Services:</strong>
* bin-flow-manager: Call flow orchestration and IVR
* bin-queue-manager: Call queue management
* bin-campaign-manager: Outbound campaign automation</p>
<p><strong>Management Services:</strong>
* bin-agent-manager: Agent state and presence
* bin-billing-manager: Usage tracking and billing
* bin-webhook-manager: Webhook delivery
* bin-storage-manager: File and media storage</p>
<p><strong>3. Real-Time Communication Layer</strong></p>
<p>See <a class="reference internal" href="architecture_rtc.html#architecture-rtc"><span class="std std-ref">RTC Architecture</span></a> for detailed information about the VoIP stack.</p>
</section>
<section id="core-design-principles">
<h3>Core Design Principles<a class="headerlink" href="#core-design-principles" title="Link to this heading"></a></h3>
<p>VoIPBIN is designed around these key architectural principles:</p>
<p><strong>Microservices Architecture</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Service</span> <span class="n">Isolation</span><span class="p">:</span>
<span class="o">+------------+</span>     <span class="o">+------------+</span>     <span class="o">+------------+</span>
<span class="o">|</span>  <span class="n">Service</span> <span class="n">A</span> <span class="o">|</span>     <span class="o">|</span>  <span class="n">Service</span> <span class="n">B</span> <span class="o">|</span>     <span class="o">|</span>  <span class="n">Service</span> <span class="n">C</span> <span class="o">|</span>
<span class="o">|</span>            <span class="o">|</span>     <span class="o">|</span>            <span class="o">|</span>     <span class="o">|</span>            <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="n">Domain</span>  <span class="o">|</span>     <span class="o">|</span>  <span class="n">o</span> <span class="n">Domain</span>  <span class="o">|</span>     <span class="o">|</span>  <span class="n">o</span> <span class="n">Domain</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="n">Logic</span>   <span class="o">|</span>     <span class="o">|</span>  <span class="n">o</span> <span class="n">Logic</span>   <span class="o">|</span>     <span class="o">|</span>  <span class="n">o</span> <span class="n">Logic</span>   <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="n">Data</span>    <span class="o">|</span>     <span class="o">|</span>  <span class="n">o</span> <span class="n">Data</span>    <span class="o">|</span>     <span class="o">|</span>  <span class="n">o</span> <span class="n">Data</span>    <span class="o">|</span>
<span class="o">+------+-----+</span>     <span class="o">+------+-----+</span>     <span class="o">+------+-----+</span>
       <span class="o">|</span>                  <span class="o">|</span>                  <span class="o">|</span>
       <span class="o">+------------------+------------------+</span>
                <span class="n">Message</span> <span class="n">Queue</span> <span class="p">(</span><span class="n">RabbitMQ</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Domain Isolation</strong>: Each service owns its domain logic and data</p></li>
<li><p><strong>Independent Deployment</strong>: Services can be deployed independently</p></li>
<li><p><strong>Technology Flexibility</strong>: Services can use different technologies as needed</p></li>
<li><p><strong>Fault Isolation</strong>: Failure in one service doesn’t cascade</p></li>
</ul>
<p><strong>Event-Driven Architecture</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Event</span> <span class="n">Flow</span><span class="p">:</span>
<span class="o">+--------------+</span>     <span class="n">Event</span>        <span class="o">+--------------+</span>
<span class="o">|</span>   <span class="n">Service</span>    <span class="o">|----------------&gt;</span> <span class="o">|</span>   <span class="n">Message</span>    <span class="o">|</span>
<span class="o">|</span>  <span class="p">(</span><span class="n">Publisher</span><span class="p">)</span> <span class="o">|</span>                  <span class="o">|</span>    <span class="n">Queue</span>     <span class="o">|</span>
<span class="o">+--------------+</span>                  <span class="o">+-------+------+</span>
                                          <span class="o">|</span>
                                          <span class="o">+----------------+</span>
                                          <span class="o">|</span>                <span class="o">|</span>
                                          <span class="n">v</span>                <span class="n">v</span>
                                 <span class="o">+------------+</span>   <span class="o">+------------+</span>
                                 <span class="o">|</span> <span class="n">Subscriber</span> <span class="o">|</span>   <span class="o">|</span> <span class="n">Subscriber</span> <span class="o">|</span>
                                 <span class="o">|</span> <span class="n">Service</span> <span class="n">A</span>  <span class="o">|</span>   <span class="o">|</span> <span class="n">Service</span> <span class="n">B</span>  <span class="o">|</span>
                                 <span class="o">+------------+</span>   <span class="o">+------------+</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Asynchronous Communication</strong>: Services communicate via events</p></li>
<li><p><strong>Loose Coupling</strong>: Publishers don’t know about subscribers</p></li>
<li><p><strong>Scalability</strong>: Multiple subscribers can process events in parallel</p></li>
<li><p><strong>Reliability</strong>: Message queues provide guaranteed delivery</p></li>
</ul>
<p><strong>API Gateway Pattern</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">External</span> <span class="n">Request</span> <span class="n">Flow</span><span class="p">:</span>

<span class="n">Client</span> <span class="n">App</span>                  <span class="n">API</span> <span class="n">Gateway</span>              <span class="n">Backend</span> <span class="n">Services</span>
    <span class="o">|</span>                           <span class="o">|</span>                           <span class="o">|</span>
    <span class="o">|</span>  <span class="n">HTTPS</span><span class="o">/</span><span class="n">REST</span>               <span class="o">|</span>                           <span class="o">|</span>
    <span class="o">+---------------------------&gt;</span>                           <span class="o">|</span>
    <span class="o">|</span>                           <span class="o">|</span>  <span class="mf">1.</span> <span class="n">Authenticate</span>          <span class="o">|</span>
    <span class="o">|</span>                           <span class="o">|</span>  <span class="mf">2.</span> <span class="n">Authorize</span>             <span class="o">|</span>
    <span class="o">|</span>                           <span class="o">|</span>  <span class="mf">3.</span> <span class="n">Route</span> <span class="n">Request</span>         <span class="o">|</span>
    <span class="o">|</span>                           <span class="o">|</span>                           <span class="o">|</span>
    <span class="o">|</span>                           <span class="o">|</span>  <span class="n">RabbitMQ</span> <span class="n">RPC</span>             <span class="o">|</span>
    <span class="o">|</span>                           <span class="o">+---------------------------&gt;</span>
    <span class="o">|</span>                           <span class="o">|</span>                           <span class="o">|</span>
    <span class="o">|</span>                           <span class="o">|</span>  <span class="n">Response</span>                 <span class="o">|</span>
    <span class="o">|</span>                           <span class="o">&lt;---------------------------+</span>
    <span class="o">|</span>  <span class="n">JSON</span> <span class="n">Response</span>            <span class="o">|</span>                           <span class="o">|</span>
    <span class="o">&lt;---------------------------+</span>                           <span class="o">|</span>
    <span class="o">|</span>                           <span class="o">|</span>                           <span class="o">|</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Single Entry Point</strong>: All external traffic goes through one gateway</p></li>
<li><p><strong>Security Layer</strong>: Authentication and authorization at the edge</p></li>
<li><p><strong>Protocol Translation</strong>: HTTP to internal messaging protocols</p></li>
<li><p><strong>Service Discovery</strong>: Gateway knows how to reach all services</p></li>
</ul>
<p><strong>Shared Data Layer</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Data</span> <span class="n">Architecture</span><span class="p">:</span>

<span class="o">+------------+</span>  <span class="o">+------------+</span>  <span class="o">+------------+</span>
<span class="o">|</span>  <span class="n">Service</span>   <span class="o">|</span>  <span class="o">|</span>  <span class="n">Service</span>   <span class="o">|</span>  <span class="o">|</span>  <span class="n">Service</span>   <span class="o">|</span>
<span class="o">|</span>      <span class="n">A</span>     <span class="o">|</span>  <span class="o">|</span>      <span class="n">B</span>     <span class="o">|</span>  <span class="o">|</span>      <span class="n">C</span>     <span class="o">|</span>
<span class="o">+------+-----+</span>  <span class="o">+-------+----+</span>  <span class="o">+--------+---+</span>
       <span class="o">|</span>                <span class="o">|</span>                <span class="o">|</span>
       <span class="o">+----------------+----------------+</span>
       <span class="o">|</span>                <span class="o">|</span>                <span class="o">|</span>
       <span class="n">v</span>                <span class="n">v</span>                <span class="n">v</span>
<span class="o">+-------------------------------------------+</span>
<span class="o">|</span>           <span class="n">Redis</span> <span class="n">Cache</span> <span class="p">(</span><span class="n">Hot</span> <span class="n">Data</span><span class="p">)</span>          <span class="o">|</span>
<span class="o">+-------------------------------------------+</span>
       <span class="n">v</span>                <span class="n">v</span>                <span class="n">v</span>
<span class="o">+-------------------------------------------+</span>
<span class="o">|</span>         <span class="n">MySQL</span> <span class="n">Database</span> <span class="p">(</span><span class="n">Cold</span> <span class="n">Data</span><span class="p">)</span>        <span class="o">|</span>
<span class="o">+-------------------------------------------+</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Shared MySQL</strong>: Single source of truth for all data</p></li>
<li><p><strong>Redis Cache</strong>: Fast access to frequently used data</p></li>
<li><p><strong>Consistent Schema</strong>: All services use common database schema</p></li>
<li><p><strong>Transaction Support</strong>: ACID guarantees for critical operations</p></li>
</ul>
</section>
<section id="communication-channels">
<h3>Communication Channels<a class="headerlink" href="#communication-channels" title="Link to this heading"></a></h3>
<p>VoIPBIN supports multiple communication channels through dedicated gateways:</p>
<p><strong>Voice Communication:</strong></p>
<ul class="simple">
<li><p><strong>PSTN</strong>: Traditional phone calls via carrier integrations</p></li>
<li><p><strong>WebRTC</strong>: Browser-based voice and video calls</p></li>
<li><p><strong>SIP</strong>: Direct SIP trunking for enterprise customers</p></li>
</ul>
<p><strong>Messaging:</strong></p>
<ul class="simple">
<li><p><strong>SMS</strong>: Text messaging via carrier integrations</p></li>
<li><p><strong>Chat</strong>: Real-time chat with WebSocket support</p></li>
<li><p><strong>Email</strong>: Email notifications and campaigns</p></li>
</ul>
<p><strong>AI-Enhanced Communication:</strong></p>
<ul class="simple">
<li><p><strong>AI Assistants</strong>: Voice-enabled AI agents for customer service</p></li>
<li><p><strong>Transcription</strong>: Real-time and batch speech-to-text</p></li>
<li><p><strong>Summarization</strong>: Call summarization and insights</p></li>
<li><p><strong>Sentiment Analysis</strong>: Real-time emotion detection</p></li>
</ul>
</section>
<section id="integration-capabilities">
<h3>Integration Capabilities<a class="headerlink" href="#integration-capabilities" title="Link to this heading"></a></h3>
<p>VoIPBIN provides multiple integration methods:</p>
<p><strong>REST API:</strong></p>
<ul class="simple">
<li><p>Comprehensive REST API for all platform features</p></li>
<li><p>OpenAPI/Swagger documentation</p></li>
<li><p>SDKs for multiple languages</p></li>
</ul>
<p><strong>WebSocket:</strong></p>
<ul class="simple">
<li><p>Real-time event streaming</p></li>
<li><p>Bi-directional media streaming</p></li>
<li><p>Live transcription feeds</p></li>
</ul>
<p><strong>Webhooks:</strong></p>
<ul class="simple">
<li><p>Event notifications to external systems</p></li>
<li><p>Configurable retry policies</p></li>
<li><p>Signature verification for security</p></li>
</ul>
<p><strong>Direct Database Access:</strong></p>
<ul class="simple">
<li><p>Read replicas for reporting</p></li>
<li><p>Analytics database for business intelligence</p></li>
</ul>
</section>
<section id="key-architectural-benefits">
<h3>Key Architectural Benefits<a class="headerlink" href="#key-architectural-benefits" title="Link to this heading"></a></h3>
<p>VoIPBIN’s architecture is designed to deliver these advantages:</p>
<p><strong>Scalability</strong></p>
<ul class="simple">
<li><p><strong>Horizontal Scaling</strong>: Add more service instances to handle increased load</p></li>
<li><p><strong>Independent Scaling</strong>: Scale only the services that need more capacity</p></li>
<li><p><strong>Auto-Scaling</strong>: Kubernetes automatically scales based on metrics</p></li>
<li><p><strong>Global Distribution</strong>: Deploy services across multiple regions</p></li>
</ul>
<p><strong>Reliability</strong></p>
<ul class="simple">
<li><p><strong>Fault Isolation</strong>: Issues in one service don’t affect others</p></li>
<li><p><strong>Circuit Breakers</strong>: Prevent cascading failures</p></li>
<li><p><strong>Automatic Failover</strong>: Kubernetes restarts failed containers</p></li>
<li><p><strong>SIP Session Recovery</strong>: Maintain calls even when servers crash</p></li>
<li><p><strong>Message Persistence</strong>: RabbitMQ ensures no messages are lost</p></li>
</ul>
<p><strong>Security</strong></p>
<ul class="simple">
<li><p><strong>API Gateway Security</strong>: All authentication at the edge</p></li>
<li><p><strong>Service Isolation</strong>: Services communicate via internal network only</p></li>
<li><p><strong>Encryption</strong>: TLS for all external communication</p></li>
<li><p><strong>Secret Management</strong>: Kubernetes secrets for sensitive data</p></li>
<li><p><strong>Audit Logging</strong>: Complete audit trail of all operations</p></li>
</ul>
<p><strong>Developer Productivity</strong></p>
<ul class="simple">
<li><p><strong>Simple REST API</strong>: Easy to integrate with any application</p></li>
<li><p><strong>Comprehensive Docs</strong>: Detailed documentation with examples</p></li>
<li><p><strong>Webhook Events</strong>: Real-time notifications of system events</p></li>
<li><p><strong>Test Environment</strong>: Sandbox for development and testing</p></li>
<li><p><strong>SDK Support</strong>: Official SDKs for popular languages</p></li>
</ul>
<p><strong>Operational Excellence</strong></p>
<ul class="simple">
<li><p><strong>Centralized Logging</strong>: All logs aggregated in one place</p></li>
<li><p><strong>Metrics &amp; Monitoring</strong>: Prometheus metrics for all services</p></li>
<li><p><strong>Distributed Tracing</strong>: Track requests across services</p></li>
<li><p><strong>Health Checks</strong>: Automated health monitoring</p></li>
<li><p><strong>Zero-Downtime Deploys</strong>: Rolling updates without service interruption</p></li>
</ul>
</section>
<section id="service-dependencies">
<h3>Service Dependencies<a class="headerlink" href="#service-dependencies" title="Link to this heading"></a></h3>
<p>VoIPBIN services have well-defined dependencies for coordinated operations:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Core</span> <span class="n">Service</span> <span class="n">Dependencies</span><span class="p">:</span>

<span class="o">+-----------------------------------------------------------------+</span>
<span class="o">|</span>                     <span class="nb">bin</span><span class="o">-</span><span class="n">api</span><span class="o">-</span><span class="n">manager</span>                             <span class="o">|</span>
<span class="o">|</span>                    <span class="p">(</span><span class="n">API</span> <span class="n">Gateway</span><span class="p">)</span>                                <span class="o">|</span>
<span class="o">|</span>  <span class="o">-------------------------------------------------------------</span>  <span class="o">|</span>
<span class="o">|</span>    <span class="n">Depends</span> <span class="n">on</span><span class="p">:</span> <span class="n">ALL</span> <span class="n">backend</span> <span class="n">services</span> <span class="k">for</span> <span class="n">RPC</span> <span class="n">routing</span>             <span class="o">|</span>
<span class="o">+-----------------------------------------------------------------+</span>
                             <span class="o">|</span>
     <span class="o">+-----------------------+-----------------------+</span>
     <span class="o">|</span>                       <span class="o">|</span>                       <span class="o">|</span>
     <span class="n">v</span>                       <span class="n">v</span>                       <span class="n">v</span>
<span class="o">+-------------+</span>        <span class="o">+-------------+</span>        <span class="o">+-------------+</span>
<span class="o">|</span><span class="nb">bin</span><span class="o">-</span><span class="n">call</span><span class="o">-</span><span class="n">mgr</span> <span class="o">|</span>        <span class="o">|</span><span class="nb">bin</span><span class="o">-</span><span class="n">flow</span><span class="o">-</span><span class="n">mgr</span> <span class="o">|</span>        <span class="o">|</span><span class="nb">bin</span><span class="o">-</span><span class="n">ai</span><span class="o">-</span><span class="n">mgr</span>   <span class="o">|</span>
<span class="o">+------+------+</span>        <span class="o">+------+------+</span>        <span class="o">+------+------+</span>
       <span class="o">|</span>                      <span class="o">|</span>                      <span class="o">|</span>
       <span class="o">|</span>                      <span class="o">|</span>                      <span class="o">|</span>
       <span class="n">v</span>                      <span class="n">v</span>                      <span class="n">v</span>
<span class="o">+-------------+</span>        <span class="o">+-------------+</span>        <span class="o">+-------------+</span>
<span class="o">|</span><span class="nb">bin</span><span class="o">-</span><span class="n">billing</span>  <span class="o">|</span>        <span class="o">|</span><span class="nb">bin</span><span class="o">-</span><span class="n">call</span><span class="o">-</span><span class="n">mgr</span> <span class="o">|</span>        <span class="o">|</span><span class="nb">bin</span><span class="o">-</span><span class="n">transcribe</span><span class="o">|</span>
<span class="o">|</span><span class="nb">bin</span><span class="o">-</span><span class="n">webhook</span>  <span class="o">|</span>        <span class="o">|</span><span class="nb">bin</span><span class="o">-</span><span class="n">queue</span><span class="o">-</span><span class="n">mgr</span><span class="o">|</span>        <span class="o">|</span><span class="nb">bin</span><span class="o">-</span><span class="n">tts</span><span class="o">-</span><span class="n">mgr</span>  <span class="o">|</span>
<span class="o">|</span><span class="nb">bin</span><span class="o">-</span><span class="n">number</span>   <span class="o">|</span>        <span class="o">|</span><span class="nb">bin</span><span class="o">-</span><span class="n">ai</span><span class="o">-</span><span class="n">mgr</span>   <span class="o">|</span>        <span class="o">|</span><span class="nb">bin</span><span class="o">-</span><span class="n">pipecat</span>  <span class="o">|</span>
<span class="o">+-------------+</span>        <span class="o">+-------------+</span>        <span class="o">+-------------+</span>
</pre></div>
</div>
<p><strong>Key Dependency Patterns:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Call</span> <span class="n">Processing</span> <span class="n">Chain</span><span class="p">:</span>
<span class="nb">bin</span><span class="o">-</span><span class="n">call</span><span class="o">-</span><span class="n">manager</span>
  <span class="o">+--&gt;</span> <span class="nb">bin</span><span class="o">-</span><span class="n">flow</span><span class="o">-</span><span class="n">manager</span>      <span class="p">(</span><span class="n">IVR</span> <span class="ow">and</span> <span class="n">call</span> <span class="n">flows</span><span class="p">)</span>
  <span class="o">+--&gt;</span> <span class="nb">bin</span><span class="o">-</span><span class="n">billing</span><span class="o">-</span><span class="n">manager</span>   <span class="p">(</span><span class="n">usage</span> <span class="n">tracking</span><span class="p">)</span>
  <span class="o">+--&gt;</span> <span class="nb">bin</span><span class="o">-</span><span class="n">webhook</span><span class="o">-</span><span class="n">manager</span>   <span class="p">(</span><span class="n">event</span> <span class="n">notifications</span><span class="p">)</span>
  <span class="o">+--&gt;</span> <span class="nb">bin</span><span class="o">-</span><span class="n">transcribe</span><span class="o">-</span><span class="n">manager</span> <span class="p">(</span><span class="n">call</span> <span class="n">transcription</span><span class="p">)</span>
  <span class="o">+--&gt;</span> <span class="nb">bin</span><span class="o">-</span><span class="n">number</span><span class="o">-</span><span class="n">manager</span>    <span class="p">(</span><span class="n">phone</span> <span class="n">number</span> <span class="n">lookup</span><span class="p">)</span>

<span class="n">AI</span> <span class="n">Voice</span> <span class="n">Pipeline</span><span class="p">:</span>
<span class="nb">bin</span><span class="o">-</span><span class="n">pipecat</span><span class="o">-</span><span class="n">manager</span>
  <span class="o">+--&gt;</span> <span class="nb">bin</span><span class="o">-</span><span class="n">ai</span><span class="o">-</span><span class="n">manager</span>        <span class="p">(</span><span class="n">LLM</span> <span class="n">coordination</span><span class="p">)</span>
  <span class="o">+--&gt;</span> <span class="nb">bin</span><span class="o">-</span><span class="n">call</span><span class="o">-</span><span class="n">manager</span>      <span class="p">(</span><span class="n">call</span> <span class="n">control</span><span class="p">)</span>
  <span class="o">+--&gt;</span> <span class="nb">bin</span><span class="o">-</span><span class="n">transcribe</span><span class="o">-</span><span class="n">manager</span> <span class="p">(</span><span class="n">STT</span><span class="p">)</span>

<span class="n">Flow</span> <span class="n">Orchestration</span><span class="p">:</span>
<span class="nb">bin</span><span class="o">-</span><span class="n">flow</span><span class="o">-</span><span class="n">manager</span>
  <span class="o">+--&gt;</span> <span class="nb">bin</span><span class="o">-</span><span class="n">call</span><span class="o">-</span><span class="n">manager</span>      <span class="p">(</span><span class="n">call</span> <span class="n">actions</span><span class="p">)</span>
  <span class="o">+--&gt;</span> <span class="nb">bin</span><span class="o">-</span><span class="n">queue</span><span class="o">-</span><span class="n">manager</span>     <span class="p">(</span><span class="n">queue</span> <span class="n">operations</span><span class="p">)</span>
  <span class="o">+--&gt;</span> <span class="nb">bin</span><span class="o">-</span><span class="n">ai</span><span class="o">-</span><span class="n">manager</span>        <span class="p">(</span><span class="n">AI</span> <span class="n">interactions</span><span class="p">)</span>
  <span class="o">+--&gt;</span> <span class="nb">bin</span><span class="o">-</span><span class="n">conference</span><span class="o">-</span><span class="n">manager</span> <span class="p">(</span><span class="n">conference</span> <span class="n">bridges</span><span class="p">)</span>

<span class="n">Infrastructure</span> <span class="n">Monitoring</span><span class="p">:</span>
<span class="nb">bin</span><span class="o">-</span><span class="n">sentinel</span><span class="o">-</span><span class="n">manager</span>
  <span class="o">+--&gt;</span> <span class="nb">bin</span><span class="o">-</span><span class="n">call</span><span class="o">-</span><span class="n">manager</span>      <span class="p">(</span><span class="n">SIP</span> <span class="n">session</span> <span class="n">recovery</span> <span class="n">events</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Circular Dependencies:</strong></p>
<p>VoIPBIN avoids circular dependencies through:</p>
<ul class="simple">
<li><p><strong>Event-Driven Decoupling</strong>: Services publish events, others subscribe</p></li>
<li><p><strong>Gateway Orchestration</strong>: API Gateway coordinates cross-service operations</p></li>
<li><p><strong>Shared Data Layer</strong>: Services share data via MySQL, not direct calls</p></li>
</ul>
</section>
<section id="technology-stack">
<h3>Technology Stack<a class="headerlink" href="#technology-stack" title="Link to this heading"></a></h3>
<p>VoIPBIN is built on modern, proven technologies:</p>
<p><strong>Backend Services:</strong></p>
<ul class="simple">
<li><p><strong>Language</strong>: Go (Golang) for all microservices</p></li>
<li><p><strong>API Framework</strong>: Gin for HTTP routing</p></li>
<li><p><strong>RPC</strong>: RabbitMQ for inter-service communication</p></li>
<li><p><strong>Database</strong>: MySQL for persistent storage</p></li>
<li><p><strong>Cache</strong>: Redis for session and hot data</p></li>
</ul>
<p><strong>Real-Time Communication:</strong></p>
<ul class="simple">
<li><p><strong>SIP Proxy</strong>: Kamailio for SIP routing</p></li>
<li><p><strong>Media Server</strong>: Asterisk for call processing</p></li>
<li><p><strong>Media Proxy</strong>: RTPEngine for RTP handling</p></li>
</ul>
<p><strong>Infrastructure:</strong></p>
<ul class="simple">
<li><p><strong>Container Runtime</strong>: Docker for containerization</p></li>
<li><p><strong>Orchestration</strong>: Kubernetes (GKE) for container management</p></li>
<li><p><strong>Cloud Provider</strong>: Google Cloud Platform</p></li>
<li><p><strong>Monitoring</strong>: Prometheus + Grafana for metrics</p></li>
<li><p><strong>Logging</strong>: ELK stack for centralized logging</p></li>
</ul>
<p><strong>Message Queue:</strong></p>
<ul class="simple">
<li><p><strong>Broker</strong>: RabbitMQ for async messaging</p></li>
<li><p><strong>Event Bus</strong>: ZeroMQ for pub/sub events</p></li>
</ul>
<p>This architecture enables VoIPBIN to deliver enterprise-grade communication services at scale while maintaining developer simplicity and operational excellence.</p>
</section>
</section>
<section id="backend-microservices">
<span id="architecture-backend"></span><h2>Backend Microservices<a class="headerlink" href="#backend-microservices" title="Link to this heading"></a></h2>
<p>VoIPBIN’s backend consists of 30+ specialized Go microservices organized into functional domains. Each service owns its specific business logic and communicates with others through a message queue, enabling independent scaling, deployment, and development.</p>
<section id="microservices-organization">
<h3>Microservices Organization<a class="headerlink" href="#microservices-organization" title="Link to this heading"></a></h3>
<p>Services are organized by functional domain:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">VoIPBIN</span> <span class="n">Microservices</span> <span class="n">Architecture</span>

<span class="o">+-------------------------------------------------------------+</span>
<span class="o">|</span>                   <span class="n">Communication</span> <span class="n">Services</span>                    <span class="o">|</span>
<span class="o">+-------------------------------------------------------------+</span>
<span class="o">|</span>  <span class="nb">bin</span><span class="o">-</span><span class="n">call</span><span class="o">-</span><span class="n">manager</span>        <span class="o">|</span>  <span class="n">Call</span> <span class="n">lifecycle</span> <span class="ow">and</span> <span class="n">routing</span>      <span class="o">|</span>
<span class="o">|</span>  <span class="nb">bin</span><span class="o">-</span><span class="n">conference</span><span class="o">-</span><span class="n">manager</span>  <span class="o">|</span>  <span class="n">Conference</span> <span class="n">bridge</span> <span class="n">management</span>    <span class="o">|</span>
<span class="o">|</span>  <span class="nb">bin</span><span class="o">-</span><span class="n">message</span><span class="o">-</span><span class="n">manager</span>     <span class="o">|</span>  <span class="n">SMS</span> <span class="n">messaging</span> <span class="p">(</span><span class="n">Telnyx</span><span class="o">/</span><span class="n">MsgBird</span><span class="p">)</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="nb">bin</span><span class="o">-</span><span class="n">talk</span><span class="o">-</span><span class="n">manager</span>        <span class="o">|</span>  <span class="n">Real</span><span class="o">-</span><span class="n">time</span> <span class="n">chat</span>                  <span class="o">|</span>
<span class="o">|</span>  <span class="nb">bin</span><span class="o">-</span><span class="n">email</span><span class="o">-</span><span class="n">manager</span>       <span class="o">|</span>  <span class="n">Email</span> <span class="n">campaigns</span>                 <span class="o">|</span>
<span class="o">|</span>  <span class="nb">bin</span><span class="o">-</span><span class="n">transfer</span><span class="o">-</span><span class="n">manager</span>    <span class="o">|</span>  <span class="n">Call</span> <span class="n">transfer</span> <span class="n">operations</span>        <span class="o">|</span>
<span class="o">+-------------------------------------------------------------+</span>

<span class="o">+-------------------------------------------------------------+</span>
<span class="o">|</span>                      <span class="n">AI</span> <span class="n">Services</span>                            <span class="o">|</span>
<span class="o">+-------------------------------------------------------------+</span>
<span class="o">|</span>  <span class="nb">bin</span><span class="o">-</span><span class="n">ai</span><span class="o">-</span><span class="n">manager</span>          <span class="o">|</span>  <span class="n">AI</span> <span class="n">assistants</span> <span class="ow">and</span> <span class="n">processing</span>    <span class="o">|</span>
<span class="o">|</span>  <span class="nb">bin</span><span class="o">-</span><span class="n">transcribe</span><span class="o">-</span><span class="n">manager</span>  <span class="o">|</span>  <span class="n">Speech</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">text</span> <span class="n">transcription</span>    <span class="o">|</span>
<span class="o">|</span>  <span class="nb">bin</span><span class="o">-</span><span class="n">tts</span><span class="o">-</span><span class="n">manager</span>         <span class="o">|</span>  <span class="n">Text</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">speech</span> <span class="n">synthesis</span>        <span class="o">|</span>
<span class="o">|</span>  <span class="nb">bin</span><span class="o">-</span><span class="n">pipecat</span><span class="o">-</span><span class="n">manager</span>     <span class="o">|</span>  <span class="n">Real</span><span class="o">-</span><span class="n">time</span> <span class="n">AI</span> <span class="n">voice</span> <span class="p">(</span><span class="n">Go</span><span class="o">/</span><span class="n">Python</span><span class="p">)</span>  <span class="o">|</span>
<span class="o">+-------------------------------------------------------------+</span>

<span class="o">+-------------------------------------------------------------+</span>
<span class="o">|</span>                    <span class="n">Workflow</span> <span class="n">Services</span>                        <span class="o">|</span>
<span class="o">+-------------------------------------------------------------+</span>
<span class="o">|</span>  <span class="nb">bin</span><span class="o">-</span><span class="n">flow</span><span class="o">-</span><span class="n">manager</span>        <span class="o">|</span>  <span class="n">Call</span> <span class="n">flow</span> <span class="ow">and</span> <span class="n">IVR</span> <span class="n">orchestration</span> <span class="o">|</span>
<span class="o">|</span>  <span class="nb">bin</span><span class="o">-</span><span class="n">queue</span><span class="o">-</span><span class="n">manager</span>       <span class="o">|</span>  <span class="n">Call</span> <span class="n">queue</span> <span class="n">management</span>           <span class="o">|</span>
<span class="o">|</span>  <span class="nb">bin</span><span class="o">-</span><span class="n">campaign</span><span class="o">-</span><span class="n">manager</span>    <span class="o">|</span>  <span class="n">Outbound</span> <span class="n">campaign</span> <span class="n">automation</span>    <span class="o">|</span>
<span class="o">|</span>  <span class="nb">bin</span><span class="o">-</span><span class="n">outdial</span><span class="o">-</span><span class="n">manager</span>     <span class="o">|</span>  <span class="n">Outbound</span> <span class="n">dialing</span> <span class="n">targets</span>        <span class="o">|</span>
<span class="o">|</span>  <span class="nb">bin</span><span class="o">-</span><span class="n">conversation</span><span class="o">-</span><span class="n">manager</span><span class="o">|</span>  <span class="n">Conversation</span> <span class="n">tracking</span>           <span class="o">|</span>
<span class="o">+-------------------------------------------------------------+</span>

<span class="o">+-------------------------------------------------------------+</span>
<span class="o">|</span>                   <span class="n">Management</span> <span class="n">Services</span>                       <span class="o">|</span>
<span class="o">+-------------------------------------------------------------+</span>
<span class="o">|</span>  <span class="nb">bin</span><span class="o">-</span><span class="n">agent</span><span class="o">-</span><span class="n">manager</span>       <span class="o">|</span>  <span class="n">Agent</span> <span class="n">state</span> <span class="ow">and</span> <span class="n">presence</span>        <span class="o">|</span>
<span class="o">|</span>  <span class="nb">bin</span><span class="o">-</span><span class="n">billing</span><span class="o">-</span><span class="n">manager</span>     <span class="o">|</span>  <span class="n">Usage</span> <span class="n">tracking</span> <span class="ow">and</span> <span class="n">billing</span>      <span class="o">|</span>
<span class="o">|</span>  <span class="nb">bin</span><span class="o">-</span><span class="n">customer</span><span class="o">-</span><span class="n">manager</span>    <span class="o">|</span>  <span class="n">Customer</span> <span class="ow">and</span> <span class="n">API</span> <span class="n">key</span> <span class="n">management</span> <span class="o">|</span>
<span class="o">|</span>  <span class="nb">bin</span><span class="o">-</span><span class="n">webhook</span><span class="o">-</span><span class="n">manager</span>     <span class="o">|</span>  <span class="n">Webhook</span> <span class="n">delivery</span>                <span class="o">|</span>
<span class="o">|</span>  <span class="nb">bin</span><span class="o">-</span><span class="n">storage</span><span class="o">-</span><span class="n">manager</span>     <span class="o">|</span>  <span class="n">File</span><span class="p">,</span> <span class="n">media</span><span class="p">,</span> <span class="ow">and</span> <span class="n">recordings</span>     <span class="o">|</span>
<span class="o">|</span>  <span class="nb">bin</span><span class="o">-</span><span class="n">number</span><span class="o">-</span><span class="n">manager</span>      <span class="o">|</span>  <span class="n">Phone</span> <span class="n">number</span> <span class="n">management</span>         <span class="o">|</span>
<span class="o">|</span>  <span class="nb">bin</span><span class="o">-</span><span class="n">tag</span><span class="o">-</span><span class="n">manager</span>         <span class="o">|</span>  <span class="n">Customer</span> <span class="n">tag</span> <span class="n">management</span>         <span class="o">|</span>
<span class="o">+-------------------------------------------------------------+</span>

<span class="o">+-------------------------------------------------------------+</span>
<span class="o">|</span>                  <span class="n">Integration</span> <span class="n">Services</span>                       <span class="o">|</span>
<span class="o">+-------------------------------------------------------------+</span>
<span class="o">|</span>  <span class="nb">bin</span><span class="o">-</span><span class="n">talk</span><span class="o">-</span><span class="n">manager</span>        <span class="o">|</span>  <span class="n">Agent</span> <span class="n">UI</span> <span class="n">backend</span>                <span class="o">|</span>
<span class="o">|</span>  <span class="nb">bin</span><span class="o">-</span><span class="n">hook</span><span class="o">-</span><span class="n">manager</span>        <span class="o">|</span>  <span class="n">External</span> <span class="n">webhook</span> <span class="n">gateway</span>        <span class="o">|</span>
<span class="o">|</span>  <span class="nb">bin</span><span class="o">-</span><span class="n">sentinel</span><span class="o">-</span><span class="n">manager</span>    <span class="o">|</span>  <span class="n">Kubernetes</span> <span class="n">pod</span> <span class="n">monitoring</span>       <span class="o">|</span>
<span class="o">|</span>  <span class="nb">bin</span><span class="o">-</span><span class="n">route</span><span class="o">-</span><span class="n">manager</span>       <span class="o">|</span>  <span class="n">Call</span> <span class="n">routing</span> <span class="ow">and</span> <span class="n">providers</span>      <span class="o">|</span>
<span class="o">|</span>  <span class="nb">bin</span><span class="o">-</span><span class="n">registrar</span><span class="o">-</span><span class="n">manager</span>   <span class="o">|</span>  <span class="n">SIP</span> <span class="n">registration</span> <span class="n">management</span>     <span class="o">|</span>
<span class="o">+-------------------------------------------------------------+</span>
</pre></div>
</div>
</section>
<section id="service-characteristics">
<h3>Service Characteristics<a class="headerlink" href="#service-characteristics" title="Link to this heading"></a></h3>
<p>Each microservice follows these design principles:</p>
<p><strong>Domain Isolation</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Service</span> <span class="n">Boundary</span><span class="p">:</span>

<span class="o">+----------------------------------------+</span>
<span class="o">|</span>         <span class="nb">bin</span><span class="o">-</span><span class="n">call</span><span class="o">-</span><span class="n">manager</span>               <span class="o">|</span>
<span class="o">|</span>                                        <span class="o">|</span>
<span class="o">|</span>  <span class="o">+----------------------------------+</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>   <span class="n">Domain</span> <span class="n">Logic</span> <span class="p">(</span><span class="n">Call</span> <span class="n">Handling</span><span class="p">)</span>   <span class="o">|</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">+----------------------------------+</span>  <span class="o">|</span>
<span class="o">|</span>                                        <span class="o">|</span>
<span class="o">|</span>  <span class="o">+----------------------------------+</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>   <span class="n">Data</span> <span class="n">Access</span> <span class="p">(</span><span class="n">Call</span> <span class="n">Records</span><span class="p">)</span>     <span class="o">|</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">+----------------------------------+</span>  <span class="o">|</span>
<span class="o">|</span>                                        <span class="o">|</span>
<span class="o">|</span>  <span class="o">+----------------------------------+</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>   <span class="n">RPC</span> <span class="n">Handlers</span> <span class="p">(</span><span class="n">Message</span> <span class="n">Queue</span><span class="p">)</span>   <span class="o">|</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">+----------------------------------+</span>  <span class="o">|</span>
<span class="o">+----------------------------------------+</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Single Responsibility</strong>: Each service owns one specific domain</p></li>
<li><p><strong>Encapsulated Logic</strong>: Business rules contained within the service</p></li>
<li><p><strong>Data Ownership</strong>: Service owns its database tables and schema</p></li>
<li><p><strong>Clear Boundaries</strong>: Well-defined interfaces and APIs</p></li>
</ul>
<p><strong>Technology Stack</strong></p>
<p>All backend services share a common technology stack:</p>
<ul class="simple">
<li><p><strong>Language</strong>: Go (Golang) 1.21+</p></li>
<li><p><strong>HTTP Framework</strong>: Gin for REST endpoints (when needed)</p></li>
<li><p><strong>Database</strong>: MySQL 8.0 via sqlx</p></li>
<li><p><strong>Cache</strong>: Redis 7.0 via go-redis</p></li>
<li><p><strong>Message Queue</strong>: RabbitMQ via bin-common-handler</p></li>
<li><p><strong>Logging</strong>: Structured logging with logrus</p></li>
<li><p><strong>Monitoring</strong>: Prometheus metrics</p></li>
</ul>
<p><strong>Common Structure</strong></p>
<p>All services follow a consistent directory structure:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">bin</span><span class="o">-&lt;</span><span class="n">service</span><span class="o">&gt;-</span><span class="n">manager</span><span class="o">/</span>
<span class="o">+--</span> <span class="n">cmd</span><span class="o">/</span>
<span class="o">|</span>   <span class="o">+--</span> <span class="o">&lt;</span><span class="n">service</span><span class="o">&gt;-</span><span class="n">manager</span><span class="o">/</span>
<span class="o">|</span>       <span class="o">+--</span> <span class="n">main</span><span class="o">.</span><span class="n">go</span>                 <span class="c1"># Entry point</span>
<span class="o">+--</span> <span class="n">pkg</span><span class="o">/</span>
<span class="o">|</span>   <span class="o">+--</span> <span class="o">&lt;</span><span class="n">domain</span><span class="o">&gt;</span><span class="n">handler</span><span class="o">/</span>            <span class="c1"># Business logic</span>
<span class="o">|</span>   <span class="o">+--</span> <span class="n">dbhandler</span><span class="o">/</span>                  <span class="c1"># Database operations</span>
<span class="o">|</span>   <span class="o">+--</span> <span class="n">cachehandler</span><span class="o">/</span>               <span class="c1"># Redis operations</span>
<span class="o">|</span>   <span class="o">+--</span> <span class="n">listenhandler</span><span class="o">/</span>              <span class="c1"># RabbitMQ RPC handlers</span>
<span class="o">+--</span> <span class="n">models</span><span class="o">/</span>
<span class="o">|</span>   <span class="o">+--</span> <span class="o">&lt;</span><span class="n">resource</span><span class="o">&gt;/</span>                 <span class="c1"># Data models</span>
<span class="o">+--</span> <span class="n">go</span><span class="o">.</span><span class="n">mod</span>                          <span class="c1"># Dependencies</span>
</pre></div>
</div>
</section>
<section id="api-gateway-bin-api-manager">
<h3>API Gateway - bin-api-manager<a class="headerlink" href="#api-gateway-bin-api-manager" title="Link to this heading"></a></h3>
<p>The API Gateway serves as the single entry point for all external requests, handling authentication, authorization, and request routing to backend services.</p>
<p><strong>Gateway Responsibilities</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">API</span> <span class="n">Gateway</span> <span class="n">Layer</span><span class="p">:</span>

<span class="n">External</span> <span class="n">Clients</span>
<span class="p">(</span><span class="n">Web</span><span class="p">,</span> <span class="n">Mobile</span><span class="p">,</span> <span class="n">Server</span><span class="p">)</span>
     <span class="o">|</span>
     <span class="o">|</span> <span class="n">HTTPS</span>
     <span class="n">v</span>
<span class="o">+----------------------------------------+</span>
<span class="o">|</span>        <span class="nb">bin</span><span class="o">-</span><span class="n">api</span><span class="o">-</span><span class="n">manager</span>                 <span class="o">|</span>
<span class="o">|</span>                                        <span class="o">|</span>
<span class="o">|</span>  <span class="mf">1.</span> <span class="o">+----------------------------+</span>     <span class="o">|</span>
<span class="o">|</span>     <span class="o">|</span>  <span class="n">Authentication</span> <span class="p">(</span><span class="n">JWT</span><span class="p">)</span>      <span class="o">|</span>     <span class="o">|</span>
<span class="o">|</span>     <span class="o">+----------------------------+</span>     <span class="o">|</span>
<span class="o">|</span>                                        <span class="o">|</span>
<span class="o">|</span>  <span class="mf">2.</span> <span class="o">+-----------------------------+</span>    <span class="o">|</span>
<span class="o">|</span>     <span class="o">|</span>  <span class="n">Authorization</span> <span class="p">(</span><span class="n">Permissions</span><span class="p">)</span><span class="o">|</span>    <span class="o">|</span>
<span class="o">|</span>     <span class="o">+-----------------------------+</span>    <span class="o">|</span>
<span class="o">|</span>                                        <span class="o">|</span>
<span class="o">|</span>  <span class="mf">3.</span> <span class="o">+----------------------------+</span>     <span class="o">|</span>
<span class="o">|</span>     <span class="o">|</span>  <span class="n">Rate</span> <span class="n">Limiting</span> <span class="o">/</span> <span class="n">Throttling</span><span class="o">|</span>     <span class="o">|</span>
<span class="o">|</span>     <span class="o">+----------------------------+</span>     <span class="o">|</span>
<span class="o">|</span>                                        <span class="o">|</span>
<span class="o">|</span>  <span class="mf">4.</span> <span class="o">+----------------------------+</span>     <span class="o">|</span>
<span class="o">|</span>     <span class="o">|</span>  <span class="n">Request</span> <span class="n">Routing</span> <span class="p">(</span><span class="n">RabbitMQ</span><span class="p">)</span><span class="o">|</span>     <span class="o">|</span>
<span class="o">|</span>     <span class="o">+----------------------------+</span>     <span class="o">|</span>
<span class="o">|</span>                                        <span class="o">|</span>
<span class="o">|</span>  <span class="mf">5.</span> <span class="o">+----------------------------+</span>     <span class="o">|</span>
<span class="o">|</span>     <span class="o">|</span>  <span class="n">Response</span> <span class="n">Aggregation</span>      <span class="o">|</span>     <span class="o">|</span>
<span class="o">|</span>     <span class="o">+----------------------------+</span>     <span class="o">|</span>
<span class="o">+----------------------------------------+</span>
     <span class="o">|</span>
     <span class="o">|</span> <span class="n">RabbitMQ</span> <span class="n">RPC</span>
     <span class="n">v</span>
<span class="n">Backend</span> <span class="n">Services</span>
</pre></div>
</div>
<p><strong>Authentication Flow</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>JWT Authentication:

Client                    API Gateway              Backend Service
  |                            |                          |
  |  POST /auth/login          |                          |
  +---------------------------&gt;&gt;                          |
  |  {user, pass}              |                          |
  |                            |                          |
  |                            |  Verify credentials      |
  |                            |                          |
  |  JWT Token                 |                          |
  &lt;&lt;---------------------------+                          |
  |                            |                          |
  |                            |                          |
  |  GET /calls?token=xyz      |                          |
  +---------------------------&gt;&gt;                          |
  |                            |  1. Validate JWT         |
  |                            |  2. Extract customer_id  |
  |                            |  3. Check permissions    |
  |                            |                          |
  |                            |  RPC: GetCalls(ctx)      |
  |                            +-------------------------&gt;&gt;
  |                            |                          |
  |                            |  [Call List]             |
  |                            &lt;&lt;-------------------------+
  |                            |                          |
  |  [Call List]               |  4. Return response      |
  &lt;&lt;---------------------------+                          |
  |                            |                          |
</pre></div>
</div>
<p><strong>Authentication Components:</strong></p>
<ul class="simple">
<li><p><strong>JWT Validation</strong>: Validates token signature and expiration</p></li>
<li><p><strong>Customer Extraction</strong>: Extracts customer_id from JWT claims</p></li>
<li><p><strong>Permission Check</strong>: Verifies user has required permissions</p></li>
<li><p><strong>Context Propagation</strong>: Passes auth context to backend services</p></li>
</ul>
<p><strong>Authorization Pattern</strong></p>
<p>VoIPBIN implements authorization at the API Gateway, NOT in backend services:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Authorization</span> <span class="n">Check</span><span class="p">:</span>

<span class="o">+-----------------------------------------------------+</span>
<span class="o">|</span>              <span class="nb">bin</span><span class="o">-</span><span class="n">api</span><span class="o">-</span><span class="n">manager</span> <span class="p">(</span><span class="n">Gateway</span><span class="p">)</span>              <span class="o">|</span>
<span class="o">|</span>                                                     <span class="o">|</span>
<span class="o">|</span>  <span class="mf">1.</span> <span class="n">Fetch</span> <span class="n">Resource</span>                                  <span class="o">|</span>
<span class="o">|</span>     <span class="o">+-------&gt;</span> <span class="nb">bin</span><span class="o">-</span><span class="n">call</span><span class="o">-</span><span class="n">manager</span><span class="o">.</span><span class="n">GetCall</span><span class="p">(</span><span class="n">call_id</span><span class="p">)</span>     <span class="o">|</span>
<span class="o">|</span>     <span class="o">|</span>                                               <span class="o">|</span>
<span class="o">|</span>  <span class="mf">2.</span> <span class="n">Check</span> <span class="n">Authorization</span>                             <span class="o">|</span>
<span class="o">|</span>     <span class="o">|</span>  <span class="k">if</span> <span class="n">call</span><span class="o">.</span><span class="n">customer_id</span> <span class="o">!=</span> <span class="n">jwt</span><span class="o">.</span><span class="n">customer_id</span><span class="p">:</span>      <span class="o">|</span>
<span class="o">|</span>     <span class="o">|</span>      <span class="k">return</span> <span class="mi">404</span> <span class="p">(</span><span class="ow">not</span> <span class="mi">403</span><span class="p">,</span> <span class="k">for</span> <span class="n">security</span><span class="p">)</span>       <span class="o">|</span>
<span class="o">|</span>     <span class="o">|</span>                                               <span class="o">|</span>
<span class="o">|</span>  <span class="mf">3.</span> <span class="n">Return</span> <span class="n">Resource</span>                                 <span class="o">|</span>
<span class="o">|</span>     <span class="o">+-------&gt;</span> <span class="k">return</span> <span class="n">call</span>                           <span class="o">|</span>
<span class="o">|</span>                                                     <span class="o">|</span>
<span class="o">+-----------------------------------------------------+</span>

<span class="o">+-----------------------------------------------------+</span>
<span class="o">|</span>           <span class="nb">bin</span><span class="o">-</span><span class="n">call</span><span class="o">-</span><span class="n">manager</span> <span class="p">(</span><span class="n">Backend</span><span class="p">)</span>                <span class="o">|</span>
<span class="o">|</span>                                                     <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="n">NO</span> <span class="n">authentication</span> <span class="n">logic</span>                          <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="n">NO</span> <span class="n">customer_id</span> <span class="n">validation</span>                        <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="n">Just</span> <span class="n">process</span> <span class="n">RPC</span> <span class="n">requests</span>                        <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="n">Return</span> <span class="n">requested</span> <span class="n">data</span>                            <span class="o">|</span>
<span class="o">|</span>                                                     <span class="o">|</span>
<span class="o">+-----------------------------------------------------+</span>
</pre></div>
</div>
<p><strong>Key Authorization Principles:</strong></p>
<ul class="simple">
<li><p><strong>Gateway-Only Auth</strong>: All authorization logic in bin-api-manager</p></li>
<li><p><strong>Fetch-Then-Check</strong>: Fetch resource first, then verify ownership</p></li>
<li><p><strong>Return 404, Not 403</strong>: Return “not found” for unauthorized access (security)</p></li>
<li><p><strong>Backend Trust</strong>: Backend services trust the gateway</p></li>
</ul>
<p><strong>Request Routing</strong></p>
<p>The gateway routes requests to appropriate backend services:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Routing</span> <span class="n">Decision</span><span class="p">:</span>

<span class="n">HTTP</span> <span class="n">Request</span>          <span class="n">Gateway</span> <span class="n">Router</span>          <span class="n">Backend</span> <span class="n">Service</span>
    <span class="o">|</span>                      <span class="o">|</span>                        <span class="o">|</span>
    <span class="o">|</span>  <span class="n">GET</span> <span class="o">/</span><span class="n">v1</span><span class="mf">.0</span><span class="o">/</span><span class="n">calls</span>     <span class="o">|</span>                        <span class="o">|</span>
    <span class="o">+---------------------&gt;&gt;</span>                        <span class="o">|</span>
    <span class="o">|</span>                      <span class="o">|</span>  <span class="n">Parse</span><span class="p">:</span> <span class="s2">&quot;calls&quot;</span>        <span class="o">|</span>
    <span class="o">|</span>                      <span class="o">|</span>  <span class="o">-&gt;</span> <span class="nb">bin</span><span class="o">-</span><span class="n">call</span><span class="o">-</span><span class="n">manager</span>   <span class="o">|</span>
    <span class="o">|</span>                      <span class="o">|</span>                        <span class="o">|</span>
    <span class="o">|</span>                      <span class="o">|</span>  <span class="n">RPC</span> <span class="n">Request</span>           <span class="o">|</span>
    <span class="o">|</span>                      <span class="o">+-----------------------&gt;&gt;</span>
    <span class="o">|</span>                      <span class="o">|</span>                        <span class="o">|</span>
    <span class="o">|</span>                      <span class="o">|</span>  <span class="n">RPC</span> <span class="n">Response</span>          <span class="o">|</span>
    <span class="o">|</span>                      <span class="o">&lt;&lt;-----------------------+</span>
    <span class="o">|</span>                      <span class="o">|</span>                        <span class="o">|</span>
    <span class="o">|</span>  <span class="n">JSON</span> <span class="n">Response</span>       <span class="o">|</span>                        <span class="o">|</span>
    <span class="o">&lt;&lt;---------------------+</span>                        <span class="o">|</span>
    <span class="o">|</span>                      <span class="o">|</span>                        <span class="o">|</span>
</pre></div>
</div>
<p><strong>Routing Table:</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>HTTP Endpoint</p></th>
<th class="head"><p>Backend Service</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>/v1.0/calls</p></td>
<td><p>bin-call-manager</p></td>
</tr>
<tr class="row-odd"><td><p>/v1.0/conferences</p></td>
<td><p>bin-conference-manager</p></td>
</tr>
<tr class="row-even"><td><p>/v1.0/messages</p></td>
<td><p>bin-message-manager</p></td>
</tr>
<tr class="row-odd"><td><p>/v1.0/talks</p></td>
<td><p>bin-talk-manager</p></td>
</tr>
<tr class="row-even"><td><p>/v1.0/emails</p></td>
<td><p>bin-email-manager</p></td>
</tr>
<tr class="row-odd"><td><p>/v1.0/agents</p></td>
<td><p>bin-agent-manager</p></td>
</tr>
<tr class="row-even"><td><p>/v1.0/queues</p></td>
<td><p>bin-queue-manager</p></td>
</tr>
<tr class="row-odd"><td><p>/v1.0/campaigns</p></td>
<td><p>bin-campaign-manager</p></td>
</tr>
<tr class="row-even"><td><p>/v1.0/outdials</p></td>
<td><p>bin-outdial-manager</p></td>
</tr>
<tr class="row-odd"><td><p>/v1.0/flows</p></td>
<td><p>bin-flow-manager</p></td>
</tr>
<tr class="row-even"><td><p>/v1.0/conversations</p></td>
<td><p>bin-conversation-manager</p></td>
</tr>
<tr class="row-odd"><td><p>/v1.0/billings</p></td>
<td><p>bin-billing-manager</p></td>
</tr>
<tr class="row-even"><td><p>/v1.0/customers</p></td>
<td><p>bin-customer-manager</p></td>
</tr>
<tr class="row-odd"><td><p>/v1.0/webhooks</p></td>
<td><p>bin-webhook-manager</p></td>
</tr>
<tr class="row-even"><td><p>/v1.0/transcribes</p></td>
<td><p>bin-transcribe-manager</p></td>
</tr>
<tr class="row-odd"><td><p>/v1.0/numbers</p></td>
<td><p>bin-number-manager</p></td>
</tr>
<tr class="row-even"><td><p>/v1.0/routes</p></td>
<td><p>bin-route-manager</p></td>
</tr>
<tr class="row-odd"><td><p>/v1.0/tags</p></td>
<td><p>bin-tag-manager</p></td>
</tr>
<tr class="row-even"><td><p>/v1.0/storage</p></td>
<td><p>bin-storage-manager</p></td>
</tr>
<tr class="row-odd"><td><p>/v1.0/transfers</p></td>
<td><p>bin-transfer-manager</p></td>
</tr>
</tbody>
</table>
</section>
<section id="special-service-architectures">
<h3>Special Service Architectures<a class="headerlink" href="#special-service-architectures" title="Link to this heading"></a></h3>
<p>Some services have unique architectures that differ from the standard microservice pattern:</p>
<p><strong>bin-pipecat-manager (Hybrid Go/Python)</strong></p>
<p>This service combines Go and Python for AI-powered voice conversations:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Hybrid</span> <span class="n">Architecture</span><span class="p">:</span>

<span class="o">+------------------------------------------------------------+</span>
<span class="o">|</span>                  <span class="nb">bin</span><span class="o">-</span><span class="n">pipecat</span><span class="o">-</span><span class="n">manager</span>                       <span class="o">|</span>
<span class="o">|</span>                                                            <span class="o">|</span>
<span class="o">|</span>   <span class="n">Go</span> <span class="n">Service</span> <span class="p">(</span><span class="n">Port</span> <span class="mi">8080</span><span class="p">)</span>         <span class="n">Python</span> <span class="n">Service</span> <span class="p">(</span><span class="n">Port</span> <span class="mi">8000</span><span class="p">)</span><span class="o">|</span>
<span class="o">|</span>   <span class="o">+---------------------+</span>        <span class="o">+---------------------+</span>   <span class="o">|</span>
<span class="o">|</span>   <span class="o">|</span> <span class="n">o</span> <span class="n">RabbitMQ</span> <span class="n">RPC</span>      <span class="o">|</span>  <span class="n">HTTP</span>  <span class="o">|</span> <span class="n">o</span> <span class="n">FastAPI</span> <span class="n">server</span>    <span class="o">|</span>   <span class="o">|</span>
<span class="o">|</span>   <span class="o">|</span> <span class="n">o</span> <span class="n">WebSocket</span> <span class="n">server</span>  <span class="o">|&lt;------&gt;|</span> <span class="n">o</span> <span class="n">Pipecat</span> <span class="n">pipelines</span> <span class="o">|</span>   <span class="o">|</span>
<span class="o">|</span>   <span class="o">|</span> <span class="n">o</span> <span class="n">Session</span> <span class="n">lifecycle</span> <span class="o">|</span>        <span class="o">|</span> <span class="n">o</span> <span class="n">STT</span><span class="o">/</span><span class="n">LLM</span><span class="o">/</span><span class="n">TTS</span>       <span class="o">|</span>   <span class="o">|</span>
<span class="o">|</span>   <span class="o">|</span> <span class="n">o</span> <span class="n">Audiosocket</span> <span class="p">(</span><span class="n">RTP</span><span class="p">)</span> <span class="o">|</span>        <span class="o">|</span> <span class="n">o</span> <span class="n">Tool</span> <span class="n">execution</span>    <span class="o">|</span>   <span class="o">|</span>
<span class="o">|</span>   <span class="o">+----------+----------+</span>        <span class="o">+---------------------+</span>   <span class="o">|</span>
<span class="o">|</span>              <span class="o">|</span>                                             <span class="o">|</span>
<span class="o">+--------------|---------------------------------------------+</span>
               <span class="o">|</span>
               <span class="o">|</span> <span class="n">Audiosocket</span> <span class="p">(</span><span class="mi">8</span><span class="n">kHz</span> <span class="n">PCM</span><span class="p">)</span>
               <span class="n">v</span>
          <span class="n">Asterisk</span> <span class="n">PBX</span>

<span class="n">Audio</span> <span class="n">Flow</span><span class="p">:</span>
<span class="n">Asterisk</span> <span class="p">(</span><span class="mi">8</span><span class="n">kHz</span><span class="p">)</span> <span class="o">--</span><span class="n">audiosocket</span><span class="o">--&gt;</span> <span class="n">Go</span> <span class="o">--</span><span class="n">websocket</span><span class="o">/</span><span class="n">protobuf</span><span class="o">--&gt;</span> <span class="n">Python</span>
                                    <span class="o">&lt;-----------------------</span>
<span class="n">STT</span> <span class="o">-&gt;</span> <span class="n">LLM</span> <span class="o">-&gt;</span> <span class="n">TTS</span> <span class="n">pipeline</span> <span class="n">executed</span> <span class="ow">in</span> <span class="n">Python</span><span class="o">/</span><span class="n">Pipecat</span>
</pre></div>
</div>
<p><strong>Key Features:</strong></p>
<ul class="simple">
<li><p><strong>Dual Runtime</strong>: Go for infrastructure, Python for AI pipelines</p></li>
<li><p><strong>Protobuf Frames</strong>: Efficient audio frame serialization</p></li>
<li><p><strong>Sample Rate Conversion</strong>: 8kHz (Asterisk) ↔ 16kHz (AI services)</p></li>
<li><p><strong>Tool Calling</strong>: LLM can invoke VoIP functions (connect_call, send_email)</p></li>
</ul>
<p><strong>bin-sentinel-manager (Kubernetes Monitoring)</strong></p>
<p>This service monitors pod lifecycle events in Kubernetes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Kubernetes</span> <span class="n">Monitoring</span><span class="p">:</span>

<span class="o">+-----------------------------------------------------------+</span>
<span class="o">|</span>              <span class="n">Kubernetes</span> <span class="n">Cluster</span> <span class="p">(</span><span class="n">voip</span> <span class="n">namespace</span><span class="p">)</span>          <span class="o">|</span>
<span class="o">|</span>                                                           <span class="o">|</span>
<span class="o">|</span>  <span class="o">+------------+</span>  <span class="o">+------------+</span>  <span class="o">+------------+</span>           <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span> <span class="n">asterisk</span><span class="o">-</span>  <span class="o">|</span>  <span class="o">|</span> <span class="n">asterisk</span><span class="o">-</span>  <span class="o">|</span>  <span class="o">|</span> <span class="n">asterisk</span><span class="o">-</span>  <span class="o">|</span>           <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>   <span class="n">call</span>     <span class="o">|</span>  <span class="o">|</span> <span class="n">conference</span> <span class="o">|</span>  <span class="o">|</span> <span class="n">registrar</span>  <span class="o">|</span>           <span class="o">|</span>
<span class="o">|</span>  <span class="o">+------+-----+</span>  <span class="o">+------+-----+</span>  <span class="o">+------+-----+</span>           <span class="o">|</span>
<span class="o">|</span>         <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>                 <span class="o">|</span>
<span class="o">|</span>         <span class="o">+---------------+---------------+</span>                 <span class="o">|</span>
<span class="o">|</span>                         <span class="o">|</span>                                 <span class="o">|</span>
<span class="o">|</span>             <span class="n">Pod</span> <span class="n">Events</span> <span class="p">(</span><span class="n">Update</span><span class="o">/</span><span class="n">Delete</span><span class="p">)</span>                    <span class="o">|</span>
<span class="o">|</span>                         <span class="o">|</span>                                 <span class="o">|</span>
<span class="o">|</span>                         <span class="n">v</span>                                 <span class="o">|</span>
<span class="o">|</span>         <span class="o">+-------------------------------+</span>                 <span class="o">|</span>
<span class="o">|</span>         <span class="o">|</span>     <span class="nb">bin</span><span class="o">-</span><span class="n">sentinel</span><span class="o">-</span><span class="n">manager</span>      <span class="o">|</span>                 <span class="o">|</span>
<span class="o">|</span>         <span class="o">|</span>                               <span class="o">|</span>                 <span class="o">|</span>
<span class="o">|</span>         <span class="o">|</span>  <span class="n">o</span> <span class="n">Pod</span> <span class="n">informers</span> <span class="p">(</span><span class="n">client</span><span class="o">-</span><span class="n">go</span><span class="p">)</span>  <span class="o">|</span>                 <span class="o">|</span>
<span class="o">|</span>         <span class="o">|</span>  <span class="n">o</span> <span class="n">Label</span> <span class="n">selector</span> <span class="n">filtering</span>   <span class="o">|</span>                 <span class="o">|</span>
<span class="o">|</span>         <span class="o">|</span>  <span class="n">o</span> <span class="n">Event</span> <span class="n">publishing</span>           <span class="o">|</span>                 <span class="o">|</span>
<span class="o">|</span>         <span class="o">+---------------+---------------+</span>                 <span class="o">|</span>
<span class="o">|</span>                         <span class="o">|</span>                                 <span class="o">|</span>
<span class="o">+-------------------------|---------------------------------+</span>
                          <span class="o">|</span>
                          <span class="o">|</span> <span class="n">RabbitMQ</span> <span class="n">Events</span>
                          <span class="n">v</span>
                <span class="o">+-------------------+</span>
                <span class="o">|</span>  <span class="nb">bin</span><span class="o">-</span><span class="n">call</span><span class="o">-</span><span class="n">manager</span> <span class="o">|</span>
                <span class="o">|</span>  <span class="p">(</span><span class="n">SIP</span> <span class="n">Recovery</span><span class="p">)</span>   <span class="o">|</span>
                <span class="o">+-------------------+</span>
</pre></div>
</div>
<p><strong>Key Features:</strong></p>
<ul class="simple">
<li><p><strong>In-Cluster Monitoring</strong>: Uses Kubernetes client-go with RBAC</p></li>
<li><p><strong>Label-Based Filtering</strong>: Watches specific pod labels (app=asterisk-<a href="#id1"><span class="problematic" id="id2">*</span></a>)</p></li>
<li><p><strong>Event Publishing</strong>: Notifies services via RabbitMQ for recovery actions</p></li>
<li><p><strong>Prometheus Metrics</strong>: Exports pod state change counters</p></li>
<li><p><strong>SIP Session Recovery</strong>: Enables call-manager to recover sessions when pods crash</p></li>
</ul>
<p><strong>bin-hook-manager (Webhook Gateway)</strong></p>
<p>This service receives external webhooks and routes them internally:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">External</span> <span class="n">Webhook</span> <span class="n">Flow</span><span class="p">:</span>

<span class="n">External</span> <span class="n">Provider</span>                       <span class="n">VoIPBIN</span> <span class="n">Internal</span>
<span class="p">(</span><span class="n">Telnyx</span><span class="p">,</span> <span class="n">MessageBird</span><span class="p">)</span>                   <span class="n">Services</span>
     <span class="o">|</span>                                      <span class="o">|</span>
     <span class="o">|</span> <span class="n">HTTPS</span> <span class="n">POST</span>                           <span class="o">|</span>
     <span class="o">|</span> <span class="o">/</span><span class="n">v1</span><span class="mf">.0</span><span class="o">/</span><span class="n">hooks</span><span class="o">/</span><span class="n">messages</span>                 <span class="o">|</span>
     <span class="n">v</span>                                      <span class="o">|</span>
<span class="o">+-----------------+</span>                         <span class="o">|</span>
<span class="o">|</span> <span class="nb">bin</span><span class="o">-</span><span class="n">hook</span><span class="o">-</span><span class="n">manager</span><span class="o">|</span>                         <span class="o">|</span>
<span class="o">|</span>                 <span class="o">|</span>   <span class="n">RabbitMQ</span>              <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Validate</span>      <span class="o">+------------------------&gt;|</span> <span class="nb">bin</span><span class="o">-</span><span class="n">message</span><span class="o">-</span><span class="n">manager</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Parse</span>         <span class="o">|</span>                         <span class="o">|</span> <span class="nb">bin</span><span class="o">-</span><span class="n">email</span><span class="o">-</span><span class="n">manager</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Route</span>         <span class="o">|</span>                         <span class="o">|</span> <span class="nb">bin</span><span class="o">-</span><span class="n">conversation</span><span class="o">-</span><span class="n">manager</span>
<span class="o">+-----------------+</span>                         <span class="o">|</span>
</pre></div>
</div>
<p><strong>Key Features:</strong></p>
<ul class="simple">
<li><p><strong>Public Endpoint</strong>: Receives webhooks from external providers</p></li>
<li><p><strong>Message Routing</strong>: Forwards to internal services via RabbitMQ</p></li>
<li><p><strong>Provider Support</strong>: Handles Telnyx, MessageBird delivery notifications</p></li>
<li><p><strong>Thin Proxy</strong>: No business logic, just routing</p></li>
</ul>
</section>
<section id="service-independence">
<h3>Service Independence<a class="headerlink" href="#service-independence" title="Link to this heading"></a></h3>
<p>VoIPBIN’s microservices architecture enables true service independence:</p>
<p><strong>Independent Deployment</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Service</span> <span class="n">Deployment</span><span class="p">:</span>

<span class="o">+--------------+</span>  <span class="o">+--------------+</span>  <span class="o">+--------------+</span>
<span class="o">|</span>  <span class="n">Service</span> <span class="n">A</span>   <span class="o">|</span>  <span class="o">|</span>  <span class="n">Service</span> <span class="n">B</span>   <span class="o">|</span>  <span class="o">|</span>  <span class="n">Service</span> <span class="n">C</span>   <span class="o">|</span>
<span class="o">|</span>  <span class="n">v1</span><span class="mf">.2.3</span>      <span class="o">|</span>  <span class="o">|</span>  <span class="n">v2</span><span class="mf">.0.1</span>      <span class="o">|</span>  <span class="o">|</span>  <span class="n">v1</span><span class="mf">.5.0</span>      <span class="o">|</span>
<span class="o">+------+-------+</span>  <span class="o">+------+-------+</span>  <span class="o">+------+-------+</span>
       <span class="o">|</span>                 <span class="o">|</span>                 <span class="o">|</span>
       <span class="o">|</span>                 <span class="o">|</span>  <span class="n">Deploy</span> <span class="n">v2</span><span class="mf">.1.0</span>  <span class="o">|</span>
       <span class="o">|</span>                 <span class="o">|</span>  <span class="p">(</span><span class="n">no</span> <span class="n">impact</span><span class="p">)</span>    <span class="o">|</span>
       <span class="o">|</span>                 <span class="n">v</span>                 <span class="o">|</span>
       <span class="o">|</span>          <span class="o">+--------------+</span>         <span class="o">|</span>
       <span class="o">|</span>          <span class="o">|</span>  <span class="n">Service</span> <span class="n">B</span>   <span class="o">|</span>         <span class="o">|</span>
       <span class="o">|</span>          <span class="o">|</span>  <span class="n">v2</span><span class="mf">.1.0</span>      <span class="o">|</span>         <span class="o">|</span>
       <span class="o">|</span>          <span class="o">+--------------+</span>         <span class="o">|</span>
       <span class="o">|</span>                 <span class="o">|</span>                 <span class="o">|</span>
       <span class="o">+-----------------+-----------------+</span>
                   <span class="n">Message</span> <span class="n">Queue</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>No Downtime</strong>: Services update without affecting others</p></li>
<li><p><strong>Version Independence</strong>: Each service has its own version</p></li>
<li><p><strong>Gradual Rollout</strong>: Can deploy to subset of instances</p></li>
<li><p><strong>Quick Rollback</strong>: Easy to revert problematic deployments</p></li>
</ul>
<p><strong>Independent Scaling</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Horizontal</span> <span class="n">Scaling</span><span class="p">:</span>

<span class="n">Normal</span> <span class="n">Load</span><span class="p">:</span>              <span class="n">High</span> <span class="n">Call</span> <span class="n">Load</span><span class="p">:</span>
<span class="o">+----------+</span>              <span class="o">+----------+</span> <span class="o">+----------+</span> <span class="o">+----------+</span>
<span class="o">|</span>   <span class="n">Call</span>   <span class="o">|</span>              <span class="o">|</span>   <span class="n">Call</span>   <span class="o">|</span> <span class="o">|</span>   <span class="n">Call</span>   <span class="o">|</span> <span class="o">|</span>   <span class="n">Call</span>   <span class="o">|</span>
<span class="o">|</span>  <span class="n">Manager</span> <span class="o">|</span>              <span class="o">|</span> <span class="n">Manager</span>  <span class="o">|</span> <span class="o">|</span> <span class="n">Manager</span>  <span class="o">|</span> <span class="o">|</span> <span class="n">Manager</span>  <span class="o">|</span>
<span class="o">|</span>   <span class="n">x1</span>     <span class="o">|</span>              <span class="o">|</span>   <span class="n">x1</span>     <span class="o">|</span> <span class="o">|</span>   <span class="n">x2</span>     <span class="o">|</span> <span class="o">|</span>   <span class="n">x3</span>     <span class="o">|</span>
<span class="o">+----------+</span>              <span class="o">+----------+</span> <span class="o">+----------+</span> <span class="o">+----------+</span>
<span class="o">+----------+</span>              <span class="o">+----------+</span>
<span class="o">|</span>   <span class="n">SMS</span>    <span class="o">|</span>              <span class="o">|</span>   <span class="n">SMS</span>    <span class="o">|</span>
<span class="o">|</span>  <span class="n">Manager</span> <span class="o">|</span>              <span class="o">|</span>  <span class="n">Manager</span> <span class="o">|</span>
<span class="o">|</span>   <span class="n">x1</span>     <span class="o">|</span>              <span class="o">|</span>   <span class="n">x1</span>     <span class="o">|</span>
<span class="o">+----------+</span>              <span class="o">+----------+</span>

<span class="n">Scale</span> <span class="n">only</span> <span class="n">what</span> <span class="n">needs</span> <span class="n">scaling</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Targeted Scaling</strong>: Scale only services experiencing load</p></li>
<li><p><strong>Cost Optimization</strong>: Don’t over-provision underutilized services</p></li>
<li><p><strong>Auto-Scaling</strong>: Kubernetes HPA scales based on metrics</p></li>
<li><p><strong>Resource Efficiency</strong>: Better resource utilization</p></li>
</ul>
<p><strong>Independent Development</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Development</span> <span class="n">Isolation</span><span class="p">:</span>

<span class="n">Team</span> <span class="n">A</span>              <span class="n">Team</span> <span class="n">B</span>              <span class="n">Team</span> <span class="n">C</span>
   <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>
   <span class="o">|</span>  <span class="nb">bin</span><span class="o">-</span><span class="n">call</span><span class="o">-</span>        <span class="o">|</span>  <span class="nb">bin</span><span class="o">-</span><span class="n">flow</span><span class="o">-</span>        <span class="o">|</span>  <span class="nb">bin</span><span class="o">-</span><span class="n">ai</span><span class="o">-</span>
   <span class="o">|</span>  <span class="n">manager</span>          <span class="o">|</span>  <span class="n">manager</span>          <span class="o">|</span>  <span class="n">manager</span>
   <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>
   <span class="o">|</span>  <span class="n">o</span> <span class="n">Go</span> <span class="n">codebase</span>    <span class="o">|</span>  <span class="n">o</span> <span class="n">Go</span> <span class="n">codebase</span>    <span class="o">|</span>  <span class="n">o</span> <span class="n">Go</span> <span class="n">codebase</span>
   <span class="o">|</span>  <span class="n">o</span> <span class="n">Own</span> <span class="n">git</span>        <span class="o">|</span>  <span class="n">o</span> <span class="n">Own</span> <span class="n">git</span>        <span class="o">|</span>  <span class="n">o</span> <span class="n">Own</span> <span class="n">git</span>
   <span class="o">|</span>    <span class="n">branch</span>         <span class="o">|</span>    <span class="n">branch</span>         <span class="o">|</span>    <span class="n">branch</span>
   <span class="o">|</span>  <span class="n">o</span> <span class="n">Own</span> <span class="n">CI</span><span class="o">/</span><span class="n">CD</span>      <span class="o">|</span>  <span class="n">o</span> <span class="n">Own</span> <span class="n">CI</span><span class="o">/</span><span class="n">CD</span>      <span class="o">|</span>  <span class="n">o</span> <span class="n">Own</span> <span class="n">CI</span><span class="o">/</span><span class="n">CD</span>
   <span class="o">|</span>  <span class="n">o</span> <span class="n">Own</span> <span class="n">tests</span>      <span class="o">|</span>  <span class="n">o</span> <span class="n">Own</span> <span class="n">tests</span>      <span class="o">|</span>  <span class="n">o</span> <span class="n">Own</span> <span class="n">tests</span>
   <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>
   <span class="o">+-------------------+-------------------+</span>
          <span class="n">Coordinate</span> <span class="n">only</span> <span class="n">via</span><span class="p">:</span>
          <span class="n">o</span> <span class="n">Message</span> <span class="n">contracts</span>
          <span class="n">o</span> <span class="n">Database</span> <span class="n">schema</span>
          <span class="n">o</span> <span class="n">API</span> <span class="n">contracts</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Team Autonomy</strong>: Teams work independently</p></li>
<li><p><strong>Faster Development</strong>: No coordination bottleneck</p></li>
<li><p><strong>Technology Flexibility</strong>: Can use different libraries</p></li>
<li><p><strong>Clear Ownership</strong>: Each team owns specific domains</p></li>
</ul>
</section>
<section id="service-communication-patterns">
<h3>Service Communication Patterns<a class="headerlink" href="#service-communication-patterns" title="Link to this heading"></a></h3>
<p>Services communicate primarily through RabbitMQ RPC:</p>
<p><strong>Synchronous RPC (Request-Response)</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">RPC</span> <span class="n">Communication</span><span class="p">:</span>

<span class="n">API</span> <span class="n">Gateway</span>                <span class="n">RabbitMQ</span>              <span class="n">Call</span> <span class="n">Manager</span>
     <span class="o">|</span>                         <span class="o">|</span>                      <span class="o">|</span>
     <span class="o">|</span>  <span class="mf">1.</span> <span class="n">Call</span> <span class="n">Request</span>        <span class="o">|</span>                      <span class="o">|</span>
     <span class="o">+------------------------&gt;&gt;</span>                      <span class="o">|</span>
     <span class="o">|</span>  <span class="n">Queue</span><span class="p">:</span> <span class="nb">bin</span><span class="o">-</span><span class="n">manager</span><span class="o">.</span>    <span class="o">|</span>                      <span class="o">|</span>
     <span class="o">|</span>         <span class="n">call</span><span class="o">.</span><span class="n">request</span>    <span class="o">|</span>                      <span class="o">|</span>
     <span class="o">|</span>                         <span class="o">|</span>  <span class="mf">2.</span> <span class="n">Dequeue</span> <span class="n">Request</span>  <span class="o">|</span>
     <span class="o">|</span>                         <span class="o">+---------------------&gt;&gt;</span>
     <span class="o">|</span>                         <span class="o">|</span>                      <span class="o">|</span>
     <span class="o">|</span>                         <span class="o">|</span>  <span class="mf">3.</span> <span class="n">Process</span> <span class="n">Request</span>  <span class="o">|</span>
     <span class="o">|</span>                         <span class="o">|</span>      <span class="p">(</span><span class="n">create</span> <span class="n">call</span><span class="p">)</span>   <span class="o">|</span>
     <span class="o">|</span>                         <span class="o">|</span>                      <span class="o">|</span>
     <span class="o">|</span>                         <span class="o">|</span>  <span class="mf">4.</span> <span class="n">Send</span> <span class="n">Response</span>    <span class="o">|</span>
     <span class="o">|</span>                         <span class="o">&lt;&lt;---------------------+</span>
     <span class="o">|</span>  <span class="mf">5.</span> <span class="n">Response</span>            <span class="o">|</span>                      <span class="o">|</span>
     <span class="o">&lt;&lt;------------------------+</span>                      <span class="o">|</span>
     <span class="o">|</span>                         <span class="o">|</span>                      <span class="o">|</span>
</pre></div>
</div>
<p><strong>Asynchronous Events (Pub/Sub)</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Event</span> <span class="n">Broadcasting</span><span class="p">:</span>

<span class="n">Call</span> <span class="n">Manager</span>          <span class="n">RabbitMQ</span> <span class="n">Exchange</span>        <span class="n">Subscribers</span>
     <span class="o">|</span>                      <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">|</span>  <span class="mf">1.</span> <span class="n">Call</span> <span class="n">Created</span>     <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">|</span>  <span class="p">(</span><span class="n">publish</span> <span class="n">event</span><span class="p">)</span>     <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">+---------------------&gt;&gt;</span>                       <span class="o">|</span>
     <span class="o">|</span>                      <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">|</span>                      <span class="o">|</span>  <span class="mf">2.</span> <span class="n">Broadcast</span>         <span class="o">|</span>
     <span class="o">|</span>                      <span class="o">|</span>      <span class="n">to</span> <span class="nb">all</span>           <span class="o">|</span>
     <span class="o">|</span>                      <span class="o">+----------+------------+</span>
     <span class="o">|</span>                      <span class="o">|</span>          <span class="o">|</span>            <span class="o">|</span>
     <span class="o">|</span>                      <span class="o">|</span>          <span class="n">v</span>            <span class="n">v</span>
     <span class="o">|</span>                      <span class="o">|</span>    <span class="o">+----------+</span> <span class="o">+----------+</span>
     <span class="o">|</span>                      <span class="o">|</span>    <span class="o">|</span> <span class="n">Billing</span>  <span class="o">|</span> <span class="o">|</span> <span class="n">Webhook</span>  <span class="o">|</span>
     <span class="o">|</span>                      <span class="o">|</span>    <span class="o">|</span> <span class="n">Manager</span>  <span class="o">|</span> <span class="o">|</span> <span class="n">Manager</span>  <span class="o">|</span>
     <span class="o">|</span>                      <span class="o">|</span>    <span class="o">+----------+</span> <span class="o">+----------+</span>
     <span class="o">|</span>                      <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">|</span>                      <span class="o">|</span>    <span class="n">Process</span> <span class="n">event</span>      <span class="o">|</span>
     <span class="o">|</span>                      <span class="o">|</span>    <span class="n">independently</span>      <span class="o">|</span>
</pre></div>
</div>
<p><strong>Communication Patterns Used:</strong></p>
<ul class="simple">
<li><p><strong>RPC (Synchronous)</strong>: For request-response operations (GET, POST, DELETE)</p></li>
<li><p><strong>Pub/Sub (Asynchronous)</strong>: For event notifications (call.created, sms.sent)</p></li>
<li><p><strong>Webhooks</strong>: For external system notifications</p></li>
<li><p><strong>WebSocket</strong>: For real-time client updates</p></li>
</ul>
</section>
<section id="service-discovery-and-configuration">
<h3>Service Discovery and Configuration<a class="headerlink" href="#service-discovery-and-configuration" title="Link to this heading"></a></h3>
<p>VoIPBIN uses a hybrid approach for service discovery:</p>
<p><strong>Queue-Based Discovery</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Service</span> <span class="n">Registration</span><span class="p">:</span>

<span class="o">+------------------------------------------------+</span>
<span class="o">|</span>            <span class="n">RabbitMQ</span> <span class="n">Queue</span> <span class="n">Naming</span>               <span class="o">|</span>
<span class="o">|</span>                                                <span class="o">|</span>
<span class="o">|</span>  <span class="nb">bin</span><span class="o">-</span><span class="n">manager</span><span class="o">.&lt;</span><span class="n">service</span><span class="o">&gt;.&lt;</span><span class="n">operation</span><span class="o">&gt;</span>             <span class="o">|</span>
<span class="o">|</span>                                                <span class="o">|</span>
<span class="o">|</span>  <span class="n">Examples</span><span class="p">:</span>                                     <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="nb">bin</span><span class="o">-</span><span class="n">manager</span><span class="o">.</span><span class="n">call</span><span class="o">.</span><span class="n">request</span>                    <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="nb">bin</span><span class="o">-</span><span class="n">manager</span><span class="o">.</span><span class="n">conference</span><span class="o">.</span><span class="n">request</span>              <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="nb">bin</span><span class="o">-</span><span class="n">manager</span><span class="o">.</span><span class="n">sms</span><span class="o">.</span><span class="n">request</span>                     <span class="o">|</span>
<span class="o">|</span>                                                <span class="o">|</span>
<span class="o">|</span>  <span class="n">Services</span> <span class="n">listen</span> <span class="n">on</span> <span class="n">their</span> <span class="n">named</span> <span class="n">queues</span>         <span class="o">|</span>
<span class="o">|</span>  <span class="n">Clients</span> <span class="n">send</span> <span class="n">to</span> <span class="n">known</span> <span class="n">queue</span> <span class="n">names</span>             <span class="o">|</span>
<span class="o">+------------------------------------------------+</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Convention-Based</strong>: Queue names follow predictable pattern</p></li>
<li><p><strong>No Registry</strong>: No central service registry needed</p></li>
<li><p><strong>Self-Registering</strong>: Services create queues on startup</p></li>
<li><p><strong>Load Balanced</strong>: Multiple instances share same queue</p></li>
</ul>
<p><strong>Configuration Management</strong></p>
<p>Services receive configuration through multiple sources:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Configuration</span> <span class="n">Sources</span><span class="p">:</span>

<span class="o">+----------------+</span>
<span class="o">|</span>   <span class="n">Service</span>      <span class="o">|</span>
<span class="o">+----+-----------+</span>
     <span class="o">|</span>
     <span class="o">+-------&gt;</span> <span class="n">Environment</span> <span class="n">Variables</span>
     <span class="o">|</span>       <span class="n">o</span> <span class="n">Database</span> <span class="n">connection</span>
     <span class="o">|</span>       <span class="n">o</span> <span class="n">RabbitMQ</span> <span class="n">address</span>
     <span class="o">|</span>       <span class="n">o</span> <span class="n">Redis</span> <span class="n">address</span>
     <span class="o">|</span>
     <span class="o">+-------&gt;</span> <span class="n">Command</span><span class="o">-</span><span class="n">Line</span> <span class="n">Flags</span>
     <span class="o">|</span>       <span class="n">o</span> <span class="n">Port</span> <span class="n">number</span>
     <span class="o">|</span>       <span class="n">o</span> <span class="n">Log</span> <span class="n">level</span>
     <span class="o">|</span>
     <span class="o">+-------&gt;</span> <span class="nb">bin</span><span class="o">-</span><span class="n">config</span><span class="o">-</span><span class="n">manager</span>
     <span class="o">|</span>       <span class="n">o</span> <span class="n">Feature</span> <span class="n">flags</span>
     <span class="o">|</span>       <span class="n">o</span> <span class="n">Business</span> <span class="n">logic</span> <span class="n">config</span>
     <span class="o">|</span>
     <span class="o">+-------&gt;</span> <span class="n">Database</span>
             <span class="n">o</span> <span class="n">Dynamic</span> <span class="n">configuration</span>
             <span class="n">o</span> <span class="n">Customer</span><span class="o">-</span><span class="n">specific</span> <span class="n">settings</span>
</pre></div>
</div>
</section>
<section id="health-monitoring">
<h3>Health Monitoring<a class="headerlink" href="#health-monitoring" title="Link to this heading"></a></h3>
<p>All services expose health check endpoints:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Health</span> <span class="n">Check</span> <span class="n">Architecture</span><span class="p">:</span>

<span class="n">Kubernetes</span>              <span class="n">Service</span> <span class="n">Health</span>          <span class="n">Dependencies</span>
     <span class="o">|</span>                       <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">|</span>  <span class="mf">1.</span> <span class="n">Health</span> <span class="n">Check</span>      <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">+----------------------&gt;&gt;</span>                       <span class="o">|</span>
     <span class="o">|</span>  <span class="n">GET</span> <span class="o">/</span><span class="n">health</span>          <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">|</span>                       <span class="o">|</span>  <span class="mf">2.</span> <span class="n">Check</span> <span class="n">MySQL</span>       <span class="o">|</span>
     <span class="o">|</span>                       <span class="o">+----------------------&gt;&gt;</span>
     <span class="o">|</span>                       <span class="o">|</span>     <span class="p">(</span><span class="n">ping</span><span class="p">)</span>            <span class="o">|</span>
     <span class="o">|</span>                       <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">|</span>                       <span class="o">|</span>  <span class="mf">3.</span> <span class="n">Check</span> <span class="n">Redis</span>       <span class="o">|</span>
     <span class="o">|</span>                       <span class="o">+----------------------&gt;&gt;</span>
     <span class="o">|</span>                       <span class="o">|</span>     <span class="p">(</span><span class="n">ping</span><span class="p">)</span>            <span class="o">|</span>
     <span class="o">|</span>                       <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">|</span>                       <span class="o">|</span>  <span class="mf">4.</span> <span class="n">Check</span> <span class="n">RabbitMQ</span>    <span class="o">|</span>
     <span class="o">|</span>                       <span class="o">+----------------------&gt;&gt;</span>
     <span class="o">|</span>                       <span class="o">|</span>     <span class="p">(</span><span class="n">connection</span><span class="p">)</span>      <span class="o">|</span>
     <span class="o">|</span>                       <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">|</span>  <span class="mi">200</span> <span class="n">OK</span> <span class="o">/</span> <span class="mi">503</span> <span class="n">Error</span>   <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">&lt;&lt;----------------------+</span>                       <span class="o">|</span>
     <span class="o">|</span>                       <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">|</span>  <span class="mf">5.</span> <span class="n">Restart</span> <span class="k">if</span> <span class="n">failed</span> <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">|</span>  <span class="p">(</span><span class="n">after</span> <span class="n">retries</span><span class="p">)</span>      <span class="o">|</span>                       <span class="o">|</span>
</pre></div>
</div>
<p><strong>Health Check Components:</strong></p>
<ul class="simple">
<li><p><strong>Liveness Probe</strong>: Is the service running?</p></li>
<li><p><strong>Readiness Probe</strong>: Is the service ready to accept traffic?</p></li>
<li><p><strong>Dependency Checks</strong>: Are database, cache, queue healthy?</p></li>
<li><p><strong>Auto-Recovery</strong>: Kubernetes restarts unhealthy pods</p></li>
</ul>
</section>
<section id="error-handling-and-resilience">
<h3>Error Handling and Resilience<a class="headerlink" href="#error-handling-and-resilience" title="Link to this heading"></a></h3>
<p>Services implement multiple resilience patterns:</p>
<p><strong>Circuit Breaker</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Circuit</span> <span class="n">Breaker</span> <span class="n">States</span><span class="p">:</span>

<span class="n">Closed</span> <span class="p">(</span><span class="n">Normal</span><span class="p">)</span>         <span class="n">Open</span> <span class="p">(</span><span class="n">Failed</span><span class="p">)</span>          <span class="n">Half</span><span class="o">-</span><span class="n">Open</span> <span class="p">(</span><span class="n">Testing</span><span class="p">)</span>
     <span class="o">|</span>                       <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">|</span>  <span class="n">Requests</span> <span class="k">pass</span>        <span class="o">|</span>  <span class="n">Requests</span> <span class="n">rejected</span>    <span class="o">|</span>  <span class="n">Limited</span> <span class="n">requests</span>
     <span class="o">|</span>  <span class="n">through</span>              <span class="o">|</span>  <span class="n">immediately</span>          <span class="o">|</span>  <span class="n">allowed</span>
     <span class="o">|</span>                       <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">|</span>  <span class="o">------------&gt;</span>        <span class="o">|</span>  <span class="o">--------</span><span class="n">X</span>            <span class="o">|</span>  <span class="o">------------&gt;</span>
     <span class="o">|</span>                       <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">|</span>  <span class="n">If</span> <span class="n">failures</span>          <span class="o">|</span>  <span class="n">After</span> <span class="n">timeout</span>        <span class="o">|</span>  <span class="n">If</span> <span class="n">success</span>
     <span class="o">|</span>  <span class="n">exceed</span> <span class="n">threshold</span>     <span class="o">|</span>  <span class="n">period</span>               <span class="o">|</span>  <span class="n">threshold</span> <span class="n">met</span>
     <span class="o">|</span>                       <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">+----------------------&gt;&gt;</span>                       <span class="o">|</span>
                             <span class="o">&lt;&lt;----------------------+</span>
                             <span class="o">|</span>                       <span class="o">|</span>
                             <span class="o">+----------------------&gt;&gt;</span>
                               <span class="n">If</span> <span class="n">still</span> <span class="n">failing</span>      <span class="o">|</span>
                                                     <span class="o">|</span>
                                                     <span class="o">+------&gt;</span> <span class="n">Closed</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Prevent Cascade Failures</strong>: Stop calling failed services</p></li>
<li><p><strong>Fast Fail</strong>: Return error immediately when circuit open</p></li>
<li><p><strong>Auto-Recovery</strong>: Periodically test if service recovered</p></li>
</ul>
<p><strong>Retry with Backoff</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Exponential</span> <span class="n">Backoff</span><span class="p">:</span>

<span class="n">Attempt</span> <span class="mi">1</span><span class="p">:</span> <span class="n">Immediate</span>
     <span class="o">|</span>
     <span class="o">|</span> <span class="n">Failed</span>
     <span class="n">v</span>
<span class="n">Attempt</span> <span class="mi">2</span><span class="p">:</span> <span class="n">Wait</span> <span class="mi">1</span><span class="n">s</span>
     <span class="o">|</span>
     <span class="o">|</span> <span class="n">Failed</span>
     <span class="n">v</span>
<span class="n">Attempt</span> <span class="mi">3</span><span class="p">:</span> <span class="n">Wait</span> <span class="mi">2</span><span class="n">s</span>
     <span class="o">|</span>
     <span class="o">|</span> <span class="n">Failed</span>
     <span class="n">v</span>
<span class="n">Attempt</span> <span class="mi">4</span><span class="p">:</span> <span class="n">Wait</span> <span class="mi">4</span><span class="n">s</span>
     <span class="o">|</span>
     <span class="o">|</span> <span class="n">Failed</span>
     <span class="n">v</span>
<span class="n">Attempt</span> <span class="mi">5</span><span class="p">:</span> <span class="n">Wait</span> <span class="mi">8</span><span class="n">s</span>
     <span class="o">|</span>
     <span class="o">|</span> <span class="n">Failed</span>
     <span class="n">v</span>
<span class="n">Give</span> <span class="n">up</span><span class="p">,</span> <span class="k">return</span> <span class="n">error</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Transient Failures</strong>: Retry on temporary failures</p></li>
<li><p><strong>Backoff Strategy</strong>: Increase wait time between retries</p></li>
<li><p><strong>Max Attempts</strong>: Limit total number of retries</p></li>
<li><p><strong>Idempotency</strong>: Ensure operations safe to retry</p></li>
</ul>
<p><strong>Timeouts</strong></p>
<p>All RPC calls have strict timeouts:</p>
<ul class="simple">
<li><p><strong>Default Timeout</strong>: 30 seconds for most operations</p></li>
<li><p><strong>Long Operations</strong>: 120 seconds for complex workflows</p></li>
<li><p><strong>Streaming</strong>: No timeout for streaming operations</p></li>
<li><p><strong>Context Propagation</strong>: Timeout passed through call chain</p></li>
</ul>
</section>
<section id="deployment-architecture">
<h3>Deployment Architecture<a class="headerlink" href="#deployment-architecture" title="Link to this heading"></a></h3>
<p>Services deploy to Kubernetes on Google Cloud Platform:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Kubernetes</span> <span class="n">Deployment</span><span class="p">:</span>

<span class="o">+---------------------------------------------------------+</span>
<span class="o">|</span>                      <span class="n">GKE</span> <span class="n">Cluster</span>                        <span class="o">|</span>
<span class="o">|</span>                                                         <span class="o">|</span>
<span class="o">|</span>  <span class="o">+---------------------------------------------------+</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>              <span class="n">Namespace</span><span class="p">:</span> <span class="n">production</span>                <span class="o">|</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>                                                   <span class="o">|</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">+---------------------------------------------+</span>  <span class="o">|</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="n">Deployment</span><span class="p">:</span> <span class="nb">bin</span><span class="o">-</span><span class="n">call</span><span class="o">-</span><span class="n">manager</span>               <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="o">+---------+</span>  <span class="o">+---------+</span>  <span class="o">+---------+</span>      <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="n">Pod</span> <span class="mi">1</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="n">Pod</span> <span class="mi">2</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="n">Pod</span> <span class="mi">3</span>  <span class="o">|</span>      <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="o">+---------+</span>  <span class="o">+---------+</span>  <span class="o">+---------+</span>      <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="n">Replicas</span><span class="p">:</span> <span class="mi">3</span>    <span class="n">HPA</span><span class="p">:</span> <span class="mi">3</span><span class="o">-</span><span class="mi">10</span>                   <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">+---------------------------------------------+</span>  <span class="o">|</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>                                                   <span class="o">|</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">+---------------------------------------------+</span>  <span class="o">|</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="n">Deployment</span><span class="p">:</span> <span class="nb">bin</span><span class="o">-</span><span class="n">api</span><span class="o">-</span><span class="n">manager</span>                <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="o">+---------+</span>  <span class="o">+---------+</span>  <span class="o">+---------+</span>      <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="n">Pod</span> <span class="mi">1</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="n">Pod</span> <span class="mi">2</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="n">Pod</span> <span class="mi">3</span>  <span class="o">|</span>      <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="o">+---------+</span>  <span class="o">+---------+</span>  <span class="o">+---------+</span>      <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="n">Replicas</span><span class="p">:</span> <span class="mi">3</span>    <span class="n">HPA</span><span class="p">:</span> <span class="mi">3</span><span class="o">-</span><span class="mi">20</span>                   <span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">+---------------------------------------------+</span>  <span class="o">|</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>                                                   <span class="o">|</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">...</span> <span class="mi">30</span><span class="o">+</span> <span class="n">more</span> <span class="n">deployments</span>                         <span class="o">|</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>                                                   <span class="o">|</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">+---------------------------------------------------+</span>  <span class="o">|</span>
<span class="o">|</span>                                                         <span class="o">|</span>
<span class="o">|</span>  <span class="o">+---------------------------------------------------+</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>         <span class="n">Shared</span> <span class="n">Resources</span> <span class="p">(</span><span class="n">same</span> <span class="n">cluster</span><span class="p">)</span>           <span class="o">|</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="n">o</span> <span class="n">MySQL</span> <span class="n">StatefulSet</span>                              <span class="o">|</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="n">o</span> <span class="n">Redis</span> <span class="n">StatefulSet</span>                              <span class="o">|</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="n">o</span> <span class="n">RabbitMQ</span> <span class="n">StatefulSet</span>                           <span class="o">|</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="n">o</span> <span class="n">Prometheus</span> <span class="n">Monitoring</span>                          <span class="o">|</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">+---------------------------------------------------+</span>  <span class="o">|</span>
<span class="o">+---------------------------------------------------------+</span>
</pre></div>
</div>
<p><strong>Deployment Characteristics:</strong></p>
<ul class="simple">
<li><p><strong>Container-Based</strong>: Each service runs in Docker containers</p></li>
<li><p><strong>Replica Sets</strong>: Multiple instances for high availability</p></li>
<li><p><strong>Auto-Scaling</strong>: HPA (Horizontal Pod Autoscaler) based on CPU/memory</p></li>
<li><p><strong>Rolling Updates</strong>: Zero-downtime deployments</p></li>
<li><p><strong>Resource Limits</strong>: CPU and memory limits per container</p></li>
<li><p><strong>Health Probes</strong>: Automatic restart of failed containers</p></li>
</ul>
</section>
<section id="monitoring-and-observability">
<h3>Monitoring and Observability<a class="headerlink" href="#monitoring-and-observability" title="Link to this heading"></a></h3>
<p>Comprehensive monitoring across all services:</p>
<p><strong>Metrics Collection</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Metrics</span> <span class="n">Pipeline</span><span class="p">:</span>

<span class="n">Services</span>                <span class="n">Prometheus</span>              <span class="n">Grafana</span>
<span class="p">(</span><span class="mi">30</span><span class="o">+</span> <span class="n">services</span><span class="p">)</span>              <span class="o">|</span>                      <span class="o">|</span>
     <span class="o">|</span>                      <span class="o">|</span>                      <span class="o">|</span>
     <span class="o">|</span>  <span class="n">Expose</span> <span class="o">/</span><span class="n">metrics</span>     <span class="o">|</span>                      <span class="o">|</span>
     <span class="o">|</span>  <span class="n">endpoint</span>            <span class="o">|</span>                      <span class="o">|</span>
     <span class="o">|</span>                      <span class="o">|</span>                      <span class="o">|</span>
     <span class="o">|</span>  <span class="n">Scrape</span> <span class="n">every</span> <span class="mi">15</span><span class="n">s</span>    <span class="o">|</span>                      <span class="o">|</span>
     <span class="o">+---------------------&gt;&gt;</span>                      <span class="o">|</span>
     <span class="o">|</span>                      <span class="o">|</span>                      <span class="o">|</span>
     <span class="o">|</span>                      <span class="o">|</span>  <span class="n">Time</span><span class="o">-</span><span class="n">series</span> <span class="n">DB</span>      <span class="o">|</span>
     <span class="o">|</span>                      <span class="o">|</span>  <span class="n">stores</span> <span class="n">metrics</span>      <span class="o">|</span>
     <span class="o">|</span>                      <span class="o">|</span>                      <span class="o">|</span>
     <span class="o">|</span>                      <span class="o">|</span>  <span class="n">Query</span> <span class="n">metrics</span>       <span class="o">|</span>
     <span class="o">|</span>                      <span class="o">+---------------------&gt;&gt;</span>
     <span class="o">|</span>                      <span class="o">|</span>                      <span class="o">|</span>
     <span class="o">|</span>                      <span class="o">|</span>  <span class="n">Visualize</span>           <span class="o">|</span>
     <span class="o">|</span>                      <span class="o">|</span>  <span class="n">dashboards</span>          <span class="o">|</span>
     <span class="o">|</span>                      <span class="o">|</span>                      <span class="o">|</span>
</pre></div>
</div>
<p><strong>Key Metrics:</strong></p>
<ul class="simple">
<li><p><strong>Request Rate</strong>: Requests per second per service</p></li>
<li><p><strong>Error Rate</strong>: Failed requests percentage</p></li>
<li><p><strong>Latency</strong>: P50, P95, P99 response times</p></li>
<li><p><strong>Resource Usage</strong>: CPU, memory, disk per pod</p></li>
<li><p><strong>Queue Depth</strong>: RabbitMQ queue backlogs</p></li>
<li><p><strong>Database Connections</strong>: Active connections per service</p></li>
</ul>
<p><strong>Logging</strong></p>
<p>All services use structured logging:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2026-01-20T12:00:00.000Z&quot;</span><span class="p">,</span>
  <span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="s2">&quot;info&quot;</span><span class="p">,</span>
  <span class="s2">&quot;service&quot;</span><span class="p">:</span> <span class="s2">&quot;bin-call-manager&quot;</span><span class="p">,</span>
  <span class="s2">&quot;instance&quot;</span><span class="p">:</span> <span class="s2">&quot;pod-xyz&quot;</span><span class="p">,</span>
  <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Call created successfully&quot;</span><span class="p">,</span>
  <span class="s2">&quot;call_id&quot;</span><span class="p">:</span> <span class="s2">&quot;abc-123-def&quot;</span><span class="p">,</span>
  <span class="s2">&quot;customer_id&quot;</span><span class="p">:</span> <span class="s2">&quot;customer-789&quot;</span><span class="p">,</span>
  <span class="s2">&quot;duration_ms&quot;</span><span class="p">:</span> <span class="mi">45</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Structured Format</strong>: JSON logs for easy parsing</p></li>
<li><p><strong>Centralized Collection</strong>: All logs aggregated in one place</p></li>
<li><p><strong>Searchable</strong>: Full-text search across all services</p></li>
<li><p><strong>Correlation IDs</strong>: Track requests across services</p></li>
</ul>
</section>
<section id="best-practices">
<h3>Best Practices<a class="headerlink" href="#best-practices" title="Link to this heading"></a></h3>
<p>VoIPBIN’s backend follows these best practices:</p>
<p><strong>Service Design:</strong></p>
<ul class="simple">
<li><p>One service, one responsibility</p></li>
<li><p>Services communicate via messages, not direct calls</p></li>
<li><p>Shared database, but logical isolation by tables</p></li>
<li><p>Idempotent operations for safe retries</p></li>
</ul>
<p><strong>Error Handling:</strong></p>
<ul class="simple">
<li><p>Always return errors, never panic</p></li>
<li><p>Use context for timeouts and cancellation</p></li>
<li><p>Implement circuit breakers for external dependencies</p></li>
<li><p>Log errors with full context</p></li>
</ul>
<p><strong>Performance:</strong></p>
<ul class="simple">
<li><p>Use connection pooling for database and Redis</p></li>
<li><p>Implement caching for frequently accessed data</p></li>
<li><p>Use batch operations where possible</p></li>
<li><p>Monitor and optimize hot paths</p></li>
</ul>
<p><strong>Security:</strong></p>
<ul class="simple">
<li><p>No authentication logic in backend services</p></li>
<li><p>Trust the API gateway for auth decisions</p></li>
<li><p>Validate all inputs at service boundaries</p></li>
<li><p>Use parameterized queries to prevent SQL injection</p></li>
</ul>
<p><strong>Testing:</strong></p>
<ul class="simple">
<li><p>Unit tests for business logic</p></li>
<li><p>Integration tests with mock dependencies</p></li>
<li><p>End-to-end tests for critical flows</p></li>
<li><p>Load tests before production deployment</p></li>
</ul>
</section>
</section>
<section id="inter-service-communication">
<span id="architecture-communication"></span><h2>Inter-Service Communication<a class="headerlink" href="#inter-service-communication" title="Link to this heading"></a></h2>
<p>VoIPBIN’s microservices communicate through multiple messaging patterns optimized for different use cases. The architecture uses RabbitMQ for RPC and pub/sub, ZeroMQ for high-performance events, and WebSocket for real-time client communication.</p>
<section id="communication-patterns-overview">
<h3>Communication Patterns Overview<a class="headerlink" href="#communication-patterns-overview" title="Link to this heading"></a></h3>
<p>VoIPBIN uses three primary communication mechanisms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Communication</span> <span class="n">Architecture</span><span class="p">:</span>

<span class="o">+---------------------------------------------------------+</span>
<span class="o">|</span>                  <span class="n">RabbitMQ</span> <span class="p">(</span><span class="n">Primary</span> <span class="n">Bus</span><span class="p">)</span>                 <span class="o">|</span>
<span class="o">|</span>                                                         <span class="o">|</span>
<span class="o">|</span>  <span class="o">+-----------------------+</span>  <span class="o">+-----------------------+</span>   <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>   <span class="n">RPC</span> <span class="p">(</span><span class="n">Synchronous</span><span class="p">)</span>   <span class="o">|</span>  <span class="o">|</span>  <span class="n">Pub</span><span class="o">/</span><span class="n">Sub</span> <span class="p">(</span><span class="n">Async</span><span class="p">)</span>      <span class="o">|</span>   <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>   <span class="n">Request</span><span class="o">-</span><span class="n">Response</span>    <span class="o">|</span>  <span class="o">|</span>  <span class="n">Event</span> <span class="n">Broadcasting</span>   <span class="o">|</span>   <span class="o">|</span>
<span class="o">|</span>  <span class="o">+-----------------------+</span>  <span class="o">+-----------------------+</span>   <span class="o">|</span>
<span class="o">+---------------------------------------------------------+</span>

<span class="o">+---------------------------------------------------------+</span>
<span class="o">|</span>              <span class="n">ZeroMQ</span> <span class="p">(</span><span class="n">High</span><span class="o">-</span><span class="n">Performance</span> <span class="n">Events</span><span class="p">)</span>           <span class="o">|</span>
<span class="o">|</span>                                                         <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="n">Real</span><span class="o">-</span><span class="n">time</span> <span class="n">event</span> <span class="n">streaming</span>                            <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="n">Agent</span> <span class="n">presence</span> <span class="n">updates</span>                               <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="n">Call</span> <span class="n">state</span> <span class="n">changes</span>                                   <span class="o">|</span>
<span class="o">+---------------------------------------------------------+</span>

<span class="o">+---------------------------------------------------------+</span>
<span class="o">|</span>              <span class="n">WebSocket</span> <span class="p">(</span><span class="n">Client</span> <span class="n">Communication</span><span class="p">)</span>           <span class="o">|</span>
<span class="o">|</span>                                                         <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="n">Real</span><span class="o">-</span><span class="n">time</span> <span class="n">client</span> <span class="n">notifications</span>                       <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="n">Bi</span><span class="o">-</span><span class="n">directional</span> <span class="n">media</span> <span class="n">streaming</span>                       <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="n">Live</span> <span class="n">transcription</span> <span class="n">feeds</span>                             <span class="o">|</span>
<span class="o">+---------------------------------------------------------+</span>
</pre></div>
</div>
</section>
<section id="rabbitmq-rpc-pattern">
<h3>RabbitMQ RPC Pattern<a class="headerlink" href="#rabbitmq-rpc-pattern" title="Link to this heading"></a></h3>
<p>VoIPBIN uses RabbitMQ for synchronous request-response communication between services.</p>
<p><strong>RPC Flow</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">RPC</span> <span class="n">Request</span><span class="o">-</span><span class="n">Response</span> <span class="n">Pattern</span><span class="p">:</span>

<span class="n">Client</span> <span class="n">Service</span>          <span class="n">RabbitMQ</span>             <span class="n">Server</span> <span class="n">Service</span>
     <span class="o">|</span>                     <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">|</span>  <span class="mf">1.</span> <span class="n">Send</span> <span class="n">Request</span>    <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">|</span>  <span class="o">+------------+</span>     <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">|</span>  <span class="o">|</span> <span class="n">call_id</span>    <span class="o">|</span>     <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">|</span>  <span class="o">|</span> <span class="n">action</span>     <span class="o">|</span>     <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">|</span>  <span class="o">|</span> <span class="n">reply_to</span>   <span class="o">|</span>     <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">|</span>  <span class="o">+------------+</span>     <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">+--------------------&gt;&gt;</span>                       <span class="o">|</span>
     <span class="o">|</span>  <span class="n">Queue</span><span class="p">:</span> <span class="nb">bin</span><span class="o">-</span><span class="n">manager</span><span class="o">.|</span>                       <span class="o">|</span>
     <span class="o">|</span>         <span class="n">call</span><span class="o">.</span><span class="n">request</span><span class="o">|</span>                       <span class="o">|</span>
     <span class="o">|</span>                     <span class="o">|</span>  <span class="mf">2.</span> <span class="n">Dequeue</span>           <span class="o">|</span>
     <span class="o">|</span>                     <span class="o">+----------------------&gt;&gt;</span>
     <span class="o">|</span>                     <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">|</span>                     <span class="o">|</span>  <span class="mf">3.</span> <span class="n">Process</span> <span class="n">Request</span>   <span class="o">|</span>
     <span class="o">|</span>                     <span class="o">|</span>     <span class="p">(</span><span class="n">business</span> <span class="n">logic</span><span class="p">)</span>  <span class="o">|</span>
     <span class="o">|</span>                     <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">|</span>                     <span class="o">|</span>  <span class="mf">4.</span> <span class="n">Send</span> <span class="n">Response</span>     <span class="o">|</span>
     <span class="o">|</span>                     <span class="o">&lt;&lt;----------------------+</span>
     <span class="o">|</span>                     <span class="o">|</span>  <span class="n">Queue</span><span class="p">:</span> <span class="n">reply_to</span>      <span class="o">|</span>
     <span class="o">|</span>  <span class="mf">5.</span> <span class="n">Receive</span> <span class="n">Response</span><span class="o">|</span>                       <span class="o">|</span>
     <span class="o">&lt;&lt;--------------------+</span>                       <span class="o">|</span>
     <span class="o">|</span>  <span class="o">+------------+</span>     <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">|</span>  <span class="o">|</span> <span class="n">status</span>     <span class="o">|</span>     <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">|</span>  <span class="o">|</span> <span class="n">data</span>       <span class="o">|</span>     <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">|</span>  <span class="o">|</span> <span class="n">error</span>      <span class="o">|</span>     <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">|</span>  <span class="o">+------------+</span>     <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">|</span>                     <span class="o">|</span>                       <span class="o">|</span>
</pre></div>
</div>
<p><strong>Queue Naming Convention</strong></p>
<p>All RPC queues follow a consistent naming pattern:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Queue</span> <span class="n">Name</span> <span class="n">Format</span><span class="p">:</span>
<span class="nb">bin</span><span class="o">-</span><span class="n">manager</span><span class="o">.&lt;</span><span class="n">service</span><span class="o">&gt;.&lt;</span><span class="n">operation</span><span class="o">&gt;</span>

<span class="n">Examples</span><span class="p">:</span>
<span class="n">o</span> <span class="nb">bin</span><span class="o">-</span><span class="n">manager</span><span class="o">.</span><span class="n">call</span><span class="o">.</span><span class="n">request</span>        <span class="o">-&gt;</span> <span class="nb">bin</span><span class="o">-</span><span class="n">call</span><span class="o">-</span><span class="n">manager</span>
<span class="n">o</span> <span class="nb">bin</span><span class="o">-</span><span class="n">manager</span><span class="o">.</span><span class="n">conference</span><span class="o">.</span><span class="n">request</span>  <span class="o">-&gt;</span> <span class="nb">bin</span><span class="o">-</span><span class="n">conference</span><span class="o">-</span><span class="n">manager</span>
<span class="n">o</span> <span class="nb">bin</span><span class="o">-</span><span class="n">manager</span><span class="o">.</span><span class="n">sms</span><span class="o">.</span><span class="n">request</span>         <span class="o">-&gt;</span> <span class="nb">bin</span><span class="o">-</span><span class="n">sms</span><span class="o">-</span><span class="n">manager</span>
<span class="n">o</span> <span class="nb">bin</span><span class="o">-</span><span class="n">manager</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">request</span>        <span class="o">-&gt;</span> <span class="nb">bin</span><span class="o">-</span><span class="n">flow</span><span class="o">-</span><span class="n">manager</span>
<span class="n">o</span> <span class="nb">bin</span><span class="o">-</span><span class="n">manager</span><span class="o">.</span><span class="n">billing</span><span class="o">.</span><span class="n">request</span>     <span class="o">-&gt;</span> <span class="nb">bin</span><span class="o">-</span><span class="n">billing</span><span class="o">-</span><span class="n">manager</span>
</pre></div>
</div>
<p><strong>Message Structure</strong></p>
<p>RPC messages use a standardized JSON format:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span> <span class="n">Message</span><span class="p">:</span>
<span class="p">{</span>
  <span class="s2">&quot;message_id&quot;</span><span class="p">:</span> <span class="s2">&quot;uuid-v4&quot;</span><span class="p">,</span>
  <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2026-01-20T12:00:00.000Z&quot;</span><span class="p">,</span>
  <span class="s2">&quot;route&quot;</span><span class="p">:</span> <span class="s2">&quot;/v1/calls&quot;</span><span class="p">,</span>
  <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
  <span class="s2">&quot;headers&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;customer_id&quot;</span><span class="p">:</span> <span class="s2">&quot;customer-123&quot;</span><span class="p">,</span>
    <span class="s2">&quot;agent_id&quot;</span><span class="p">:</span> <span class="s2">&quot;agent-456&quot;</span>
  <span class="p">},</span>
  <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;tel&quot;</span><span class="p">,</span> <span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;+15551234567&quot;</span><span class="p">},</span>
    <span class="s2">&quot;destinations&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;tel&quot;</span><span class="p">,</span> <span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;+15559876543&quot;</span><span class="p">}]</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="n">Response</span> <span class="n">Message</span><span class="p">:</span>
<span class="p">{</span>
  <span class="s2">&quot;message_id&quot;</span><span class="p">:</span> <span class="s2">&quot;uuid-v4&quot;</span><span class="p">,</span>
  <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2026-01-20T12:00:01.000Z&quot;</span><span class="p">,</span>
  <span class="s2">&quot;status_code&quot;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
  <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;call-789&quot;</span><span class="p">,</span>
    <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;ringing&quot;</span><span class="p">,</span>
    <span class="o">...</span>
  <span class="p">},</span>
  <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="n">null</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>RPC Implementation Pattern</strong></p>
<p>Services implement RPC handlers following this pattern:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Service</span> <span class="n">RPC</span> <span class="n">Handler</span><span class="p">:</span>

<span class="o">+------------------------------------------------+</span>
<span class="o">|</span>        <span class="nb">bin</span><span class="o">-</span><span class="n">call</span><span class="o">-</span><span class="n">manager</span>                        <span class="o">|</span>
<span class="o">|</span>                                                <span class="o">|</span>
<span class="o">|</span>  <span class="mf">1.</span> <span class="n">Listen</span> <span class="n">on</span> <span class="n">Queue</span>                            <span class="o">|</span>
<span class="o">|</span>     <span class="o">+-</span> <span class="nb">bin</span><span class="o">-</span><span class="n">manager</span><span class="o">.</span><span class="n">call</span><span class="o">.</span><span class="n">request</span>                <span class="o">|</span>
<span class="o">|</span>     <span class="o">|</span>                                          <span class="o">|</span>
<span class="o">|</span>  <span class="mf">2.</span> <span class="n">Receive</span> <span class="n">Message</span>                            <span class="o">|</span>
<span class="o">|</span>     <span class="o">+-</span> <span class="n">Deserialize</span> <span class="n">JSON</span>                        <span class="o">|</span>
<span class="o">|</span>     <span class="o">+-</span> <span class="n">Validate</span> <span class="n">request</span>                        <span class="o">|</span>
<span class="o">|</span>     <span class="o">|</span>                                          <span class="o">|</span>
<span class="o">|</span>  <span class="mf">3.</span> <span class="n">Route</span> <span class="n">to</span> <span class="n">Handler</span>                           <span class="o">|</span>
<span class="o">|</span>     <span class="o">+-</span> <span class="n">Parse</span> <span class="n">route</span><span class="p">:</span> <span class="n">POST</span> <span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">calls</span>             <span class="o">|</span>
<span class="o">|</span>     <span class="o">+-</span> <span class="n">Call</span><span class="p">:</span> <span class="n">CallCreate</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">req</span><span class="p">)</span>              <span class="o">|</span>
<span class="o">|</span>     <span class="o">|</span>                                          <span class="o">|</span>
<span class="o">|</span>  <span class="mf">4.</span> <span class="n">Execute</span> <span class="n">Business</span> <span class="n">Logic</span>                     <span class="o">|</span>
<span class="o">|</span>     <span class="o">+-</span> <span class="n">Validate</span> <span class="n">data</span>                           <span class="o">|</span>
<span class="o">|</span>     <span class="o">+-</span> <span class="n">Create</span> <span class="n">call</span> <span class="n">record</span>                      <span class="o">|</span>
<span class="o">|</span>     <span class="o">+-</span> <span class="n">Initiate</span> <span class="n">SIP</span> <span class="n">call</span>                       <span class="o">|</span>
<span class="o">|</span>     <span class="o">|</span>                                          <span class="o">|</span>
<span class="o">|</span>  <span class="mf">5.</span> <span class="n">Send</span> <span class="n">Response</span>                              <span class="o">|</span>
<span class="o">|</span>     <span class="o">+-</span> <span class="n">Serialize</span> <span class="n">result</span>                        <span class="o">|</span>
<span class="o">|</span>     <span class="o">+-</span> <span class="n">Reply</span> <span class="n">to</span> <span class="n">reply_to</span> <span class="n">queue</span>                 <span class="o">|</span>
<span class="o">|</span>                                                <span class="o">|</span>
<span class="o">+------------------------------------------------+</span>
</pre></div>
</div>
<p><strong>Load Balancing</strong></p>
<p>Multiple service instances share the same queue:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Load</span> <span class="n">Balanced</span> <span class="n">RPC</span><span class="p">:</span>

<span class="n">API</span> <span class="n">Gateway</span>                <span class="n">Queue</span>              <span class="n">Service</span> <span class="n">Instances</span>
     <span class="o">|</span>                      <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">|</span>  <span class="n">Request</span> <span class="mi">1</span>           <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">+---------------------&gt;&gt;</span>                       <span class="o">|</span>
     <span class="o">|</span>                      <span class="o">+----------------------&gt;&gt;</span> <span class="n">Instance</span> <span class="mi">1</span>
     <span class="o">|</span>                      <span class="o">|</span>  <span class="p">(</span><span class="nb">round</span><span class="o">-</span><span class="n">robin</span><span class="p">)</span>        <span class="o">|</span> <span class="p">(</span><span class="n">processes</span> <span class="n">req</span> <span class="mi">1</span><span class="p">)</span>
     <span class="o">|</span>                      <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">|</span>  <span class="n">Request</span> <span class="mi">2</span>           <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">+---------------------&gt;&gt;</span>                       <span class="o">|</span>
     <span class="o">|</span>                      <span class="o">+----------------------&gt;&gt;</span> <span class="n">Instance</span> <span class="mi">2</span>
     <span class="o">|</span>                      <span class="o">|</span>  <span class="p">(</span><span class="nb">round</span><span class="o">-</span><span class="n">robin</span><span class="p">)</span>        <span class="o">|</span> <span class="p">(</span><span class="n">processes</span> <span class="n">req</span> <span class="mi">2</span><span class="p">)</span>
     <span class="o">|</span>                      <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">|</span>  <span class="n">Request</span> <span class="mi">3</span>           <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">+---------------------&gt;&gt;</span>                       <span class="o">|</span>
     <span class="o">|</span>                      <span class="o">+----------------------&gt;&gt;</span> <span class="n">Instance</span> <span class="mi">3</span>
     <span class="o">|</span>                      <span class="o">|</span>  <span class="p">(</span><span class="nb">round</span><span class="o">-</span><span class="n">robin</span><span class="p">)</span>        <span class="o">|</span> <span class="p">(</span><span class="n">processes</span> <span class="n">req</span> <span class="mi">3</span><span class="p">)</span>
     <span class="o">|</span>                      <span class="o">|</span>                       <span class="o">|</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Fair Distribution</strong>: RabbitMQ distributes messages evenly</p></li>
<li><p><strong>No Coordination</strong>: Instances don’t need to know about each other</p></li>
<li><p><strong>Dynamic Scaling</strong>: Add/remove instances without configuration</p></li>
<li><p><strong>Automatic Recovery</strong>: If instance fails, messages redelivered</p></li>
</ul>
</section>
<section id="rabbitmq-pub-sub-pattern">
<h3>RabbitMQ Pub/Sub Pattern<a class="headerlink" href="#rabbitmq-pub-sub-pattern" title="Link to this heading"></a></h3>
<p>For asynchronous event notifications, VoIPBIN uses RabbitMQ’s pub/sub (fanout exchange) pattern.</p>
<p><strong>Pub/Sub Flow</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Event</span> <span class="n">Publishing</span> <span class="n">Pattern</span><span class="p">:</span>

<span class="n">Publisher</span>               <span class="n">Exchange</span>              <span class="n">Subscribers</span>
     <span class="o">|</span>                      <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">|</span>  <span class="mf">1.</span> <span class="n">Publish</span> <span class="n">Event</span>    <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">|</span>  <span class="o">+------------+</span>      <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">|</span>  <span class="o">|</span><span class="n">event</span><span class="p">:</span> <span class="n">call</span> <span class="o">|</span>      <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">|</span>  <span class="o">|</span>      <span class="o">.</span><span class="n">created</span><span class="o">|</span>    <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">|</span>  <span class="o">|</span><span class="n">data</span><span class="p">:</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span> <span class="o">|</span>      <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">|</span>  <span class="o">+------------+</span>      <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">+---------------------&gt;&gt;</span>                       <span class="o">|</span>
     <span class="o">|</span>  <span class="n">Exchange</span><span class="p">:</span>           <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">|</span>  <span class="n">call</span><span class="o">.</span><span class="n">events</span>         <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">|</span>                      <span class="o">|</span>  <span class="mf">2.</span> <span class="n">Fanout</span> <span class="n">to</span> <span class="nb">all</span>     <span class="o">|</span>
     <span class="o">|</span>                      <span class="o">|</span>     <span class="n">subscribers</span>       <span class="o">|</span>
     <span class="o">|</span>                      <span class="o">+------+----------------+</span>
     <span class="o">|</span>                      <span class="o">|</span>      <span class="o">|</span>                <span class="o">|</span>
     <span class="o">|</span>                      <span class="o">|</span>      <span class="n">v</span>                <span class="n">v</span>
     <span class="o">|</span>                      <span class="o">|</span>  <span class="o">+--------+</span>      <span class="o">+--------+</span>
     <span class="o">|</span>                      <span class="o">|</span>  <span class="o">|</span><span class="n">Billing</span> <span class="o">|</span>      <span class="o">|</span><span class="n">Webhook</span> <span class="o">|</span>
     <span class="o">|</span>                      <span class="o">|</span>  <span class="o">|</span><span class="n">Manager</span> <span class="o">|</span>      <span class="o">|</span><span class="n">Manager</span> <span class="o">|</span>
     <span class="o">|</span>                      <span class="o">|</span>  <span class="o">+--------+</span>      <span class="o">+--------+</span>
     <span class="o">|</span>                      <span class="o">|</span>      <span class="o">|</span>                <span class="o">|</span>
     <span class="o">|</span>                      <span class="o">|</span>  <span class="mf">3.</span> <span class="n">Process</span>       <span class="mf">3.</span> <span class="n">Process</span>
     <span class="o">|</span>                      <span class="o">|</span>     <span class="n">event</span>             <span class="n">event</span>
     <span class="o">|</span>                      <span class="o">|</span>     <span class="n">independently</span>     <span class="n">independently</span>
</pre></div>
</div>
<p><strong>Event Types</strong></p>
<p>VoIPBIN publishes events for major state changes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Event</span> <span class="n">Categories</span><span class="p">:</span>

<span class="n">Call</span> <span class="n">Events</span><span class="p">:</span>
<span class="n">o</span> <span class="n">call</span><span class="o">.</span><span class="n">created</span>       <span class="o">-</span> <span class="n">New</span> <span class="n">call</span> <span class="n">initiated</span>
<span class="n">o</span> <span class="n">call</span><span class="o">.</span><span class="n">ringing</span>       <span class="o">-</span> <span class="n">Call</span> <span class="n">ringing</span>
<span class="n">o</span> <span class="n">call</span><span class="o">.</span><span class="n">answered</span>      <span class="o">-</span> <span class="n">Call</span> <span class="n">answered</span>
<span class="n">o</span> <span class="n">call</span><span class="o">.</span><span class="n">ended</span>         <span class="o">-</span> <span class="n">Call</span> <span class="n">terminated</span>

<span class="n">Conference</span> <span class="n">Events</span><span class="p">:</span>
<span class="n">o</span> <span class="n">conference</span><span class="o">.</span><span class="n">created</span>       <span class="o">-</span> <span class="n">Conference</span> <span class="n">created</span>
<span class="n">o</span> <span class="n">conference</span><span class="o">.</span><span class="n">participant_joined</span>
<span class="n">o</span> <span class="n">conference</span><span class="o">.</span><span class="n">participant_left</span>
<span class="n">o</span> <span class="n">conference</span><span class="o">.</span><span class="n">ended</span>

<span class="n">SMS</span> <span class="n">Events</span><span class="p">:</span>
<span class="n">o</span> <span class="n">sms</span><span class="o">.</span><span class="n">sent</span>           <span class="o">-</span> <span class="n">SMS</span> <span class="n">sent</span> <span class="n">successfully</span>
<span class="n">o</span> <span class="n">sms</span><span class="o">.</span><span class="n">delivered</span>      <span class="o">-</span> <span class="n">SMS</span> <span class="n">delivered</span> <span class="n">to</span> <span class="n">recipient</span>
<span class="n">o</span> <span class="n">sms</span><span class="o">.</span><span class="n">failed</span>         <span class="o">-</span> <span class="n">SMS</span> <span class="n">delivery</span> <span class="n">failed</span>

<span class="n">Agent</span> <span class="n">Events</span><span class="p">:</span>
<span class="n">o</span> <span class="n">agent</span><span class="o">.</span><span class="n">login</span>        <span class="o">-</span> <span class="n">Agent</span> <span class="n">logged</span> <span class="ow">in</span>
<span class="n">o</span> <span class="n">agent</span><span class="o">.</span><span class="n">logout</span>       <span class="o">-</span> <span class="n">Agent</span> <span class="n">logged</span> <span class="n">out</span>
<span class="n">o</span> <span class="n">agent</span><span class="o">.</span><span class="n">status_change</span> <span class="o">-</span> <span class="n">Agent</span> <span class="n">status</span> <span class="n">changed</span>

<span class="n">Transcription</span> <span class="n">Events</span><span class="p">:</span>
<span class="n">o</span> <span class="n">transcribe</span><span class="o">.</span><span class="n">started</span> <span class="o">-</span> <span class="n">Transcription</span> <span class="n">started</span>
<span class="n">o</span> <span class="n">transcribe</span><span class="o">.</span><span class="n">completed</span>
<span class="n">o</span> <span class="n">transcript</span><span class="o">.</span><span class="n">created</span> <span class="o">-</span> <span class="n">New</span> <span class="n">transcript</span> <span class="n">segment</span>
</pre></div>
</div>
<p><strong>Event Message Structure</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Event</span> <span class="n">Message</span> <span class="n">Format</span><span class="p">:</span>
<span class="p">{</span>
  <span class="s2">&quot;event_id&quot;</span><span class="p">:</span> <span class="s2">&quot;uuid-v4&quot;</span><span class="p">,</span>
  <span class="s2">&quot;event_type&quot;</span><span class="p">:</span> <span class="s2">&quot;call.created&quot;</span><span class="p">,</span>
  <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2026-01-20T12:00:00.000Z&quot;</span><span class="p">,</span>
  <span class="s2">&quot;customer_id&quot;</span><span class="p">:</span> <span class="s2">&quot;customer-123&quot;</span><span class="p">,</span>
  <span class="s2">&quot;resource_type&quot;</span><span class="p">:</span> <span class="s2">&quot;call&quot;</span><span class="p">,</span>
  <span class="s2">&quot;resource_id&quot;</span><span class="p">:</span> <span class="s2">&quot;call-789&quot;</span><span class="p">,</span>
  <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;call-789&quot;</span><span class="p">,</span>
    <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;+15551234567&quot;</span><span class="p">,</span>
    <span class="s2">&quot;destination&quot;</span><span class="p">:</span> <span class="s2">&quot;+15559876543&quot;</span><span class="p">,</span>
    <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;ringing&quot;</span><span class="p">,</span>
    <span class="o">...</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Subscriber Pattern</strong></p>
<p>Services subscribe to events they’re interested in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Subscriber</span> <span class="n">Implementation</span><span class="p">:</span>

<span class="o">+------------------------------------------------+</span>
<span class="o">|</span>         <span class="nb">bin</span><span class="o">-</span><span class="n">billing</span><span class="o">-</span><span class="n">manager</span>                    <span class="o">|</span>
<span class="o">|</span>                                                <span class="o">|</span>
<span class="o">|</span>  <span class="mf">1.</span> <span class="n">Declare</span> <span class="n">Exchange</span>                           <span class="o">|</span>
<span class="o">|</span>     <span class="o">+-</span> <span class="n">call</span><span class="o">.</span><span class="n">events</span> <span class="p">(</span><span class="n">fanout</span><span class="p">)</span>                    <span class="o">|</span>
<span class="o">|</span>                                                <span class="o">|</span>
<span class="o">|</span>  <span class="mf">2.</span> <span class="n">Create</span> <span class="n">Queue</span>                               <span class="o">|</span>
<span class="o">|</span>     <span class="o">+-</span> <span class="n">billing</span><span class="o">.</span><span class="n">call</span><span class="o">.</span><span class="n">events</span> <span class="p">(</span><span class="n">unique</span><span class="p">)</span>            <span class="o">|</span>
<span class="o">|</span>                                                <span class="o">|</span>
<span class="o">|</span>  <span class="mf">3.</span> <span class="n">Bind</span> <span class="n">Queue</span> <span class="n">to</span> <span class="n">Exchange</span>                     <span class="o">|</span>
<span class="o">|</span>     <span class="o">+-</span> <span class="n">Receive</span> <span class="nb">all</span> <span class="n">events</span> <span class="kn">from</span> <span class="nn">exchange</span>        <span class="o">|</span>
<span class="o">|</span>                                                <span class="o">|</span>
<span class="o">|</span>  <span class="mf">4.</span> <span class="n">Consume</span> <span class="n">Events</span>                             <span class="o">|</span>
<span class="o">|</span>     <span class="o">+-</span> <span class="n">call</span><span class="o">.</span><span class="n">created</span> <span class="o">-&gt;</span> <span class="n">Track</span> <span class="n">call</span> <span class="n">start</span>        <span class="o">|</span>
<span class="o">|</span>     <span class="o">+-</span> <span class="n">call</span><span class="o">.</span><span class="n">answered</span> <span class="o">-&gt;</span> <span class="n">Start</span> <span class="n">billing</span>          <span class="o">|</span>
<span class="o">|</span>     <span class="o">+-</span> <span class="n">call</span><span class="o">.</span><span class="n">ended</span> <span class="o">-&gt;</span> <span class="n">Calculate</span> <span class="n">charges</span>         <span class="o">|</span>
<span class="o">|</span>     <span class="o">+-</span> <span class="n">Other</span> <span class="n">events</span> <span class="o">-&gt;</span> <span class="n">Ignore</span>                  <span class="o">|</span>
<span class="o">|</span>                                                <span class="o">|</span>
<span class="o">+------------------------------------------------+</span>
</pre></div>
</div>
<p><strong>Event Processing Guarantees</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Event</span> <span class="n">Processing</span><span class="p">:</span>

<span class="o">+--------------+</span>
<span class="o">|</span>   <span class="n">Publish</span>    <span class="o">|</span>
<span class="o">+------+-------+</span>
       <span class="o">|</span>
       <span class="o">|</span>  <span class="n">RabbitMQ</span> <span class="n">persists</span> <span class="n">event</span>
       <span class="o">|</span>  <span class="p">(</span><span class="n">survives</span> <span class="n">broker</span> <span class="n">restart</span><span class="p">)</span>
       <span class="n">v</span>
<span class="o">+--------------+</span>
<span class="o">|</span>   <span class="n">Deliver</span>    <span class="o">|</span>
<span class="o">+------+-------+</span>
       <span class="o">|</span>
       <span class="o">|</span>  <span class="n">Subscriber</span> <span class="n">processes</span>
       <span class="o">|</span>  <span class="p">(</span><span class="n">may</span> <span class="n">retry</span> <span class="n">on</span> <span class="n">failure</span><span class="p">)</span>
       <span class="n">v</span>
<span class="o">+--------------+</span>
<span class="o">|</span>     <span class="n">ACK</span>      <span class="o">|</span>
<span class="o">+--------------+</span>
       <span class="o">|</span>
       <span class="o">|</span>  <span class="n">Remove</span> <span class="kn">from</span> <span class="nn">queue</span>
       <span class="o">|</span>  <span class="p">(</span><span class="n">event</span> <span class="n">processed</span> <span class="n">successfully</span><span class="p">)</span>
       <span class="n">v</span>
<span class="o">+--------------+</span>
<span class="o">|</span>   <span class="n">Complete</span>   <span class="o">|</span>
<span class="o">+--------------+</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>At-Least-Once Delivery</strong>: Events delivered at least once (may duplicate)</p></li>
<li><p><strong>Persistent</strong>: Events survive broker restart</p></li>
<li><p><strong>Manual ACK</strong>: Subscriber acknowledges after processing</p></li>
<li><p><strong>Retry on Failure</strong>: Redelivered if subscriber crashes</p></li>
</ul>
</section>
<section id="zeromq-event-streaming">
<h3>ZeroMQ Event Streaming<a class="headerlink" href="#zeromq-event-streaming" title="Link to this heading"></a></h3>
<p>For high-performance, low-latency event streaming, VoIPBIN uses ZeroMQ pub/sub sockets.</p>
<p><strong>ZMQ Architecture</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ZeroMQ</span> <span class="n">Pub</span><span class="o">/</span><span class="n">Sub</span> <span class="n">Pattern</span><span class="p">:</span>

<span class="n">Publishers</span>                               <span class="n">Subscribers</span>
     <span class="o">|</span>                                        <span class="o">|</span>
     <span class="o">|</span>  <span class="n">Call</span> <span class="n">Manager</span>                          <span class="o">|</span>
     <span class="o">|</span>  <span class="p">(</span><span class="n">publishes</span> <span class="n">call</span> <span class="n">events</span><span class="p">)</span>               <span class="o">|</span>
     <span class="o">+----------------------+</span>                 <span class="o">|</span>
     <span class="o">|</span>  <span class="n">ZMQ</span> <span class="n">PUB</span> <span class="n">Socket</span>      <span class="o">|</span>                 <span class="o">|</span>
     <span class="o">|</span>  <span class="n">tcp</span><span class="p">:</span><span class="o">//*</span><span class="p">:</span><span class="mi">5555</span>        <span class="o">|</span>                 <span class="o">|</span>
     <span class="o">+----------+-----------+</span>                 <span class="o">|</span>
                <span class="o">|</span>                             <span class="o">|</span>
                <span class="o">|</span>  <span class="n">Event</span> <span class="n">Stream</span>               <span class="o">|</span>
                <span class="o">|</span>  <span class="p">(</span><span class="n">no</span> <span class="n">broker</span><span class="p">)</span>                <span class="o">|</span>
                <span class="o">|</span>                             <span class="o">|</span>
                <span class="o">+----------------------------&gt;&gt;</span> <span class="n">Agent</span> <span class="n">Manager</span>
                <span class="o">|</span>                             <span class="o">|</span> <span class="p">(</span><span class="n">agent</span> <span class="n">presence</span><span class="p">)</span>
                <span class="o">|</span>                             <span class="o">|</span>
                <span class="o">+----------------------------&gt;&gt;</span> <span class="n">Webhook</span> <span class="n">Manager</span>
                <span class="o">|</span>                             <span class="o">|</span> <span class="p">(</span><span class="n">webhook</span> <span class="n">delivery</span><span class="p">)</span>
                <span class="o">|</span>                             <span class="o">|</span>
                <span class="o">+----------------------------&gt;&gt;</span> <span class="n">Talk</span> <span class="n">Manager</span>
                                              <span class="o">|</span> <span class="p">(</span><span class="n">agent</span> <span class="n">UI</span> <span class="n">updates</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Key Differences from RabbitMQ</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">RabbitMQ</span> <span class="n">vs</span> <span class="n">ZeroMQ</span><span class="p">:</span>

<span class="n">RabbitMQ</span><span class="p">:</span>                          <span class="n">ZeroMQ</span><span class="p">:</span>
<span class="o">+------------+</span>                     <span class="o">+------------+</span>
<span class="o">|</span> <span class="n">Publisher</span>  <span class="o">|</span>                     <span class="o">|</span> <span class="n">Publisher</span>  <span class="o">|</span>
<span class="o">+------+-----+</span>                     <span class="o">+------+-----+</span>
       <span class="o">|</span>                                  <span class="o">|</span>
       <span class="o">|</span> <span class="n">Reliable</span>                         <span class="o">|</span> <span class="n">Fast</span>
       <span class="o">|</span> <span class="n">Persistent</span>                       <span class="o">|</span> <span class="n">In</span><span class="o">-</span><span class="n">memory</span>
       <span class="o">|</span> <span class="n">Broker</span><span class="o">-</span><span class="n">based</span>                     <span class="o">|</span> <span class="n">Direct</span> <span class="n">socket</span>
       <span class="n">v</span>                                  <span class="n">v</span>
<span class="o">+------------+</span>                     <span class="o">+------------+</span>
<span class="o">|</span>  <span class="n">RabbitMQ</span>  <span class="o">|</span>                     <span class="o">|</span> <span class="n">Subscriber</span> <span class="o">|</span>
<span class="o">|</span>   <span class="n">Broker</span>   <span class="o">|</span>                     <span class="o">|</span>  <span class="p">(</span><span class="n">Direct</span><span class="p">)</span>  <span class="o">|</span>
<span class="o">+------+-----+</span>                     <span class="o">+------------+</span>
       <span class="o">|</span>
       <span class="o">|</span> <span class="n">At</span><span class="o">-</span><span class="n">least</span><span class="o">-</span><span class="n">once</span>
       <span class="n">v</span>
<span class="o">+------------+</span>
<span class="o">|</span> <span class="n">Subscriber</span> <span class="o">|</span>
<span class="o">+------------+</span>
</pre></div>
</div>
<p><strong>RabbitMQ:</strong>
* Persistent, reliable
* Guaranteed delivery
* Message queuing
* Higher latency (~10ms)</p>
<p><strong>ZeroMQ:</strong>
* In-memory, fast
* Best-effort delivery
* Direct sockets
* Lower latency (&lt;1ms)</p>
<p><strong>Use Cases</strong></p>
<p>VoIPBIN uses ZeroMQ for:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ZeroMQ</span> <span class="n">Use</span> <span class="n">Cases</span><span class="p">:</span>

<span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="n">Agent</span> <span class="n">Presence</span> <span class="n">Updates</span>
  <span class="n">o</span> <span class="n">Agent</span> <span class="n">login</span><span class="o">/</span><span class="n">logout</span>
  <span class="n">o</span> <span class="n">Status</span> <span class="n">changes</span> <span class="p">(</span><span class="n">available</span><span class="p">,</span> <span class="n">busy</span><span class="p">,</span> <span class="n">away</span><span class="p">)</span>
  <span class="n">o</span> <span class="n">Real</span><span class="o">-</span><span class="n">time</span> <span class="n">UI</span> <span class="n">updates</span>
  <span class="n">o</span> <span class="n">High</span> <span class="n">frequency</span><span class="p">,</span> <span class="n">acceptable</span> <span class="n">loss</span>

<span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="n">Call</span> <span class="n">State</span> <span class="n">Changes</span>
  <span class="n">o</span> <span class="n">Call</span> <span class="n">ringing</span><span class="p">,</span> <span class="n">answered</span><span class="p">,</span> <span class="n">ended</span>
  <span class="n">o</span> <span class="n">Conference</span> <span class="n">participant</span> <span class="n">updates</span>
  <span class="n">o</span> <span class="n">Duplicate</span> <span class="k">with</span> <span class="n">RabbitMQ</span> <span class="p">(</span><span class="n">redundant</span><span class="p">)</span>
  <span class="n">o</span> <span class="n">Speed</span> <span class="n">over</span> <span class="n">reliability</span>

<span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="n">Real</span><span class="o">-</span><span class="n">Time</span> <span class="n">Metrics</span>
  <span class="n">o</span> <span class="n">Queue</span> <span class="n">statistics</span>
  <span class="n">o</span> <span class="n">Active</span> <span class="n">call</span> <span class="n">counts</span>
  <span class="n">o</span> <span class="n">System</span> <span class="n">health</span> <span class="n">metrics</span>
  <span class="n">o</span> <span class="n">Dashboard</span> <span class="n">updates</span>

<span class="p">[</span> <span class="p">]</span> <span class="n">NOT</span> <span class="n">Used</span> <span class="n">For</span><span class="p">:</span>
  <span class="n">o</span> <span class="n">Billing</span> <span class="n">events</span> <span class="p">(</span><span class="n">use</span> <span class="n">RabbitMQ</span><span class="p">)</span>
  <span class="n">o</span> <span class="n">Webhook</span> <span class="n">delivery</span> <span class="p">(</span><span class="n">use</span> <span class="n">RabbitMQ</span><span class="p">)</span>
  <span class="n">o</span> <span class="n">Critical</span> <span class="n">state</span> <span class="n">changes</span> <span class="p">(</span><span class="n">use</span> <span class="n">RabbitMQ</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>ZMQ Message Format</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ZMQ</span> <span class="n">Message</span> <span class="n">Structure</span><span class="p">:</span>

<span class="n">Topic</span> <span class="p">(</span><span class="n">routing</span> <span class="n">key</span><span class="p">)</span>
<span class="o">|</span>
<span class="o">+-</span> <span class="s2">&quot;agent.presence&quot;</span>
<span class="o">|</span>  <span class="p">{</span>
<span class="o">|</span>    <span class="s2">&quot;agent_id&quot;</span><span class="p">:</span> <span class="s2">&quot;agent-123&quot;</span><span class="p">,</span>
<span class="o">|</span>    <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;available&quot;</span><span class="p">,</span>
<span class="o">|</span>    <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2026-01-20T12:00:00.000Z&quot;</span>
<span class="o">|</span>  <span class="p">}</span>
<span class="o">|</span>
<span class="o">+-</span> <span class="s2">&quot;call.state&quot;</span>
<span class="o">|</span>  <span class="p">{</span>
<span class="o">|</span>    <span class="s2">&quot;call_id&quot;</span><span class="p">:</span> <span class="s2">&quot;call-789&quot;</span><span class="p">,</span>
<span class="o">|</span>    <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;answered&quot;</span><span class="p">,</span>
<span class="o">|</span>    <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2026-01-20T12:00:01.000Z&quot;</span>
<span class="o">|</span>  <span class="p">}</span>
<span class="o">|</span>
<span class="o">+-</span> <span class="s2">&quot;queue.stats&quot;</span>
   <span class="p">{</span>
     <span class="s2">&quot;queue_id&quot;</span><span class="p">:</span> <span class="s2">&quot;queue-456&quot;</span><span class="p">,</span>
     <span class="s2">&quot;waiting&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
     <span class="s2">&quot;active&quot;</span><span class="p">:</span> <span class="mi">3</span>
   <span class="p">}</span>
</pre></div>
</div>
<p><strong>Topic Filtering</strong></p>
<p>Subscribers can filter events by topic:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Topic</span><span class="o">-</span><span class="n">Based</span> <span class="n">Filtering</span><span class="p">:</span>

<span class="n">Subscriber</span> <span class="n">A</span><span class="p">:</span>
<span class="n">o</span> <span class="n">Subscribe</span> <span class="n">to</span><span class="p">:</span> <span class="s2">&quot;agent.*&quot;</span>
<span class="n">o</span> <span class="n">Receives</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">agent</span><span class="o">.</span><span class="n">presence</span>
  <span class="o">-</span> <span class="n">agent</span><span class="o">.</span><span class="n">login</span>
  <span class="o">-</span> <span class="n">agent</span><span class="o">.</span><span class="n">logout</span>

<span class="n">Subscriber</span> <span class="n">B</span><span class="p">:</span>
<span class="n">o</span> <span class="n">Subscribe</span> <span class="n">to</span><span class="p">:</span> <span class="s2">&quot;call.*&quot;</span>
<span class="n">o</span> <span class="n">Receives</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">call</span><span class="o">.</span><span class="n">state</span>
  <span class="o">-</span> <span class="n">call</span><span class="o">.</span><span class="n">metrics</span>

<span class="n">Subscriber</span> <span class="n">C</span><span class="p">:</span>
<span class="n">o</span> <span class="n">Subscribe</span> <span class="n">to</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>  <span class="p">(</span><span class="n">empty</span> <span class="o">=</span> <span class="nb">all</span><span class="p">)</span>
<span class="n">o</span> <span class="n">Receives</span><span class="p">:</span> <span class="n">everything</span>
</pre></div>
</div>
</section>
<section id="websocket-communication">
<h3>WebSocket Communication<a class="headerlink" href="#websocket-communication" title="Link to this heading"></a></h3>
<p>For real-time client communication, VoIPBIN uses WebSocket connections.</p>
<p><strong>WebSocket Architecture</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">WebSocket</span> <span class="n">Connection</span> <span class="n">Flow</span><span class="p">:</span>

<span class="n">Client</span> <span class="p">(</span><span class="n">Browser</span><span class="o">/</span><span class="n">App</span><span class="p">)</span>    <span class="n">API</span> <span class="n">Gateway</span>         <span class="n">Backend</span> <span class="n">Services</span>
     <span class="o">|</span>                      <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">|</span>  <span class="mf">1.</span> <span class="n">HTTP</span> <span class="n">Upgrade</span>     <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">|</span>  <span class="p">(</span><span class="n">WebSocket</span><span class="p">)</span>         <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">+---------------------&gt;&gt;</span>                       <span class="o">|</span>
     <span class="o">|</span>                      <span class="o">|</span>  <span class="mf">2.</span> <span class="n">Authenticate</span>      <span class="o">|</span>
     <span class="o">|</span>                      <span class="o">|</span>     <span class="p">(</span><span class="n">JWT</span> <span class="n">token</span><span class="p">)</span>       <span class="o">|</span>
     <span class="o">|</span>                      <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">|</span>  <span class="mf">3.</span> <span class="n">Connection</span>       <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">|</span>     <span class="n">Established</span>      <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">&lt;&lt;---------------------+</span>                       <span class="o">|</span>
     <span class="o">|</span>                      <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">|</span>  <span class="mf">4.</span> <span class="n">Subscribe</span>        <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">|</span>  <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;subscribe&quot;</span><span class="p">,</span><span class="o">|</span>                       <span class="o">|</span>
     <span class="o">|</span>   <span class="s2">&quot;topics&quot;</span><span class="p">:[</span><span class="s2">&quot;...&quot;</span><span class="p">]}</span>  <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">+---------------------&gt;&gt;</span>                       <span class="o">|</span>
     <span class="o">|</span>                      <span class="o">|</span>  <span class="mf">5.</span> <span class="n">Register</span>          <span class="o">|</span>
     <span class="o">|</span>                      <span class="o">|</span>     <span class="n">subscription</span>      <span class="o">|</span>
     <span class="o">|</span>                      <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">|</span>                      <span class="o">|</span>  <span class="mf">6.</span> <span class="n">Backend</span> <span class="n">Event</span>     <span class="o">|</span>
     <span class="o">|</span>                      <span class="o">&lt;&lt;----------------------+</span>
     <span class="o">|</span>                      <span class="o">|</span>  <span class="p">(</span><span class="n">via</span> <span class="n">RabbitMQ</span><span class="o">/</span><span class="n">ZMQ</span><span class="p">)</span>   <span class="o">|</span>
     <span class="o">|</span>                      <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">|</span>  <span class="mf">7.</span> <span class="n">Push</span> <span class="n">to</span> <span class="n">Client</span>   <span class="o">|</span>                       <span class="o">|</span>
     <span class="o">&lt;&lt;---------------------+</span>                       <span class="o">|</span>
     <span class="o">|</span>  <span class="p">{</span><span class="s2">&quot;event&quot;</span><span class="p">:</span><span class="s2">&quot;call.     |                       |</span>
     <span class="o">|</span>   <span class="n">created</span><span class="s2">&quot;,...}      |                       |</span>
     <span class="o">|</span>                      <span class="o">|</span>                       <span class="o">|</span>
</pre></div>
</div>
<p><strong>Subscription Topics</strong></p>
<p>Clients subscribe to specific event topics:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Topic</span> <span class="n">Pattern</span><span class="p">:</span>
<span class="n">customer_id</span><span class="p">:</span><span class="o">&lt;</span><span class="nb">id</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">resource</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">resource_id</span><span class="o">&gt;</span>

<span class="n">Examples</span><span class="p">:</span>
<span class="n">o</span> <span class="n">customer_id</span><span class="p">:</span><span class="mi">123</span><span class="p">:</span><span class="n">call</span><span class="p">:</span><span class="o">*</span>
  <span class="o">-&gt;</span> <span class="n">All</span> <span class="n">calls</span> <span class="k">for</span> <span class="n">customer</span> <span class="mi">123</span>

<span class="n">o</span> <span class="n">customer_id</span><span class="p">:</span><span class="mi">123</span><span class="p">:</span><span class="n">call</span><span class="p">:</span><span class="n">call</span><span class="o">-</span><span class="mi">789</span>
  <span class="o">-&gt;</span> <span class="n">Specific</span> <span class="n">call</span> <span class="n">updates</span>

<span class="n">o</span> <span class="n">customer_id</span><span class="p">:</span><span class="mi">123</span><span class="p">:</span><span class="n">agent</span><span class="p">:</span><span class="n">agent</span><span class="o">-</span><span class="mi">456</span>
  <span class="o">-&gt;</span> <span class="n">Specific</span> <span class="n">agent</span> <span class="n">updates</span>

<span class="n">o</span> <span class="n">customer_id</span><span class="p">:</span><span class="mi">123</span><span class="p">:</span><span class="n">queue</span><span class="p">:</span><span class="o">*</span>
  <span class="o">-&gt;</span> <span class="n">All</span> <span class="n">queues</span> <span class="k">for</span> <span class="n">customer</span>

<span class="n">o</span> <span class="n">customer_id</span><span class="p">:</span><span class="mi">123</span><span class="p">:</span><span class="n">conference</span><span class="p">:</span><span class="n">conf</span><span class="o">-</span><span class="mi">999</span>
  <span class="o">-&gt;</span> <span class="n">Specific</span> <span class="n">conference</span> <span class="n">updates</span>
</pre></div>
</div>
<p><strong>WebSocket Use Cases</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">WebSocket</span> <span class="n">Applications</span><span class="p">:</span>

<span class="n">Agent</span> <span class="n">Dashboard</span><span class="p">:</span>
<span class="o">+--------------------------------------+</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Real</span><span class="o">-</span><span class="n">time</span> <span class="n">call</span> <span class="n">notifications</span>       <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Queue</span> <span class="n">status</span> <span class="n">updates</span>               <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Agent</span> <span class="n">presence</span>                     <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Live</span> <span class="n">chat</span> <span class="n">messages</span>                 <span class="o">|</span>
<span class="o">+--------------------------------------+</span>

<span class="n">Customer</span> <span class="n">Portal</span><span class="p">:</span>
<span class="o">+--------------------------------------+</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Call</span> <span class="n">status</span> <span class="n">updates</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Campaign</span> <span class="n">progress</span>                  <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Billing</span> <span class="n">updates</span>                    <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">System</span> <span class="n">notifications</span>               <span class="o">|</span>
<span class="o">+--------------------------------------+</span>

<span class="n">Media</span> <span class="n">Streaming</span><span class="p">:</span>
<span class="o">+--------------------------------------+</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Bi</span><span class="o">-</span><span class="n">directional</span> <span class="n">audio</span> <span class="p">(</span><span class="n">RTP</span><span class="p">)</span>         <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Live</span> <span class="n">transcription</span> <span class="n">feed</span>            <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Real</span><span class="o">-</span><span class="n">time</span> <span class="n">metrics</span>                  <span class="o">|</span>
<span class="o">+--------------------------------------+</span>
</pre></div>
</div>
<p><strong>Connection Management</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">WebSocket</span> <span class="n">Lifecycle</span><span class="p">:</span>

<span class="o">+------------+</span>
<span class="o">|</span>  <span class="n">Connect</span>   <span class="o">|</span>  <span class="n">Client</span> <span class="n">establishes</span> <span class="n">WebSocket</span>
<span class="o">+------+-----+</span>
       <span class="o">|</span>
       <span class="n">v</span>
<span class="o">+------------+</span>
<span class="o">|</span> <span class="n">Authenticate</span><span class="o">|</span>  <span class="n">Validate</span> <span class="n">JWT</span> <span class="n">token</span>
<span class="o">+------+-----+</span>
       <span class="o">|</span>
       <span class="n">v</span>
<span class="o">+------------+</span>
<span class="o">|</span> <span class="n">Subscribe</span>  <span class="o">|</span>  <span class="n">Client</span> <span class="n">subscribes</span> <span class="n">to</span> <span class="n">topics</span>
<span class="o">+------+-----+</span>
       <span class="o">|</span>
       <span class="n">v</span>
<span class="o">+------------+</span>
<span class="o">|</span>  <span class="n">Active</span>    <span class="o">|</span>  <span class="n">Bi</span><span class="o">-</span><span class="n">directional</span> <span class="n">communication</span>
<span class="o">|</span>            <span class="o">|</span>  <span class="n">o</span> <span class="n">Server</span> <span class="n">pushes</span> <span class="n">events</span>
<span class="o">|</span>            <span class="o">|</span>  <span class="n">o</span> <span class="n">Client</span> <span class="n">sends</span> <span class="n">commands</span>
<span class="o">|</span>            <span class="o">|</span>  <span class="n">o</span> <span class="n">Pinger</span> <span class="n">sends</span> <span class="n">ping</span> <span class="n">frames</span>
<span class="o">+------+-----+</span>
       <span class="o">|</span>
       <span class="o">|</span>  <span class="p">(</span><span class="n">Keep</span><span class="o">-</span><span class="n">alive</span> <span class="n">ping</span><span class="o">/</span><span class="n">pong</span><span class="p">)</span>
       <span class="o">|</span>
       <span class="n">v</span>
<span class="o">+------------+</span>
<span class="o">|</span> <span class="n">Disconnect</span> <span class="o">|</span>  <span class="n">Connection</span> <span class="n">closed</span>
<span class="o">+------------+</span>
</pre></div>
</div>
<p><strong>Keep-Alive Mechanism (Server-Side Ping/Pong)</strong></p>
<p>VoIPBIN implements server-side keep-alive to prevent load balancer timeouts:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Keep</span><span class="o">-</span><span class="n">Alive</span> <span class="n">Configuration</span><span class="p">:</span>

<span class="o">+------------------------------------------------+</span>
<span class="o">|</span>  <span class="n">Ping</span> <span class="n">Interval</span><span class="p">:</span>  <span class="mi">30</span> <span class="n">seconds</span>                    <span class="o">|</span>
<span class="o">|</span>  <span class="n">Pong</span> <span class="n">Wait</span><span class="p">:</span>      <span class="mi">60</span> <span class="n">seconds</span>                    <span class="o">|</span>
<span class="o">|</span>  <span class="n">Write</span> <span class="n">Timeout</span><span class="p">:</span>  <span class="mi">10</span> <span class="n">seconds</span>                    <span class="o">|</span>
<span class="o">+------------------------------------------------+</span>

<span class="n">Keep</span><span class="o">-</span><span class="n">Alive</span> <span class="n">Flow</span><span class="p">:</span>

<span class="n">Server</span>                                    <span class="n">Client</span>
   <span class="o">|</span>                                         <span class="o">|</span>
   <span class="o">|</span>  <span class="n">Every</span> <span class="mi">30</span><span class="n">s</span><span class="p">:</span> <span class="n">Send</span> <span class="n">Ping</span> <span class="n">Frame</span>             <span class="o">|</span>
   <span class="o">+----------------------------------------&gt;&gt;</span>
   <span class="o">|</span>                                         <span class="o">|</span>
   <span class="o">|</span>  <span class="n">Automatic</span> <span class="n">Pong</span> <span class="n">Response</span>                <span class="o">|</span>
   <span class="o">&lt;&lt;----------------------------------------+</span>
   <span class="o">|</span>                                         <span class="o">|</span>
   <span class="o">|</span>  <span class="n">Reset</span> <span class="n">read</span> <span class="n">deadline</span> <span class="p">(</span><span class="mi">60</span><span class="n">s</span><span class="p">)</span>              <span class="o">|</span>
   <span class="o">|</span>                                         <span class="o">|</span>

<span class="n">Error</span> <span class="n">Detection</span><span class="p">:</span>
<span class="o">+------------------------------------------------+</span>
<span class="o">|</span>  <span class="n">No</span> <span class="n">pong</span> <span class="n">within</span> <span class="mi">60</span><span class="n">s</span> <span class="o">-&gt;</span> <span class="n">Connection</span> <span class="n">dead</span>         <span class="o">|</span>
<span class="o">|</span>  <span class="n">Write</span> <span class="n">failure</span> <span class="o">-&gt;</span> <span class="n">Connection</span> <span class="n">broken</span>            <span class="o">|</span>
<span class="o">|</span>  <span class="n">Either</span> <span class="n">error</span> <span class="o">-&gt;</span> <span class="n">Close</span> <span class="ow">and</span> <span class="n">cleanup</span>             <span class="o">|</span>
<span class="o">+------------------------------------------------+</span>
</pre></div>
</div>
<p><strong>Keep-Alive Benefits:</strong></p>
<ul class="simple">
<li><p><strong>Prevents Idle Drops</strong>: Load balancers see regular traffic</p></li>
<li><p><strong>Dead Connection Detection</strong>: Server detects unresponsive clients</p></li>
<li><p><strong>Automatic Cleanup</strong>: Zombie connections closed promptly</p></li>
<li><p><strong>RFC 6455 Compliant</strong>: Uses standard WebSocket ping/pong frames</p></li>
</ul>
<p><strong>Connection Features:</strong></p>
<ul class="simple">
<li><p><strong>Keepalive</strong>: Server-side ping every 30 seconds</p></li>
<li><p><strong>Dead Detection</strong>: 60-second timeout for pong response</p></li>
<li><p><strong>Auto-Reconnect</strong>: Client should reconnect on disconnect</p></li>
<li><p><strong>Subscription Restore</strong>: Re-subscribe after reconnect</p></li>
<li><p><strong>Write Protection</strong>: Mutex prevents concurrent write race conditions</p></li>
</ul>
</section>
<section id="message-reliability">
<h3>Message Reliability<a class="headerlink" href="#message-reliability" title="Link to this heading"></a></h3>
<p>Different patterns provide different reliability guarantees:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Reliability Comparison:

Pattern          Delivery          Persistence    Use Case
───────────────────────────────────────────────────────────
RabbitMQ RPC     Exactly-once     Yes            Critical ops
                 (request-reply)

RabbitMQ Pub/Sub At-least-once    Yes            Important events
                 (may duplicate)

ZeroMQ Pub/Sub   Best-effort      No             Real-time updates
                 (may lose)

WebSocket        Best-effort      No             Client notifications
                 (may lose)
</pre></div>
</div>
<p><strong>Reliability Patterns</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Ensuring</span> <span class="n">Reliability</span><span class="p">:</span>

<span class="n">Critical</span> <span class="n">Operations</span> <span class="p">(</span><span class="n">RabbitMQ</span> <span class="n">RPC</span><span class="p">):</span>
<span class="o">+------------------------------------+</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Persistent</span> <span class="n">messages</span>              <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Manual</span> <span class="n">acknowledgment</span>            <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Automatic</span> <span class="n">retry</span>                  <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Timeout</span> <span class="n">handling</span>                 <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Idempotent</span> <span class="n">operations</span>            <span class="o">|</span>
<span class="o">+------------------------------------+</span>

<span class="n">Important</span> <span class="n">Events</span> <span class="p">(</span><span class="n">RabbitMQ</span> <span class="n">Pub</span><span class="o">/</span><span class="n">Sub</span><span class="p">):</span>
<span class="o">+------------------------------------+</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Persistent</span> <span class="n">messages</span>              <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Multiple</span> <span class="n">subscribers</span>             <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Redundant</span> <span class="n">processing</span> <span class="n">OK</span>          <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Deduplication</span> <span class="ow">in</span> <span class="n">subscriber</span>      <span class="o">|</span>
<span class="o">+------------------------------------+</span>

<span class="n">Real</span><span class="o">-</span><span class="n">Time</span> <span class="n">Updates</span> <span class="p">(</span><span class="n">ZeroMQ</span><span class="p">):</span>
<span class="o">+------------------------------------+</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">No</span> <span class="n">persistence</span>                   <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Fast</span> <span class="n">delivery</span>                    <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Acceptable</span> <span class="n">loss</span>                  <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Often</span> <span class="n">duplicated</span> <span class="ow">in</span> <span class="n">RabbitMQ</span>     <span class="o">|</span>
<span class="o">+------------------------------------+</span>
</pre></div>
</div>
</section>
<section id="message-ordering">
<h3>Message Ordering<a class="headerlink" href="#message-ordering" title="Link to this heading"></a></h3>
<p>VoIPBIN guarantees ordering within specific boundaries:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Ordering</span> <span class="n">Guarantees</span><span class="p">:</span>

<span class="n">Same</span> <span class="n">Queue</span><span class="p">:</span>              <span class="n">Different</span> <span class="n">Queues</span><span class="p">:</span>
<span class="o">+----------+</span>             <span class="o">+----------+</span>  <span class="o">+----------+</span>
<span class="o">|</span> <span class="n">Message</span> <span class="mi">1</span><span class="o">|</span>             <span class="o">|</span> <span class="n">Message</span> <span class="mi">1</span><span class="o">|</span>  <span class="o">|</span> <span class="n">Message</span> <span class="mi">2</span><span class="o">|</span>
<span class="o">+-----+----+</span>             <span class="o">+-----+----+</span>  <span class="o">+-----+----+</span>
      <span class="o">|</span>                        <span class="o">|</span>             <span class="o">|</span>
      <span class="o">|</span> <span class="n">Queue</span> <span class="n">A</span>                <span class="o">|</span> <span class="n">Queue</span> <span class="n">A</span>     <span class="o">|</span> <span class="n">Queue</span> <span class="n">B</span>
      <span class="o">|</span>                        <span class="o">|</span>             <span class="o">|</span>
      <span class="n">v</span>                        <span class="n">v</span>             <span class="n">v</span>
<span class="o">+----------+</span>             <span class="o">+----------+</span>  <span class="o">+----------+</span>
<span class="o">|</span> <span class="n">Message</span> <span class="mi">2</span><span class="o">|</span>             <span class="o">|</span> <span class="n">Service</span> <span class="n">A</span><span class="o">|</span>  <span class="o">|</span> <span class="n">Service</span> <span class="n">B</span><span class="o">|</span>
<span class="o">+-----+----+</span>             <span class="o">+----------+</span>  <span class="o">+----------+</span>
      <span class="o">|</span>                        <span class="o">|</span>             <span class="o">|</span>
      <span class="o">|</span>                        <span class="o">|</span>  <span class="n">May</span> <span class="n">arrive</span> <span class="ow">in</span> <span class="nb">any</span> <span class="n">order</span>
      <span class="n">v</span>                        <span class="n">v</span>             <span class="n">v</span>
<span class="o">+----------+</span>             <span class="o">+----------+</span>  <span class="o">+----------+</span>
<span class="o">|</span> <span class="n">Message</span> <span class="mi">3</span><span class="o">|</span>             <span class="o">|</span> <span class="n">Ordered</span>  <span class="o">|</span>  <span class="o">|</span> <span class="n">No</span> <span class="n">order</span> <span class="o">|</span>
<span class="o">+----------+</span>             <span class="o">|</span> <span class="n">delivery</span> <span class="o">|</span>  <span class="o">|</span> <span class="n">guarantee</span><span class="o">|</span>
                         <span class="o">+----------+</span>  <span class="o">+----------+</span>

<span class="n">Ordered</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span>               <span class="n">Unordered</span> <span class="p">[</span> <span class="p">]</span>
</pre></div>
</div>
<p><strong>Ordering Strategy:</strong></p>
<ul class="simple">
<li><p><strong>Within Queue</strong>: Messages delivered in order to same consumer</p></li>
<li><p><strong>Across Queues</strong>: No ordering guarantee</p></li>
<li><p><strong>Single Publisher</strong>: Maintains order if using single connection</p></li>
<li><p><strong>Application Logic</strong>: Handle out-of-order messages when necessary</p></li>
</ul>
</section>
<section id="error-handling-and-retries">
<h3>Error Handling and Retries<a class="headerlink" href="#error-handling-and-retries" title="Link to this heading"></a></h3>
<p>VoIPBIN implements comprehensive error handling:</p>
<p><strong>Retry Strategy</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Exponential Backoff Retry:

Attempt    Delay      Total Time
──────────────────────────────────
1          0s         0s
2          1s         1s
3          2s         3s
4          4s         7s
5          8s         15s
6          16s        31s
7          32s        63s
Max: 7 attempts, ~1 minute total
</pre></div>
</div>
<p><strong>Dead Letter Queue</strong></p>
<p>Failed messages move to dead letter queue for investigation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Dead</span> <span class="n">Letter</span> <span class="n">Processing</span><span class="p">:</span>

<span class="n">Normal</span> <span class="n">Flow</span><span class="p">:</span>              <span class="n">Failed</span> <span class="n">Flow</span><span class="p">:</span>
<span class="o">+----------+</span>              <span class="o">+----------+</span>
<span class="o">|</span> <span class="n">Message</span>  <span class="o">|</span>              <span class="o">|</span> <span class="n">Message</span>  <span class="o">|</span>
<span class="o">+-----+----+</span>              <span class="o">+-----+----+</span>
      <span class="o">|</span>                         <span class="o">|</span>
      <span class="o">|</span> <span class="n">Process</span>                 <span class="o">|</span> <span class="n">Process</span> <span class="p">(</span><span class="n">fails</span><span class="p">)</span>
      <span class="n">v</span>                         <span class="n">v</span>
<span class="o">+----------+</span>              <span class="o">+----------+</span>
<span class="o">|</span>  <span class="n">Success</span> <span class="o">|</span>              <span class="o">|</span>  <span class="n">Retry</span>   <span class="o">|</span>
<span class="o">+----------+</span>              <span class="o">+-----+----+</span>
                                <span class="o">|</span> <span class="p">(</span><span class="nb">max</span> <span class="n">retries</span> <span class="n">exceeded</span><span class="p">)</span>
                                <span class="n">v</span>
                          <span class="o">+----------+</span>
                          <span class="o">|</span>   <span class="n">DLQ</span>    <span class="o">|</span> <span class="n">Dead</span> <span class="n">Letter</span> <span class="n">Queue</span>
                          <span class="o">+-----+----+</span>
                                <span class="o">|</span>
                                <span class="o">|</span> <span class="n">Manual</span> <span class="n">investigation</span>
                                <span class="o">|</span> <span class="ow">or</span> <span class="n">automated</span> <span class="n">recovery</span>
                                <span class="n">v</span>
                          <span class="o">+----------+</span>
                          <span class="o">|</span>  <span class="n">Alert</span>   <span class="o">|</span>
                          <span class="o">+----------+</span>
</pre></div>
</div>
<p><strong>Error Categories</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Error</span> <span class="n">Handling</span> <span class="n">by</span> <span class="n">Type</span><span class="p">:</span>

<span class="n">Transient</span> <span class="n">Errors</span> <span class="p">(</span><span class="n">Retry</span><span class="p">):</span>
<span class="n">o</span> <span class="n">Network</span> <span class="n">timeout</span>
<span class="n">o</span> <span class="n">Database</span> <span class="n">connection</span> <span class="n">lost</span>
<span class="n">o</span> <span class="n">Service</span> <span class="n">temporarily</span> <span class="n">unavailable</span>
<span class="o">-&gt;</span> <span class="n">Retry</span> <span class="k">with</span> <span class="n">exponential</span> <span class="n">backoff</span>

<span class="n">Permanent</span> <span class="n">Errors</span> <span class="p">(</span><span class="n">Don</span><span class="s1">&#39;t Retry):</span>
<span class="n">o</span> <span class="n">Invalid</span> <span class="n">data</span> <span class="nb">format</span>
<span class="n">o</span> <span class="n">Resource</span> <span class="ow">not</span> <span class="n">found</span>
<span class="n">o</span> <span class="n">Permission</span> <span class="n">denied</span>
<span class="o">-&gt;</span> <span class="n">Send</span> <span class="n">to</span> <span class="n">DLQ</span><span class="p">,</span> <span class="n">alert</span> <span class="n">operator</span>

<span class="n">Business</span> <span class="n">Errors</span> <span class="p">(</span><span class="n">Log</span> <span class="ow">and</span> <span class="n">Return</span><span class="p">):</span>
<span class="n">o</span> <span class="n">Insufficient</span> <span class="n">balance</span>
<span class="n">o</span> <span class="n">Invalid</span> <span class="n">phone</span> <span class="n">number</span>
<span class="n">o</span> <span class="n">Duplicate</span> <span class="n">request</span>
<span class="o">-&gt;</span> <span class="n">Return</span> <span class="n">error</span> <span class="n">to</span> <span class="n">caller</span>
</pre></div>
</div>
</section>
<section id="performance-optimization">
<h3>Performance Optimization<a class="headerlink" href="#performance-optimization" title="Link to this heading"></a></h3>
<p>VoIPBIN optimizes messaging performance:</p>
<p><strong>Connection Pooling</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Connection</span> <span class="n">Management</span><span class="p">:</span>

<span class="n">Service</span> <span class="n">Instance</span>
<span class="o">+------------------------------------+</span>
<span class="o">|</span>                                    <span class="o">|</span>
<span class="o">|</span>  <span class="n">Connection</span> <span class="n">Pool</span> <span class="p">(</span><span class="mi">5</span> <span class="n">connections</span><span class="p">)</span>   <span class="o">|</span>
<span class="o">|</span>  <span class="o">+----+</span> <span class="o">+----+</span> <span class="o">+----+</span> <span class="o">+----+</span> <span class="o">+----+|</span>
<span class="o">|</span>  <span class="o">|</span> <span class="mi">1</span>  <span class="o">|</span> <span class="o">|</span> <span class="mi">2</span>  <span class="o">|</span> <span class="o">|</span> <span class="mi">3</span>  <span class="o">|</span> <span class="o">|</span> <span class="mi">4</span>  <span class="o">|</span> <span class="o">|</span> <span class="mi">5</span>  <span class="o">||</span>
<span class="o">|</span>  <span class="o">+-+--+</span> <span class="o">+-+--+</span> <span class="o">+-+--+</span> <span class="o">+-+--+</span> <span class="o">+-+--+|</span>
<span class="o">|</span>    <span class="o">|</span>      <span class="o">|</span>      <span class="o">|</span>      <span class="o">|</span>      <span class="o">|</span>   <span class="o">|</span>
<span class="o">+----+------+------+------+------+---+</span>
     <span class="o">|</span>      <span class="o">|</span>      <span class="o">|</span>      <span class="o">|</span>      <span class="o">|</span>
     <span class="o">+------+------+------+------+</span>
                <span class="o">|</span>
                <span class="o">|</span> <span class="n">Single</span> <span class="n">TCP</span> <span class="n">connection</span>
                <span class="n">v</span>
          <span class="o">+----------+</span>
          <span class="o">|</span> <span class="n">RabbitMQ</span> <span class="o">|</span>
          <span class="o">+----------+</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Reuse Connections</strong>: Don’t create per-request</p></li>
<li><p><strong>Multiple Channels</strong>: Use channels for concurrency</p></li>
<li><p><strong>Connection Limits</strong>: Pool size based on load</p></li>
<li><p><strong>Health Checks</strong>: Monitor connection health</p></li>
</ul>
<p><strong>Batch Processing</strong></p>
<p>For high-volume operations:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Batch</span> <span class="n">vs</span> <span class="n">Individual</span><span class="p">:</span>

<span class="n">Individual</span> <span class="n">Messages</span><span class="p">:</span>     <span class="n">Batch</span> <span class="n">Processing</span><span class="p">:</span>
<span class="o">+----+</span> <span class="o">+----+</span> <span class="o">+----+</span>    <span class="o">+--------------+</span>
<span class="o">|</span> <span class="n">M1</span> <span class="o">|</span> <span class="o">|</span> <span class="n">M2</span> <span class="o">|</span> <span class="o">|</span> <span class="n">M3</span> <span class="o">|</span>    <span class="o">|</span> <span class="n">M1</span><span class="p">,</span> <span class="n">M2</span><span class="p">,</span> <span class="n">M3</span>   <span class="o">|</span>
<span class="o">+-+--+</span> <span class="o">+-+--+</span> <span class="o">+-+--+</span>    <span class="o">|</span> <span class="n">M4</span><span class="p">,</span> <span class="n">M5</span><span class="p">,</span> <span class="n">M6</span>   <span class="o">|</span>
  <span class="o">|</span>      <span class="o">|</span>      <span class="o">|</span>       <span class="o">|</span> <span class="o">...</span> <span class="p">(</span><span class="mi">100</span><span class="p">)</span>    <span class="o">|</span>
  <span class="n">v</span>      <span class="n">v</span>      <span class="n">v</span>       <span class="o">+------+-------+</span>
<span class="n">Send</span> <span class="mi">100</span> <span class="n">times</span>            <span class="n">Send</span> <span class="n">once</span>
<span class="p">(</span><span class="n">high</span> <span class="n">overhead</span><span class="p">)</span>           <span class="p">(</span><span class="n">low</span> <span class="n">overhead</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Bulk Publishing</strong>: Send multiple messages at once</p></li>
<li><p><strong>Bulk ACK</strong>: Acknowledge multiple messages together</p></li>
<li><p><strong>Reduced Overhead</strong>: Fewer network round-trips</p></li>
<li><p><strong>Higher Throughput</strong>: 10x-100x improvement</p></li>
</ul>
</section>
<section id="monitoring-and-debugging">
<h3>Monitoring and Debugging<a class="headerlink" href="#monitoring-and-debugging" title="Link to this heading"></a></h3>
<p>VoIPBIN monitors all communication channels:</p>
<p><strong>Metrics</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Message</span> <span class="n">Queue</span> <span class="n">Metrics</span><span class="p">:</span>

<span class="n">Queue</span> <span class="n">Depth</span><span class="p">:</span>
<span class="o">+---------------------------------+</span>
<span class="o">|</span>     <span class="n">Pending</span> <span class="n">Messages</span>            <span class="o">|</span>
<span class="o">|</span>  <span class="o">+--++--++--++--++--+</span>           <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span><span class="n">M1</span><span class="o">||</span><span class="n">M2</span><span class="o">||</span><span class="n">M3</span><span class="o">||</span><span class="n">M4</span><span class="o">||</span><span class="n">M5</span><span class="o">|...</span>        <span class="o">|</span>
<span class="o">|</span>  <span class="o">+--++--++--++--++--+</span>           <span class="o">|</span>
<span class="o">+---------------------------------+</span>
<span class="n">Alert</span> <span class="k">if</span> <span class="o">&gt;</span> <span class="mi">1000</span> <span class="n">messages</span>

<span class="n">Processing</span> <span class="n">Rate</span><span class="p">:</span>
<span class="n">Messages</span><span class="o">/</span><span class="n">sec</span><span class="p">:</span> <span class="o">========</span> <span class="mi">850</span><span class="o">/</span><span class="n">s</span>
<span class="n">Target</span><span class="p">:</span>       <span class="o">========</span> <span class="mi">1000</span><span class="o">/</span><span class="n">s</span>
<span class="n">Alert</span> <span class="k">if</span> <span class="o">&lt;</span> <span class="mi">500</span><span class="o">/</span><span class="n">s</span>

<span class="n">Error</span> <span class="n">Rate</span><span class="p">:</span>
<span class="n">Failures</span><span class="p">:</span>     <span class="o">==</span> <span class="mi">2</span><span class="o">%</span>
<span class="n">Target</span><span class="p">:</span>       <span class="o">==</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="o">%</span>
<span class="n">Alert</span> <span class="k">if</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="o">%</span>
</pre></div>
</div>
<p><strong>Distributed Tracing</strong></p>
<p>Track requests across services:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Trace</span> <span class="n">ID</span><span class="p">:</span> <span class="n">trace</span><span class="o">-</span><span class="mi">123</span>

<span class="mf">1.</span> <span class="n">API</span> <span class="n">Gateway</span>          <span class="p">[</span><span class="mi">50</span><span class="n">ms</span><span class="p">]</span>
   <span class="o">+-</span> <span class="n">Authenticate</span>      <span class="p">[</span><span class="mi">5</span><span class="n">ms</span><span class="p">]</span>
   <span class="o">+-</span> <span class="n">Authorize</span>         <span class="p">[</span><span class="mi">10</span><span class="n">ms</span><span class="p">]</span>
   <span class="o">+-</span> <span class="n">Send</span> <span class="n">RPC</span>          <span class="p">[</span><span class="mi">35</span><span class="n">ms</span><span class="p">]</span>
       <span class="o">|</span>
       <span class="n">v</span>
<span class="mf">2.</span> <span class="n">Call</span> <span class="n">Manager</span>         <span class="p">[</span><span class="mi">80</span><span class="n">ms</span><span class="p">]</span>
   <span class="o">+-</span> <span class="n">Validate</span>          <span class="p">[</span><span class="mi">10</span><span class="n">ms</span><span class="p">]</span>
   <span class="o">+-</span> <span class="n">Create</span> <span class="n">Record</span>     <span class="p">[</span><span class="mi">20</span><span class="n">ms</span><span class="p">]</span>
   <span class="o">+-</span> <span class="n">Initiate</span> <span class="n">Call</span>     <span class="p">[</span><span class="mi">50</span><span class="n">ms</span><span class="p">]</span>
       <span class="o">|</span>
       <span class="n">v</span>
<span class="mf">3.</span> <span class="n">RTC</span> <span class="n">Manager</span>          <span class="p">[</span><span class="mi">120</span><span class="n">ms</span><span class="p">]</span>
   <span class="o">+-</span> <span class="n">Setup</span> <span class="n">Media</span>       <span class="p">[</span><span class="mi">120</span><span class="n">ms</span><span class="p">]</span>

<span class="n">Total</span><span class="p">:</span> <span class="mi">250</span><span class="n">ms</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Correlation IDs</strong>: Track requests across services</p></li>
<li><p><strong>Timing</strong>: Measure latency at each hop</p></li>
<li><p><strong>Errors</strong>: Identify where failures occur</p></li>
<li><p><strong>Dependencies</strong>: Visualize service interactions</p></li>
</ul>
</section>
<section id="id3">
<h3>Best Practices<a class="headerlink" href="#id3" title="Link to this heading"></a></h3>
<p><strong>Message Design:</strong></p>
<ul class="simple">
<li><p>Keep messages small (&lt;1MB)</p></li>
<li><p>Use JSON for human-readable format</p></li>
<li><p>Include timestamps for debugging</p></li>
<li><p>Add correlation IDs for tracing</p></li>
</ul>
<p><strong>Error Handling:</strong></p>
<ul class="simple">
<li><p>Always handle errors gracefully</p></li>
<li><p>Implement retry with exponential backoff</p></li>
<li><p>Use dead letter queues for failed messages</p></li>
<li><p>Alert on high error rates</p></li>
</ul>
<p><strong>Performance:</strong></p>
<ul class="simple">
<li><p>Use connection pooling</p></li>
<li><p>Batch messages when possible</p></li>
<li><p>Set appropriate timeouts</p></li>
<li><p>Monitor queue depths</p></li>
</ul>
<p><strong>Security:</strong></p>
<ul class="simple">
<li><p>Encrypt sensitive data in messages</p></li>
<li><p>Validate all incoming messages</p></li>
<li><p>Use authentication for connections</p></li>
<li><p>Limit message size to prevent abuse</p></li>
</ul>
</section>
</section>
<section id="data-architecture">
<span id="architecture-data"></span><h2>Data Architecture<a class="headerlink" href="#data-architecture" title="Link to this heading"></a></h2>
<p>VoIPBIN uses a shared data layer with MySQL for persistent storage and Redis for caching and session management. This architecture provides consistency across services while enabling high-performance data access.</p>
<section id="data-layer-overview">
<h3>Data Layer Overview<a class="headerlink" href="#data-layer-overview" title="Link to this heading"></a></h3>
<p>VoIPBIN’s data architecture consists of three layers:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Data</span> <span class="n">Architecture</span><span class="p">:</span>

<span class="o">+---------------------------------------------------------+</span>
<span class="o">|</span>                   <span class="n">Application</span> <span class="n">Layer</span>                     <span class="o">|</span>
<span class="o">|</span>            <span class="p">(</span><span class="mi">30</span><span class="o">+</span> <span class="n">Microservices</span><span class="p">)</span>                          <span class="o">|</span>
<span class="o">+--------------------+-------------------+----------------+</span>
                     <span class="o">|</span>                   <span class="o">|</span>
                     <span class="o">|</span>                   <span class="o">|</span>
     <span class="o">+---------------</span><span class="n">v</span><span class="o">------+</span>   <span class="o">+--------</span><span class="n">v</span><span class="o">-----------+</span>
     <span class="o">|</span>                      <span class="o">|</span>   <span class="o">|</span>                    <span class="o">|</span>
     <span class="o">|</span>   <span class="n">Redis</span> <span class="n">Cache</span>        <span class="o">|</span>   <span class="o">|</span>   <span class="n">MySQL</span> <span class="n">Database</span>   <span class="o">|</span>
     <span class="o">|</span>   <span class="p">(</span><span class="n">Hot</span> <span class="n">Data</span><span class="p">)</span>         <span class="o">|</span>   <span class="o">|</span>   <span class="p">(</span><span class="n">Persistent</span><span class="p">)</span>     <span class="o">|</span>
     <span class="o">|</span>                      <span class="o">|</span>   <span class="o">|</span>                    <span class="o">|</span>
     <span class="o">|</span>  <span class="n">o</span> <span class="n">Sessions</span>          <span class="o">|</span>   <span class="o">|</span>  <span class="n">o</span> <span class="n">All</span> <span class="n">entities</span>    <span class="o">|</span>
     <span class="o">|</span>  <span class="n">o</span> <span class="n">Frequently</span> <span class="n">read</span>   <span class="o">|</span>   <span class="o">|</span>  <span class="n">o</span> <span class="n">Relationships</span>   <span class="o">|</span>
     <span class="o">|</span>  <span class="n">o</span> <span class="n">Temporary</span> <span class="n">data</span>    <span class="o">|</span>   <span class="o">|</span>  <span class="n">o</span> <span class="n">Audit</span> <span class="n">logs</span>      <span class="o">|</span>
     <span class="o">|</span>                      <span class="o">|</span>   <span class="o">|</span>                    <span class="o">|</span>
     <span class="o">+----------------------+</span>   <span class="o">+--------------------+</span>

     <span class="n">Cache</span><span class="o">-</span><span class="n">Aside</span> <span class="n">Pattern</span><span class="p">:</span>
     <span class="mf">1.</span> <span class="n">Check</span> <span class="n">cache</span> <span class="n">first</span>
     <span class="mf">2.</span> <span class="n">If</span> <span class="n">miss</span><span class="p">,</span> <span class="n">query</span> <span class="n">database</span>
     <span class="mf">3.</span> <span class="n">Store</span> <span class="ow">in</span> <span class="n">cache</span> <span class="k">for</span> <span class="nb">next</span> <span class="n">time</span>
</pre></div>
</div>
</section>
<section id="mysql-database">
<h3>MySQL Database<a class="headerlink" href="#mysql-database" title="Link to this heading"></a></h3>
<p>VoIPBIN uses a single shared MySQL database accessed by all services.</p>
<p><strong>Database Characteristics</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Shared</span> <span class="n">Database</span> <span class="n">Pattern</span><span class="p">:</span>

<span class="o">+--------------+</span>  <span class="o">+--------------+</span>  <span class="o">+--------------+</span>
<span class="o">|</span>   <span class="n">Service</span> <span class="n">A</span>  <span class="o">|</span>  <span class="o">|</span>   <span class="n">Service</span> <span class="n">B</span>  <span class="o">|</span>  <span class="o">|</span>   <span class="n">Service</span> <span class="n">C</span>  <span class="o">|</span>
<span class="o">|</span>              <span class="o">|</span>  <span class="o">|</span>              <span class="o">|</span>  <span class="o">|</span>              <span class="o">|</span>
<span class="o">|</span>  <span class="n">call</span><span class="o">-</span><span class="n">mgr</span>    <span class="o">|</span>  <span class="o">|</span>  <span class="n">flow</span><span class="o">-</span><span class="n">mgr</span>    <span class="o">|</span>  <span class="o">|</span>  <span class="n">agent</span><span class="o">-</span><span class="n">mgr</span>   <span class="o">|</span>
<span class="o">+------+-------+</span>  <span class="o">+------+-------+</span>  <span class="o">+------+-------+</span>
       <span class="o">|</span>                 <span class="o">|</span>                 <span class="o">|</span>
       <span class="o">|</span>   <span class="n">Connection</span>    <span class="o">|</span>                 <span class="o">|</span>
       <span class="o">|</span>   <span class="n">Pooling</span>       <span class="o">|</span>                 <span class="o">|</span>
       <span class="o">+--------+--------+-----------------+</span>
                <span class="o">|</span>
                <span class="n">v</span>
     <span class="o">+----------------------------+</span>
     <span class="o">|</span>      <span class="n">MySQL</span> <span class="n">Database</span>        <span class="o">|</span>
     <span class="o">|</span>                            <span class="o">|</span>
     <span class="o">|</span>  <span class="o">+----------------------+</span>  <span class="o">|</span>
     <span class="o">|</span>  <span class="o">|</span>  <span class="n">calls</span> <span class="n">table</span>         <span class="o">|</span>  <span class="o">|</span>
     <span class="o">|</span>  <span class="o">|</span>  <span class="n">conferences</span> <span class="n">table</span>   <span class="o">|</span>  <span class="o">|</span>
     <span class="o">|</span>  <span class="o">|</span>  <span class="n">agents</span> <span class="n">table</span>        <span class="o">|</span>  <span class="o">|</span>
     <span class="o">|</span>  <span class="o">|</span>  <span class="n">flows</span> <span class="n">table</span>         <span class="o">|</span>  <span class="o">|</span>
     <span class="o">|</span>  <span class="o">|</span>  <span class="n">customers</span> <span class="n">table</span>     <span class="o">|</span>  <span class="o">|</span>
     <span class="o">|</span>  <span class="o">|</span>  <span class="o">...</span> <span class="mi">100</span><span class="o">+</span> <span class="n">tables</span>     <span class="o">|</span>  <span class="o">|</span>
     <span class="o">|</span>  <span class="o">+----------------------+</span>  <span class="o">|</span>
     <span class="o">+----------------------------+</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Shared Schema</strong>: All services access same database</p></li>
<li><p><strong>Logical Separation</strong>: Services own specific tables</p></li>
<li><p><strong>ACID Transactions</strong>: Strong consistency guarantees</p></li>
<li><p><strong>Connection Pooling</strong>: Each service maintains pool</p></li>
</ul>
<p><strong>Schema Organization</strong></p>
<p>Tables are logically grouped by domain:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Table</span> <span class="n">Organization</span><span class="p">:</span>

<span class="n">Communication</span> <span class="n">Domain</span><span class="p">:</span>
<span class="n">o</span> <span class="n">calls</span>                <span class="o">-</span> <span class="n">Call</span> <span class="n">records</span>
<span class="n">o</span> <span class="n">conferences</span>          <span class="o">-</span> <span class="n">Conference</span> <span class="n">bridges</span>
<span class="n">o</span> <span class="n">sms</span>                  <span class="o">-</span> <span class="n">SMS</span> <span class="n">messages</span>
<span class="n">o</span> <span class="n">chats</span>                <span class="o">-</span> <span class="n">Chat</span> <span class="n">messages</span>
<span class="n">o</span> <span class="n">emails</span>               <span class="o">-</span> <span class="n">Email</span> <span class="n">records</span>

<span class="n">Workflow</span> <span class="n">Domain</span><span class="p">:</span>
<span class="n">o</span> <span class="n">flows</span>                <span class="o">-</span> <span class="n">Call</span> <span class="n">flow</span> <span class="n">definitions</span>
<span class="n">o</span> <span class="n">flow_actions</span>         <span class="o">-</span> <span class="n">Flow</span> <span class="n">action</span> <span class="n">steps</span>
<span class="n">o</span> <span class="n">queues</span>               <span class="o">-</span> <span class="n">Call</span> <span class="n">queues</span>
<span class="n">o</span> <span class="n">campaigns</span>            <span class="o">-</span> <span class="n">Campaign</span> <span class="n">definitions</span>

<span class="n">Management</span> <span class="n">Domain</span><span class="p">:</span>
<span class="n">o</span> <span class="n">customers</span>            <span class="o">-</span> <span class="n">Customer</span> <span class="n">accounts</span>
<span class="n">o</span> <span class="n">agents</span>               <span class="o">-</span> <span class="n">Agent</span> <span class="n">records</span>
<span class="n">o</span> <span class="n">billings</span>             <span class="o">-</span> <span class="n">Billing</span> <span class="n">records</span>
<span class="n">o</span> <span class="n">webhooks</span>             <span class="o">-</span> <span class="n">Webhook</span> <span class="n">configurations</span>
<span class="n">o</span> <span class="n">accesskeys</span>           <span class="o">-</span> <span class="n">API</span> <span class="n">keys</span>

<span class="n">Resource</span> <span class="n">Domain</span><span class="p">:</span>
<span class="n">o</span> <span class="n">numbers</span>              <span class="o">-</span> <span class="n">Phone</span> <span class="n">numbers</span>
<span class="n">o</span> <span class="n">recordings</span>           <span class="o">-</span> <span class="n">Call</span> <span class="n">recordings</span>
<span class="n">o</span> <span class="n">transcribes</span>          <span class="o">-</span> <span class="n">Transcription</span> <span class="n">jobs</span>
<span class="n">o</span> <span class="n">transcripts</span>          <span class="o">-</span> <span class="n">Transcript</span> <span class="n">segments</span>
</pre></div>
</div>
<p><strong>Common Table Pattern</strong></p>
<p>All tables follow a consistent structure:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Standard</span> <span class="n">Table</span> <span class="n">Schema</span><span class="p">:</span>

<span class="n">CREATE</span> <span class="n">TABLE</span> <span class="n">resource</span> <span class="p">(</span>
    <span class="nb">id</span>              <span class="n">VARCHAR</span><span class="p">(</span><span class="mi">36</span><span class="p">)</span> <span class="n">PRIMARY</span> <span class="n">KEY</span><span class="p">,</span>    <span class="o">--</span> <span class="n">UUID</span>
    <span class="n">customer_id</span>     <span class="n">VARCHAR</span><span class="p">(</span><span class="mi">36</span><span class="p">)</span> <span class="n">NOT</span> <span class="n">NULL</span><span class="p">,</span>       <span class="o">--</span> <span class="n">Ownership</span>

    <span class="o">--</span> <span class="n">Resource</span><span class="o">-</span><span class="n">specific</span> <span class="n">fields</span>
    <span class="n">name</span>            <span class="n">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
    <span class="n">status</span>          <span class="n">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
    <span class="n">detail</span>          <span class="n">TEXT</span><span class="p">,</span>

    <span class="o">--</span> <span class="n">Timestamps</span>
    <span class="n">tm_create</span>       <span class="n">DATETIME</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="n">NOT</span> <span class="n">NULL</span><span class="p">,</span>       <span class="o">--</span> <span class="n">Creation</span> <span class="n">time</span>
    <span class="n">tm_update</span>       <span class="n">DATETIME</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="n">NOT</span> <span class="n">NULL</span><span class="p">,</span>       <span class="o">--</span> <span class="n">Last</span> <span class="n">update</span>
    <span class="n">tm_delete</span>       <span class="n">DATETIME</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="n">NOT</span> <span class="n">NULL</span><span class="p">,</span>       <span class="o">--</span> <span class="n">Soft</span> <span class="n">delete</span>

    <span class="o">--</span> <span class="n">Indexes</span>
    <span class="n">INDEX</span> <span class="n">idx_customer</span> <span class="p">(</span><span class="n">customer_id</span><span class="p">),</span>
    <span class="n">INDEX</span> <span class="n">idx_status</span> <span class="p">(</span><span class="n">status</span><span class="p">),</span>
    <span class="n">INDEX</span> <span class="n">idx_tm_create</span> <span class="p">(</span><span class="n">tm_create</span><span class="p">),</span>
    <span class="n">INDEX</span> <span class="n">idx_tm_delete</span> <span class="p">(</span><span class="n">tm_delete</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="n">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8mb4</span><span class="p">;</span>
</pre></div>
</div>
<p><strong>Key Design Patterns:</strong></p>
<ul class="simple">
<li><p><strong>UUID Primary Keys</strong>: Globally unique identifiers</p></li>
<li><p><strong>Customer Ownership</strong>: Every resource has customer_id</p></li>
<li><p><strong>Soft Deletes</strong>: tm_delete = ‘9999-01-01’ for active records</p></li>
<li><p><strong>Microsecond Timestamps</strong>: DATETIME(6) for precise ordering</p></li>
<li><p><strong>UTF8MB4</strong>: Full Unicode support including emojis</p></li>
</ul>
<p><strong>Data Access Patterns</strong></p>
<p>Services access data through consistent patterns:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Data</span> <span class="n">Access</span> <span class="n">Flow</span><span class="p">:</span>

<span class="n">Service</span> <span class="n">Handler</span>
     <span class="o">|</span>
     <span class="o">|</span>  <span class="mf">1.</span> <span class="n">Validate</span> <span class="n">Input</span>
     <span class="n">v</span>
<span class="o">+----------------------+</span>
<span class="o">|</span>  <span class="n">Business</span> <span class="n">Logic</span>      <span class="o">|</span>
<span class="o">+------+---------------+</span>
       <span class="o">|</span>  <span class="mf">2.</span> <span class="n">Check</span> <span class="n">Cache</span>
       <span class="n">v</span>
<span class="o">+----------------------+</span>
<span class="o">|</span>  <span class="n">Cache</span> <span class="n">Handler</span>       <span class="o">|</span>
<span class="o">|</span>  <span class="p">(</span><span class="n">Redis</span><span class="p">)</span>             <span class="o">|</span>
<span class="o">+------+---------------+</span>
       <span class="o">|</span>  <span class="n">Cache</span> <span class="n">Miss</span>
       <span class="o">|</span>  <span class="mf">3.</span> <span class="n">Query</span> <span class="n">DB</span>
       <span class="n">v</span>
<span class="o">+----------------------+</span>
<span class="o">|</span>  <span class="n">DB</span> <span class="n">Handler</span>          <span class="o">|</span>
<span class="o">|</span>  <span class="p">(</span><span class="n">MySQL</span><span class="p">)</span>             <span class="o">|</span>
<span class="o">+------+---------------+</span>
       <span class="o">|</span>  <span class="mf">4.</span> <span class="n">Store</span> <span class="ow">in</span> <span class="n">Cache</span>
       <span class="n">v</span>
<span class="o">+----------------------+</span>
<span class="o">|</span>  <span class="n">Return</span> <span class="n">Result</span>       <span class="o">|</span>
<span class="o">+----------------------+</span>
</pre></div>
</div>
<p><strong>Transaction Handling</strong></p>
<p>VoIPBIN uses transactions for consistency:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Transaction</span> <span class="n">Example</span><span class="p">:</span>

<span class="n">BEGIN</span> <span class="n">TRANSACTION</span>
    <span class="o">|</span>
    <span class="o">|</span>  <span class="mf">1.</span> <span class="n">Create</span> <span class="n">Call</span> <span class="n">Record</span>
    <span class="o">+--&gt;</span> <span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">calls</span> <span class="o">...</span>
    <span class="o">|</span>
    <span class="o">|</span>  <span class="mf">2.</span> <span class="n">Update</span> <span class="n">Customer</span> <span class="n">Stats</span>
    <span class="o">+--&gt;</span> <span class="n">UPDATE</span> <span class="n">customers</span> <span class="n">SET</span> <span class="n">total_calls</span> <span class="o">=</span> <span class="n">total_calls</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">...</span>
    <span class="o">|</span>
    <span class="o">|</span>  <span class="mf">3.</span> <span class="n">Create</span> <span class="n">Billing</span> <span class="n">Entry</span>
    <span class="o">+--&gt;</span> <span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">billings</span> <span class="o">...</span>
    <span class="o">|</span>
    <span class="o">|</span>  <span class="n">If</span> <span class="nb">all</span> <span class="n">succeed</span><span class="p">:</span>
    <span class="o">|</span>    <span class="n">COMMIT</span>
    <span class="o">|</span>  <span class="n">If</span> <span class="nb">any</span> <span class="n">fails</span><span class="p">:</span>
    <span class="o">|</span>    <span class="n">ROLLBACK</span>
    <span class="o">|</span>
<span class="n">END</span> <span class="n">TRANSACTION</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>ACID Guarantees</strong>: Atomic, Consistent, Isolated, Durable</p></li>
<li><p><strong>Rollback on Error</strong>: All changes reverted if any step fails</p></li>
<li><p><strong>Isolation Levels</strong>: READ COMMITTED for most operations</p></li>
<li><p><strong>Lock Timeout</strong>: 30 seconds to prevent deadlocks</p></li>
</ul>
<p><strong>Query Optimization</strong></p>
<p>VoIPBIN optimizes queries for performance:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Query Optimization Strategies:

1. Proper Indexing:
   +---------------------------------+
   | INDEX idx_customer_status       |
   | ON calls (customer_id, status)  |
   +---------------------------------+

   SELECT * FROM calls
   WHERE customer_id = ? AND status = &#39;active&#39;
   -&gt; Uses index, fast lookup

2. Avoid SELECT *:
   +---------------------------------+
   | SELECT id, status, tm_create    |
   | FROM calls WHERE ...            |
   +---------------------------------+
   -&gt; Only retrieve needed columns

3. Pagination:
   +---------------------------------+
   | SELECT * FROM calls             |
   | WHERE customer_id = ?           |
   | LIMIT 50 OFFSET 0               |
   +---------------------------------+
   -&gt; Limit result size

4. Connection Pooling:
   +---------------------------------+
   | Pool Size: 10-50 connections    |
   | Max Idle: 5 minutes             |
   | Max Lifetime: 1 hour            |
   +---------------------------------+
   -&gt; Reuse connections
</pre></div>
</div>
</section>
<section id="database-migrations">
<h3>Database Migrations<a class="headerlink" href="#database-migrations" title="Link to this heading"></a></h3>
<p>Schema changes are managed through Alembic migrations:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Migration</span> <span class="n">Workflow</span><span class="p">:</span>

<span class="n">Development</span>                 <span class="n">Migration</span> <span class="n">Script</span>              <span class="n">Production</span>
     <span class="o">|</span>                            <span class="o">|</span>                           <span class="o">|</span>
     <span class="o">|</span>  <span class="mf">1.</span> <span class="n">Schema</span> <span class="n">Change</span>          <span class="o">|</span>                           <span class="o">|</span>
     <span class="o">|</span>     <span class="n">Needed</span>                 <span class="o">|</span>                           <span class="o">|</span>
     <span class="n">v</span>                            <span class="o">|</span>                           <span class="o">|</span>
<span class="o">+-------------+</span>                   <span class="o">|</span>                           <span class="o">|</span>
<span class="o">|</span> <span class="n">Create</span>      <span class="o">|</span>                   <span class="o">|</span>                           <span class="o">|</span>
<span class="o">|</span> <span class="n">Migration</span>   <span class="o">|------------------&gt;|</span>                           <span class="o">|</span>
<span class="o">|</span> <span class="n">Script</span>      <span class="o">|</span>                   <span class="o">|</span>                           <span class="o">|</span>
<span class="o">+-------------+</span>                   <span class="o">|</span>                           <span class="o">|</span>
     <span class="o">|</span>                            <span class="o">|</span>                           <span class="o">|</span>
     <span class="o">|</span>  <span class="mf">2.</span> <span class="n">Test</span> <span class="n">Locally</span>           <span class="o">|</span>                           <span class="o">|</span>
     <span class="n">v</span>                            <span class="o">|</span>                           <span class="o">|</span>
<span class="o">+-------------+</span>                   <span class="o">|</span>                           <span class="o">|</span>
<span class="o">|</span> <span class="n">Run</span>         <span class="o">|</span>                   <span class="o">|</span>                           <span class="o">|</span>
<span class="o">|</span> <span class="n">Migration</span>   <span class="o">|&lt;------------------|</span>                           <span class="o">|</span>
<span class="o">|</span> <span class="p">(</span><span class="n">dev</span> <span class="n">DB</span><span class="p">)</span>    <span class="o">|</span>                   <span class="o">|</span>                           <span class="o">|</span>
<span class="o">+-------------+</span>                   <span class="o">|</span>                           <span class="o">|</span>
     <span class="o">|</span>                            <span class="o">|</span>                           <span class="o">|</span>
     <span class="o">|</span>  <span class="mf">3.</span> <span class="n">Commit</span> <span class="n">to</span> <span class="n">Git</span>          <span class="o">|</span>                           <span class="o">|</span>
     <span class="n">v</span>                            <span class="o">|</span>                           <span class="o">|</span>
<span class="o">+-------------+</span>                   <span class="o">|</span>                           <span class="o">|</span>
<span class="o">|</span> <span class="n">Code</span> <span class="n">Review</span> <span class="o">|</span>                   <span class="o">|</span>                           <span class="o">|</span>
<span class="o">|</span> <span class="o">&amp;</span> <span class="n">Approval</span>  <span class="o">|</span>                   <span class="o">|</span>                           <span class="o">|</span>
<span class="o">+-------------+</span>                   <span class="o">|</span>                           <span class="o">|</span>
     <span class="o">|</span>                            <span class="o">|</span>                           <span class="o">|</span>
     <span class="o">|</span>  <span class="mf">4.</span> <span class="n">Deploy</span>                 <span class="o">|</span>                           <span class="o">|</span>
     <span class="o">|</span>                            <span class="o">|</span>  <span class="mf">5.</span> <span class="n">Manual</span> <span class="n">Execution</span>      <span class="o">|</span>
     <span class="o">|</span>                            <span class="o">|</span>     <span class="p">(</span><span class="n">by</span> <span class="n">human</span><span class="p">)</span>            <span class="o">|</span>
     <span class="o">|</span>                            <span class="o">+--------------------------&gt;&gt;</span>
     <span class="o">|</span>                            <span class="o">|</span>                           <span class="o">|</span>
     <span class="o">|</span>                            <span class="o">|</span>  <span class="n">alembic</span> <span class="n">upgrade</span> <span class="n">head</span>     <span class="o">|</span>
     <span class="o">|</span>                            <span class="o">|</span>                           <span class="o">|</span>
</pre></div>
</div>
<p><strong>Migration Best Practices:</strong></p>
<ul class="simple">
<li><p><strong>Version Control</strong>: All migrations in git</p></li>
<li><p><strong>Forward Only</strong>: Never modify existing migrations</p></li>
<li><p><strong>Backward Compatible</strong>: Support gradual rollout</p></li>
<li><p><strong>Manual Execution</strong>: Humans run migrations, not automation</p></li>
<li><p><strong>Testing</strong>: Test on staging before production</p></li>
</ul>
</section>
<section id="redis-cache">
<h3>Redis Cache<a class="headerlink" href="#redis-cache" title="Link to this heading"></a></h3>
<p>Redis provides fast access to frequently used data:</p>
<p><strong>Cache Architecture</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Redis</span> <span class="n">Cache</span> <span class="n">Pattern</span><span class="p">:</span>

<span class="n">Application</span> <span class="n">Request</span>
     <span class="o">|</span>
     <span class="o">|</span>  <span class="mf">1.</span> <span class="n">Generate</span> <span class="n">Cache</span> <span class="n">Key</span>
     <span class="o">|</span>     <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;call:123&quot;</span>
     <span class="n">v</span>
<span class="o">+--------------------+</span>
<span class="o">|</span>  <span class="n">Check</span> <span class="n">Redis</span>       <span class="o">|</span>
<span class="o">|</span>  <span class="n">GET</span> <span class="n">call</span><span class="p">:</span><span class="mi">123</span>      <span class="o">|</span>
<span class="o">+----+---------------+</span>
     <span class="o">|</span>
     <span class="o">+-</span> <span class="n">Cache</span> <span class="n">Hit</span> <span class="o">--------+</span>
     <span class="o">|</span>                    <span class="o">|</span>
     <span class="o">|</span>                    <span class="n">v</span>
     <span class="o">|</span>              <span class="o">+----------------+</span>
     <span class="o">|</span>              <span class="o">|</span> <span class="n">Return</span> <span class="n">Cached</span>  <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span> <span class="n">Data</span> <span class="p">(</span><span class="n">fast</span><span class="p">)</span>    <span class="o">|</span>
     <span class="o">|</span>              <span class="o">+----------------+</span>
     <span class="o">|</span>
     <span class="o">+-</span> <span class="n">Cache</span> <span class="n">Miss</span> <span class="o">-------+</span>
     <span class="o">|</span>                    <span class="o">|</span>
     <span class="o">|</span>                    <span class="n">v</span>
     <span class="o">|</span>              <span class="o">+----------------+</span>
     <span class="o">|</span>              <span class="o">|</span> <span class="n">Query</span> <span class="n">MySQL</span>    <span class="o">|</span>
     <span class="o">|</span>              <span class="o">+----+-----------+</span>
     <span class="o">|</span>                   <span class="o">|</span>
     <span class="o">|</span>                   <span class="n">v</span>
     <span class="o">|</span>              <span class="o">+----------------+</span>
     <span class="o">|</span>              <span class="o">|</span> <span class="n">Store</span> <span class="ow">in</span> <span class="n">Redis</span> <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span> <span class="n">SET</span> <span class="n">call</span><span class="p">:</span><span class="mi">123</span>   <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span> <span class="n">EX</span> <span class="mi">300</span> <span class="p">(</span><span class="mi">5</span> <span class="nb">min</span><span class="p">)</span> <span class="o">|</span>
     <span class="o">|</span>              <span class="o">+----+-----------+</span>
     <span class="o">|</span>                   <span class="o">|</span>
     <span class="o">|</span>                   <span class="n">v</span>
     <span class="o">|</span>              <span class="o">+----------------+</span>
     <span class="o">|</span>              <span class="o">|</span> <span class="n">Return</span> <span class="n">Data</span>    <span class="o">|</span>
     <span class="o">|</span>              <span class="o">+----------------+</span>
</pre></div>
</div>
<p><strong>Cache Key Patterns</strong></p>
<p>VoIPBIN uses structured cache keys:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Key</span> <span class="n">Naming</span> <span class="n">Convention</span><span class="p">:</span>
<span class="o">&lt;</span><span class="n">resource</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="nb">id</span><span class="o">&gt;</span><span class="p">[:</span><span class="o">&lt;</span><span class="n">field</span><span class="o">&gt;</span><span class="p">]</span>

<span class="n">Examples</span><span class="p">:</span>
<span class="n">o</span> <span class="n">call</span><span class="p">:</span><span class="n">abc</span><span class="o">-</span><span class="mi">123</span>              <span class="o">-&gt;</span> <span class="n">Full</span> <span class="n">call</span> <span class="n">record</span>
<span class="n">o</span> <span class="n">agent</span><span class="p">:</span><span class="n">xyz</span><span class="o">-</span><span class="mi">789</span><span class="p">:</span><span class="n">status</span>      <span class="o">-&gt;</span> <span class="n">Agent</span> <span class="n">status</span> <span class="n">only</span>
<span class="n">o</span> <span class="n">customer</span><span class="p">:</span><span class="n">customer</span><span class="o">-</span><span class="mi">456</span>     <span class="o">-&gt;</span> <span class="n">Customer</span> <span class="n">record</span>
<span class="n">o</span> <span class="n">queue</span><span class="p">:</span><span class="n">queue</span><span class="o">-</span><span class="mi">999</span><span class="p">:</span><span class="n">stats</span>     <span class="o">-&gt;</span> <span class="n">Queue</span> <span class="n">statistics</span>
<span class="n">o</span> <span class="n">flow</span><span class="p">:</span><span class="n">flow</span><span class="o">-</span><span class="mi">111</span><span class="p">:</span><span class="n">definition</span>  <span class="o">-&gt;</span> <span class="n">Flow</span> <span class="n">definition</span>

<span class="n">Advantages</span><span class="p">:</span>
<span class="n">o</span> <span class="n">Predictable</span> <span class="n">keys</span>
<span class="n">o</span> <span class="n">Easy</span> <span class="n">to</span> <span class="n">invalidate</span>
<span class="n">o</span> <span class="n">Pattern</span> <span class="n">matching</span> <span class="k">for</span> <span class="n">bulk</span> <span class="n">operations</span>
</pre></div>
</div>
<p><strong>Data Structures</strong></p>
<p>Redis supports multiple data structures:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Redis</span> <span class="n">Data</span> <span class="n">Structures</span><span class="p">:</span>

<span class="mf">1.</span> <span class="n">String</span> <span class="p">(</span><span class="n">Simple</span> <span class="n">Values</span><span class="p">):</span>
   <span class="n">SET</span> <span class="n">call</span><span class="p">:</span><span class="mi">123</span><span class="p">:</span><span class="n">status</span> <span class="s2">&quot;active&quot;</span>
   <span class="n">GET</span> <span class="n">call</span><span class="p">:</span><span class="mi">123</span><span class="p">:</span><span class="n">status</span>
   <span class="o">-&gt;</span> <span class="s2">&quot;active&quot;</span>

<span class="mf">2.</span> <span class="n">Hash</span> <span class="p">(</span><span class="n">Object</span> <span class="n">Fields</span><span class="p">):</span>
   <span class="n">HSET</span> <span class="n">call</span><span class="p">:</span><span class="mi">123</span> <span class="n">status</span> <span class="s2">&quot;active&quot;</span> <span class="n">duration</span> <span class="s2">&quot;120&quot;</span>
   <span class="n">HGET</span> <span class="n">call</span><span class="p">:</span><span class="mi">123</span> <span class="n">status</span>
   <span class="o">-&gt;</span> <span class="s2">&quot;active&quot;</span>
   <span class="n">HGETALL</span> <span class="n">call</span><span class="p">:</span><span class="mi">123</span>
   <span class="o">-&gt;</span> <span class="p">{</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;active&quot;</span><span class="p">,</span> <span class="s2">&quot;duration&quot;</span><span class="p">:</span> <span class="s2">&quot;120&quot;</span><span class="p">}</span>

<span class="mf">3.</span> <span class="n">List</span> <span class="p">(</span><span class="n">Ordered</span> <span class="n">Collection</span><span class="p">):</span>
   <span class="n">LPUSH</span> <span class="n">queue</span><span class="p">:</span><span class="mi">456</span><span class="p">:</span><span class="n">waiting</span> <span class="n">call</span><span class="p">:</span><span class="mi">123</span>
   <span class="n">LPUSH</span> <span class="n">queue</span><span class="p">:</span><span class="mi">456</span><span class="p">:</span><span class="n">waiting</span> <span class="n">call</span><span class="p">:</span><span class="mi">789</span>
   <span class="n">LRANGE</span> <span class="n">queue</span><span class="p">:</span><span class="mi">456</span><span class="p">:</span><span class="n">waiting</span> <span class="mi">0</span> <span class="o">-</span><span class="mi">1</span>
   <span class="o">-&gt;</span> <span class="p">[</span><span class="n">call</span><span class="p">:</span><span class="mi">789</span><span class="p">,</span> <span class="n">call</span><span class="p">:</span><span class="mi">123</span><span class="p">]</span>

<span class="mf">4.</span> <span class="n">Set</span> <span class="p">(</span><span class="n">Unique</span> <span class="n">Collection</span><span class="p">):</span>
   <span class="n">SADD</span> <span class="n">conference</span><span class="p">:</span><span class="mi">999</span><span class="p">:</span><span class="n">participants</span> <span class="n">agent</span><span class="p">:</span><span class="mi">111</span>
   <span class="n">SADD</span> <span class="n">conference</span><span class="p">:</span><span class="mi">999</span><span class="p">:</span><span class="n">participants</span> <span class="n">agent</span><span class="p">:</span><span class="mi">222</span>
   <span class="n">SMEMBERS</span> <span class="n">conference</span><span class="p">:</span><span class="mi">999</span><span class="p">:</span><span class="n">participants</span>
   <span class="o">-&gt;</span> <span class="p">[</span><span class="n">agent</span><span class="p">:</span><span class="mi">111</span><span class="p">,</span> <span class="n">agent</span><span class="p">:</span><span class="mi">222</span><span class="p">]</span>

<span class="mf">5.</span> <span class="n">Sorted</span> <span class="n">Set</span> <span class="p">(</span><span class="n">Scored</span> <span class="n">Collection</span><span class="p">):</span>
   <span class="n">ZADD</span> <span class="n">leaderboard</span> <span class="mi">100</span> <span class="n">agent</span><span class="p">:</span><span class="mi">111</span>
   <span class="n">ZADD</span> <span class="n">leaderboard</span> <span class="mi">95</span> <span class="n">agent</span><span class="p">:</span><span class="mi">222</span>
   <span class="n">ZRANGE</span> <span class="n">leaderboard</span> <span class="mi">0</span> <span class="o">-</span><span class="mi">1</span> <span class="n">WITHSCORES</span>
   <span class="o">-&gt;</span> <span class="p">[(</span><span class="n">agent</span><span class="p">:</span><span class="mi">111</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="p">(</span><span class="n">agent</span><span class="p">:</span><span class="mi">222</span><span class="p">,</span> <span class="mi">95</span><span class="p">)]</span>
</pre></div>
</div>
<p><strong>Cache Expiration</strong></p>
<p>All cached data has Time-To-Live (TTL):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>TTL Strategy:

Data Type              TTL        Reason
─────────────────────────────────────────────
Session tokens         1 hour     Security
User profiles          5 min      Frequently updated
Call records           1 min      Real-time changes
Configuration          1 hour     Rarely changes
Static data            24 hours   Almost never changes

Set TTL:
SET key value EX 300   # 5 minutes
SETEX key 300 value    # Same as above
EXPIRE key 300         # Set TTL on existing key
</pre></div>
</div>
<p><strong>Cache Invalidation</strong></p>
<p>VoIPBIN invalidates cache on updates:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Cache</span> <span class="n">Invalidation</span> <span class="n">Flow</span><span class="p">:</span>

<span class="n">Update</span> <span class="n">Request</span>
     <span class="o">|</span>
     <span class="o">|</span>  <span class="mf">1.</span> <span class="n">Update</span> <span class="n">Database</span>
     <span class="n">v</span>
<span class="o">+--------------------+</span>
<span class="o">|</span>  <span class="n">UPDATE</span> <span class="n">calls</span>      <span class="o">|</span>
<span class="o">|</span>  <span class="n">SET</span> <span class="n">status</span><span class="o">=</span><span class="s1">&#39;ended&#39;</span><span class="o">|</span>
<span class="o">|</span>  <span class="n">WHERE</span> <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;123&#39;</span>    <span class="o">|</span>
<span class="o">+----+---------------+</span>
     <span class="o">|</span>
     <span class="o">|</span>  <span class="mf">2.</span> <span class="n">Invalidate</span> <span class="n">Cache</span>
     <span class="n">v</span>
<span class="o">+--------------------+</span>
<span class="o">|</span>  <span class="n">DEL</span> <span class="n">call</span><span class="p">:</span><span class="mi">123</span>      <span class="o">|</span>
<span class="o">+----+---------------+</span>
     <span class="o">|</span>
     <span class="o">|</span>  <span class="mf">3.</span> <span class="n">Return</span> <span class="n">Success</span>
     <span class="n">v</span>
<span class="o">+--------------------+</span>
<span class="o">|</span>  <span class="n">Response</span> <span class="n">to</span> <span class="n">Client</span><span class="o">|</span>
<span class="o">+--------------------+</span>

<span class="n">Next</span> <span class="n">Read</span><span class="p">:</span>
<span class="n">o</span> <span class="n">Cache</span> <span class="n">miss</span>
<span class="n">o</span> <span class="n">Fetch</span> <span class="kn">from</span> <span class="nn">DB</span>
<span class="n">o</span> <span class="n">Store</span> <span class="ow">in</span> <span class="n">cache</span> <span class="k">with</span> <span class="n">new</span> <span class="n">data</span>
</pre></div>
</div>
<p><strong>Cache Patterns</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Common</span> <span class="n">Cache</span> <span class="n">Patterns</span><span class="p">:</span>

<span class="mf">1.</span> <span class="n">Cache</span><span class="o">-</span><span class="n">Aside</span> <span class="p">(</span><span class="n">Read</span> <span class="n">Through</span><span class="p">):</span>
   <span class="n">App</span> <span class="n">checks</span> <span class="n">cache</span> <span class="o">-&gt;</span> <span class="n">Cache</span> <span class="n">miss</span> <span class="o">-&gt;</span> <span class="n">Query</span> <span class="n">DB</span> <span class="o">-&gt;</span> <span class="n">Store</span> <span class="ow">in</span> <span class="n">cache</span>

<span class="mf">2.</span> <span class="n">Write</span><span class="o">-</span><span class="n">Through</span><span class="p">:</span>
   <span class="n">App</span> <span class="n">writes</span> <span class="n">to</span> <span class="n">cache</span> <span class="o">-&gt;</span> <span class="n">Cache</span> <span class="n">writes</span> <span class="n">to</span> <span class="n">DB</span> <span class="o">-&gt;</span> <span class="n">Return</span> <span class="n">success</span>

<span class="mf">3.</span> <span class="n">Write</span><span class="o">-</span><span class="n">Behind</span> <span class="p">(</span><span class="n">Async</span><span class="p">):</span>
   <span class="n">App</span> <span class="n">writes</span> <span class="n">to</span> <span class="n">cache</span> <span class="o">-&gt;</span> <span class="n">Return</span> <span class="n">success</span> <span class="o">-&gt;</span> <span class="n">Cache</span> <span class="n">writes</span> <span class="n">to</span> <span class="n">DB</span> <span class="n">later</span>

<span class="n">VoIPBIN</span> <span class="n">primarily</span> <span class="n">uses</span> <span class="n">Cache</span><span class="o">-</span><span class="n">Aside</span> <span class="k">for</span> <span class="n">simplicity</span> <span class="ow">and</span> <span class="n">consistency</span><span class="o">.</span>
</pre></div>
</div>
</section>
<section id="session-management">
<h3>Session Management<a class="headerlink" href="#session-management" title="Link to this heading"></a></h3>
<p>Redis stores session data for authenticated users:</p>
<p><strong>Session Structure</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Session</span> <span class="n">Data</span> <span class="ow">in</span> <span class="n">Redis</span><span class="p">:</span>

<span class="n">Key</span><span class="p">:</span> <span class="n">session</span><span class="p">:</span><span class="o">&lt;</span><span class="n">token</span><span class="o">-</span><span class="nb">hash</span><span class="o">&gt;</span>
<span class="n">Type</span><span class="p">:</span> <span class="n">Hash</span>
<span class="n">TTL</span><span class="p">:</span> <span class="mi">1</span> <span class="n">hour</span> <span class="p">(</span><span class="n">refreshed</span> <span class="n">on</span> <span class="n">activity</span><span class="p">)</span>

<span class="n">Data</span><span class="p">:</span>
<span class="o">+-------------------------------------+</span>
<span class="o">|</span> <span class="n">customer_id</span>    <span class="p">:</span> <span class="n">customer</span><span class="o">-</span><span class="mi">123</span>       <span class="o">|</span>
<span class="o">|</span> <span class="n">agent_id</span>       <span class="p">:</span> <span class="n">agent</span><span class="o">-</span><span class="mi">456</span>          <span class="o">|</span>
<span class="o">|</span> <span class="n">permissions</span>    <span class="p">:</span> <span class="p">[</span><span class="s2">&quot;admin&quot;</span><span class="p">,</span> <span class="s2">&quot;call&quot;</span><span class="p">]</span>  <span class="o">|</span>
<span class="o">|</span> <span class="n">login_time</span>     <span class="p">:</span> <span class="mi">2026</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">20</span> <span class="mi">12</span><span class="p">:</span><span class="mi">00</span>   <span class="o">|</span>
<span class="o">|</span> <span class="n">last_activity</span>  <span class="p">:</span> <span class="mi">2026</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">20</span> <span class="mi">12</span><span class="p">:</span><span class="mi">30</span>   <span class="o">|</span>
<span class="o">|</span> <span class="n">ip_address</span>     <span class="p">:</span> <span class="mf">192.168.1.100</span>      <span class="o">|</span>
<span class="o">|</span> <span class="n">user_agent</span>     <span class="p">:</span> <span class="n">Mozilla</span><span class="o">/</span><span class="mf">5.0</span> <span class="o">...</span>    <span class="o">|</span>
<span class="o">+-------------------------------------+</span>
</pre></div>
</div>
<p><strong>Session Lifecycle</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Session</span> <span class="n">Flow</span><span class="p">:</span>

<span class="mf">1.</span> <span class="n">Login</span><span class="p">:</span>
   <span class="o">+----------------------------+</span>
   <span class="o">|</span> <span class="n">Generate</span> <span class="n">JWT</span> <span class="n">token</span>         <span class="o">|</span>
   <span class="o">|</span> <span class="n">Hash</span> <span class="n">token</span> <span class="o">-&gt;</span> <span class="n">session_key</span>  <span class="o">|</span>
   <span class="o">|</span> <span class="n">Store</span> <span class="n">session</span> <span class="ow">in</span> <span class="n">Redis</span>     <span class="o">|</span>
   <span class="o">|</span> <span class="n">SET</span> <span class="n">session</span><span class="p">:</span><span class="n">xyz</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>      <span class="o">|</span>
   <span class="o">|</span> <span class="n">EXPIRE</span> <span class="n">session</span><span class="p">:</span><span class="n">xyz</span> <span class="mi">3600</span>    <span class="o">|</span>
   <span class="o">+----------------------------+</span>

<span class="mf">2.</span> <span class="n">Request</span><span class="p">:</span>
   <span class="o">+----------------------------+</span>
   <span class="o">|</span> <span class="n">Extract</span> <span class="n">token</span> <span class="kn">from</span> <span class="nn">header</span>  <span class="o">|</span>
   <span class="o">|</span> <span class="n">Hash</span> <span class="n">token</span> <span class="o">-&gt;</span> <span class="n">session_key</span>  <span class="o">|</span>
   <span class="o">|</span> <span class="n">GET</span> <span class="n">session</span><span class="p">:</span><span class="n">xyz</span>            <span class="o">|</span>
   <span class="o">|</span> <span class="n">Validate</span> <span class="n">session</span> <span class="n">data</span>      <span class="o">|</span>
   <span class="o">|</span> <span class="n">EXPIRE</span> <span class="n">session</span><span class="p">:</span><span class="n">xyz</span> <span class="mi">3600</span>    <span class="o">|</span>  <span class="o">&lt;-</span> <span class="n">Refresh</span> <span class="n">TTL</span>
   <span class="o">+----------------------------+</span>

<span class="mf">3.</span> <span class="n">Logout</span><span class="p">:</span>
   <span class="o">+----------------------------+</span>
   <span class="o">|</span> <span class="n">Extract</span> <span class="n">token</span> <span class="kn">from</span> <span class="nn">header</span>  <span class="o">|</span>
   <span class="o">|</span> <span class="n">Hash</span> <span class="n">token</span> <span class="o">-&gt;</span> <span class="n">session_key</span>  <span class="o">|</span>
   <span class="o">|</span> <span class="n">DEL</span> <span class="n">session</span><span class="p">:</span><span class="n">xyz</span>            <span class="o">|</span>
   <span class="o">+----------------------------+</span>
</pre></div>
</div>
</section>
<section id="data-consistency">
<h3>Data Consistency<a class="headerlink" href="#data-consistency" title="Link to this heading"></a></h3>
<p>VoIPBIN ensures consistency across data layers:</p>
<p><strong>Consistency Model</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Consistency</span> <span class="n">Strategy</span><span class="p">:</span>

<span class="n">Strong</span> <span class="n">Consistency</span><span class="p">:</span>        <span class="n">Eventual</span> <span class="n">Consistency</span><span class="p">:</span>
<span class="o">+--------------+</span>           <span class="o">+--------------+</span>
<span class="o">|</span>   <span class="n">MySQL</span>      <span class="o">|</span>           <span class="o">|</span>   <span class="n">Redis</span>      <span class="o">|</span>
<span class="o">|</span>  <span class="p">(</span><span class="n">Source</span> <span class="n">of</span>  <span class="o">|</span>           <span class="o">|</span>  <span class="p">(</span><span class="n">May</span> <span class="n">be</span>     <span class="o">|</span>
<span class="o">|</span>   <span class="n">Truth</span><span class="p">)</span>     <span class="o">|</span>           <span class="o">|</span>   <span class="n">stale</span><span class="p">)</span>     <span class="o">|</span>
<span class="o">+------+-------+</span>           <span class="o">+------+-------+</span>
       <span class="o">|</span>                          <span class="o">|</span>
       <span class="o">|</span>  <span class="n">Always</span> <span class="n">consistent</span>       <span class="o">|</span>  <span class="n">May</span> <span class="n">lag</span> <span class="n">behind</span>
       <span class="o">|</span>  <span class="n">ACID</span> <span class="n">transactions</span>       <span class="o">|</span>  <span class="n">Best</span> <span class="n">effort</span>
       <span class="o">|</span>                          <span class="o">|</span>
       <span class="o">+----------+---------------+</span>
                  <span class="o">|</span>
            <span class="n">Database</span> <span class="ow">is</span> <span class="n">authoritative</span>
</pre></div>
</div>
<p><strong>Write Path</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Write</span> <span class="n">Flow</span> <span class="p">(</span><span class="n">Strong</span> <span class="n">Consistency</span><span class="p">):</span>

<span class="mf">1.</span> <span class="n">Write</span> <span class="n">Request</span>
   <span class="o">|</span>
   <span class="n">v</span>
<span class="mf">2.</span> <span class="n">Update</span> <span class="n">Database</span> <span class="n">First</span>
   <span class="o">+-</span> <span class="n">BEGIN</span> <span class="n">TRANSACTION</span>
   <span class="o">+-</span> <span class="n">UPDATE</span> <span class="n">table</span> <span class="o">...</span>
   <span class="o">+-</span> <span class="n">COMMIT</span>
   <span class="o">|</span>
   <span class="n">v</span>
<span class="mf">3.</span> <span class="n">Invalidate</span> <span class="n">Cache</span>
   <span class="o">+-</span> <span class="n">DEL</span> <span class="n">cache_key</span>
   <span class="o">|</span>
   <span class="n">v</span>
<span class="mf">4.</span> <span class="n">Publish</span> <span class="n">Event</span>
   <span class="o">+-</span> <span class="n">Notify</span> <span class="n">subscribers</span>
   <span class="o">|</span>
   <span class="n">v</span>
<span class="mf">5.</span> <span class="n">Return</span> <span class="n">Success</span>

<span class="n">Database</span> <span class="n">updated</span> <span class="n">before</span> <span class="n">cache</span> <span class="n">invalidation</span>
<span class="n">ensures</span> <span class="n">consistency</span><span class="o">.</span>
</pre></div>
</div>
<p><strong>Read Path</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Read</span> <span class="n">Flow</span> <span class="p">(</span><span class="n">Eventual</span> <span class="n">Consistency</span> <span class="n">Acceptable</span><span class="p">):</span>

<span class="mf">1.</span> <span class="n">Read</span> <span class="n">Request</span>
   <span class="o">|</span>
   <span class="n">v</span>
<span class="mf">2.</span> <span class="n">Check</span> <span class="n">Cache</span>
   <span class="o">+-</span> <span class="n">Cache</span> <span class="n">Hit</span> <span class="o">-&gt;</span> <span class="n">Return</span> <span class="p">(</span><span class="n">may</span> <span class="n">be</span> <span class="n">slightly</span> <span class="n">stale</span><span class="p">)</span>
   <span class="o">+-</span> <span class="n">Cache</span> <span class="n">Miss</span> <span class="o">-&gt;</span> <span class="n">Continue</span>
   <span class="o">|</span>
   <span class="n">v</span>
<span class="mf">3.</span> <span class="n">Query</span> <span class="n">Database</span>
   <span class="o">+-</span> <span class="n">SELECT</span> <span class="o">*</span> <span class="n">FROM</span> <span class="n">table</span> <span class="n">WHERE</span> <span class="o">...</span>
   <span class="o">|</span>
   <span class="n">v</span>
<span class="mf">4.</span> <span class="n">Store</span> <span class="ow">in</span> <span class="n">Cache</span>
   <span class="o">+-</span> <span class="n">SET</span> <span class="n">cache_key</span> <span class="n">value</span> <span class="n">EX</span> <span class="n">ttl</span>
   <span class="o">|</span>
   <span class="n">v</span>
<span class="mf">5.</span> <span class="n">Return</span> <span class="n">Result</span>
</pre></div>
</div>
</section>
<section id="data-backup-and-recovery">
<h3>Data Backup and Recovery<a class="headerlink" href="#data-backup-and-recovery" title="Link to this heading"></a></h3>
<p>VoIPBIN implements comprehensive backup strategy:</p>
<p><strong>Backup Architecture</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Backup</span> <span class="n">Strategy</span><span class="p">:</span>

<span class="n">Production</span> <span class="n">Database</span>
     <span class="o">|</span>
     <span class="o">|</span>  <span class="n">Continuous</span> <span class="n">Replication</span>
     <span class="n">v</span>
<span class="o">+--------------------+</span>
<span class="o">|</span>  <span class="n">Read</span> <span class="n">Replica</span>      <span class="o">|</span>  <span class="o">&lt;-</span> <span class="n">Used</span> <span class="k">for</span> <span class="n">backups</span>
<span class="o">+----+---------------+</span>    <span class="p">(</span><span class="n">no</span> <span class="n">production</span> <span class="n">impact</span><span class="p">)</span>
     <span class="o">|</span>
     <span class="o">|</span>  <span class="n">Daily</span> <span class="n">Full</span> <span class="n">Backup</span>
     <span class="n">v</span>
<span class="o">+--------------------+</span>
<span class="o">|</span>  <span class="n">Backup</span> <span class="n">Storage</span>    <span class="o">|</span>
<span class="o">|</span>  <span class="p">(</span><span class="n">Google</span> <span class="n">Cloud</span><span class="p">)</span>    <span class="o">|</span>
<span class="o">|</span>                    <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="n">Daily</span><span class="p">:</span> <span class="mi">30</span> <span class="n">days</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="n">Weekly</span><span class="p">:</span> <span class="mi">1</span> <span class="n">year</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="n">Monthly</span><span class="p">:</span> <span class="mi">7</span> <span class="n">years</span><span class="o">|</span>
<span class="o">+--------------------+</span>
</pre></div>
</div>
<p><strong>Backup Schedule</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Backup</span> <span class="n">Timeline</span><span class="p">:</span>

<span class="n">Daily</span> <span class="p">(</span><span class="mi">3</span> <span class="n">AM</span> <span class="n">UTC</span><span class="p">):</span>
<span class="o">+------------------------------+</span>
<span class="o">|</span> <span class="n">Full</span> <span class="n">database</span> <span class="n">dump</span>           <span class="o">|</span>
<span class="o">|</span> <span class="n">Stored</span> <span class="k">for</span> <span class="mi">30</span> <span class="n">days</span>           <span class="o">|</span>
<span class="o">|</span> <span class="o">~</span><span class="mi">100</span> <span class="n">GB</span> <span class="n">compressed</span>           <span class="o">|</span>
<span class="o">+------------------------------+</span>

<span class="n">Weekly</span> <span class="p">(</span><span class="n">Sunday</span> <span class="mi">3</span> <span class="n">AM</span><span class="p">):</span>
<span class="o">+------------------------------+</span>
<span class="o">|</span> <span class="n">Full</span> <span class="n">database</span> <span class="n">dump</span>           <span class="o">|</span>
<span class="o">|</span> <span class="n">Stored</span> <span class="k">for</span> <span class="mi">1</span> <span class="n">year</span>            <span class="o">|</span>
<span class="o">|</span> <span class="n">Long</span><span class="o">-</span><span class="n">term</span> <span class="n">retention</span>          <span class="o">|</span>
<span class="o">+------------------------------+</span>

<span class="n">Continuous</span><span class="p">:</span>
<span class="o">+------------------------------+</span>
<span class="o">|</span> <span class="n">Binary</span> <span class="n">logs</span> <span class="p">(</span><span class="n">point</span><span class="o">-</span><span class="ow">in</span><span class="o">-</span><span class="n">time</span><span class="p">)</span>  <span class="o">|</span>
<span class="o">|</span> <span class="n">Stored</span> <span class="k">for</span> <span class="mi">7</span> <span class="n">days</span>            <span class="o">|</span>
<span class="o">|</span> <span class="n">For</span> <span class="n">recovery</span> <span class="n">between</span> <span class="n">backups</span> <span class="o">|</span>
<span class="o">+------------------------------+</span>
</pre></div>
</div>
<p><strong>Recovery Procedures</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Recovery</span> <span class="n">Scenarios</span><span class="p">:</span>

<span class="mf">1.</span> <span class="n">Recent</span> <span class="n">Data</span> <span class="n">Loss</span> <span class="p">(</span><span class="o">&lt;</span> <span class="mi">7</span> <span class="n">days</span><span class="p">):</span>
   <span class="o">+----------------------------+</span>
   <span class="o">|</span> <span class="n">Restore</span> <span class="n">latest</span> <span class="n">daily</span> <span class="n">backup</span><span class="o">|</span>
   <span class="o">|</span> <span class="n">Apply</span> <span class="n">binary</span> <span class="n">logs</span>          <span class="o">|</span>
   <span class="o">|</span> <span class="n">Point</span><span class="o">-</span><span class="ow">in</span><span class="o">-</span><span class="n">time</span> <span class="n">recovery</span>     <span class="o">|</span>
   <span class="o">+----------------------------+</span>
   <span class="n">Recovery</span> <span class="n">time</span><span class="p">:</span> <span class="mi">1</span><span class="o">-</span><span class="mi">2</span> <span class="n">hours</span>

<span class="mf">2.</span> <span class="n">Older</span> <span class="n">Data</span> <span class="n">Loss</span> <span class="p">(</span><span class="o">&lt;</span> <span class="mi">1</span> <span class="n">year</span><span class="p">):</span>
   <span class="o">+----------------------------+</span>
   <span class="o">|</span> <span class="n">Restore</span> <span class="n">weekly</span> <span class="n">backup</span>      <span class="o">|</span>
   <span class="o">|</span> <span class="n">No</span> <span class="n">binary</span> <span class="n">logs</span> <span class="n">available</span>   <span class="o">|</span>
   <span class="o">+----------------------------+</span>
   <span class="n">Recovery</span> <span class="n">time</span><span class="p">:</span> <span class="mi">2</span><span class="o">-</span><span class="mi">4</span> <span class="n">hours</span>

<span class="mf">3.</span> <span class="n">Disaster</span> <span class="n">Recovery</span><span class="p">:</span>
   <span class="o">+----------------------------+</span>
   <span class="o">|</span> <span class="n">Failover</span> <span class="n">to</span> <span class="n">replica</span>        <span class="o">|</span>
   <span class="o">|</span> <span class="n">Promote</span> <span class="n">to</span> <span class="n">primary</span>         <span class="o">|</span>
   <span class="o">|</span> <span class="n">Restore</span> <span class="kn">from</span> <span class="nn">backup</span>        <span class="o">|</span>
   <span class="o">+----------------------------+</span>
   <span class="n">Recovery</span> <span class="n">time</span><span class="p">:</span> <span class="mi">15</span> <span class="n">minutes</span>
</pre></div>
</div>
</section>
<section id="performance-monitoring">
<h3>Performance Monitoring<a class="headerlink" href="#performance-monitoring" title="Link to this heading"></a></h3>
<p>VoIPBIN monitors data layer performance:</p>
<p><strong>Database Metrics</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Key</span> <span class="n">Database</span> <span class="n">Metrics</span><span class="p">:</span>

<span class="n">Query</span> <span class="n">Performance</span><span class="p">:</span>
<span class="o">+-------------------------------------+</span>
<span class="o">|</span> <span class="n">Slow</span> <span class="n">queries</span> <span class="p">(</span><span class="o">&gt;</span> <span class="mi">1</span> <span class="n">second</span><span class="p">):</span> <span class="mf">0.1</span><span class="o">%</span>     <span class="o">|</span>
<span class="o">|</span> <span class="n">Average</span> <span class="n">query</span> <span class="n">time</span><span class="p">:</span> <span class="mi">5</span><span class="n">ms</span>             <span class="o">|</span>
<span class="o">|</span> <span class="n">P95</span> <span class="n">query</span> <span class="n">time</span><span class="p">:</span> <span class="mi">50</span><span class="n">ms</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">P99</span> <span class="n">query</span> <span class="n">time</span><span class="p">:</span> <span class="mi">200</span><span class="n">ms</span>               <span class="o">|</span>
<span class="o">+-------------------------------------+</span>

<span class="n">Connection</span> <span class="n">Pool</span><span class="p">:</span>
<span class="o">+-------------------------------------+</span>
<span class="o">|</span> <span class="n">Active</span> <span class="n">connections</span><span class="p">:</span> <span class="mi">45</span><span class="o">/</span><span class="mi">50</span>           <span class="o">|</span>
<span class="o">|</span> <span class="n">Idle</span> <span class="n">connections</span><span class="p">:</span> <span class="mi">5</span><span class="o">/</span><span class="mi">50</span>              <span class="o">|</span>
<span class="o">|</span> <span class="n">Wait</span> <span class="n">time</span><span class="p">:</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="n">ms</span>                    <span class="o">|</span>
<span class="o">+-------------------------------------+</span>

<span class="n">Table</span> <span class="n">Size</span><span class="p">:</span>
<span class="o">+-------------------------------------+</span>
<span class="o">|</span> <span class="n">calls</span><span class="p">:</span>        <span class="mi">50</span> <span class="n">million</span> <span class="n">rows</span>       <span class="o">|</span>
<span class="o">|</span> <span class="n">conferences</span><span class="p">:</span>  <span class="mi">5</span> <span class="n">million</span> <span class="n">rows</span>        <span class="o">|</span>
<span class="o">|</span> <span class="n">agents</span><span class="p">:</span>       <span class="mi">10</span><span class="p">,</span><span class="mi">000</span> <span class="n">rows</span>           <span class="o">|</span>
<span class="o">|</span> <span class="n">Total</span> <span class="n">size</span><span class="p">:</span>   <span class="mi">500</span> <span class="n">GB</span>                <span class="o">|</span>
<span class="o">+-------------------------------------+</span>
</pre></div>
</div>
<p><strong>Cache Metrics</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Redis</span> <span class="n">Performance</span><span class="p">:</span>

<span class="n">Hit</span> <span class="n">Rate</span><span class="p">:</span>
<span class="o">+-------------------------------------+</span>
<span class="o">|</span> <span class="n">Cache</span> <span class="n">hits</span><span class="p">:</span>   <span class="mi">95</span><span class="o">%</span>                   <span class="o">|</span>
<span class="o">|</span> <span class="n">Cache</span> <span class="n">misses</span><span class="p">:</span> <span class="mi">5</span><span class="o">%</span>                    <span class="o">|</span>
<span class="o">|</span> <span class="n">Target</span><span class="p">:</span>       <span class="o">&gt;</span> <span class="mi">90</span><span class="o">%</span>                 <span class="o">|</span>
<span class="o">+-------------------------------------+</span>

<span class="n">Memory</span> <span class="n">Usage</span><span class="p">:</span>
<span class="o">+-------------------------------------+</span>
<span class="o">|</span> <span class="n">Used</span> <span class="n">memory</span><span class="p">:</span> <span class="mi">8</span> <span class="n">GB</span> <span class="o">/</span> <span class="mi">16</span> <span class="n">GB</span>           <span class="o">|</span>
<span class="o">|</span> <span class="n">Peak</span> <span class="n">memory</span><span class="p">:</span> <span class="mi">12</span> <span class="n">GB</span>                  <span class="o">|</span>
<span class="o">|</span> <span class="n">Eviction</span><span class="p">:</span>    <span class="n">LRU</span> <span class="n">policy</span>             <span class="o">|</span>
<span class="o">+-------------------------------------+</span>

<span class="n">Latency</span><span class="p">:</span>
<span class="o">+-------------------------------------+</span>
<span class="o">|</span> <span class="n">P50</span><span class="p">:</span> <span class="mf">0.5</span><span class="n">ms</span>                          <span class="o">|</span>
<span class="o">|</span> <span class="n">P95</span><span class="p">:</span> <span class="mi">2</span><span class="n">ms</span>                            <span class="o">|</span>
<span class="o">|</span> <span class="n">P99</span><span class="p">:</span> <span class="mi">5</span><span class="n">ms</span>                            <span class="o">|</span>
<span class="o">+-------------------------------------+</span>
</pre></div>
</div>
</section>
<section id="scalability-considerations">
<h3>Scalability Considerations<a class="headerlink" href="#scalability-considerations" title="Link to this heading"></a></h3>
<p>As VoIPBIN scales, data layer adapts:</p>
<p><strong>Database Scaling</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Scaling</span> <span class="n">Strategy</span><span class="p">:</span>

<span class="n">Current</span> <span class="p">(</span><span class="o">&lt;</span> <span class="mi">1</span><span class="n">M</span> <span class="n">customers</span><span class="p">):</span>
<span class="o">+--------------------------+</span>
<span class="o">|</span>   <span class="n">Single</span> <span class="n">Primary</span>         <span class="o">|</span>
<span class="o">|</span>   <span class="o">+</span> <span class="n">Read</span> <span class="n">Replicas</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>    <span class="o">|</span>
<span class="o">+--------------------------+</span>

<span class="n">Future</span> <span class="p">(</span><span class="o">&gt;</span> <span class="mi">1</span><span class="n">M</span> <span class="n">customers</span><span class="p">):</span>
<span class="o">+--------------------------+</span>
<span class="o">|</span>   <span class="n">Sharding</span> <span class="n">by</span> <span class="n">Customer</span>   <span class="o">|</span>
<span class="o">|</span>                          <span class="o">|</span>
<span class="o">|</span>   <span class="n">Shard</span> <span class="mi">1</span><span class="p">:</span> <span class="n">customers</span> <span class="n">A</span><span class="o">-</span><span class="n">M</span> <span class="o">|</span>
<span class="o">|</span>   <span class="n">Shard</span> <span class="mi">2</span><span class="p">:</span> <span class="n">customers</span> <span class="n">N</span><span class="o">-</span><span class="n">Z</span> <span class="o">|</span>
<span class="o">+--------------------------+</span>
</pre></div>
</div>
<p><strong>Cache Scaling</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Redis</span> <span class="n">Scaling</span><span class="p">:</span>

<span class="n">Current</span><span class="p">:</span>
<span class="o">+--------------------------+</span>
<span class="o">|</span>  <span class="n">Single</span> <span class="n">Redis</span> <span class="n">Instance</span>   <span class="o">|</span>
<span class="o">|</span>  <span class="mi">16</span> <span class="n">GB</span> <span class="n">Memory</span>            <span class="o">|</span>
<span class="o">+--------------------------+</span>

<span class="n">Future</span><span class="p">:</span>
<span class="o">+--------------------------+</span>
<span class="o">|</span>  <span class="n">Redis</span> <span class="n">Cluster</span>           <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="n">Multiple</span> <span class="n">nodes</span>        <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="n">Automatic</span> <span class="n">sharding</span>    <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="n">High</span> <span class="n">availability</span>     <span class="o">|</span>
<span class="o">+--------------------------+</span>
</pre></div>
</div>
</section>
<section id="id4">
<h3>Best Practices<a class="headerlink" href="#id4" title="Link to this heading"></a></h3>
<p><strong>Database:</strong></p>
<ul class="simple">
<li><p>Use indexes for all WHERE clauses</p></li>
<li><p>Avoid SELECT <a href="#id5"><span class="problematic" id="id6">*</span></a>, specify columns</p></li>
<li><p>Use connection pooling</p></li>
<li><p>Set appropriate timeouts</p></li>
<li><p>Monitor slow queries</p></li>
<li><p>Regular ANALYZE TABLE for statistics</p></li>
</ul>
<p><strong>Cache:</strong></p>
<ul class="simple">
<li><p>Set appropriate TTLs</p></li>
<li><p>Invalidate on updates</p></li>
<li><p>Use structured keys</p></li>
<li><p>Monitor hit rates</p></li>
<li><p>Handle cache failures gracefully</p></li>
<li><p>Don’t store large objects (&gt; 1MB)</p></li>
</ul>
<p><strong>Security:</strong></p>
<ul class="simple">
<li><p>Use parameterized queries (prevent SQL injection)</p></li>
<li><p>Encrypt sensitive data at rest</p></li>
<li><p>Use SSL/TLS for connections</p></li>
<li><p>Rotate database credentials regularly</p></li>
<li><p>Audit database access</p></li>
<li><p>Restrict network access</p></li>
</ul>
<p><strong>Monitoring:</strong></p>
<ul class="simple">
<li><p>Track query performance</p></li>
<li><p>Monitor connection pool utilization</p></li>
<li><p>Alert on cache hit rate &lt; 90%</p></li>
<li><p>Alert on slow queries</p></li>
<li><p>Monitor disk space</p></li>
<li><p>Track replication lag</p></li>
</ul>
</section>
</section>
<section id="data-flow-diagrams">
<span id="architecture-dataflow"></span><h2>Data Flow Diagrams<a class="headerlink" href="#data-flow-diagrams" title="Link to this heading"></a></h2>
<p>This section illustrates how data flows through VoIPBIN’s components for common operations. Understanding these flows helps developers integrate with the platform and troubleshoot issues.</p>
<section id="end-to-end-request-flow">
<h3>End-to-End Request Flow<a class="headerlink" href="#end-to-end-request-flow" title="Link to this heading"></a></h3>
<p>Every API request follows a consistent path through the system:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Complete</span> <span class="n">API</span> <span class="n">Request</span> <span class="n">Flow</span><span class="p">:</span>

<span class="n">Client</span>          <span class="n">Load</span> <span class="n">Balancer</span>      <span class="n">API</span> <span class="n">Gateway</span>       <span class="n">Backend</span> <span class="n">Service</span>        <span class="n">Database</span>
   <span class="o">|</span>                 <span class="o">|</span>                  <span class="o">|</span>                  <span class="o">|</span>                   <span class="o">|</span>
   <span class="o">|</span> <span class="n">HTTPS</span> <span class="n">Request</span>   <span class="o">|</span>                  <span class="o">|</span>                  <span class="o">|</span>                   <span class="o">|</span>
   <span class="o">+----------------&gt;|</span>                  <span class="o">|</span>                  <span class="o">|</span>                   <span class="o">|</span>
   <span class="o">|</span>                 <span class="o">|</span> <span class="n">TLS</span> <span class="n">Termination</span>  <span class="o">|</span>                  <span class="o">|</span>                   <span class="o">|</span>
   <span class="o">|</span>                 <span class="o">+-----------------&gt;|</span>                  <span class="o">|</span>                   <span class="o">|</span>
   <span class="o">|</span>                 <span class="o">|</span>                  <span class="o">|</span>                  <span class="o">|</span>                   <span class="o">|</span>
   <span class="o">|</span>                 <span class="o">|</span>                  <span class="o">|</span> <span class="mf">1.</span> <span class="n">Parse</span> <span class="n">Auth</span>    <span class="o">|</span>                   <span class="o">|</span>
   <span class="o">|</span>                 <span class="o">|</span>                  <span class="o">|</span>    <span class="n">Header</span>        <span class="o">|</span>                   <span class="o">|</span>
   <span class="o">|</span>                 <span class="o">|</span>                  <span class="o">|</span>                  <span class="o">|</span>                   <span class="o">|</span>
   <span class="o">|</span>                 <span class="o">|</span>                  <span class="o">|</span> <span class="mf">2.</span> <span class="n">Validate</span> <span class="n">JWT</span>  <span class="o">|</span>                   <span class="o">|</span>
   <span class="o">|</span>                 <span class="o">|</span>                  <span class="o">|</span>    <span class="ow">or</span> <span class="n">AccessKey</span>  <span class="o">|</span>                   <span class="o">|</span>
   <span class="o">|</span>                 <span class="o">|</span>                  <span class="o">|</span>                  <span class="o">|</span>                   <span class="o">|</span>
   <span class="o">|</span>                 <span class="o">|</span>                  <span class="o">|</span> <span class="mf">3.</span> <span class="n">Extract</span>       <span class="o">|</span>                   <span class="o">|</span>
   <span class="o">|</span>                 <span class="o">|</span>                  <span class="o">|</span>    <span class="n">customer_id</span>   <span class="o">|</span>                   <span class="o">|</span>
   <span class="o">|</span>                 <span class="o">|</span>                  <span class="o">|</span>                  <span class="o">|</span>                   <span class="o">|</span>
   <span class="o">|</span>                 <span class="o">|</span>                  <span class="o">|</span> <span class="mf">4.</span> <span class="n">RabbitMQ</span> <span class="n">RPC</span>  <span class="o">|</span>                   <span class="o">|</span>
   <span class="o">|</span>                 <span class="o">|</span>                  <span class="o">+-----------------&gt;|</span>                   <span class="o">|</span>
   <span class="o">|</span>                 <span class="o">|</span>                  <span class="o">|</span>                  <span class="o">|</span>                   <span class="o">|</span>
   <span class="o">|</span>                 <span class="o">|</span>                  <span class="o">|</span>                  <span class="o">|</span> <span class="mf">5.</span> <span class="n">Check</span> <span class="n">Redis</span>   <span class="o">|</span>
   <span class="o">|</span>                 <span class="o">|</span>                  <span class="o">|</span>                  <span class="o">|</span>    <span class="n">Cache</span>          <span class="o">|</span>
   <span class="o">|</span>                 <span class="o">|</span>                  <span class="o">|</span>                  <span class="o">+------------------&gt;|</span>
   <span class="o">|</span>                 <span class="o">|</span>                  <span class="o">|</span>                  <span class="o">|</span>                   <span class="o">|</span>
   <span class="o">|</span>                 <span class="o">|</span>                  <span class="o">|</span>                  <span class="o">|&lt;------------------+</span>
   <span class="o">|</span>                 <span class="o">|</span>                  <span class="o">|</span>                  <span class="o">|</span> <span class="p">(</span><span class="n">cache</span> <span class="n">hit</span><span class="o">/</span><span class="n">miss</span><span class="p">)</span> <span class="o">|</span>
   <span class="o">|</span>                 <span class="o">|</span>                  <span class="o">|</span>                  <span class="o">|</span>                   <span class="o">|</span>
   <span class="o">|</span>                 <span class="o">|</span>                  <span class="o">|</span>                  <span class="o">|</span> <span class="mf">6.</span> <span class="n">Query</span> <span class="n">MySQL</span>   <span class="o">|</span>
   <span class="o">|</span>                 <span class="o">|</span>                  <span class="o">|</span>                  <span class="o">|</span>    <span class="p">(</span><span class="k">if</span> <span class="n">cache</span> <span class="n">miss</span><span class="p">)</span><span class="o">|</span>
   <span class="o">|</span>                 <span class="o">|</span>                  <span class="o">|</span>                  <span class="o">+------------------&gt;|</span>
   <span class="o">|</span>                 <span class="o">|</span>                  <span class="o">|</span>                  <span class="o">|</span>                   <span class="o">|</span>
   <span class="o">|</span>                 <span class="o">|</span>                  <span class="o">|</span>                  <span class="o">|&lt;------------------+</span>
   <span class="o">|</span>                 <span class="o">|</span>                  <span class="o">|</span>                  <span class="o">|</span> <span class="n">Data</span>             <span class="o">|</span>
   <span class="o">|</span>                 <span class="o">|</span>                  <span class="o">|</span>                  <span class="o">|</span>                   <span class="o">|</span>
   <span class="o">|</span>                 <span class="o">|</span>                  <span class="o">|</span>                  <span class="o">|</span> <span class="mf">7.</span> <span class="n">Update</span> <span class="n">Cache</span>  <span class="o">|</span>
   <span class="o">|</span>                 <span class="o">|</span>                  <span class="o">|</span>                  <span class="o">+------------------&gt;|</span>
   <span class="o">|</span>                 <span class="o">|</span>                  <span class="o">|</span>                  <span class="o">|</span>                   <span class="o">|</span>
   <span class="o">|</span>                 <span class="o">|</span>                  <span class="o">|&lt;-----------------+</span>                   <span class="o">|</span>
   <span class="o">|</span>                 <span class="o">|</span>                  <span class="o">|</span> <span class="n">RPC</span> <span class="n">Response</span>     <span class="o">|</span>                   <span class="o">|</span>
   <span class="o">|</span>                 <span class="o">|</span>                  <span class="o">|</span>                  <span class="o">|</span>                   <span class="o">|</span>
   <span class="o">|</span>                 <span class="o">|</span>                  <span class="o">|</span> <span class="mf">8.</span> <span class="n">Check</span>         <span class="o">|</span>                   <span class="o">|</span>
   <span class="o">|</span>                 <span class="o">|</span>                  <span class="o">|</span>    <span class="n">Authorization</span> <span class="o">|</span>                   <span class="o">|</span>
   <span class="o">|</span>                 <span class="o">|</span>                  <span class="o">|</span>    <span class="p">(</span><span class="n">customer_id</span><span class="p">)</span> <span class="o">|</span>                   <span class="o">|</span>
   <span class="o">|</span>                 <span class="o">|</span>                  <span class="o">|</span>                  <span class="o">|</span>                   <span class="o">|</span>
   <span class="o">|&lt;----------------+-----------------+</span>                   <span class="o">|</span>                   <span class="o">|</span>
   <span class="o">|</span> <span class="n">JSON</span> <span class="n">Response</span>   <span class="o">|</span>                  <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>
   <span class="o">|</span>                 <span class="o">|</span>                  <span class="o">|</span>                  <span class="o">|</span>                   <span class="o">|</span>
</pre></div>
</div>
<p><strong>Key Data Transformations:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Data</span> <span class="n">Format</span> <span class="n">at</span> <span class="n">Each</span> <span class="n">Stage</span><span class="p">:</span>

<span class="mf">1.</span> <span class="n">Client</span> <span class="o">-&gt;</span> <span class="n">API</span> <span class="n">Gateway</span><span class="p">:</span>
   <span class="o">+------------------------------------------+</span>
   <span class="o">|</span> <span class="n">Format</span><span class="p">:</span> <span class="n">HTTPS</span><span class="o">/</span><span class="n">JSON</span>                       <span class="o">|</span>
   <span class="o">|</span> <span class="n">Auth</span><span class="p">:</span> <span class="n">Bearer</span> <span class="n">JWT</span> <span class="ow">or</span> <span class="n">AccessKey</span> <span class="n">header</span>     <span class="o">|</span>
   <span class="o">|</span> <span class="n">Body</span><span class="p">:</span> <span class="n">JSON</span> <span class="n">request</span> <span class="n">body</span>                  <span class="o">|</span>
   <span class="o">+------------------------------------------+</span>

<span class="mf">2.</span> <span class="n">API</span> <span class="n">Gateway</span> <span class="o">-&gt;</span> <span class="n">Backend</span> <span class="n">Service</span><span class="p">:</span>
   <span class="o">+------------------------------------------+</span>
   <span class="o">|</span> <span class="n">Format</span><span class="p">:</span> <span class="n">RabbitMQ</span> <span class="n">message</span> <span class="p">(</span><span class="n">JSON</span><span class="p">)</span>          <span class="o">|</span>
   <span class="o">|</span> <span class="n">Contains</span><span class="p">:</span> <span class="n">customer_id</span><span class="p">,</span> <span class="n">agent_id</span><span class="p">,</span>         <span class="o">|</span>
   <span class="o">|</span>           <span class="n">original</span> <span class="n">request</span> <span class="n">data</span>          <span class="o">|</span>
   <span class="o">|</span> <span class="n">Queue</span><span class="p">:</span> <span class="nb">bin</span><span class="o">-</span><span class="n">manager</span><span class="o">.&lt;</span><span class="n">service</span><span class="o">&gt;.</span><span class="n">request</span>     <span class="o">|</span>
   <span class="o">+------------------------------------------+</span>

<span class="mf">3.</span> <span class="n">Backend</span> <span class="n">Service</span> <span class="o">-&gt;</span> <span class="n">Database</span><span class="p">:</span>
   <span class="o">+------------------------------------------+</span>
   <span class="o">|</span> <span class="n">Format</span><span class="p">:</span> <span class="n">SQL</span> <span class="n">queries</span> <span class="p">(</span><span class="n">parameterized</span><span class="p">)</span>      <span class="o">|</span>
   <span class="o">|</span> <span class="n">ORM</span><span class="p">:</span> <span class="n">Squirrel</span> <span class="n">query</span> <span class="n">builder</span>              <span class="o">|</span>
   <span class="o">+------------------------------------------+</span>

<span class="mf">4.</span> <span class="n">Backend</span> <span class="n">Service</span> <span class="o">-&gt;</span> <span class="n">API</span> <span class="n">Gateway</span><span class="p">:</span>
   <span class="o">+------------------------------------------+</span>
   <span class="o">|</span> <span class="n">Format</span><span class="p">:</span> <span class="n">RabbitMQ</span> <span class="n">response</span> <span class="p">(</span><span class="n">JSON</span><span class="p">)</span>         <span class="o">|</span>
   <span class="o">|</span> <span class="n">Contains</span><span class="p">:</span> <span class="n">status_code</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">error</span>       <span class="o">|</span>
   <span class="o">+------------------------------------------+</span>

<span class="mf">5.</span> <span class="n">API</span> <span class="n">Gateway</span> <span class="o">-&gt;</span> <span class="n">Client</span><span class="p">:</span>
   <span class="o">+------------------------------------------+</span>
   <span class="o">|</span> <span class="n">Format</span><span class="p">:</span> <span class="n">HTTPS</span><span class="o">/</span><span class="n">JSON</span>                       <span class="o">|</span>
   <span class="o">|</span> <span class="n">Headers</span><span class="p">:</span> <span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">,</span> <span class="n">Cache</span><span class="o">-</span><span class="n">Control</span>     <span class="o">|</span>
   <span class="o">+------------------------------------------+</span>
</pre></div>
</div>
</section>
<section id="event-publishing-flow">
<h3>Event Publishing Flow<a class="headerlink" href="#event-publishing-flow" title="Link to this heading"></a></h3>
<p>When resources change, events propagate through the system:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Event</span> <span class="n">Publishing</span> <span class="n">Flow</span><span class="p">:</span>

<span class="n">Source</span> <span class="n">Service</span>       <span class="n">RabbitMQ</span> <span class="n">Exchange</span>       <span class="n">Subscriber</span> <span class="n">Services</span>
     <span class="o">|</span>                     <span class="o">|</span>                        <span class="o">|</span>
     <span class="o">|</span> <span class="mf">1.</span> <span class="n">Business</span> <span class="n">Logic</span>   <span class="o">|</span>                        <span class="o">|</span>
     <span class="o">|</span>    <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="p">,</span> <span class="n">call</span> <span class="n">ends</span><span class="p">)</span><span class="o">|</span>                        <span class="o">|</span>
     <span class="o">|</span>                     <span class="o">|</span>                        <span class="o">|</span>
     <span class="o">|</span> <span class="mf">2.</span> <span class="n">Update</span> <span class="n">Database</span>  <span class="o">|</span>                        <span class="o">|</span>
     <span class="o">|</span>                     <span class="o">|</span>                        <span class="o">|</span>
     <span class="o">|</span> <span class="mf">3.</span> <span class="n">Invalidate</span> <span class="n">Cache</span> <span class="o">|</span>                        <span class="o">|</span>
     <span class="o">|</span>                     <span class="o">|</span>                        <span class="o">|</span>
     <span class="o">|</span> <span class="mf">4.</span> <span class="n">Publish</span> <span class="n">Event</span>    <span class="o">|</span>                        <span class="o">|</span>
     <span class="o">+--------------------&gt;|</span>                        <span class="o">|</span>
     <span class="o">|</span>  <span class="n">Exchange</span><span class="p">:</span>          <span class="o">|</span>                        <span class="o">|</span>
     <span class="o">|</span>  <span class="n">call</span><span class="o">.</span><span class="n">events</span>        <span class="o">|</span>                        <span class="o">|</span>
     <span class="o">|</span>                     <span class="o">|</span>                        <span class="o">|</span>
     <span class="o">|</span>                     <span class="o">|</span> <span class="mf">5.</span> <span class="n">Fanout</span> <span class="n">to</span> <span class="n">Queues</span>    <span class="o">|</span>
     <span class="o">|</span>                     <span class="o">+----------+-------------+</span>
     <span class="o">|</span>                     <span class="o">|</span>          <span class="o">|</span>             <span class="o">|</span>
     <span class="o">|</span>                     <span class="n">v</span>          <span class="n">v</span>             <span class="n">v</span>
     <span class="o">|</span>               <span class="o">+--------+</span> <span class="o">+--------+</span>    <span class="o">+--------+</span>
     <span class="o">|</span>               <span class="o">|</span><span class="n">billing</span> <span class="o">|</span> <span class="o">|</span><span class="n">webhook</span> <span class="o">|</span>    <span class="o">|</span><span class="n">queue</span>   <span class="o">|</span>
     <span class="o">|</span>               <span class="o">|.</span><span class="n">call</span>   <span class="o">|</span> <span class="o">|.</span><span class="n">call</span>   <span class="o">|</span>    <span class="o">|.</span><span class="n">call</span>   <span class="o">|</span>
     <span class="o">|</span>               <span class="o">|.</span><span class="n">events</span> <span class="o">|</span> <span class="o">|.</span><span class="n">events</span> <span class="o">|</span>    <span class="o">|.</span><span class="n">events</span> <span class="o">|</span>
     <span class="o">|</span>               <span class="o">+---+----+</span> <span class="o">+---+----+</span>    <span class="o">+---+----+</span>
     <span class="o">|</span>                   <span class="o">|</span>          <span class="o">|</span>             <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span> <span class="mf">6.</span> <span class="n">Process</span>             <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>    <span class="n">Event</span>               <span class="o">|</span>
     <span class="o">|</span>                   <span class="n">v</span>          <span class="n">v</span>             <span class="n">v</span>
     <span class="o">|</span>              <span class="n">billing</span><span class="o">-</span>   <span class="n">webhook</span><span class="o">-</span>      <span class="n">queue</span><span class="o">-</span>
     <span class="o">|</span>              <span class="n">manager</span>    <span class="n">manager</span>       <span class="n">manager</span>
     <span class="o">|</span>                   <span class="o">|</span>          <span class="o">|</span>             <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span> <span class="mf">7.</span> <span class="n">Take</span>  <span class="o">|</span> <span class="mf">7.</span> <span class="n">Send</span>     <span class="o">|</span> <span class="mf">7.</span> <span class="n">Update</span>
     <span class="o">|</span>                   <span class="o">|</span>    <span class="n">Action</span><span class="o">|</span>    <span class="n">Webhook</span>  <span class="o">|</span>    <span class="n">Stats</span>
     <span class="o">|</span>                   <span class="o">|</span>          <span class="o">|</span>             <span class="o">|</span>
</pre></div>
</div>
<p><strong>Event Data Structure:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Published</span> <span class="n">Event</span><span class="p">:</span>

<span class="n">Exchange</span><span class="p">:</span> <span class="n">call</span><span class="o">.</span><span class="n">events</span>
<span class="n">Routing</span> <span class="n">Key</span><span class="p">:</span> <span class="n">call</span><span class="o">.</span><span class="n">hungup</span>

<span class="n">Message</span><span class="p">:</span>
<span class="p">{</span>
  <span class="s2">&quot;event_id&quot;</span><span class="p">:</span> <span class="s2">&quot;uuid&quot;</span><span class="p">,</span>
  <span class="s2">&quot;event_type&quot;</span><span class="p">:</span> <span class="s2">&quot;call_hungup&quot;</span><span class="p">,</span>
  <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2026-01-20T12:00:00.000Z&quot;</span><span class="p">,</span>
  <span class="s2">&quot;customer_id&quot;</span><span class="p">:</span> <span class="s2">&quot;uuid&quot;</span><span class="p">,</span>
  <span class="s2">&quot;resource&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;uuid&quot;</span><span class="p">,</span>
    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;call&quot;</span><span class="p">,</span>
    <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;+15551234567&quot;</span><span class="p">,</span>
    <span class="s2">&quot;destination&quot;</span><span class="p">:</span> <span class="s2">&quot;+15559876543&quot;</span><span class="p">,</span>
    <span class="s2">&quot;duration&quot;</span><span class="p">:</span> <span class="mi">120</span><span class="p">,</span>
    <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;completed&quot;</span><span class="p">,</span>
    <span class="s2">&quot;hangup_cause&quot;</span><span class="p">:</span> <span class="s2">&quot;normal_clearing&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Subscriber Processing:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Event</span> <span class="n">Processing</span> <span class="n">by</span> <span class="n">Service</span><span class="p">:</span>

<span class="n">billing</span><span class="o">-</span><span class="n">manager</span><span class="p">:</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">On</span><span class="p">:</span> <span class="n">call_hungup</span>                          <span class="o">|</span>
<span class="o">|</span> <span class="n">Action</span><span class="p">:</span>                                  <span class="o">|</span>
<span class="o">|</span>   <span class="mf">1.</span> <span class="n">Calculate</span> <span class="n">call</span> <span class="n">cost</span>                 <span class="o">|</span>
<span class="o">|</span>   <span class="mf">2.</span> <span class="n">Deduct</span> <span class="kn">from</span> <span class="nn">customer</span> <span class="n">balance</span>        <span class="o">|</span>
<span class="o">|</span>   <span class="mf">3.</span> <span class="n">Create</span> <span class="n">billing</span> <span class="n">record</span>               <span class="o">|</span>
<span class="o">+------------------------------------------+</span>

<span class="n">webhook</span><span class="o">-</span><span class="n">manager</span><span class="p">:</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">On</span><span class="p">:</span> <span class="n">call_hungup</span>                          <span class="o">|</span>
<span class="o">|</span> <span class="n">Action</span><span class="p">:</span>                                  <span class="o">|</span>
<span class="o">|</span>   <span class="mf">1.</span> <span class="n">Lookup</span> <span class="n">customer</span> <span class="n">webhook</span> <span class="n">config</span>      <span class="o">|</span>
<span class="o">|</span>   <span class="mf">2.</span> <span class="n">Format</span> <span class="n">webhook</span> <span class="n">payload</span>              <span class="o">|</span>
<span class="o">|</span>   <span class="mf">3.</span> <span class="n">POST</span> <span class="n">to</span> <span class="n">customer</span> <span class="n">endpoint</span>           <span class="o">|</span>
<span class="o">|</span>   <span class="mf">4.</span> <span class="n">Handle</span> <span class="n">retries</span> <span class="n">on</span> <span class="n">failure</span>           <span class="o">|</span>
<span class="o">+------------------------------------------+</span>

<span class="n">queue</span><span class="o">-</span><span class="n">manager</span><span class="p">:</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">On</span><span class="p">:</span> <span class="n">call_hungup</span>                          <span class="o">|</span>
<span class="o">|</span> <span class="n">Action</span><span class="p">:</span>                                  <span class="o">|</span>
<span class="o">|</span>   <span class="mf">1.</span> <span class="n">Check</span> <span class="k">if</span> <span class="n">call</span> <span class="n">was</span> <span class="kn">from</span> <span class="nn">queue</span>        <span class="o">|</span>
<span class="o">|</span>   <span class="mf">2.</span> <span class="n">Update</span> <span class="n">queue</span> <span class="n">statistics</span>             <span class="o">|</span>
<span class="o">|</span>   <span class="mf">3.</span> <span class="n">Mark</span> <span class="n">agent</span> <span class="k">as</span> <span class="n">available</span>             <span class="o">|</span>
<span class="o">+------------------------------------------+</span>
</pre></div>
</div>
</section>
<section id="real-time-data-flow-websocket">
<h3>Real-Time Data Flow (WebSocket)<a class="headerlink" href="#real-time-data-flow-websocket" title="Link to this heading"></a></h3>
<p>WebSocket connections provide real-time updates to clients:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">WebSocket</span> <span class="n">Data</span> <span class="n">Flow</span><span class="p">:</span>

<span class="n">Client</span>           <span class="n">API</span> <span class="n">Gateway</span>          <span class="n">ZMQ</span> <span class="n">Publisher</span>        <span class="n">Backend</span> <span class="n">Service</span>
   <span class="o">|</span>                  <span class="o">|</span>                    <span class="o">|</span>                      <span class="o">|</span>
   <span class="o">|</span> <span class="mf">1.</span> <span class="n">WS</span> <span class="n">Connect</span>    <span class="o">|</span>                    <span class="o">|</span>                      <span class="o">|</span>
   <span class="o">+-----------------&gt;|</span>                    <span class="o">|</span>                      <span class="o">|</span>
   <span class="o">|</span>                  <span class="o">|</span> <span class="mf">2.</span> <span class="n">Authenticate</span>    <span class="o">|</span>                      <span class="o">|</span>
   <span class="o">|</span>                  <span class="o">|</span>    <span class="p">(</span><span class="n">JWT</span> <span class="n">token</span><span class="p">)</span>     <span class="o">|</span>                      <span class="o">|</span>
   <span class="o">|</span>                  <span class="o">|</span>                    <span class="o">|</span>                      <span class="o">|</span>
   <span class="o">|</span> <span class="mf">3.</span> <span class="n">Subscribe</span>     <span class="o">|</span>                    <span class="o">|</span>                      <span class="o">|</span>
   <span class="o">|</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;subscribe&quot;</span><span class="p">,</span>                  <span class="o">|</span>                      <span class="o">|</span>
   <span class="o">|</span>  <span class="s2">&quot;topics&quot;</span><span class="p">:[</span><span class="s2">&quot;customer_id:123:call:*&quot;</span><span class="p">]}</span> <span class="o">|</span>                      <span class="o">|</span>
   <span class="o">+-----------------&gt;|</span>                    <span class="o">|</span>                      <span class="o">|</span>
   <span class="o">|</span>                  <span class="o">|</span> <span class="mf">4.</span> <span class="n">Register</span>        <span class="o">|</span>                      <span class="o">|</span>
   <span class="o">|</span>                  <span class="o">|</span>    <span class="n">Subscription</span>    <span class="o">|</span>                      <span class="o">|</span>
   <span class="o">|</span>                  <span class="o">|</span>                    <span class="o">|</span>                      <span class="o">|</span>
   <span class="o">|</span>                  <span class="o">|</span>                    <span class="o">|</span>                      <span class="o">|</span> <span class="mf">5.</span> <span class="n">Call</span> <span class="n">Starts</span>
   <span class="o">|</span>                  <span class="o">|</span>                    <span class="o">|</span>                      <span class="o">|</span>    <span class="p">(</span><span class="n">business</span> <span class="n">event</span><span class="p">)</span>
   <span class="o">|</span>                  <span class="o">|</span>                    <span class="o">|</span>                      <span class="o">|</span>
   <span class="o">|</span>                  <span class="o">|</span>                    <span class="o">|&lt;---------------------+</span>
   <span class="o">|</span>                  <span class="o">|</span>                    <span class="o">|</span> <span class="mf">6.</span> <span class="n">ZMQ</span> <span class="n">Publish</span>       <span class="o">|</span>
   <span class="o">|</span>                  <span class="o">|</span>                    <span class="o">|</span>    <span class="n">topic</span><span class="p">:</span> <span class="n">call</span><span class="o">.</span><span class="n">state</span> <span class="o">|</span>
   <span class="o">|</span>                  <span class="o">|</span>                    <span class="o">|</span>                      <span class="o">|</span>
   <span class="o">|</span>                  <span class="o">|&lt;-------------------+</span>                      <span class="o">|</span>
   <span class="o">|</span>                  <span class="o">|</span> <span class="mf">7.</span> <span class="n">Match</span> <span class="n">to</span>        <span class="o">|</span>                      <span class="o">|</span>
   <span class="o">|</span>                  <span class="o">|</span>    <span class="n">Subscriptions</span>   <span class="o">|</span>                      <span class="o">|</span>
   <span class="o">|</span>                  <span class="o">|</span>                    <span class="o">|</span>                      <span class="o">|</span>
   <span class="o">|&lt;-----------------+</span>                    <span class="o">|</span>                      <span class="o">|</span>
   <span class="o">|</span> <span class="mf">8.</span> <span class="n">Push</span> <span class="n">Event</span>    <span class="o">|</span>                    <span class="o">|</span>                      <span class="o">|</span>
   <span class="o">|</span> <span class="p">{</span><span class="s2">&quot;event&quot;</span><span class="p">:</span><span class="s2">&quot;call_created&quot;</span><span class="p">,</span><span class="o">...</span><span class="p">}</span>          <span class="o">|</span>                      <span class="o">|</span>
   <span class="o">|</span>                  <span class="o">|</span>                    <span class="o">|</span>                      <span class="o">|</span>
</pre></div>
</div>
<p><strong>Topic Matching:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Subscription</span> <span class="n">Topic</span> <span class="n">Matching</span><span class="p">:</span>

<span class="n">Subscribed</span> <span class="n">Topic</span><span class="p">:</span>
<span class="n">customer_id</span><span class="p">:</span><span class="mi">123</span><span class="p">:</span><span class="n">call</span><span class="p">:</span><span class="o">*</span>

<span class="n">Matches</span><span class="p">:</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">customer_id</span><span class="p">:</span><span class="mi">123</span><span class="p">:</span><span class="n">call</span><span class="p">:</span><span class="n">abc</span><span class="o">-</span><span class="mi">456</span>  <span class="p">[</span><span class="n">match</span><span class="p">]</span>    <span class="o">|</span>
<span class="o">|</span> <span class="n">customer_id</span><span class="p">:</span><span class="mi">123</span><span class="p">:</span><span class="n">call</span><span class="p">:</span><span class="n">xyz</span><span class="o">-</span><span class="mi">789</span>  <span class="p">[</span><span class="n">match</span><span class="p">]</span>    <span class="o">|</span>
<span class="o">|</span> <span class="n">customer_id</span><span class="p">:</span><span class="mi">123</span><span class="p">:</span><span class="n">call</span><span class="p">:</span><span class="o">*</span>        <span class="p">[</span><span class="n">match</span><span class="p">]</span>    <span class="o">|</span>
<span class="o">+------------------------------------------+</span>

<span class="n">Does</span> <span class="n">Not</span> <span class="n">Match</span><span class="p">:</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">customer_id</span><span class="p">:</span><span class="mi">456</span><span class="p">:</span><span class="n">call</span><span class="p">:</span><span class="n">abc</span><span class="o">-</span><span class="mi">123</span>  <span class="p">[</span><span class="n">no</span> <span class="n">match</span><span class="p">]</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">customer_id</span><span class="p">:</span><span class="mi">123</span><span class="p">:</span><span class="n">conference</span><span class="p">:</span><span class="o">*</span>  <span class="p">[</span><span class="n">no</span> <span class="n">match</span><span class="p">]</span> <span class="o">|</span>
<span class="o">+------------------------------------------+</span>
</pre></div>
</div>
</section>
<section id="media-stream-data-flow">
<h3>Media Stream Data Flow<a class="headerlink" href="#media-stream-data-flow" title="Link to this heading"></a></h3>
<p>Audio data flows through the media pipeline:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Audio</span> <span class="n">Stream</span> <span class="n">Flow</span> <span class="p">(</span><span class="n">AI</span> <span class="n">Voice</span><span class="p">):</span>

<span class="n">Caller</span>        <span class="n">RTPEngine</span>      <span class="n">Asterisk</span>      <span class="n">pipecat</span><span class="o">-</span><span class="n">mgr</span>       <span class="n">AI</span><span class="o">/</span><span class="n">LLM</span>
   <span class="o">|</span>              <span class="o">|</span>             <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
   <span class="o">|</span> <span class="n">RTP</span> <span class="n">Audio</span>    <span class="o">|</span>             <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
   <span class="o">|</span> <span class="p">(</span><span class="n">Various</span><span class="p">)</span>    <span class="o">|</span>             <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
   <span class="o">+-------------&gt;|</span>             <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span> <span class="n">Transcode</span>   <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span> <span class="n">to</span> <span class="n">ulaw</span>     <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
   <span class="o">|</span>              <span class="o">+------------&gt;|</span>               <span class="o">|</span>               <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>             <span class="o">|</span> <span class="n">Audiosocket</span>   <span class="o">|</span>               <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>             <span class="o">|</span> <span class="p">(</span><span class="mi">8</span><span class="n">kHz</span> <span class="n">ulaw</span><span class="p">)</span>   <span class="o">|</span>               <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>             <span class="o">+--------------&gt;|</span>               <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>             <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>             <span class="o">|</span>               <span class="o">|</span> <span class="n">Resample</span> <span class="n">to</span>   <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>             <span class="o">|</span>               <span class="o">|</span> <span class="mi">16</span><span class="n">kHz</span> <span class="n">PCM</span>     <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>             <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>             <span class="o">|</span>               <span class="o">|</span> <span class="n">WebSocket</span>     <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>             <span class="o">|</span>               <span class="o">|</span> <span class="p">(</span><span class="n">Protobuf</span><span class="p">)</span>    <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>             <span class="o">|</span>               <span class="o">+--------------&gt;|</span>
   <span class="o">|</span>              <span class="o">|</span>             <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>             <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span> <span class="n">STT</span> <span class="o">+</span>
   <span class="o">|</span>              <span class="o">|</span>             <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span> <span class="n">LLM</span> <span class="o">+</span>
   <span class="o">|</span>              <span class="o">|</span>             <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span> <span class="n">TTS</span>
   <span class="o">|</span>              <span class="o">|</span>             <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>             <span class="o">|</span>               <span class="o">|&lt;--------------+</span>
   <span class="o">|</span>              <span class="o">|</span>             <span class="o">|</span>               <span class="o">|</span> <span class="n">Audio</span> <span class="n">Response</span><span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>             <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>             <span class="o">|</span>               <span class="o">|</span> <span class="n">Resample</span> <span class="n">to</span>   <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>             <span class="o">|</span>               <span class="o">|</span> <span class="mi">8</span><span class="n">kHz</span> <span class="n">ulaw</span>     <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>             <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>             <span class="o">|&lt;--------------+</span>               <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>             <span class="o">|</span> <span class="n">Audiosocket</span>   <span class="o">|</span>               <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>             <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|&lt;------------+</span>               <span class="o">|</span>               <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span> <span class="n">RTP</span>         <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
   <span class="o">|&lt;-------------+</span>             <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
   <span class="o">|</span> <span class="n">Audio</span> <span class="n">to</span>     <span class="o">|</span>             <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
   <span class="o">|</span> <span class="n">Caller</span>       <span class="o">|</span>             <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
</pre></div>
</div>
<p><strong>Audio Format Transformations:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Audio</span> <span class="n">Format</span> <span class="n">Pipeline</span><span class="p">:</span>

<span class="n">External</span> <span class="p">(</span><span class="n">Varies</span><span class="p">)</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">Codecs</span><span class="p">:</span> <span class="n">G</span><span class="mf">.711</span><span class="p">,</span> <span class="n">G</span><span class="mf">.722</span><span class="p">,</span> <span class="n">Opus</span><span class="p">,</span> <span class="n">etc</span><span class="o">.</span>         <span class="o">|</span>
<span class="o">|</span> <span class="n">Sample</span> <span class="n">Rate</span><span class="p">:</span> <span class="mi">8</span><span class="n">kHz</span> <span class="o">-</span> <span class="mi">48</span><span class="n">kHz</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">Bitrate</span><span class="p">:</span> <span class="mi">64</span><span class="n">kbps</span> <span class="o">-</span> <span class="mi">510</span><span class="n">kbps</span>                <span class="o">|</span>
<span class="o">+------------------------------------------+</span>
          <span class="o">|</span>
          <span class="o">|</span> <span class="n">RTPEngine</span> <span class="p">(</span><span class="n">Edge</span> <span class="n">Transcoding</span><span class="p">)</span>
          <span class="n">v</span>
<span class="n">Internal</span> <span class="p">(</span><span class="n">Standard</span><span class="p">)</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">Codec</span><span class="p">:</span> <span class="n">G</span><span class="mf">.711</span> <span class="n">ulaw</span>                        <span class="o">|</span>
<span class="o">|</span> <span class="n">Sample</span> <span class="n">Rate</span><span class="p">:</span> <span class="mi">8</span><span class="n">kHz</span>                        <span class="o">|</span>
<span class="o">|</span> <span class="n">Bitrate</span><span class="p">:</span> <span class="mi">64</span><span class="n">kbps</span>                          <span class="o">|</span>
<span class="o">+------------------------------------------+</span>
          <span class="o">|</span>
          <span class="o">|</span> <span class="n">pipecat</span><span class="o">-</span><span class="n">manager</span> <span class="p">(</span><span class="n">AI</span> <span class="n">Processing</span><span class="p">)</span>
          <span class="n">v</span>
<span class="n">AI</span> <span class="n">Pipeline</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">Format</span><span class="p">:</span> <span class="n">PCM</span> <span class="n">Linear</span>                       <span class="o">|</span>
<span class="o">|</span> <span class="n">Sample</span> <span class="n">Rate</span><span class="p">:</span> <span class="mi">16</span><span class="n">kHz</span>                       <span class="o">|</span>
<span class="o">|</span> <span class="n">Bit</span> <span class="n">Depth</span><span class="p">:</span> <span class="mi">16</span><span class="o">-</span><span class="n">bit</span>                        <span class="o">|</span>
<span class="o">+------------------------------------------+</span>
</pre></div>
</div>
</section>
<section id="database-write-flow">
<h3>Database Write Flow<a class="headerlink" href="#database-write-flow" title="Link to this heading"></a></h3>
<p>Write operations follow a specific pattern for consistency:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Database</span> <span class="n">Write</span> <span class="n">Flow</span><span class="p">:</span>

<span class="n">Service</span> <span class="n">Handler</span>      <span class="n">Cache</span> <span class="n">Handler</span>      <span class="n">DB</span> <span class="n">Handler</span>       <span class="n">MySQL</span>
      <span class="o">|</span>                   <span class="o">|</span>                 <span class="o">|</span>              <span class="o">|</span>
      <span class="o">|</span> <span class="mf">1.</span> <span class="n">Validate</span>       <span class="o">|</span>                 <span class="o">|</span>              <span class="o">|</span>
      <span class="o">|</span>    <span class="n">Input</span>          <span class="o">|</span>                 <span class="o">|</span>              <span class="o">|</span>
      <span class="o">|</span>                   <span class="o">|</span>                 <span class="o">|</span>              <span class="o">|</span>
      <span class="o">|</span> <span class="mf">2.</span> <span class="n">Business</span>       <span class="o">|</span>                 <span class="o">|</span>              <span class="o">|</span>
      <span class="o">|</span>    <span class="n">Logic</span>          <span class="o">|</span>                 <span class="o">|</span>              <span class="o">|</span>
      <span class="o">|</span>                   <span class="o">|</span>                 <span class="o">|</span>              <span class="o">|</span>
      <span class="o">|</span> <span class="mf">3.</span> <span class="n">Call</span> <span class="n">DB</span> <span class="n">Handler</span><span class="o">|</span>                 <span class="o">|</span>              <span class="o">|</span>
      <span class="o">+----------------------------------&gt;|</span>              <span class="o">|</span>
      <span class="o">|</span>                   <span class="o">|</span>                 <span class="o">|</span>              <span class="o">|</span>
      <span class="o">|</span>                   <span class="o">|</span>                 <span class="o">|</span> <span class="mf">4.</span> <span class="n">Begin</span>    <span class="o">|</span>
      <span class="o">|</span>                   <span class="o">|</span>                 <span class="o">|</span>    <span class="n">Transaction</span>
      <span class="o">|</span>                   <span class="o">|</span>                 <span class="o">+-------------&gt;|</span>
      <span class="o">|</span>                   <span class="o">|</span>                 <span class="o">|</span>              <span class="o">|</span>
      <span class="o">|</span>                   <span class="o">|</span>                 <span class="o">|</span> <span class="mf">5.</span> <span class="n">INSERT</span><span class="o">/</span>  <span class="o">|</span>
      <span class="o">|</span>                   <span class="o">|</span>                 <span class="o">|</span>    <span class="n">UPDATE</span>   <span class="o">|</span>
      <span class="o">|</span>                   <span class="o">|</span>                 <span class="o">+-------------&gt;|</span>
      <span class="o">|</span>                   <span class="o">|</span>                 <span class="o">|</span>              <span class="o">|</span>
      <span class="o">|</span>                   <span class="o">|</span>                 <span class="o">|&lt;-------------+</span>
      <span class="o">|</span>                   <span class="o">|</span>                 <span class="o">|</span> <span class="n">Success</span>     <span class="o">|</span>
      <span class="o">|</span>                   <span class="o">|</span>                 <span class="o">|</span>              <span class="o">|</span>
      <span class="o">|</span>                   <span class="o">|</span>                 <span class="o">|</span> <span class="mf">6.</span> <span class="n">COMMIT</span>   <span class="o">|</span>
      <span class="o">|</span>                   <span class="o">|</span>                 <span class="o">+-------------&gt;|</span>
      <span class="o">|</span>                   <span class="o">|</span>                 <span class="o">|</span>              <span class="o">|</span>
      <span class="o">|</span>                   <span class="o">|&lt;----------------+</span>              <span class="o">|</span>
      <span class="o">|</span>                   <span class="o">|</span> <span class="n">Return</span> <span class="n">ID</span>       <span class="o">|</span>              <span class="o">|</span>
      <span class="o">|</span>                   <span class="o">|</span>                 <span class="o">|</span>              <span class="o">|</span>
      <span class="o">|</span>                   <span class="o">|</span> <span class="mf">7.</span> <span class="n">Invalidate</span>   <span class="o">|</span>              <span class="o">|</span>
      <span class="o">|</span>                   <span class="o">|</span>    <span class="n">Cache</span>        <span class="o">|</span>              <span class="o">|</span>
      <span class="o">|&lt;------------------+</span>                 <span class="o">|</span>              <span class="o">|</span>
      <span class="o">|</span>                   <span class="o">|</span> <span class="n">DEL</span> <span class="n">key</span>         <span class="o">|</span>              <span class="o">|</span>
      <span class="o">|</span>                   <span class="o">|</span>                 <span class="o">|</span>              <span class="o">|</span>
      <span class="o">|</span> <span class="mf">8.</span> <span class="n">Publish</span> <span class="n">Event</span>  <span class="o">|</span>                 <span class="o">|</span>              <span class="o">|</span>
      <span class="o">|</span>    <span class="p">(</span><span class="n">RabbitMQ</span><span class="p">)</span>     <span class="o">|</span>                 <span class="o">|</span>              <span class="o">|</span>
      <span class="o">|</span>                   <span class="o">|</span>                 <span class="o">|</span>              <span class="o">|</span>
</pre></div>
</div>
<p><strong>Write Consistency Rules:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Data</span> <span class="n">Consistency</span><span class="p">:</span>

<span class="n">Order</span> <span class="n">of</span> <span class="n">Operations</span><span class="p">:</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="mf">1.</span> <span class="n">Write</span> <span class="n">to</span> <span class="n">database</span> <span class="n">FIRST</span>               <span class="o">|</span>
<span class="o">|</span> <span class="mf">2.</span> <span class="n">Invalidate</span> <span class="n">cache</span> <span class="n">SECOND</span>               <span class="o">|</span>
<span class="o">|</span> <span class="mf">3.</span> <span class="n">Publish</span> <span class="n">event</span> <span class="n">THIRD</span>                   <span class="o">|</span>
<span class="o">+------------------------------------------+</span>

<span class="n">Why</span> <span class="n">This</span> <span class="n">Order</span><span class="p">:</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Database</span> <span class="ow">is</span> <span class="n">source</span> <span class="n">of</span> <span class="n">truth</span>            <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Cache</span> <span class="n">invalidation</span> <span class="n">ensures</span> <span class="n">freshness</span>   <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Events</span> <span class="n">notify</span> <span class="n">other</span> <span class="n">services</span>           <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">If</span> <span class="n">publish</span> <span class="n">fails</span><span class="p">,</span> <span class="n">data</span> <span class="n">still</span> <span class="n">correct</span>   <span class="o">|</span>
<span class="o">+------------------------------------------+</span>

<span class="n">Failure</span> <span class="n">Handling</span><span class="p">:</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">DB</span> <span class="n">write</span> <span class="n">fails</span>  <span class="o">-&gt;</span> <span class="n">Rollback</span><span class="p">,</span> <span class="k">return</span> <span class="n">error</span><span class="o">|</span>
<span class="o">|</span> <span class="n">Cache</span> <span class="n">inv</span><span class="o">.</span> <span class="n">fails</span><span class="o">-&gt;</span> <span class="n">Log</span><span class="p">,</span> <span class="k">continue</span>         <span class="o">|</span>
<span class="o">|</span> <span class="n">Event</span> <span class="n">pub</span><span class="o">.</span> <span class="n">fails</span><span class="o">-&gt;</span> <span class="n">Log</span><span class="p">,</span> <span class="n">retry</span> <span class="k">async</span>      <span class="o">|</span>
<span class="o">+------------------------------------------+</span>
</pre></div>
</div>
</section>
<section id="campaign-execution-data-flow">
<h3>Campaign Execution Data Flow<a class="headerlink" href="#campaign-execution-data-flow" title="Link to this heading"></a></h3>
<p>Outbound campaigns involve complex data orchestration:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Campaign</span> <span class="n">Data</span> <span class="n">Flow</span><span class="p">:</span>

<span class="n">Scheduler</span>      <span class="n">campaign</span><span class="o">-</span><span class="n">mgr</span>    <span class="n">outdial</span><span class="o">-</span><span class="n">mgr</span>       <span class="n">MySQL</span>         <span class="n">call</span><span class="o">-</span><span class="n">mgr</span>
    <span class="o">|</span>              <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
    <span class="o">|</span> <span class="mf">1.</span> <span class="n">Trigger</span>   <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
    <span class="o">|</span>    <span class="n">Campaign</span>  <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
    <span class="o">+-------------&gt;|</span>               <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
    <span class="o">|</span>              <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
    <span class="o">|</span>              <span class="o">|</span> <span class="mf">2.</span> <span class="n">Get</span>        <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
    <span class="o">|</span>              <span class="o">|</span>    <span class="n">Campaign</span>   <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
    <span class="o">|</span>              <span class="o">+------------------------------&gt;|</span>               <span class="o">|</span>
    <span class="o">|</span>              <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
    <span class="o">|</span>              <span class="o">|&lt;------------------------------+</span>               <span class="o">|</span>
    <span class="o">|</span>              <span class="o">|</span> <span class="n">Campaign</span> <span class="n">Data</span> <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
    <span class="o">|</span>              <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
    <span class="o">|</span>              <span class="o">|</span> <span class="mf">3.</span> <span class="n">Get</span> <span class="n">Next</span>   <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
    <span class="o">|</span>              <span class="o">|</span>    <span class="n">Targets</span>    <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
    <span class="o">|</span>              <span class="o">+--------------&gt;|</span>               <span class="o">|</span>               <span class="o">|</span>
    <span class="o">|</span>              <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
    <span class="o">|</span>              <span class="o">|</span>               <span class="o">|</span> <span class="mf">4.</span> <span class="n">Query</span>      <span class="o">|</span>               <span class="o">|</span>
    <span class="o">|</span>              <span class="o">|</span>               <span class="o">|</span>    <span class="n">Outplan</span>    <span class="o">|</span>               <span class="o">|</span>
    <span class="o">|</span>              <span class="o">|</span>               <span class="o">+--------------&gt;|</span>               <span class="o">|</span>
    <span class="o">|</span>              <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
    <span class="o">|</span>              <span class="o">|</span>               <span class="o">|&lt;--------------+</span>               <span class="o">|</span>
    <span class="o">|</span>              <span class="o">|</span>               <span class="o">|</span> <span class="n">Target</span> <span class="n">List</span>   <span class="o">|</span>               <span class="o">|</span>
    <span class="o">|</span>              <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
    <span class="o">|</span>              <span class="o">|&lt;--------------+</span>               <span class="o">|</span>               <span class="o">|</span>
    <span class="o">|</span>              <span class="o">|</span> <span class="n">Dial</span> <span class="n">Targets</span>  <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
    <span class="o">|</span>              <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
    <span class="o">|</span>              <span class="o">|</span> <span class="mf">5.</span> <span class="n">For</span> <span class="n">each</span> <span class="n">target</span><span class="p">:</span>           <span class="o">|</span>               <span class="o">|</span>
    <span class="o">|</span>              <span class="o">|</span> <span class="o">+-------------------------------------------+</span> <span class="o">|</span>
    <span class="o">|</span>              <span class="o">|</span> <span class="o">|</span>                             <span class="o">|</span>             <span class="o">|</span> <span class="o">|</span>
    <span class="o">|</span>              <span class="o">|</span> <span class="o">|</span> <span class="n">Create</span> <span class="n">Call</span>                 <span class="o">|</span>             <span class="o">|</span> <span class="o">|</span>
    <span class="o">|</span>              <span class="o">|</span> <span class="o">+--------------------------------------------&gt;|</span>
    <span class="o">|</span>              <span class="o">|</span> <span class="o">|</span>                             <span class="o">|</span>             <span class="o">|</span> <span class="o">|</span>
    <span class="o">|</span>              <span class="o">|</span> <span class="o">|</span>                             <span class="o">|&lt;------------+</span> <span class="o">|</span>
    <span class="o">|</span>              <span class="o">|</span> <span class="o">|</span>                             <span class="o">|</span> <span class="n">Call</span> <span class="n">Created</span><span class="o">|</span> <span class="o">|</span>
    <span class="o">|</span>              <span class="o">|</span> <span class="o">|</span>                             <span class="o">|</span>             <span class="o">|</span> <span class="o">|</span>
    <span class="o">|</span>              <span class="o">|</span> <span class="o">+-------------------------------------------+</span> <span class="o">|</span>
    <span class="o">|</span>              <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
    <span class="o">|</span>              <span class="o">|</span> <span class="mf">6.</span> <span class="n">Subscribe</span>  <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
    <span class="o">|</span>              <span class="o">|</span>    <span class="n">call_hungup</span><span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
    <span class="o">|</span>              <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
    <span class="o">|</span>              <span class="o">|</span>                               <span class="o">|</span>               <span class="o">|</span>
    <span class="o">|</span>              <span class="o">|</span> <span class="p">(</span><span class="n">Later</span><span class="p">)</span>       <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
    <span class="o">|</span>              <span class="o">|</span> <span class="mf">7.</span> <span class="n">Event</span><span class="p">:</span>     <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
    <span class="o">|</span>              <span class="o">|</span>    <span class="n">call_hungup</span><span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
    <span class="o">|</span>              <span class="o">|&lt;---------------------------------------------|</span>
    <span class="o">|</span>              <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
    <span class="o">|</span>              <span class="o">|</span> <span class="mf">8.</span> <span class="n">Update</span>     <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
    <span class="o">|</span>              <span class="o">|</span>    <span class="n">Campaign</span>   <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
    <span class="o">|</span>              <span class="o">|</span>    <span class="n">Status</span>     <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
    <span class="o">|</span>              <span class="o">+------------------------------&gt;|</span>               <span class="o">|</span>
    <span class="o">|</span>              <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
</pre></div>
</div>
<p><strong>Campaign State Machine:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Campaign</span> <span class="n">Data</span> <span class="n">States</span><span class="p">:</span>

<span class="n">Campaign</span> <span class="n">Record</span><span class="p">:</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">status</span><span class="p">:</span> <span class="n">pending</span> <span class="o">-&gt;</span> <span class="n">running</span> <span class="o">-&gt;</span> <span class="n">completed</span>  <span class="o">|</span>
<span class="o">|</span> <span class="n">total_targets</span><span class="p">:</span> <span class="mi">1000</span>                      <span class="o">|</span>
<span class="o">|</span> <span class="n">dialed</span><span class="p">:</span> <span class="mi">0</span> <span class="o">-&gt;</span> <span class="mi">500</span> <span class="o">-&gt;</span> <span class="mi">1000</span>                 <span class="o">|</span>
<span class="o">|</span> <span class="n">answered</span><span class="p">:</span> <span class="mi">0</span> <span class="o">-&gt;</span> <span class="mi">250</span> <span class="o">-&gt;</span> <span class="mi">500</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">failed</span><span class="p">:</span> <span class="mi">0</span> <span class="o">-&gt;</span> <span class="mi">50</span> <span class="o">-&gt;</span> <span class="mi">100</span>                   <span class="o">|</span>
<span class="o">+------------------------------------------+</span>

<span class="n">Outplan</span> <span class="p">(</span><span class="n">Dial</span> <span class="n">Target</span><span class="p">):</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">status</span><span class="p">:</span> <span class="n">pending</span> <span class="o">-&gt;</span> <span class="n">dialing</span> <span class="o">-&gt;</span> <span class="n">completed</span>  <span class="o">|</span>
<span class="o">|</span> <span class="n">dial_count</span><span class="p">:</span> <span class="mi">0</span> <span class="o">-&gt;</span> <span class="mi">1</span> <span class="o">-&gt;</span> <span class="mi">2</span>                  <span class="o">|</span>
<span class="o">|</span> <span class="n">last_dial_time</span><span class="p">:</span> <span class="n">timestamp</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">result</span><span class="p">:</span> <span class="n">null</span> <span class="o">-&gt;</span> <span class="n">answered</span><span class="o">/</span><span class="n">busy</span><span class="o">/</span><span class="n">no_answer</span>  <span class="o">|</span>
<span class="o">+------------------------------------------+</span>
</pre></div>
</div>
</section>
<section id="transcription-data-flow">
<h3>Transcription Data Flow<a class="headerlink" href="#transcription-data-flow" title="Link to this heading"></a></h3>
<p>Real-time transcription processes audio streams:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Transcription</span> <span class="n">Data</span> <span class="n">Flow</span><span class="p">:</span>

<span class="n">Asterisk</span>      <span class="n">call</span><span class="o">-</span><span class="n">mgr</span>     <span class="n">transcribe</span><span class="o">-</span><span class="n">mgr</span>     <span class="n">STT</span> <span class="n">Provider</span>      <span class="n">MySQL</span>
    <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span>                  <span class="o">|</span>              <span class="o">|</span>
    <span class="o">|</span> <span class="n">Channel</span>     <span class="o">|</span>              <span class="o">|</span>                  <span class="o">|</span>              <span class="o">|</span>
    <span class="o">|</span> <span class="n">Up</span>          <span class="o">|</span>              <span class="o">|</span>                  <span class="o">|</span>              <span class="o">|</span>
    <span class="o">+------------&gt;|</span>              <span class="o">|</span>                  <span class="o">|</span>              <span class="o">|</span>
    <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span>                  <span class="o">|</span>              <span class="o">|</span>
    <span class="o">|</span>             <span class="o">|</span> <span class="mf">1.</span> <span class="n">Start</span>     <span class="o">|</span>                  <span class="o">|</span>              <span class="o">|</span>
    <span class="o">|</span>             <span class="o">|</span>    <span class="n">Transcribe</span><span class="o">|</span>                  <span class="o">|</span>              <span class="o">|</span>
    <span class="o">|</span>             <span class="o">+-------------&gt;|</span>                  <span class="o">|</span>              <span class="o">|</span>
    <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span>                  <span class="o">|</span>              <span class="o">|</span>
    <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span> <span class="mf">2.</span> <span class="n">Create</span>        <span class="o">|</span>              <span class="o">|</span>
    <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span>    <span class="n">Transcribe</span>    <span class="o">|</span>              <span class="o">|</span>
    <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span>    <span class="n">Record</span>        <span class="o">|</span>              <span class="o">|</span>
    <span class="o">|</span>             <span class="o">|</span>              <span class="o">+--------------------------------&gt;|</span>
    <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span>                  <span class="o">|</span>              <span class="o">|</span>
    <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span> <span class="mf">3.</span> <span class="n">Connect</span> <span class="n">to</span>    <span class="o">|</span>              <span class="o">|</span>
    <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span>    <span class="n">STT</span> <span class="n">Stream</span>    <span class="o">|</span>              <span class="o">|</span>
    <span class="o">|</span>             <span class="o">|</span>              <span class="o">+-----------------&gt;|</span>              <span class="o">|</span>
    <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span>                  <span class="o">|</span>              <span class="o">|</span>
    <span class="o">|</span> <span class="n">Audio</span>       <span class="o">|</span>              <span class="o">|</span>                  <span class="o">|</span>              <span class="o">|</span>
    <span class="o">|</span> <span class="n">Stream</span>      <span class="o">|</span>              <span class="o">|</span>                  <span class="o">|</span>              <span class="o">|</span>
    <span class="o">+--------------------------&gt;|</span>                  <span class="o">|</span>              <span class="o">|</span>
    <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span> <span class="n">Audio</span> <span class="n">Chunks</span>     <span class="o">|</span>              <span class="o">|</span>
    <span class="o">|</span>             <span class="o">|</span>              <span class="o">+-----------------&gt;|</span>              <span class="o">|</span>
    <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span>                  <span class="o">|</span>              <span class="o">|</span>
    <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span>                  <span class="o">|</span> <span class="mf">4.</span> <span class="n">Process</span>   <span class="o">|</span>
    <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span>                  <span class="o">|</span>    <span class="n">Audio</span>     <span class="o">|</span>
    <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span>                  <span class="o">|</span>              <span class="o">|</span>
    <span class="o">|</span>             <span class="o">|</span>              <span class="o">|&lt;-----------------+</span>              <span class="o">|</span>
    <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span> <span class="n">Transcript</span>       <span class="o">|</span>              <span class="o">|</span>
    <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span> <span class="n">Segment</span>          <span class="o">|</span>              <span class="o">|</span>
    <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span>                  <span class="o">|</span>              <span class="o">|</span>
    <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span> <span class="mf">5.</span> <span class="n">Save</span>          <span class="o">|</span>              <span class="o">|</span>
    <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span>    <span class="n">Transcript</span>    <span class="o">|</span>              <span class="o">|</span>
    <span class="o">|</span>             <span class="o">|</span>              <span class="o">+--------------------------------&gt;|</span>
    <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span>                  <span class="o">|</span>              <span class="o">|</span>
    <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span> <span class="mf">6.</span> <span class="n">Publish</span>       <span class="o">|</span>              <span class="o">|</span>
    <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span>    <span class="n">Event</span>         <span class="o">|</span>              <span class="o">|</span>
    <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span> <span class="p">(</span><span class="n">transcript_created</span><span class="p">)</span>            <span class="o">|</span>
    <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span>                  <span class="o">|</span>              <span class="o">|</span>
</pre></div>
</div>
<p><strong>Transcript Data Structure:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Transcript</span> <span class="n">Record</span><span class="p">:</span>

<span class="n">transcribes</span> <span class="n">table</span><span class="p">:</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="nb">id</span><span class="p">:</span> <span class="n">uuid</span>                                 <span class="o">|</span>
<span class="o">|</span> <span class="n">customer_id</span><span class="p">:</span> <span class="n">uuid</span>                        <span class="o">|</span>
<span class="o">|</span> <span class="n">reference_type</span><span class="p">:</span> <span class="s2">&quot;call&quot;</span> <span class="o">|</span> <span class="s2">&quot;conference&quot;</span>    <span class="o">|</span>
<span class="o">|</span> <span class="n">reference_id</span><span class="p">:</span> <span class="n">uuid</span> <span class="p">(</span><span class="n">call_id</span><span class="p">)</span>             <span class="o">|</span>
<span class="o">|</span> <span class="n">language</span><span class="p">:</span> <span class="s2">&quot;en-US&quot;</span>                        <span class="o">|</span>
<span class="o">|</span> <span class="n">status</span><span class="p">:</span> <span class="s2">&quot;running&quot;</span> <span class="o">|</span> <span class="s2">&quot;completed&quot;</span>          <span class="o">|</span>
<span class="o">+------------------------------------------+</span>

<span class="n">transcripts</span> <span class="n">table</span> <span class="p">(</span><span class="n">segments</span><span class="p">):</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="nb">id</span><span class="p">:</span> <span class="n">uuid</span>                                 <span class="o">|</span>
<span class="o">|</span> <span class="n">transcribe_id</span><span class="p">:</span> <span class="n">uuid</span>                      <span class="o">|</span>
<span class="o">|</span> <span class="n">direction</span><span class="p">:</span> <span class="s2">&quot;in&quot;</span> <span class="o">|</span> <span class="s2">&quot;out&quot;</span>                  <span class="o">|</span>
<span class="o">|</span> <span class="n">message</span><span class="p">:</span> <span class="s2">&quot;Hello, how can I help?&quot;</span>        <span class="o">|</span>
<span class="o">|</span> <span class="n">tm_transcript</span><span class="p">:</span> <span class="n">relative</span> <span class="n">timestamp</span>        <span class="o">|</span>
<span class="o">|</span> <span class="n">tm_create</span><span class="p">:</span> <span class="n">absolute</span> <span class="n">timestamp</span>            <span class="o">|</span>
<span class="o">+------------------------------------------+</span>
</pre></div>
</div>
</section>
<section id="webhook-delivery-data-flow">
<h3>Webhook Delivery Data Flow<a class="headerlink" href="#webhook-delivery-data-flow" title="Link to this heading"></a></h3>
<p>Webhooks deliver events to external systems:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Webhook</span> <span class="n">Delivery</span> <span class="n">Flow</span><span class="p">:</span>

<span class="n">Event</span> <span class="n">Source</span>    <span class="n">webhook</span><span class="o">-</span><span class="n">mgr</span>        <span class="n">MySQL</span>         <span class="n">HTTP</span> <span class="n">Client</span>      <span class="n">External</span>
     <span class="o">|</span>              <span class="o">|</span>                <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
     <span class="o">|</span> <span class="n">Event</span><span class="p">:</span>       <span class="o">|</span>                <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
     <span class="o">|</span> <span class="n">call_hungup</span>  <span class="o">|</span>                <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
     <span class="o">+-------------&gt;|</span>                <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span>                <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span> <span class="mf">1.</span> <span class="n">Lookup</span>      <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span>    <span class="n">Webhook</span>     <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span>    <span class="n">Config</span>      <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
     <span class="o">|</span>              <span class="o">+---------------&gt;|</span>               <span class="o">|</span>               <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span>                <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|&lt;---------------+</span>               <span class="o">|</span>               <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span> <span class="n">Webhook</span> <span class="n">URL</span><span class="p">,</span>   <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span> <span class="n">Secret</span>         <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span>                <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span> <span class="mf">2.</span> <span class="n">Format</span>      <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span>    <span class="n">Payload</span>     <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span>                <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span> <span class="mf">3.</span> <span class="n">Sign</span>        <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span>    <span class="n">Payload</span>     <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span>    <span class="p">(</span><span class="n">HMAC</span><span class="o">-</span><span class="n">SHA256</span><span class="p">)</span><span class="o">|</span>              <span class="o">|</span>               <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span>                <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span> <span class="mf">4.</span> <span class="n">Create</span>      <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span>    <span class="n">Delivery</span>    <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span>    <span class="n">Record</span>      <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
     <span class="o">|</span>              <span class="o">+---------------&gt;|</span>               <span class="o">|</span>               <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span>                <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span> <span class="mf">5.</span> <span class="n">POST</span>        <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span>    <span class="n">Webhook</span>     <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
     <span class="o">|</span>              <span class="o">+------------------------------&gt;|</span>               <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span>                <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span>                <span class="o">|</span>               <span class="o">+--------------&gt;|</span>
     <span class="o">|</span>              <span class="o">|</span>                <span class="o">|</span>               <span class="o">|</span> <span class="n">HTTPS</span> <span class="n">POST</span>    <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span>                <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span>                <span class="o">|</span>               <span class="o">|&lt;--------------+</span>
     <span class="o">|</span>              <span class="o">|</span>                <span class="o">|</span>               <span class="o">|</span> <span class="mi">200</span> <span class="n">OK</span>        <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span>                <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|&lt;------------------------------+</span>               <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span> <span class="n">Success</span>        <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span>                <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span> <span class="mf">6.</span> <span class="n">Update</span>      <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span>    <span class="n">Delivery</span>    <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span>    <span class="n">Status</span>      <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
     <span class="o">|</span>              <span class="o">+---------------&gt;|</span>               <span class="o">|</span>               <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span>                <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
</pre></div>
</div>
<p><strong>Webhook Payload:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Webhook</span> <span class="n">HTTP</span> <span class="n">Request</span><span class="p">:</span>

<span class="n">POST</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">customer</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">webhook</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">json</span>
<span class="n">X</span><span class="o">-</span><span class="n">VoIPBIN</span><span class="o">-</span><span class="n">Signature</span><span class="p">:</span> <span class="n">sha256</span><span class="o">=</span><span class="n">abc123</span><span class="o">...</span>
<span class="n">X</span><span class="o">-</span><span class="n">VoIPBIN</span><span class="o">-</span><span class="n">Timestamp</span><span class="p">:</span> <span class="mi">2026</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">20</span><span class="n">T12</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.000</span><span class="n">Z</span>
<span class="n">X</span><span class="o">-</span><span class="n">VoIPBIN</span><span class="o">-</span><span class="n">Event</span><span class="p">:</span> <span class="n">call_hungup</span>

<span class="p">{</span>
  <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;event-uuid&quot;</span><span class="p">,</span>
  <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;call_hungup&quot;</span><span class="p">,</span>
  <span class="s2">&quot;created&quot;</span><span class="p">:</span> <span class="s2">&quot;2026-01-20T12:00:00.000Z&quot;</span><span class="p">,</span>
  <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;call-uuid&quot;</span><span class="p">,</span>
    <span class="s2">&quot;customer_id&quot;</span><span class="p">:</span> <span class="s2">&quot;customer-uuid&quot;</span><span class="p">,</span>
    <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;+15551234567&quot;</span><span class="p">,</span>
    <span class="s2">&quot;destination&quot;</span><span class="p">:</span> <span class="s2">&quot;+15559876543&quot;</span><span class="p">,</span>
    <span class="s2">&quot;duration&quot;</span><span class="p">:</span> <span class="mi">120</span><span class="p">,</span>
    <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;completed&quot;</span><span class="p">,</span>
    <span class="s2">&quot;hangup_cause&quot;</span><span class="p">:</span> <span class="s2">&quot;normal_clearing&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Signature Verification (Customer Side):</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Signature</span> <span class="n">Verification</span><span class="p">:</span>

<span class="mf">1.</span> <span class="n">Extract</span> <span class="n">signature</span> <span class="kn">from</span> <span class="nn">header</span><span class="p">:</span>
   <span class="n">X</span><span class="o">-</span><span class="n">VoIPBIN</span><span class="o">-</span><span class="n">Signature</span><span class="p">:</span> <span class="n">sha256</span><span class="o">=</span><span class="n">abc123</span><span class="o">...</span>

<span class="mf">2.</span> <span class="n">Compute</span> <span class="n">expected</span> <span class="n">signature</span><span class="p">:</span>
   <span class="n">expected</span> <span class="o">=</span> <span class="n">HMAC</span><span class="o">-</span><span class="n">SHA256</span><span class="p">(</span>
     <span class="n">secret</span> <span class="o">=</span> <span class="s2">&quot;webhook_secret&quot;</span><span class="p">,</span>
     <span class="n">message</span> <span class="o">=</span> <span class="n">timestamp</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">body</span>
   <span class="p">)</span>

<span class="mf">3.</span> <span class="n">Compare</span><span class="p">:</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">signature</span> <span class="o">==</span> <span class="n">expected</span><span class="p">)</span> <span class="p">{</span>
     <span class="o">//</span> <span class="n">Valid</span> <span class="n">webhook</span>
   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="o">//</span> <span class="n">Reject</span> <span class="o">-</span> <span class="n">possible</span> <span class="n">tampering</span>
   <span class="p">}</span>
</pre></div>
</div>
</section>
<section id="data-synchronization-patterns">
<h3>Data Synchronization Patterns<a class="headerlink" href="#data-synchronization-patterns" title="Link to this heading"></a></h3>
<p>Services maintain data consistency through patterns:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Cache</span><span class="o">-</span><span class="n">Aside</span> <span class="n">Pattern</span><span class="p">:</span>

<span class="n">Service</span>              <span class="n">Redis</span>              <span class="n">MySQL</span>
   <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>
   <span class="o">|</span> <span class="mf">1.</span> <span class="n">Get</span> <span class="n">Call</span>       <span class="o">|</span>                  <span class="o">|</span>
   <span class="o">+------------------&gt;|</span>                  <span class="o">|</span>
   <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>
   <span class="o">|</span> <span class="n">Cache</span> <span class="n">Miss</span>        <span class="o">|</span>                  <span class="o">|</span>
   <span class="o">|&lt;------------------+</span>                  <span class="o">|</span>
   <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>
   <span class="o">|</span> <span class="mf">2.</span> <span class="n">Query</span> <span class="n">DB</span>       <span class="o">|</span>                  <span class="o">|</span>
   <span class="o">+-------------------------------------&gt;|</span>
   <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>
   <span class="o">|&lt;-------------------------------------+</span>
   <span class="o">|</span> <span class="n">Call</span> <span class="n">Data</span>         <span class="o">|</span>                  <span class="o">|</span>
   <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>
   <span class="o">|</span> <span class="mf">3.</span> <span class="n">Store</span> <span class="ow">in</span> <span class="n">Cache</span> <span class="o">|</span>                  <span class="o">|</span>
   <span class="o">|</span> <span class="p">(</span><span class="n">TTL</span><span class="p">:</span> <span class="mi">24</span> <span class="n">hours</span><span class="p">)</span>   <span class="o">|</span>                  <span class="o">|</span>
   <span class="o">+------------------&gt;|</span>                  <span class="o">|</span>
   <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>
   <span class="o">|</span> <span class="mf">4.</span> <span class="n">Return</span> <span class="n">Data</span>    <span class="o">|</span>                  <span class="o">|</span>
   <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Write</span><span class="o">-</span><span class="n">Through</span> <span class="n">Pattern</span><span class="p">:</span>

<span class="n">Service</span>              <span class="n">MySQL</span>              <span class="n">Redis</span>
   <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>
   <span class="o">|</span> <span class="mf">1.</span> <span class="n">Update</span> <span class="n">Call</span>    <span class="o">|</span>                  <span class="o">|</span>
   <span class="o">+------------------&gt;|</span>                  <span class="o">|</span>
   <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>
   <span class="o">|&lt;------------------+</span>                  <span class="o">|</span>
   <span class="o">|</span> <span class="n">Commit</span> <span class="n">Success</span>    <span class="o">|</span>                  <span class="o">|</span>
   <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>
   <span class="o">|</span> <span class="mf">2.</span> <span class="n">Invalidate</span>     <span class="o">|</span>                  <span class="o">|</span>
   <span class="o">|</span>    <span class="n">Cache</span>          <span class="o">|</span>                  <span class="o">|</span>
   <span class="o">+-------------------------------------&gt;|</span>
   <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>
   <span class="o">|&lt;-------------------------------------+</span>
   <span class="o">|</span> <span class="n">DEL</span> <span class="n">Success</span>       <span class="o">|</span>                  <span class="o">|</span>
   <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Event</span> <span class="n">Sourcing</span> <span class="p">(</span><span class="k">for</span> <span class="n">Audit</span><span class="p">):</span>

<span class="n">Service</span>              <span class="n">MySQL</span>              <span class="n">Audit</span> <span class="n">Log</span>
   <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>
   <span class="o">|</span> <span class="mf">1.</span> <span class="n">Action</span><span class="p">:</span>        <span class="o">|</span>                  <span class="o">|</span>
   <span class="o">|</span>    <span class="n">Delete</span> <span class="n">Call</span>    <span class="o">|</span>                  <span class="o">|</span>
   <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>
   <span class="o">|</span> <span class="mf">2.</span> <span class="n">Write</span> <span class="n">to</span>       <span class="o">|</span>                  <span class="o">|</span>
   <span class="o">|</span>    <span class="n">calls</span> <span class="n">table</span>    <span class="o">|</span>                  <span class="o">|</span>
   <span class="o">+------------------&gt;|</span>                  <span class="o">|</span>
   <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>
   <span class="o">|</span> <span class="mf">3.</span> <span class="n">Write</span> <span class="n">to</span>       <span class="o">|</span>                  <span class="o">|</span>
   <span class="o">|</span>    <span class="n">audit_log</span>      <span class="o">|</span>                  <span class="o">|</span>
   <span class="o">+-------------------------------------&gt;|</span>
   <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>
   <span class="o">|</span> <span class="n">Record</span><span class="p">:</span>           <span class="o">|</span>                  <span class="o">|</span>
   <span class="o">|</span> <span class="o">-</span> <span class="n">action</span><span class="p">:</span> <span class="n">delete</span>  <span class="o">|</span>                  <span class="o">|</span>
   <span class="o">|</span> <span class="o">-</span> <span class="n">resource</span><span class="p">:</span> <span class="n">call</span>  <span class="o">|</span>                  <span class="o">|</span>
   <span class="o">|</span> <span class="o">-</span> <span class="n">actor</span><span class="p">:</span> <span class="n">agent_id</span> <span class="o">|</span>                  <span class="o">|</span>
   <span class="o">|</span> <span class="o">-</span> <span class="n">timestamp</span>       <span class="o">|</span>                  <span class="o">|</span>
   <span class="o">|</span> <span class="o">-</span> <span class="n">before_state</span>    <span class="o">|</span>                  <span class="o">|</span>
   <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>
</pre></div>
</div>
</section>
</section>
<section id="real-time-communication-rtc">
<span id="architecture-rtc"></span><h2>Real-Time Communication (RTC)<a class="headerlink" href="#real-time-communication-rtc" title="Link to this heading"></a></h2>
<p>VoIPBIN’s RTC architecture handles all real-time voice and video communication through a distributed stack of specialized components. The architecture separates signaling (SIP) from media (RTP) processing, enabling independent scaling and fault tolerance.</p>
<section id="voip-stack-overview">
<h3>VoIP Stack Overview<a class="headerlink" href="#voip-stack-overview" title="Link to this heading"></a></h3>
<p>VoIPBIN’s VoIP stack consists of three main components working together:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SIP</span> <span class="n">Traffic</span> <span class="n">Flow</span><span class="p">:</span>

<span class="n">External</span> <span class="n">Client</span>                                      <span class="n">Internal</span> <span class="n">Services</span>
     <span class="o">|</span>                                                      <span class="o">|</span>
     <span class="o">|</span> <span class="n">SIP</span> <span class="p">(</span><span class="n">INVITE</span><span class="p">,</span> <span class="n">etc</span><span class="o">.</span><span class="p">)</span>                                   <span class="o">|</span>
     <span class="n">v</span>                                                      <span class="n">v</span>
<span class="o">+----------+</span>         <span class="o">+----------+</span>         <span class="o">+------------------+</span>
<span class="o">|</span>   <span class="n">Load</span>   <span class="o">|</span>  <span class="n">SIP</span>    <span class="o">|</span> <span class="n">Kamailio</span> <span class="o">|</span>  <span class="n">SIP</span>    <span class="o">|</span>    <span class="n">Asterisk</span>      <span class="o">|</span>
<span class="o">|</span> <span class="n">Balancer</span> <span class="o">|&lt;-------&gt;|</span>   <span class="n">Farm</span>   <span class="o">|&lt;-------&gt;|</span>     <span class="p">(</span><span class="n">Call</span><span class="p">)</span>       <span class="o">|</span>
<span class="o">+----------+</span>         <span class="o">+-----+----+</span>         <span class="o">+--------+---------+</span>
                           <span class="o">|</span>                       <span class="o">|</span>
                           <span class="o">|</span> <span class="n">RTP</span> <span class="n">Control</span>           <span class="o">|</span> <span class="n">RTP</span> <span class="n">Control</span>
                           <span class="n">v</span>                       <span class="o">|</span>
                     <span class="o">+----------+</span>                  <span class="o">|</span>
                     <span class="o">|</span> <span class="n">RTPEngine</span><span class="o">|</span>                  <span class="o">|</span>
                     <span class="o">|</span>   <span class="n">Farm</span>   <span class="o">|&lt;-----------------+</span>
                     <span class="o">+-----+----+</span>  <span class="n">Media</span>
                           <span class="o">|</span>
                           <span class="o">|</span> <span class="n">RTP</span> <span class="p">(</span><span class="n">Audio</span><span class="o">/</span><span class="n">Video</span><span class="p">)</span>
                           <span class="n">v</span>
                     <span class="n">External</span> <span class="n">Client</span>
</pre></div>
</div>
<img alt="Architecture VoIP" src="_images/architecture_rtc_voip.png" />
<p><strong>Key Characteristics:</strong></p>
<ul class="simple">
<li><p><strong>Stateless SIP Proxies</strong>: Kamailio instances maintain no state, enabling dynamic scaling</p></li>
<li><p><strong>Distributed Media Processing</strong>: RTPEngine handles all media transcoding and routing</p></li>
<li><p><strong>Separated Concerns</strong>: Signaling (Kamailio) and media (RTPEngine, Asterisk) are independent</p></li>
<li><p><strong>Zero-Downtime</strong>: Load balancer redirects traffic when instances fail</p></li>
<li><p><strong>Horizontal Scaling</strong>: Add more instances of any component to handle increased load</p></li>
</ul>
<p><strong>Traffic Flow:</strong></p>
<ol class="arabic simple">
<li><p><strong>SIP Signaling</strong>: Load balancer distributes SIP traffic to Kamailio instances</p></li>
<li><p><strong>Call Routing</strong>: Kamailio routes signaling to appropriate Asterisk instance</p></li>
<li><p><strong>Media Setup</strong>: RTPEngine handles RTP media streams and transcoding</p></li>
<li><p><strong>Call Control</strong>: Asterisk manages call state and conference bridges</p></li>
</ol>
<p>This modular design ensures VoIPBIN can provide reliable, scalable VoIP services while accommodating high traffic loads.</p>
</section>
<section id="kamailio-sip-edge-router">
<h3>Kamailio - SIP Edge Router<a class="headerlink" href="#kamailio-sip-edge-router" title="Link to this heading"></a></h3>
<p>Kamailio is an open-source SIP server providing the edge routing layer for all SIP traffic.</p>
<ul class="simple">
<li><p><strong>Official Site</strong>: <a class="reference external" href="https://www.kamailio.org/">https://www.kamailio.org/</a></p></li>
</ul>
<p><strong>Role in VoIPBIN:</strong></p>
<p>Kamailio acts as the stateless SIP proxy and edge router, responsible for:</p>
<ul class="simple">
<li><p><strong>SIP Routing</strong>: Forwarding SIP messages to appropriate backend services</p></li>
<li><p><strong>Load Distribution</strong>: Balancing traffic across Asterisk instances</p></li>
<li><p><strong>Authentication</strong>: Validating SIP registration credentials</p></li>
<li><p><strong>Protocol Handling</strong>: Managing SIP message parsing and routing</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Stateless</span> <span class="n">Operation</span><span class="p">:</span>

<span class="n">Client</span>          <span class="n">Kamailio</span><span class="o">-</span><span class="mi">1</span>        <span class="n">Kamailio</span><span class="o">-</span><span class="mi">2</span>        <span class="n">Asterisk</span>
  <span class="o">|</span>                 <span class="o">|</span>                 <span class="o">|</span>                 <span class="o">|</span>
  <span class="o">|</span> <span class="n">INVITE</span>          <span class="o">|</span>                 <span class="o">|</span>                 <span class="o">|</span>
  <span class="o">+----------------&gt;|</span>                 <span class="o">|</span>                 <span class="o">|</span>
  <span class="o">|</span>                 <span class="o">|</span> <span class="n">Forward</span>         <span class="o">|</span>                 <span class="o">|</span>
  <span class="o">|</span>                 <span class="o">+----------------------------------&gt;|</span>
  <span class="o">|</span>                 <span class="o">|</span>                 <span class="o">|</span>                 <span class="o">|</span>
  <span class="o">|</span>                 <span class="o">|</span>                 <span class="o">|</span>                 <span class="o">|</span>
  <span class="o">|</span> <span class="mi">200</span> <span class="n">OK</span>          <span class="o">|</span>                 <span class="o">|</span>                 <span class="o">|</span>
  <span class="o">|&lt;----------------+-----------------------------------+</span>
  <span class="o">|</span>                 <span class="o">|</span>                 <span class="o">|</span>                 <span class="o">|</span>
  <span class="o">|</span> <span class="n">ACK</span>             <span class="o">|</span>                 <span class="o">|</span>                 <span class="o">|</span>
  <span class="o">+----------------------------------&gt;|</span>                 <span class="o">|</span>
  <span class="o">|</span>                 <span class="o">|</span>                 <span class="o">|</span> <span class="n">Forward</span>         <span class="o">|</span>
  <span class="o">|</span>                 <span class="o">|</span>                 <span class="o">+----------------&gt;|</span>
  <span class="o">|</span>                 <span class="o">|</span>                 <span class="o">|</span>                 <span class="o">|</span>

<span class="n">Note</span><span class="p">:</span> <span class="n">Different</span> <span class="n">Kamailio</span> <span class="n">instances</span> <span class="n">handle</span> <span class="n">different</span> <span class="n">messages</span>
      <span class="ow">in</span> <span class="n">the</span> <span class="n">same</span> <span class="n">call</span> <span class="p">(</span><span class="n">stateless</span> <span class="n">operation</span><span class="p">)</span>
</pre></div>
</div>
<img alt="Architecture Kamailio" src="_images/architecture_rtc_kamailio.png" />
<p><strong>Key Features:</strong></p>
<ul class="simple">
<li><p><strong>Load Balancing</strong>: Distributes incoming SIP traffic across multiple instances</p></li>
<li><p><strong>Stateless Operation</strong>: No state maintained, enabling dynamic scaling and failover</p></li>
<li><p><strong>High Availability</strong>: Instances can be added or removed without affecting ongoing calls</p></li>
<li><p><strong>Fast Performance</strong>: C-based implementation with minimal overhead</p></li>
</ul>
<p><strong>Stateless Benefits:</strong></p>
<p>In the diagram above, Kamailio receives initial SIP traffic from the client and forwards it to Asterisk. However, subsequent SIP messages in the same call may go to different Kamailio instances. This stateless design allows for:</p>
<ul class="simple">
<li><p>Instant failover without session loss</p></li>
<li><p>Dynamic scaling without coordination</p></li>
<li><p>Simplified operations and deployment</p></li>
</ul>
</section>
<section id="asterisk-media-and-call-processing">
<h3>Asterisk - Media and Call Processing<a class="headerlink" href="#asterisk-media-and-call-processing" title="Link to this heading"></a></h3>
<p>Asterisk is an open-source communications platform providing comprehensive telephony services.</p>
<img alt="Architecture Asterisk" src="_images/architecture_rtc_asterisk.png" />
<p><strong>VoIPBIN’s Three Asterisk Farms:</strong></p>
<p>VoIPBIN employs three specialized Asterisk farms for optimized scalability and fault isolation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Asterisk</span> <span class="n">Farm</span> <span class="n">Architecture</span><span class="p">:</span>

<span class="o">+---------------------------------------------------------+</span>
<span class="o">|</span>                  <span class="n">Kamailio</span> <span class="n">Farm</span>                          <span class="o">|</span>
<span class="o">+------+-------------------------------------+------------+</span>
       <span class="o">|</span>                                     <span class="o">|</span>
       <span class="o">|</span> <span class="n">All</span> <span class="n">Calls</span>                           <span class="o">|</span> <span class="n">Registrations</span>
       <span class="n">v</span>                 <span class="n">Conferences</span>         <span class="n">v</span>
<span class="o">+-------------+</span>    <span class="o">+-------------+</span>    <span class="o">+-------------+</span>
<span class="o">|</span>  <span class="n">Asterisk</span>   <span class="o">|</span>    <span class="o">|</span>  <span class="n">Asterisk</span>   <span class="o">|</span>    <span class="o">|</span>  <span class="n">Asterisk</span>   <span class="o">|</span>
<span class="o">|</span>    <span class="n">Call</span>     <span class="o">|</span>    <span class="o">|</span> <span class="n">Conference</span>  <span class="o">|</span>    <span class="o">|</span>  <span class="n">Registrar</span>  <span class="o">|</span>
<span class="o">|</span>   <span class="n">Farm</span>      <span class="o">|</span>    <span class="o">|</span>    <span class="n">Farm</span>     <span class="o">|</span>    <span class="o">|</span>    <span class="n">Farm</span>     <span class="o">|</span>
<span class="o">|</span>             <span class="o">|---&gt;|</span>             <span class="o">|</span>    <span class="o">|</span>             <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span> <span class="n">calls</span> <span class="o">|</span>    <span class="o">|</span> <span class="n">o</span> <span class="n">N</span><span class="o">-</span><span class="n">way</span>     <span class="o">|</span>    <span class="o">|</span> <span class="n">o</span> <span class="n">SIP</span>       <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Call</span>      <span class="o">|</span>    <span class="o">|</span>   <span class="n">conference</span><span class="o">|</span>    <span class="o">|</span>   <span class="n">REGISTER</span>  <span class="o">|</span>
<span class="o">|</span>   <span class="n">bridging</span>  <span class="o">|</span>    <span class="o">|</span> <span class="n">o</span> <span class="n">Mixing</span>    <span class="o">|</span>    <span class="o">|</span> <span class="n">o</span> <span class="n">Auth</span>      <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Transfers</span> <span class="o">|</span>    <span class="o">|</span> <span class="n">o</span> <span class="n">Recording</span> <span class="o">|</span>    <span class="o">|</span> <span class="n">o</span> <span class="n">Presence</span>  <span class="o">|</span>
<span class="o">+-------------+</span>    <span class="o">+-------------+</span>    <span class="o">+-------------+</span>
</pre></div>
</div>
<p><strong>1. Asterisk-Call Farm</strong></p>
<p>Handles 1:1 call processing:</p>
<ul class="simple">
<li><p>Call setup and teardown</p></li>
<li><p>Media bridging between two parties</p></li>
<li><p>Call transfers and forwarding</p></li>
<li><p>DTMF processing</p></li>
<li><p>Call recording</p></li>
</ul>
<p><strong>2. Asterisk-Conference Farm</strong></p>
<p>Manages multi-party conference calls:</p>
<ul class="simple">
<li><p>Conference bridge creation and management</p></li>
<li><p>Participant mixing (up to hundreds of participants)</p></li>
<li><p>Conference recording</p></li>
<li><p>Participant management (mute, kick, etc.)</p></li>
<li><p>Audio/video conferencing</p></li>
</ul>
<p><strong>3. Asterisk-Registrar Farm</strong></p>
<p>Handles SIP registration:</p>
<ul class="simple">
<li><p>User authentication</p></li>
<li><p>Registration lifecycle management</p></li>
<li><p>Presence information</p></li>
<li><p>Contact database</p></li>
</ul>
<p><strong>Farm Benefits:</strong></p>
<ul class="simple">
<li><p><strong>Independent Scaling</strong>: Scale each farm based on specific load patterns</p></li>
<li><p><strong>Fault Isolation</strong>: Issues in one farm don’t affect others</p></li>
<li><p><strong>Optimized Configuration</strong>: Each farm can be tuned for its specific workload</p></li>
<li><p><strong>Targeted Upgrades</strong>: Update farms independently without full system downtime</p></li>
</ul>
<p><strong>Inter-Farm Communication:</strong></p>
<p>While farms operate independently, Asterisk-Call and Asterisk-Conference communicate when bridging calls into conference sessions, enabling seamless transitions from 1:1 calls to conferences.</p>
</section>
<section id="rtpengine-media-proxy-and-transcoding">
<h3>RTPEngine - Media Proxy and Transcoding<a class="headerlink" href="#rtpengine-media-proxy-and-transcoding" title="Link to this heading"></a></h3>
<p>RTPEngine is an open-source media proxy providing RTP processing and transcoding capabilities.</p>
<img alt="Architecture RTPEngine" src="_images/architecture_rtc_rtpengine.png" />
<p><strong>Role in VoIPBIN:</strong></p>
<p>RTPEngine serves as the codec edge server and media proxy:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Codec</span> <span class="n">Transcoding</span><span class="p">:</span>

<span class="n">External</span> <span class="n">Client</span>                      <span class="n">VoIPBIN</span> <span class="n">Internal</span>
<span class="p">(</span><span class="n">Various</span> <span class="n">Codecs</span><span class="p">)</span>                     <span class="p">(</span><span class="n">ulaw</span> <span class="n">only</span><span class="p">)</span>
     <span class="o">|</span>                                     <span class="o">|</span>
     <span class="o">|</span> <span class="n">RTP</span> <span class="p">(</span><span class="n">G</span><span class="mf">.722</span><span class="p">,</span> <span class="n">Opus</span><span class="p">,</span> <span class="n">etc</span><span class="o">.</span><span class="p">)</span>             <span class="o">|</span>
     <span class="n">v</span>                                     <span class="n">v</span>
<span class="o">+---------------------------------------------+</span>
<span class="o">|</span>            <span class="n">RTPEngine</span> <span class="n">Farm</span>                   <span class="o">|</span>
<span class="o">|</span>                                             <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="n">Transcode</span> <span class="n">external</span> <span class="o">-&gt;</span> <span class="n">ulaw</span> <span class="p">(</span><span class="n">internal</span><span class="p">)</span>    <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="n">Transcode</span> <span class="n">ulaw</span> <span class="p">(</span><span class="n">internal</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">external</span>    <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="n">NAT</span> <span class="n">traversal</span>                            <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="n">Packet</span> <span class="n">switching</span>                         <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="n">SRTP</span><span class="o">/</span><span class="n">RTP</span> <span class="n">conversion</span>                      <span class="o">|</span>
<span class="o">+------------------+--------------------------+</span>
                   <span class="o">|</span>
                   <span class="o">|</span> <span class="n">RTP</span> <span class="p">(</span><span class="n">ulaw</span><span class="p">)</span>
                   <span class="n">v</span>
               <span class="n">Asterisk</span> <span class="n">Farm</span>
</pre></div>
</div>
<p><strong>Responsibilities:</strong></p>
<ul class="simple">
<li><p><strong>Codec Transcoding</strong>: Convert between external codecs and internal ulaw</p></li>
<li><p><strong>NAT Traversal</strong>: Handle media through NAT and firewalls</p></li>
<li><p><strong>SRTP Support</strong>: Encrypt/decrypt media streams</p></li>
<li><p><strong>Packet Routing</strong>: Efficient RTP packet switching</p></li>
<li><p><strong>Load Distribution</strong>: Distribute media processing across instances</p></li>
</ul>
<p><strong>Internal Codec Strategy:</strong></p>
<ul class="simple">
<li><p><strong>Internal</strong>: VoIPBIN uses ulaw codec exclusively for all internal communication</p></li>
<li><p><strong>External</strong>: Clients can use any supported codec (G.711, G.722, Opus, etc.)</p></li>
<li><p><strong>Edge Transcoding</strong>: RTPEngine performs all transcoding at the edge</p></li>
<li><p><strong>Performance</strong>: Internal ulaw ensures minimal CPU overhead for media processing</p></li>
</ul>
<p>This edge transcoding strategy ensures optimal internal performance while supporting diverse client codecs.</p>
</section>
<section id="conference-architecture">
<h3>Conference Architecture<a class="headerlink" href="#conference-architecture" title="Link to this heading"></a></h3>
<p>VoIPBIN’s conference functionality is powered by the dedicated Asterisk-Conference farm.</p>
<img alt="Architecture Conference" src="_images/architecture_rtc_conference.png" />
<p><strong>Conference Design:</strong></p>
<p>VoIPBIN leverages a dedicated Asterisk-Conference component for all conference calls:</p>
<p><strong>Advantages:</strong></p>
<ul class="simple">
<li><p><strong>Isolation and Scalability</strong>: Conference processing separated from regular calls ensures stable service</p></li>
<li><p><strong>Independent Scaling</strong>: Conference farm scales based on conferencing usage patterns</p></li>
<li><p><strong>Centralized Management</strong>: All conference operations managed in one place</p></li>
<li><p><strong>Fault Isolation</strong>: Conference issues don’t impact regular call processing</p></li>
</ul>
<section id="conference-flow">
<h4>Conference Flow<a class="headerlink" href="#conference-flow" title="Link to this heading"></a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Conference</span> <span class="n">Lifecycle</span><span class="p">:</span>

<span class="n">Flow</span> <span class="n">Manager</span>       <span class="n">Asterisk</span><span class="o">-</span><span class="n">Conf</span>      <span class="n">Conference</span> <span class="n">Bridge</span>
     <span class="o">|</span>                  <span class="o">|</span>                    <span class="o">|</span>
     <span class="o">|</span> <span class="mf">1.</span> <span class="n">Create</span> <span class="n">Conf</span>   <span class="o">|</span>                    <span class="o">|</span>
     <span class="o">+-----------------&gt;|</span>                    <span class="o">|</span>
     <span class="o">|</span>                  <span class="o">|</span> <span class="mf">2.</span> <span class="n">Create</span> <span class="n">Bridge</span>   <span class="o">|</span>
     <span class="o">|</span>                  <span class="o">+-------------------&gt;|</span>
     <span class="o">|</span>                  <span class="o">|</span>                    <span class="o">|</span>
     <span class="o">|</span> <span class="mf">3.</span> <span class="n">Add</span> <span class="n">Part</span><span class="o">.</span> <span class="mi">1</span>   <span class="o">|</span>                    <span class="o">|</span>
     <span class="o">+-----------------&gt;|</span> <span class="mf">4.</span> <span class="n">Join</span> <span class="n">Bridge</span>     <span class="o">|</span>
     <span class="o">|</span>                  <span class="o">+-------------------&gt;|</span>
     <span class="o">|</span>                  <span class="o">|</span>                    <span class="o">|</span>
     <span class="o">|</span> <span class="mf">5.</span> <span class="n">Add</span> <span class="n">Part</span><span class="o">.</span> <span class="mi">2</span>   <span class="o">|</span>                    <span class="o">|</span>
     <span class="o">+-----------------&gt;|</span> <span class="mf">6.</span> <span class="n">Join</span> <span class="n">Bridge</span>     <span class="o">|</span>
     <span class="o">|</span>                  <span class="o">+-------------------&gt;|</span>
     <span class="o">|</span>                  <span class="o">|</span>                    <span class="o">|</span>
     <span class="o">|</span>                  <span class="o">|</span>  <span class="p">[</span><span class="n">Audio</span> <span class="n">Mixing</span><span class="p">]</span>    <span class="o">|</span>
     <span class="o">|</span>                  <span class="o">|&lt;------------------&gt;|</span>
     <span class="o">|</span>                  <span class="o">|</span>                    <span class="o">|</span>
     <span class="o">|</span> <span class="mf">7.</span> <span class="n">End</span> <span class="n">Conf</span>      <span class="o">|</span>                    <span class="o">|</span>
     <span class="o">+-----------------&gt;|</span> <span class="mf">8.</span> <span class="n">Destroy</span> <span class="n">Bridge</span>  <span class="o">|</span>
     <span class="o">|</span>                  <span class="o">+-------------------&gt;|</span>
     <span class="o">|</span>                  <span class="o">|</span>                    <span class="o">|</span>
</pre></div>
</div>
<p><strong>Conference Steps:</strong></p>
<ol class="arabic simple">
<li><p><strong>Call Initiation</strong>: Flow Manager requests conference creation (via “connect” or “conference_join” action)</p></li>
<li><p><strong>Conference Establishment</strong>: Asterisk-Conference creates dedicated bridge for participants</p></li>
<li><p><strong>Participant Joining</strong>: Participants added to bridge sequentially or simultaneously</p></li>
<li><p><strong>Conference Interaction</strong>: Participants communicate with voice/video, screen sharing, etc.</p></li>
<li><p><strong>Conference Termination</strong>: Bridge destroyed when conference ends or all participants leave</p></li>
</ol>
<p><strong>Conference Features:</strong></p>
<ul class="simple">
<li><p>Audio and video mixing</p></li>
<li><p>Recording capabilities</p></li>
<li><p>Dynamic participant management</p></li>
<li><p>Mute/unmute controls</p></li>
<li><p>Moderator capabilities</p></li>
<li><p>Entry/exit tones</p></li>
</ul>
</section>
<section id="calls-as-conferences">
<h4>1:1 Calls as Conferences<a class="headerlink" href="#calls-as-conferences" title="Link to this heading"></a></h4>
<p>VoIPBIN treats 1:1 calls as special cases of conferencing with only two participants:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span> <span class="n">Call</span> <span class="o">=</span> <span class="n">Conference</span> <span class="k">with</span> <span class="mi">2</span> <span class="n">Participants</span>

<span class="o">+--------------+</span>         <span class="o">+--------------+</span>
<span class="o">|</span> <span class="n">Participant</span> <span class="n">A</span><span class="o">|</span>         <span class="o">|</span> <span class="n">Participant</span> <span class="n">B</span><span class="o">|</span>
<span class="o">+------+-------+</span>         <span class="o">+------+-------+</span>
       <span class="o">|</span>                        <span class="o">|</span>
       <span class="o">|</span>    <span class="n">Conference</span> <span class="n">Bridge</span>   <span class="o">|</span>
       <span class="o">|</span>    <span class="p">(</span><span class="mi">2</span> <span class="n">participants</span><span class="p">)</span>    <span class="o">|</span>
       <span class="o">+-----------+------------+</span>
                   <span class="o">|</span>
              <span class="n">Asterisk</span><span class="o">-</span><span class="n">Call</span>
              <span class="p">(</span><span class="n">manages</span> <span class="n">bridge</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Benefits of Unified Approach:</strong></p>
<ul class="simple">
<li><p><strong>Simplified Development</strong>: Same infrastructure for 1:1 calls and conferences</p></li>
<li><p><strong>Enhanced Flexibility</strong>: Seamless transitions from 1:1 to multi-party conferences</p></li>
<li><p><strong>Improved Resource Utilization</strong>: Optimized resource allocation across all call types</p></li>
<li><p><strong>Consistent Features</strong>: Same feature set available for all call types</p></li>
<li><p><strong>Easier Maintenance</strong>: Single codebase for all call scenarios</p></li>
</ul>
<p><strong>Example Transition:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span> <span class="n">Call</span> <span class="o">-&gt;</span> <span class="n">Multi</span><span class="o">-</span><span class="n">Party</span> <span class="n">Conference</span><span class="p">:</span>

<span class="n">Initial</span> <span class="n">State</span><span class="p">:</span>         <span class="n">Add</span> <span class="mi">3</span><span class="n">rd</span> <span class="n">Party</span><span class="p">:</span>          <span class="n">Result</span><span class="p">:</span>
<span class="o">+-----+</span>  <span class="o">+-----+</span>      <span class="o">+-----+</span>  <span class="o">+-----+</span>      <span class="o">+-----+</span>  <span class="o">+-----+</span>
<span class="o">|</span>  <span class="n">A</span>  <span class="o">|--|</span>  <span class="n">B</span>  <span class="o">|</span>      <span class="o">|</span>  <span class="n">A</span>  <span class="o">|--|</span>  <span class="n">B</span>  <span class="o">|</span>      <span class="o">|</span>  <span class="n">A</span>  <span class="o">|--|</span>  <span class="n">B</span>  <span class="o">|</span>
<span class="o">+-----+</span>  <span class="o">+-----+</span>      <span class="o">+-----+</span>  <span class="o">+-----+</span>      <span class="o">+-----+</span>  <span class="o">+-----+</span>
                             <span class="o">|</span>                     <span class="o">|</span>
                             <span class="o">|</span>                     <span class="o">|</span>
                             <span class="n">v</span>                     <span class="n">v</span>
                          <span class="o">+-----+</span>               <span class="o">+-----+</span>
                          <span class="o">|</span>  <span class="n">C</span>  <span class="o">|</span>               <span class="o">|</span>  <span class="n">C</span>  <span class="o">|</span>
                          <span class="o">+-----+</span>               <span class="o">+-----+</span>

<span class="mi">2</span><span class="o">-</span><span class="n">participant</span> <span class="n">bridge</span>   <span class="n">Add</span> <span class="n">participant</span>      <span class="mi">3</span><span class="o">-</span><span class="n">participant</span> <span class="n">bridge</span>
<span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span> <span class="n">call</span><span class="p">)</span>            <span class="n">without</span> <span class="n">disruption</span>    <span class="p">(</span><span class="n">conference</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="sip-session-recovery">
<h3>SIP Session Recovery<a class="headerlink" href="#sip-session-recovery" title="Link to this heading"></a></h3>
<p>VoIPBIN provides <strong>SIP session recovery</strong> to maintain active SIP sessions even when an Asterisk instance crashes unexpectedly. This feature prevents call drops, conference exits, and media failures by making the client perceive the session as uninterrupted.</p>
<div class="video_wrapper" style="">
<iframe allowfullscreen="true" src="https://www.youtube.com/embed/GMd-pOwyrtA" style="border: 0; height: 345px; width: 560px">
</iframe></div><section id="how-it-works">
<h4>How It Works<a class="headerlink" href="#how-it-works" title="Link to this heading"></a></h4>
<p>When an Asterisk instance crashes, all SIP sessions managed by that instance disappear immediately. Without a BYE message, clients experience unexpected termination. VoIPBIN recovers sessions through an automated process:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Session</span> <span class="n">Recovery</span> <span class="n">Flow</span><span class="p">:</span>

<span class="n">Asterisk</span><span class="o">-</span><span class="mi">1</span>     <span class="n">Client</span>       <span class="n">Sentinel</span>    <span class="n">Call</span><span class="o">-</span><span class="n">manager</span>  <span class="n">HOMER</span> <span class="n">DB</span>    <span class="n">Asterisk</span><span class="o">-</span><span class="mi">2</span>
    <span class="o">|</span>             <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span>         <span class="o">|</span>            <span class="o">|</span>
    <span class="o">|</span>   <span class="n">Active</span>    <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span>         <span class="o">|</span>            <span class="o">|</span>
    <span class="o">|</span>   <span class="n">Session</span>   <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span>         <span class="o">|</span>            <span class="o">|</span>
    <span class="o">|&lt;-----------&gt;|</span>             <span class="o">|</span>              <span class="o">|</span>         <span class="o">|</span>            <span class="o">|</span>
    <span class="o">|</span>             <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span>         <span class="o">|</span>            <span class="o">|</span>
    <span class="n">X</span>  <span class="n">CRASH</span>      <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span>         <span class="o">|</span>            <span class="o">|</span>
                  <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span>         <span class="o">|</span>            <span class="o">|</span>
                  <span class="o">|</span>          <span class="n">Detect</span> <span class="n">Crash</span>      <span class="o">|</span>         <span class="o">|</span>            <span class="o">|</span>
                  <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span>         <span class="o">|</span>            <span class="o">|</span>
                  <span class="o">|</span>     <span class="n">Publish</span> <span class="n">Crash</span> <span class="n">event</span>    <span class="o">|</span>         <span class="o">|</span>            <span class="o">|</span>
                  <span class="o">|</span>             <span class="o">+-------------&gt;|</span>         <span class="o">|</span>            <span class="o">|</span>
                  <span class="o">|</span>                       <span class="n">Query</span> <span class="n">Sessions</span> <span class="o">|</span>            <span class="o">|</span>
                  <span class="o">|</span>                      <span class="n">Get</span> <span class="n">SIP</span> <span class="n">Headers</span> <span class="o">|</span>            <span class="o">|</span>
                  <span class="o">|</span>                            <span class="o">|&lt;--------+</span>            <span class="o">|</span>
                  <span class="o">|</span>                            <span class="o">|</span>                      <span class="o">|</span>
                  <span class="o">|</span>                   <span class="n">Create</span> <span class="n">Channels</span>                 <span class="o">|</span>
                  <span class="o">|</span>                            <span class="o">+---------------------&gt;|</span>
                  <span class="o">|</span>                                                   <span class="o">|</span>
                  <span class="o">|</span>                                                   <span class="o">|</span>
                  <span class="o">|</span>                                                   <span class="o">|</span>
                  <span class="o">|</span>          <span class="n">Send</span> <span class="n">Recovery</span> <span class="n">INVITE</span>                     <span class="o">|</span>
                  <span class="o">|&lt;--------------------------------------------------+</span>
                  <span class="o">|</span>                                                   <span class="o">|</span>
                  <span class="o">|</span>   <span class="mi">200</span> <span class="n">OK</span> <span class="p">(</span><span class="n">same</span> <span class="n">Call</span><span class="o">-</span><span class="n">ID</span><span class="p">)</span>                           <span class="o">|</span>
                  <span class="o">+--------------------------------------------------&gt;|</span>
                  <span class="o">|</span>                                                   <span class="o">|</span>
        <span class="n">Session</span>   <span class="o">|</span>                                                   <span class="o">|</span>
       <span class="n">Recovered</span>  <span class="o">|</span>                                                   <span class="o">|</span>
                  <span class="o">|&lt;-------------------------------------------------&gt;|</span>
</pre></div>
</div>
<img alt="SIP Session Recovery Flow" src="_images/architecture_rtc_sip_session_recovery_flow.png" />
</section>
<section id="detailed-steps">
<h4>Detailed Steps<a class="headerlink" href="#detailed-steps" title="Link to this heading"></a></h4>
<p><strong>1. Crash Detection</strong></p>
<p>The <cite>sentinel-manager</cite> quickly detects abnormal termination of an Asterisk instance.</p>
<p><strong>2. Session Lookup</strong></p>
<p>The internal database is queried to retrieve all active sessions from the failed instance.</p>
<p><strong>3. SIP Field Collection (via HOMER)</strong></p>
<p>The HOMER SIP capture API provides SIP header information:</p>
<ul class="simple">
<li><p>Call-ID</p></li>
<li><p>From/To headers and tags</p></li>
<li><p>Route headers</p></li>
<li><p>CSeq values</p></li>
<li><p>Other SIP state information</p></li>
</ul>
<p><strong>4. Create SIP Channels on Another Asterisk</strong></p>
<p>A healthy Asterisk instance is selected and new SIP channels are created with original session information.</p>
<p><strong>5. Set Recovery Channel Variables</strong></p>
<p>Channel variables are set to ensure the new INVITE appears as continuation:</p>
<ul class="simple">
<li><p>PJSIP_RECOVERY_FROM_DISPLAY</p></li>
<li><p>PJSIP_RECOVERY_FROM_URI</p></li>
<li><p>PJSIP_RECOVERY_FROM_TAG</p></li>
<li><p>PJSIP_RECOVERY_TO_DISPLAY</p></li>
<li><p>PJSIP_RECOVERY_TO_URI</p></li>
<li><p>PJSIP_RECOVERY_TO_TAG</p></li>
<li><p>Call-ID, CSeq, Routes (preserved from original session)</p></li>
</ul>
<p><strong>6. Send Recovery INVITE</strong></p>
<p>The INVITE reuses the original Call-ID and tags, so the client interprets it as a re-INVITE within the existing session.</p>
<p><strong>7. Restore RTP and SIP Sessions</strong></p>
<p>Signaling and media are fully re-established, restoring the call to its previous state.</p>
<p><strong>8. Resume Flow Execution</strong></p>
<p>The recovered session resumes Flow execution from before the crash:</p>
<ul class="simple">
<li><p><strong>Active Calls</strong>: Conversation continues without interruption</p></li>
<li><p><strong>Conferences</strong>: User reconnected to same conference bridge</p></li>
<li><p><strong>Call State</strong>: All call variables and state restored</p></li>
</ul>
</section>
<section id="asterisk-patch-for-recovery">
<h4>Asterisk Patch for Recovery<a class="headerlink" href="#asterisk-patch-for-recovery" title="Link to this heading"></a></h4>
<p>VoIPBIN patches Asterisk’s PJSIP stack to override SIP header fields based on channel variables:</p>
<img alt="SIP Session Recovery Diagram" src="_images/architecture_rtc_sip_session_recovery_diagram.png" />
<p><strong>Patch Implementation:</strong></p>
<p>This patch allows a newly created SIP channel to impersonate the original one, making the recovery INVITE appear as a legitimate continuation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Extract</span> <span class="n">recovery</span> <span class="n">variables</span> <span class="kn">from</span> <span class="nn">channel</span>
<span class="n">val_from_display_c_str</span> <span class="o">=</span> <span class="n">pbx_builtin_getvar_helper</span><span class="p">(</span><span class="n">session</span><span class="o">-&gt;</span><span class="n">channel</span><span class="p">,</span> <span class="s2">&quot;PJSIP_RECOVERY_FROM_DISPLAY&quot;</span><span class="p">);</span>
<span class="n">val_from_uri_c_str</span>     <span class="o">=</span> <span class="n">pbx_builtin_getvar_helper</span><span class="p">(</span><span class="n">session</span><span class="o">-&gt;</span><span class="n">channel</span><span class="p">,</span> <span class="s2">&quot;PJSIP_RECOVERY_FROM_URI&quot;</span><span class="p">);</span>
<span class="n">val_from_tag_c_str</span>     <span class="o">=</span> <span class="n">pbx_builtin_getvar_helper</span><span class="p">(</span><span class="n">session</span><span class="o">-&gt;</span><span class="n">channel</span><span class="p">,</span> <span class="s2">&quot;PJSIP_RECOVERY_FROM_TAG&quot;</span><span class="p">);</span>

<span class="n">val_to_display_c_str</span>   <span class="o">=</span> <span class="n">pbx_builtin_getvar_helper</span><span class="p">(</span><span class="n">session</span><span class="o">-&gt;</span><span class="n">channel</span><span class="p">,</span> <span class="s2">&quot;PJSIP_RECOVERY_TO_DISPLAY&quot;</span><span class="p">);</span>
<span class="n">val_to_uri_c_str</span>       <span class="o">=</span> <span class="n">pbx_builtin_getvar_helper</span><span class="p">(</span><span class="n">session</span><span class="o">-&gt;</span><span class="n">channel</span><span class="p">,</span> <span class="s2">&quot;PJSIP_RECOVERY_TO_URI&quot;</span><span class="p">);</span>
<span class="n">val_to_tag_c_str</span>       <span class="o">=</span> <span class="n">pbx_builtin_getvar_helper</span><span class="p">(</span><span class="n">session</span><span class="o">-&gt;</span><span class="n">channel</span><span class="p">,</span> <span class="s2">&quot;PJSIP_RECOVERY_TO_TAG&quot;</span><span class="p">);</span>

<span class="o">//</span> <span class="n">Call</span><span class="o">-</span><span class="n">ID</span><span class="p">,</span> <span class="n">CSeq</span><span class="p">,</span> <span class="n">Routes</span><span class="p">,</span> <span class="ow">and</span> <span class="n">other</span> <span class="n">headers</span> <span class="n">are</span> <span class="n">handled</span> <span class="n">similarly</span>
<span class="o">//</span> <span class="n">Override</span> <span class="n">PJSIP</span> <span class="n">headers</span> <span class="k">with</span> <span class="n">recovery</span> <span class="n">values</span>
</pre></div>
</div>
<p><strong>Full Patch:</strong></p>
<p>The complete implementation is available on GitHub:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/voipbin/etc/blob/main/asterisk/add_pjsip_recovery.patch">https://github.com/voipbin/etc/blob/main/asterisk/add_pjsip_recovery.patch</a></p></li>
</ul>
<p><strong>Recovery Guarantees:</strong></p>
<ul class="simple">
<li><p><strong>Transparent to Client</strong>: Client sees normal re-INVITE, no indication of crash</p></li>
<li><p><strong>State Preservation</strong>: All call state and variables restored</p></li>
<li><p><strong>Media Continuity</strong>: Audio/video streams resume without gaps</p></li>
<li><p><strong>Flow Continuity</strong>: Call flow resumes at exact point before crash</p></li>
</ul>
</section>
</section>
</section>
<section id="system-request-flows">
<span id="architecture-flow"></span><h2>System Request Flows<a class="headerlink" href="#system-request-flows" title="Link to this heading"></a></h2>
<p>This section demonstrates how requests flow through VoIPBIN’s architecture from client to backend services and back. Understanding these flows helps developers build integrations and debug issues.</p>
<section id="request-flow-overview">
<h3>Request Flow Overview<a class="headerlink" href="#request-flow-overview" title="Link to this heading"></a></h3>
<p>All external requests follow this general pattern:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Complete</span> <span class="n">Request</span> <span class="n">Flow</span><span class="p">:</span>

<span class="n">Client</span> <span class="n">App</span>          <span class="n">API</span> <span class="n">Gateway</span>         <span class="n">Message</span> <span class="n">Queue</span>       <span class="n">Backend</span> <span class="n">Service</span>      <span class="n">Data</span> <span class="n">Layer</span>
    <span class="o">|</span>                   <span class="o">|</span>                    <span class="o">|</span>                     <span class="o">|</span>                  <span class="o">|</span>
    <span class="o">|</span>  <span class="n">HTTP</span> <span class="n">Request</span>     <span class="o">|</span>                    <span class="o">|</span>                     <span class="o">|</span>                  <span class="o">|</span>
    <span class="o">+------------------&gt;|</span>                    <span class="o">|</span>                     <span class="o">|</span>                  <span class="o">|</span>
    <span class="o">|</span>                   <span class="o">|</span>  <span class="mf">1.</span> <span class="n">Authenticate</span>   <span class="o">|</span>                     <span class="o">|</span>                  <span class="o">|</span>
    <span class="o">|</span>                   <span class="o">|</span>  <span class="mf">2.</span> <span class="n">Authorize</span>      <span class="o">|</span>                     <span class="o">|</span>                  <span class="o">|</span>
    <span class="o">|</span>                   <span class="o">|</span>  <span class="mf">3.</span> <span class="n">Validate</span>       <span class="o">|</span>                     <span class="o">|</span>                  <span class="o">|</span>
    <span class="o">|</span>                   <span class="o">|</span>                    <span class="o">|</span>                     <span class="o">|</span>                  <span class="o">|</span>
    <span class="o">|</span>                   <span class="o">|</span>  <span class="n">RPC</span> <span class="n">Request</span>       <span class="o">|</span>                     <span class="o">|</span>                  <span class="o">|</span>
    <span class="o">|</span>                   <span class="o">+-------------------&gt;|</span>                     <span class="o">|</span>                  <span class="o">|</span>
    <span class="o">|</span>                   <span class="o">|</span>                    <span class="o">|</span>  <span class="n">Dequeue</span>            <span class="o">|</span>                  <span class="o">|</span>
    <span class="o">|</span>                   <span class="o">|</span>                    <span class="o">+--------------------&gt;|</span>                  <span class="o">|</span>
    <span class="o">|</span>                   <span class="o">|</span>                    <span class="o">|</span>                     <span class="o">|</span>  <span class="n">Query</span>           <span class="o">|</span>
    <span class="o">|</span>                   <span class="o">|</span>                    <span class="o">|</span>                     <span class="o">+-----------------&gt;|</span>
    <span class="o">|</span>                   <span class="o">|</span>                    <span class="o">|</span>                     <span class="o">|</span>                  <span class="o">|</span>
    <span class="o">|</span>                   <span class="o">|</span>                    <span class="o">|</span>                     <span class="o">|</span>  <span class="n">Result</span>          <span class="o">|</span>
    <span class="o">|</span>                   <span class="o">|</span>                    <span class="o">|</span>                     <span class="o">|&lt;-----------------+</span>
    <span class="o">|</span>                   <span class="o">|</span>                    <span class="o">|</span>  <span class="n">Response</span>           <span class="o">|</span>                  <span class="o">|</span>
    <span class="o">|</span>                   <span class="o">|</span>                    <span class="o">|&lt;--------------------+</span>                  <span class="o">|</span>
    <span class="o">|</span>                   <span class="o">|</span>  <span class="n">RPC</span> <span class="n">Response</span>      <span class="o">|</span>                     <span class="o">|</span>                  <span class="o">|</span>
    <span class="o">|</span>                   <span class="o">|&lt;-------------------+</span>                     <span class="o">|</span>                  <span class="o">|</span>
    <span class="o">|</span>  <span class="n">JSON</span> <span class="n">Response</span>    <span class="o">|</span>                    <span class="o">|</span>                     <span class="o">|</span>                  <span class="o">|</span>
    <span class="o">|&lt;------------------+</span>                    <span class="o">|</span>                     <span class="o">|</span>                  <span class="o">|</span>
    <span class="o">|</span>                   <span class="o">|</span>                    <span class="o">|</span>                     <span class="o">|</span>                  <span class="o">|</span>
</pre></div>
</div>
</section>
<section id="flow-1-create-call-simple">
<h3>Flow 1: Create Call (Simple)<a class="headerlink" href="#flow-1-create-call-simple" title="Link to this heading"></a></h3>
<p>This flow shows how a basic call creation request flows through the system.</p>
<p><strong>Step-by-Step Flow:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>1. Client Request:

Client Application
    |
    |  POST /v1.0/calls
    |  Authorization: Bearer eyJhbGc...
    |  Content-Type: application/json
    |
    |  {
    |    &quot;source&quot;: {&quot;type&quot;: &quot;tel&quot;, &quot;target&quot;: &quot;+15551234567&quot;},
    |    &quot;destinations&quot;: [{&quot;type&quot;: &quot;tel&quot;, &quot;target&quot;: &quot;+15559876543&quot;}]
    |  }
    |
    v

2. API Gateway (bin-api-manager):

+-------------------------------------------------+
|  a) Extract JWT token                           |
|     → token = &quot;eyJhbGc...&quot;                      |
|                                                 |
|  b) Validate JWT signature                      |
|     → customer_id = &quot;customer-123&quot;              |
|     → agent_id = &quot;agent-456&quot;                    |
|                                                 |
|  c) Check permissions                           |
|     → hasPermission(customer-123, &quot;call.create&quot;)|
|     → ✓ Allowed                                 |
|                                                 |
|  d) Validate request body                       |
|     → Source phone valid                        |
|     → Destination phone valid                   |
|     → ✓ Valid                                   |
|                                                 |
|  e) Build RPC message                           |
|     {                                           |
|       &quot;route&quot;: &quot;POST /v1/calls&quot;,                |
|       &quot;headers&quot;: {                              |
|         &quot;customer_id&quot;: &quot;customer-123&quot;,          |
|         &quot;agent_id&quot;: &quot;agent-456&quot;                 |
|       },                                        |
|       &quot;body&quot;: {...}                             |
|     }                                           |
|                                                 |
|  f) Send to RabbitMQ                            |
|     → Queue: bin-manager.call.request           |
+-------------------------------------------------+
    |
    v

3. RabbitMQ:

+------------------------------------------------+
|  a) Receive message                            |
|     → Queue: bin-manager.call.request          |
|                                                |
|  b) Route to available consumer                |
|     → bin-call-manager instance 2 (of 3)       |
+------------------------------------------------+
    |
    v

4. Call Manager (bin-call-manager):

+-------------------------------------------------+
|  a) Receive RPC message                         |
|     → Parse route: POST /v1/calls               |
|     → Extract customer_id, agent_id             |
|                                                 |
|  b) Validate business logic                     |
|     → Check billing balance                     |
|     → ✓ Sufficient funds                        |
|                                                 |
|  c) Create call record                          |
|     → Generate call_id = &quot;call-789&quot;             |
|     → INSERT INTO calls (...)                   |
|     → Status: &quot;initiating&quot;                      |
|                                                 |
|  d) Initiate SIP call                           |
|     → Send to bin-rtc-manager                   |
|     → Request Asterisk channel creation         |
|                                                 |
|  e) Update call status                          |
|     → UPDATE calls SET status=&#39;ringing&#39; WHERE...|
|                                                 |
|  f) Publish event                               |
|     → Event: call.created                       |
|     → RabbitMQ exchange: call.events            |
|                                                 |
|  g) Build response                              |
|     {                                           |
|       &quot;id&quot;: &quot;call-789&quot;,                         |
|       &quot;status&quot;: &quot;ringing&quot;,                      |
|       &quot;source&quot;: &quot;+15551234567&quot;,                 |
|       &quot;destination&quot;: &quot;+15559876543&quot;,            |
|       &quot;tm_create&quot;: &quot;2026-01-20T12:00:00.000Z&quot;   |
|     }                                           |
|                                                 |
|  h) Send RPC response                           |
|     → Reply to: reply_to queue                  |
+-------------------------------------------------+
    |
    v

5. RabbitMQ (Response):

+------------------------------------------------+
|  a) Deliver response to API Gateway            |
|     → Queue: amq.gen-xyz (reply_to)            |
+------------------------------------------------+
    |
    v

6. API Gateway (Response):

+------------------------------------------------+
|  a) Receive RPC response                       |
|     → status_code: 200                         |
|     → body: {...}                              |
|                                                |
|  b) Format HTTP response                       |
|     → HTTP 201 Created                         |
|     → Content-Type: application/json           |
+------------------------------------------------+
    |
    v

7. Client Response:

HTTP/1.1 201 Created
Content-Type: application/json

{
  &quot;id&quot;: &quot;call-789&quot;,
  &quot;status&quot;: &quot;ringing&quot;,
  &quot;source&quot;: &quot;+15551234567&quot;,
  &quot;destination&quot;: &quot;+15559876543&quot;,
  &quot;tm_create&quot;: &quot;2026-01-20T12:00:00.000Z&quot;
}
</pre></div>
</div>
<p><strong>Timing Breakdown:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Component</span>               <span class="n">Time</span>      <span class="n">Cumulative</span>
<span class="o">---------------------------------------------</span>
<span class="n">API</span> <span class="n">Gateway</span> <span class="n">auth</span>        <span class="mi">5</span><span class="n">ms</span>       <span class="mi">5</span><span class="n">ms</span>
<span class="n">RabbitMQ</span> <span class="n">routing</span>        <span class="mi">2</span><span class="n">ms</span>       <span class="mi">7</span><span class="n">ms</span>
<span class="n">Call</span> <span class="n">Manager</span> <span class="n">logic</span>      <span class="mi">30</span><span class="n">ms</span>      <span class="mi">37</span><span class="n">ms</span>
<span class="n">Database</span> <span class="n">insert</span>         <span class="mi">8</span><span class="n">ms</span>       <span class="mi">45</span><span class="n">ms</span>
<span class="n">RTC</span> <span class="n">Manager</span> <span class="n">SIP</span> <span class="n">setup</span>   <span class="mi">50</span><span class="n">ms</span>      <span class="mi">95</span><span class="n">ms</span>
<span class="n">Response</span> <span class="n">routing</span>        <span class="mi">5</span><span class="n">ms</span>       <span class="mi">100</span><span class="n">ms</span>
<span class="o">---------------------------------------------</span>
<span class="n">Total</span>                   <span class="mi">100</span><span class="n">ms</span>
</pre></div>
</div>
</section>
<section id="flow-2-get-call-with-caching">
<h3>Flow 2: Get Call with Caching<a class="headerlink" href="#flow-2-get-call-with-caching" title="Link to this heading"></a></h3>
<p>This flow demonstrates cache-aside pattern for reading data.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>1. Client Request:

GET /v1.0/calls/call-789
Authorization: Bearer eyJhbGc...

    |
    v

2. API Gateway:

+------------------------------------------------+
|  • Authenticate (5ms)                          |
|  • Build RPC message                           |
|  • Send to bin-manager.call.request            |
+------------------------------------------------+
    |
    v

3. Call Manager:

+------------------------------------------------+
|  a) Check Redis cache first                    |
|     key = &quot;call:call-789&quot;                      |
|                                                |
|     GET call:call-789                          |
|     → Cache HIT! (90% of requests)             |
|     → Return cached data (2ms)                 |
|                                                |
|     OR                                         |
|                                                |
|     → Cache MISS (10% of requests)             |
|                                                |
|  b) If cache miss, query MySQL                 |
|     SELECT * FROM calls WHERE id=&#39;call-789&#39;    |
|     → Query time: 10ms                         |
|                                                |
|  c) Store in Redis for next time               |
|     SET call:call-789 {...} EX 300  # 5 min    |
|     → Store time: 2ms                          |
|                                                |
|  d) Check authorization                        |
|     if call.customer_id != jwt.customer_id:    |
|       return 404 (not 403, for security)       |
|                                                |
|  e) Return response                            |
+------------------------------------------------+
    |
    v

4. Response Times:

Cache Hit Path:  ~12ms total
• API Gateway: 5ms
• Redis lookup: 2ms
• Response: 5ms

Cache Miss Path: ~27ms total
• API Gateway: 5ms
• Redis lookup: 2ms (miss)
• MySQL query: 10ms
• Redis store: 2ms
• Response: 5ms
• Authorization: 3ms
</pre></div>
</div>
</section>
<section id="flow-3-call-with-event-broadcasting">
<h3>Flow 3: Call with Event Broadcasting<a class="headerlink" href="#flow-3-call-with-event-broadcasting" title="Link to this heading"></a></h3>
<p>This flow shows asynchronous event publishing to multiple subscribers.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Call State Change Flow:

1. Call Answered (in bin-call-manager):

+------------------------------------------------+
|  a) Receive SIP 200 OK from Asterisk           |
|     → Call answered                            |
|                                                |
|  b) Update database                            |
|     UPDATE calls                               |
|     SET status=&#39;active&#39;, tm_answer=NOW()       |
|     WHERE id=&#39;call-789&#39;                        |
|                                                |
|  c) Invalidate cache                           |
|     DEL call:call-789                          |
|                                                |
|  d) Publish event to RabbitMQ                  |
|     Exchange: call.events                      |
|     Event: call.answered                       |
|     {                                          |
|       &quot;event_type&quot;: &quot;call.answered&quot;,           |
|       &quot;call_id&quot;: &quot;call-789&quot;,                   |
|       &quot;timestamp&quot;: &quot;2026-01-20T12:00:05.000Z&quot;  |
|     }                                          |
|                                                |
|  e) Publish to ZeroMQ (fast path)              |
|     Topic: &quot;call.state&quot;                        |
|     {                                          |
|       &quot;call_id&quot;: &quot;call-789&quot;,                   |
|       &quot;status&quot;: &quot;active&quot;                       |
|     }                                          |
+------------------------------------------------+
    |
    |
    +----------------------+----------------------+----------------------+
    |                      |                      |                      |
    v                      v                      v                      v

2a. Billing Manager    2b. Webhook Manager   2c. Talk Manager      2d. Agent Manager

+----------------+    +----------------+    +----------------+   +----------------+
| Start billing  |    | Send webhook   |    | Update agent   |   | Update agent   |
| for call       |    | to customer    |    | dashboard      |   | stats          |
|                |    | endpoint       |    | via WebSocket  |   |                |
| • Calculate    |    |                |    |                |   | • Active calls |
|   charges      |    | POST https://  |    | {              |   | • Talk time    |
| • Create       |    | customer.com/  |    |   &quot;event&quot;:     |   | • Status       |
|   billing      |    | webhook        |    |   &quot;call.       |   |                |
|   record       |    |                |    |   answered&quot;,   |   |                |
|                |    | {              |    |   &quot;call_id&quot;:   |   |                |
| INSERT INTO    |    |   &quot;event_type&quot;:|    |   &quot;call-789&quot;   |   |                |
| billings       |    |   &quot;call.       |    | }              |   |                |
| (...)          |    |   answered&quot;,   |    |                |   |                |
|                |    |   ...          |    |                |   |                |
|                |    | }              |    |                |   |                |
+----------------+    +----------------+    +----------------+   +----------------+

All subscribers process event independently and concurrently
</pre></div>
</div>
</section>
<section id="flow-4-complex-multi-service-flow">
<h3>Flow 4: Complex Multi-Service Flow<a class="headerlink" href="#flow-4-complex-multi-service-flow" title="Link to this heading"></a></h3>
<p>This flow demonstrates a complex operation involving multiple services.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Conference Join with Flow Execution:

Client                API Gateway         Flow Manager        Conference Mgr      Call Manager
  |                       |                    |                    |                  |
  |  POST /conferences/   |                    |                    |                  |
  |  conf-123/join        |                    |                    |                  |
  +----------------------&gt;|                    |                    |                  |
  |                       |  Auth + RPC        |                    |                  |
  |                       +-------------------&gt;|                    |                  |
  |                       |                    |                    |                  |
  |                       |                    |  1. Get Conference |                  |
  |                       |                    +-------------------&gt;|                  |
  |                       |                    |                    |  [conf data]     |
  |                       |                    |&lt;-------------------+                  |
  |                       |                    |                    |                  |
  |                       |                    |  2. Get Flow       |                  |
  |                       |                    |  (from conf)       |                  |
  |                       |                    |                    |                  |
  |                       |                    |  3. Execute Flow   |                  |
  |                       |                    |  Actions:          |                  |
  |                       |                    |                    |                  |
  |                       |                    |  Action 1: Answer  |                  |
  |                       |                    +--------------------------------------&gt;|
  |                       |                    |                    |                  |
  |                       |                    |  Action 2: Talk    |                  |
  |                       |                    |  &quot;Welcome to conf&quot; |                  |
  |                       |                    +--------------------------------------&gt;|
  |                       |                    |                    |                  |
  |                       |                    |  Action 3: Join    |                  |
  |                       |                    |  Conference        |                  |
  |                       |                    +-------------------&gt;|                  |
  |                       |                    |                    |  Add participant |
  |                       |                    |                    |  to bridge       |
  |                       |                    |&lt;-------------------+                  |
  |                       |                    |                    |                  |
  |                       |  Response          |                    |                  |
  |                       |&lt;-------------------+                    |                  |
  |  Success              |                    |                    |                  |
  |&lt;----------------------+                    |                    |                  |
  |                       |                    |                    |                  |

Services Involved:
• API Gateway (authentication, routing)
• Flow Manager (orchestration)
• Conference Manager (conference state)
• Call Manager (call handling)
• RTC Manager (not shown, handles SIP/media)

Total Time: ~200ms
• Gateway: 5ms
• Conference lookup: 10ms
• Flow execution: 150ms (multiple actions)
• Conference join: 30ms
• Response: 5ms
</pre></div>
</div>
</section>
<section id="flow-5-real-time-event-notification">
<h3>Flow 5: Real-Time Event Notification<a class="headerlink" href="#flow-5-real-time-event-notification" title="Link to this heading"></a></h3>
<p>This flow shows how real-time events reach clients via WebSocket.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Real-Time Call Status Updates:

1. Client Subscribes:

Client (Browser)        API Gateway (WebSocket)    Backend Services
    |                           |                       |
    |  WebSocket Connect        |                       |
    +--------------------------&gt;|                       |
    |  wss://api.voipbin.net/ws |                       |
    |  ?token=eyJhbGc...        |                       |
    |                           |  Validate JWT         |
    |                           |  → customer_id: 123   |
    |                           |                       |
    |  Subscribe                |                       |
    |  {                        |                       |
    |    &quot;type&quot;: &quot;subscribe&quot;,   |                       |
    |    &quot;topics&quot;: [            |                       |
    |      &quot;customer_id:123:    |                       |
    |       call:*&quot;             |                       |
    |    ]                      |                       |
    |  }                        |                       |
    +--------------------------&gt;|                       |
    |                           |  Register             |
    |                           |  subscription         |
    |                           |                       |
    |  ACK                      |                       |
    |&lt;--------------------------+                       |
    |                           |                       |

2. Event Occurs:

Call Manager                RabbitMQ/ZMQ          API Gateway (WS)      Client
    |                           |                       |                  |
    |  Call status changed      |                       |                  |
    |  (answered)               |                       |                  |
    |                           |                       |                  |
    |  Publish event            |                       |                  |
    +--------------------------&gt;|                       |                  |
    |  {                        |                       |                  |
    |    &quot;event&quot;: &quot;call.        |                       |                  |
    |     answered&quot;,            |                       |                  |
    |    &quot;customer_id&quot;: &quot;123&quot;,  |                       |                  |
    |    &quot;call_id&quot;: &quot;call-789&quot;  |                       |                  |
    |  }                        |                       |                  |
    |                           |                       |                  |
    |                           |  Fanout to            |                  |
    |                           |  subscribers          |                  |
    |                           +----------------------&gt;|                  |
    |                           |                       |  Match topic     |
    |                           |                       |  filter          |
    |                           |                       |                  |
    |                           |                       |  Push to client  |
    |                           |                       +-----------------&gt;|
    |                           |                       |                  |
    |                           |                       |  {               |
    |                           |                       |    &quot;event_type&quot;: |
    |                           |                       |    &quot;call.        |
    |                           |                       |    answered&quot;,    |
    |                           |                       |    &quot;call_id&quot;:    |
    |                           |                       |    &quot;call-789&quot;,   |
    |                           |                       |    &quot;timestamp&quot;:  |
    |                           |                       |    &quot;...&quot;         |
    |                           |                       |  }               |

Latency: &lt; 100ms from event to client notification
</pre></div>
</div>
</section>
<section id="flow-6-error-handling-flow">
<h3>Flow 6: Error Handling Flow<a class="headerlink" href="#flow-6-error-handling-flow" title="Link to this heading"></a></h3>
<p>This flow demonstrates error handling and retry logic.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Failed Request with Retry:

1. Initial Request (Fails):

API Gateway         Call Manager        Database
    |                   |                   |
    |  RPC: Create Call |                   |
    +------------------&gt;|                   |
    |                   |  INSERT INTO      |
    |                   |  calls (...)      |
    |                   +------------------&gt;|
    |                   |                   X  Connection lost
    |                   |                   |
    |                   |  ← Error          |
    |                   |&lt;------------------+
    |                   |                   |
    |                   |  Retry (1s delay) |
    |                   |                   |

2. Automatic Retry (Attempt 2):

    |                   |  Reconnect        |
    |                   +------------------&gt;|
    |                   |                   |
    |                   |  INSERT INTO      |
    |                   |  calls (...)      |
    |                   +------------------&gt;|
    |                   |                   ✓  Success
    |                   |                   |
    |                   |  Success          |
    |                   |&lt;------------------+
    |                   |                   |
    |  Success          |                   |
    |&lt;------------------+                   |
    |                   |                   |

3. Permanent Error (No Retry):

API Gateway         Call Manager        Billing Manager
    |                   |                   |
    |  RPC: Create Call |                   |
    +------------------&gt;|                   |
    |                   |  Check balance    |
    |                   +------------------&gt;|
    |                   |                   |
    |                   |  Insufficient     |
    |                   |  balance          |
    |                   |&lt;------------------+
    |                   |                   |
    |  Error 402        |  Don&#39;t retry      |
    |  Payment Required |  (permanent error)|
    |&lt;------------------+                   |
    |                   |                   |

Error Categories:
• Transient → Retry (network, timeout, connection)
• Permanent → Don&#39;t retry (invalid data, permissions)
• Business → Return error (insufficient balance)
</pre></div>
</div>
</section>
<section id="id7">
<h3>Performance Optimization<a class="headerlink" href="#id7" title="Link to this heading"></a></h3>
<p>VoIPBIN optimizes flow performance through several techniques:</p>
<p><strong>Parallel Processing</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Sequential</span> <span class="n">vs</span> <span class="n">Parallel</span><span class="p">:</span>

<span class="n">Sequential</span> <span class="p">(</span><span class="n">Slow</span><span class="p">):</span>           <span class="n">Parallel</span> <span class="p">(</span><span class="n">Fast</span><span class="p">):</span>
<span class="o">+----------+</span>                 <span class="o">+----------+</span>
<span class="o">|</span> <span class="n">Task</span> <span class="n">A</span>   <span class="o">|</span> <span class="mi">50</span><span class="n">ms</span>            <span class="o">|</span> <span class="n">Task</span> <span class="n">A</span>   <span class="o">|</span> <span class="mi">50</span><span class="n">ms</span>
<span class="o">+----+-----+</span>                 <span class="o">+----+-----+</span>
     <span class="o">|</span>                            <span class="o">|</span>
     <span class="n">v</span>                            <span class="o">|</span>
<span class="o">+----------+</span>                      <span class="o">|</span>
<span class="o">|</span> <span class="n">Task</span> <span class="n">B</span>   <span class="o">|</span> <span class="mi">50</span><span class="n">ms</span>                 <span class="o">+-------------+</span>
<span class="o">+----+-----+</span>                      <span class="o">|</span>             <span class="o">|</span>
     <span class="o">|</span>                            <span class="n">v</span>             <span class="n">v</span>
     <span class="n">v</span>                        <span class="o">+----------+</span> <span class="o">+----------+</span>
<span class="o">+----------+</span>                  <span class="o">|</span> <span class="n">Task</span> <span class="n">B</span>   <span class="o">|</span> <span class="o">|</span> <span class="n">Task</span> <span class="n">C</span>   <span class="o">|</span>
<span class="o">|</span> <span class="n">Task</span> <span class="n">C</span>   <span class="o">|</span> <span class="mi">50</span><span class="n">ms</span>             <span class="o">|</span> <span class="mi">50</span><span class="n">ms</span>     <span class="o">|</span> <span class="o">|</span> <span class="mi">50</span><span class="n">ms</span>     <span class="o">|</span>
<span class="o">+----------+</span>                  <span class="o">+----------+</span> <span class="o">+----------+</span>

<span class="n">Total</span><span class="p">:</span> <span class="mi">150</span><span class="n">ms</span>                 <span class="n">Total</span><span class="p">:</span> <span class="mi">50</span><span class="n">ms</span> <span class="p">(</span><span class="mi">3</span><span class="n">x</span> <span class="n">faster</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Caching Strategy</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Without Cache:               With Cache:
Every request → DB           First request → DB
Query time: 10ms             Query time: 10ms
                             Cache for 5 minutes

                             Subsequent requests → Cache
                             Query time: 2ms

1000 requests = 10s          1000 requests = 2s (5x faster)
</pre></div>
</div>
<p><strong>Connection Pooling</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>No Pooling:                  With Pooling:
Each request:                Each request:
• Connect: 20ms              • Get from pool: 1ms
• Query: 10ms                • Query: 10ms
• Disconnect: 5ms            • Return to pool: 1ms
Total: 35ms                  Total: 12ms (3x faster)
</pre></div>
</div>
</section>
<section id="best-practices-for-developers">
<h3>Best Practices for Developers<a class="headerlink" href="#best-practices-for-developers" title="Link to this heading"></a></h3>
<p><strong>When Integrating with VoIPBIN:</strong></p>
<ol class="arabic simple">
<li><p><strong>Always Include Authentication</strong>
- Include JWT token in Authorization header
- Handle 401 responses (refresh token)</p></li>
<li><p><strong>Handle Asynchronous Operations</strong>
- Many operations are asynchronous
- Use webhooks or WebSocket for notifications
- Poll with reasonable intervals if needed</p></li>
<li><p><strong>Implement Retry Logic</strong>
- Retry on 5xx errors
- Use exponential backoff
- Don’t retry on 4xx errors</p></li>
<li><p><strong>Subscribe to Events</strong>
- Use WebSocket for real-time updates
- Configure webhooks for important events
- Handle duplicate events gracefully</p></li>
<li><p><strong>Optimize Requests</strong>
- Use pagination for lists
- Request only needed fields
- Cache responses when appropriate</p></li>
<li><p><strong>Monitor Performance</strong>
- Track response times
- Alert on high error rates
- Monitor webhook delivery</p></li>
</ol>
</section>
<section id="debugging-request-flows">
<h3>Debugging Request Flows<a class="headerlink" href="#debugging-request-flows" title="Link to this heading"></a></h3>
<p><strong>Using Correlation IDs:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span> <span class="n">Tracing</span><span class="p">:</span>

<span class="mf">1.</span> <span class="n">Client</span> <span class="n">sends</span> <span class="n">request</span> <span class="k">with</span> <span class="n">X</span><span class="o">-</span><span class="n">Request</span><span class="o">-</span><span class="n">ID</span> <span class="n">header</span><span class="p">:</span>
   <span class="n">POST</span> <span class="o">/</span><span class="n">v1</span><span class="mf">.0</span><span class="o">/</span><span class="n">calls</span>
   <span class="n">X</span><span class="o">-</span><span class="n">Request</span><span class="o">-</span><span class="n">ID</span><span class="p">:</span> <span class="n">req</span><span class="o">-</span><span class="n">abc</span><span class="o">-</span><span class="mi">123</span>

<span class="mf">2.</span> <span class="n">API</span> <span class="n">Gateway</span> <span class="n">logs</span><span class="p">:</span>
   <span class="p">[</span><span class="n">req</span><span class="o">-</span><span class="n">abc</span><span class="o">-</span><span class="mi">123</span><span class="p">]</span> <span class="n">Authenticated</span> <span class="n">customer</span><span class="o">-</span><span class="mi">123</span>
   <span class="p">[</span><span class="n">req</span><span class="o">-</span><span class="n">abc</span><span class="o">-</span><span class="mi">123</span><span class="p">]</span> <span class="n">Sending</span> <span class="n">RPC</span> <span class="n">to</span> <span class="n">call</span><span class="o">-</span><span class="n">manager</span>

<span class="mf">3.</span> <span class="n">Call</span> <span class="n">Manager</span> <span class="n">logs</span><span class="p">:</span>
   <span class="p">[</span><span class="n">req</span><span class="o">-</span><span class="n">abc</span><span class="o">-</span><span class="mi">123</span><span class="p">]</span> <span class="n">Creating</span> <span class="n">call</span> <span class="n">record</span>
   <span class="p">[</span><span class="n">req</span><span class="o">-</span><span class="n">abc</span><span class="o">-</span><span class="mi">123</span><span class="p">]</span> <span class="n">Call</span> <span class="n">created</span><span class="p">:</span> <span class="n">call</span><span class="o">-</span><span class="mi">789</span>

<span class="mf">4.</span> <span class="n">Search</span> <span class="n">logs</span> <span class="n">by</span> <span class="n">correlation</span> <span class="n">ID</span> <span class="n">to</span> <span class="n">trace</span> <span class="n">full</span> <span class="n">flow</span>
</pre></div>
</div>
<p><strong>Common Issues:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Issue: 401 Unauthorized
→ Check JWT token validity
→ Ensure token not expired
→ Verify customer_id matches resource

Issue: 404 Not Found
→ May be authorization failure (returns 404 for security)
→ Check customer_id ownership
→ Verify resource exists

Issue: 500 Internal Server Error
→ Backend service error
→ Check logs with correlation ID
→ May require retry

Issue: Slow Response
→ Check cache hit rate
→ Review database query performance
→ Monitor service health
</pre></div>
</div>
</section>
<section id="summary">
<h3>Summary<a class="headerlink" href="#summary" title="Link to this heading"></a></h3>
<p>VoIPBIN’s request flows are designed for:</p>
<ul class="simple">
<li><p><strong>Performance</strong>: Caching, connection pooling, parallel processing</p></li>
<li><p><strong>Reliability</strong>: Retry logic, circuit breakers, health checks</p></li>
<li><p><strong>Scalability</strong>: Stateless services, horizontal scaling, queue-based communication</p></li>
<li><p><strong>Observability</strong>: Correlation IDs, distributed tracing, comprehensive logging</p></li>
<li><p><strong>Security</strong>: Gateway authentication, authorization checks, encrypted communication</p></li>
</ul>
<p>Understanding these flows helps developers build efficient integrations and troubleshoot issues effectively.</p>
</section>
</section>
<section id="call-flow-sequences">
<span id="architecture-sequences"></span><h2>Call Flow Sequences<a class="headerlink" href="#call-flow-sequences" title="Link to this heading"></a></h2>
<p>This section provides detailed sequence diagrams for VoIPBIN’s core call flows, showing how components interact during real-world scenarios.</p>
<section id="inbound-call-flow">
<h3>Inbound Call Flow<a class="headerlink" href="#inbound-call-flow" title="Link to this heading"></a></h3>
<p>When an external caller dials a VoIPBIN number, the following sequence occurs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Inbound</span> <span class="n">Call</span> <span class="n">Flow</span><span class="p">:</span>

<span class="n">PSTN</span> <span class="n">Carrier</span>    <span class="n">Kamailio</span>     <span class="n">Asterisk</span>    <span class="n">asterisk</span><span class="o">-</span><span class="n">proxy</span>   <span class="n">call</span><span class="o">-</span><span class="n">manager</span>    <span class="n">flow</span><span class="o">-</span><span class="n">manager</span>
     <span class="o">|</span>             <span class="o">|</span>            <span class="o">|</span>              <span class="o">|</span>                <span class="o">|</span>               <span class="o">|</span>
     <span class="o">|</span>  <span class="n">SIP</span> <span class="n">INVITE</span> <span class="o">|</span>            <span class="o">|</span>              <span class="o">|</span>                <span class="o">|</span>               <span class="o">|</span>
     <span class="o">+------------&gt;|</span>            <span class="o">|</span>              <span class="o">|</span>                <span class="o">|</span>               <span class="o">|</span>
     <span class="o">|</span>             <span class="o">|</span> <span class="n">Route</span>      <span class="o">|</span>              <span class="o">|</span>                <span class="o">|</span>               <span class="o">|</span>
     <span class="o">|</span>             <span class="o">+-----------&gt;|</span>              <span class="o">|</span>                <span class="o">|</span>               <span class="o">|</span>
     <span class="o">|</span>             <span class="o">|</span>            <span class="o">|</span> <span class="n">Channel</span>      <span class="o">|</span>                <span class="o">|</span>               <span class="o">|</span>
     <span class="o">|</span>             <span class="o">|</span>            <span class="o">|</span> <span class="n">Created</span>      <span class="o">|</span>                <span class="o">|</span>               <span class="o">|</span>
     <span class="o">|</span>             <span class="o">|</span>            <span class="o">+-------------&gt;|</span>                <span class="o">|</span>               <span class="o">|</span>
     <span class="o">|</span>             <span class="o">|</span>            <span class="o">|</span>              <span class="o">|</span> <span class="n">Publish</span><span class="p">:</span>       <span class="o">|</span>               <span class="o">|</span>
     <span class="o">|</span>             <span class="o">|</span>            <span class="o">|</span>              <span class="o">|</span> <span class="n">asterisk</span><span class="o">.</span><span class="n">all</span><span class="o">.</span><span class="n">event</span>             <span class="o">|</span>
     <span class="o">|</span>             <span class="o">|</span>            <span class="o">|</span>              <span class="o">+---------------&gt;|</span>               <span class="o">|</span>
     <span class="o">|</span>             <span class="o">|</span>            <span class="o">|</span>              <span class="o">|</span>                <span class="o">|</span>               <span class="o">|</span>
     <span class="o">|</span>             <span class="o">|</span>            <span class="o">|</span>              <span class="o">|</span>                <span class="o">|</span> <span class="n">Create</span> <span class="n">Call</span>   <span class="o">|</span>
     <span class="o">|</span>             <span class="o">|</span>            <span class="o">|</span>              <span class="o">|</span>                <span class="o">|</span> <span class="n">Record</span>        <span class="o">|</span>
     <span class="o">|</span>             <span class="o">|</span>            <span class="o">|</span>              <span class="o">|</span>                <span class="o">|</span>               <span class="o">|</span>
     <span class="o">|</span>             <span class="o">|</span>            <span class="o">|</span>              <span class="o">|</span>                <span class="o">|</span> <span class="n">Lookup</span> <span class="n">Number</span> <span class="o">|</span>
     <span class="o">|</span>             <span class="o">|</span>            <span class="o">|</span>              <span class="o">|</span>                <span class="o">|</span> <span class="o">-&gt;</span> <span class="n">Flow</span> <span class="n">ID</span>    <span class="o">|</span>
     <span class="o">|</span>             <span class="o">|</span>            <span class="o">|</span>              <span class="o">|</span>                <span class="o">|</span>               <span class="o">|</span>
     <span class="o">|</span>             <span class="o">|</span>            <span class="o">|</span>              <span class="o">|</span>                <span class="o">|</span> <span class="n">RPC</span><span class="p">:</span> <span class="n">Start</span>    <span class="o">|</span>
     <span class="o">|</span>             <span class="o">|</span>            <span class="o">|</span>              <span class="o">|</span>                <span class="o">|</span> <span class="n">ActiveFlow</span>    <span class="o">|</span>
     <span class="o">|</span>             <span class="o">|</span>            <span class="o">|</span>              <span class="o">|</span>                <span class="o">+--------------&gt;|</span>
     <span class="o">|</span>             <span class="o">|</span>            <span class="o">|</span>              <span class="o">|</span>                <span class="o">|</span>               <span class="o">|</span>
     <span class="o">|</span>             <span class="o">|</span>            <span class="o">|</span>              <span class="o">|</span>                <span class="o">|</span>               <span class="o">|</span> <span class="n">Execute</span>
     <span class="o">|</span>             <span class="o">|</span>            <span class="o">|</span>              <span class="o">|</span>                <span class="o">|</span>               <span class="o">|</span> <span class="n">Actions</span>
     <span class="o">|</span>             <span class="o">|</span>            <span class="o">|</span>              <span class="o">|</span>                <span class="o">|</span>               <span class="o">|</span>
     <span class="o">|</span>             <span class="o">|</span>            <span class="o">|</span>              <span class="o">|</span>  <span class="n">RPC</span><span class="p">:</span> <span class="n">Answer</span>   <span class="o">|</span>               <span class="o">|</span>
     <span class="o">|</span>             <span class="o">|</span>            <span class="o">|&lt;-----------------------------------+----------+</span>
     <span class="o">|</span>             <span class="o">|</span>            <span class="o">|</span>              <span class="o">|</span>                <span class="o">|</span>               <span class="o">|</span>
     <span class="o">|</span>  <span class="mi">200</span> <span class="n">OK</span>     <span class="o">|</span>            <span class="o">|</span>              <span class="o">|</span>                <span class="o">|</span>               <span class="o">|</span>
     <span class="o">|&lt;------------+------------+</span>              <span class="o">|</span>                <span class="o">|</span>               <span class="o">|</span>
     <span class="o">|</span>             <span class="o">|</span>            <span class="o">|</span>              <span class="o">|</span>                <span class="o">|</span>               <span class="o">|</span>
     <span class="o">|</span>   <span class="n">RTP</span> <span class="n">Media</span> <span class="n">Established</span>  <span class="o">|</span>              <span class="o">|</span>                <span class="o">|</span>               <span class="o">|</span>
     <span class="o">|&lt;------------------------&gt;|</span>              <span class="o">|</span>                <span class="o">|</span>               <span class="o">|</span>
     <span class="o">|</span>             <span class="o">|</span>            <span class="o">|</span>              <span class="o">|</span>                <span class="o">|</span>               <span class="o">|</span>
</pre></div>
</div>
<p><strong>Key Components:</strong></p>
<ol class="arabic simple">
<li><p><strong>Kamailio</strong> - Receives SIP INVITE, routes to appropriate Asterisk instance</p></li>
<li><p><strong>Asterisk</strong> - Creates SIP channel, generates ARI events via ARI WebSocket</p></li>
<li><p><strong>asterisk-proxy</strong> - Bridges ARI events to RabbitMQ (<code class="docutils literal notranslate"><span class="pre">asterisk.all.event</span></code> queue)</p></li>
<li><p><strong>call-manager</strong> - Processes events, creates call record, initiates flow</p></li>
<li><p><strong>flow-manager</strong> - Executes the configured call flow (IVR actions)</p></li>
</ol>
<p><strong>Event Routing in call-manager:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">asterisk</span><span class="o">-</span><span class="n">proxy</span> <span class="n">Event</span> <span class="n">Routing</span><span class="p">:</span>

<span class="n">asterisk</span><span class="o">.</span><span class="n">all</span><span class="o">.</span><span class="n">event</span>
      <span class="o">|</span>
      <span class="n">v</span>
<span class="o">+------------------+</span>
<span class="o">|</span> <span class="n">subscribehandler</span> <span class="o">|</span>
<span class="o">+--------+---------+</span>
         <span class="o">|</span>
         <span class="o">|</span> <span class="n">Routes</span> <span class="n">by</span> <span class="n">event</span> <span class="nb">type</span>
         <span class="n">v</span>
<span class="o">+------------------+</span>
<span class="o">|</span> <span class="n">arieventhandler</span>  <span class="o">|</span>
<span class="o">+--------+---------+</span>
         <span class="o">|</span>
 <span class="o">+-------+-------+</span>
 <span class="o">|</span>               <span class="o">|</span>
 <span class="n">v</span>               <span class="n">v</span>
<span class="o">+----------+</span> <span class="o">+----------+</span>
<span class="o">|</span><span class="n">channelhdl</span><span class="o">|</span> <span class="o">|</span><span class="n">bridgehdl</span> <span class="o">|</span>
<span class="o">+----------+</span> <span class="o">+----------+</span>
     <span class="o">|</span>            <span class="o">|</span>
     <span class="n">v</span>            <span class="n">v</span>
<span class="n">Channel</span>      <span class="n">Bridge</span>
<span class="n">Events</span>       <span class="n">Events</span>
<span class="p">(</span><span class="n">create</span><span class="p">,</span>     <span class="p">(</span><span class="n">join</span><span class="p">,</span>
<span class="n">hangup</span><span class="p">,</span>      <span class="n">leave</span><span class="p">)</span>
<span class="n">dtmf</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Channel Events:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">StasisStart</span></code> - Channel enters Stasis application (call starts)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">StasisEnd</span></code> - Channel exits Stasis (call ends)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ChannelDtmfReceived</span></code> - DTMF digit pressed</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ChannelHangupRequest</span></code> - Hangup initiated</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ChannelStateChange</span></code> - Channel state changed (ringing, up, etc.)</p></li>
</ul>
<p><strong>Bridge Events:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ChannelEnteredBridge</span></code> - Participant joined bridge (conference)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ChannelLeftBridge</span></code> - Participant left bridge</p></li>
</ul>
</section>
<section id="outbound-campaign-flow">
<h3>Outbound Campaign Flow<a class="headerlink" href="#outbound-campaign-flow" title="Link to this heading"></a></h3>
<p>Outbound campaigns automate calling lists of targets:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Campaign Execution Flow:

API Request    campaign-mgr    outdial-mgr    call-manager    flow-manager
     |             |               |               |               |
     | Start       |               |               |               |
     | Campaign    |               |               |               |
     +------------&gt;|               |               |               |
     |             |               |               |               |
     |             | Get Targets   |               |               |
     |             | (Outplan)     |               |               |
     |             +--------------&gt;|               |               |
     |             |               |               |               |
     |             |&lt;--------------+               |               |
     |             | Dial Targets  |               |               |
     |             |               |               |               |
     |             | For each target:              |               |
     |             +------------------------------------------+    |
     |             |               |               |          |    |
     |             | RPC: Create   |               |          |    |
     |             | Outbound Call |               |          |    |
     |             +------------------------------&gt;|          |    |
     |             |               |               |          |    |
     |             |               |               | Asterisk |    |
     |             |               |               | Originate|    |
     |             |               |               +---------&gt;|    |
     |             |               |               |          |    |
     |             |               |               | Answer?  |    |
     |             |               |               |&lt;---------+    |
     |             |               |               |          |    |
     |             |               |               | If answered:  |
     |             |               |               | Start Flow    |
     |             |               |               +--------------&gt;|
     |             |               |               |               |
     |             |               |               |               | Execute
     |             |               |               |               | Actions
     |             |               |               |               | (play,
     |             |               |               |               |  gather,
     |             |               |               |               |  ai_talk)
     |             |               |               |               |
     |             | Event:        |               |               |
     |             | call_hungup   |               |               |
     |             |&lt;------------------------------+               |
     |             |               |               |               |
     |             | Update        |               |               |
     |             | Campaign      |               |               |
     |             | Status        |               |               |
     |             +------------------------------------------+    |
     |             |                                               |
     |             | Continue with next target...                  |
     |             |                                               |
</pre></div>
</div>
<p><strong>Campaign Components:</strong></p>
<ul class="simple">
<li><p><strong>campaign-manager</strong> - Orchestrates campaign execution, tracks progress</p></li>
<li><p><strong>outdial-manager</strong> - Manages dial targets (outplans), provides next numbers to dial</p></li>
<li><p><strong>call-manager</strong> - Creates and manages individual calls</p></li>
<li><p><strong>flow-manager</strong> - Executes call flow when target answers</p></li>
</ul>
<p><strong>Campaign Events:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Event</span> <span class="n">Subscriptions</span><span class="p">:</span>

<span class="n">campaign</span><span class="o">-</span><span class="n">manager</span> <span class="n">subscribes</span> <span class="n">to</span><span class="p">:</span>
<span class="o">+--------------------------------+</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">call_hungup</span>                  <span class="o">|</span> <span class="o">-</span> <span class="n">Track</span> <span class="n">call</span> <span class="n">completion</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">activeflow_deleted</span>           <span class="o">|</span> <span class="o">-</span> <span class="n">Track</span> <span class="n">flow</span> <span class="n">completion</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">call_answered</span>                <span class="o">|</span> <span class="o">-</span> <span class="n">Track</span> <span class="n">answer</span> <span class="n">rates</span>
<span class="o">+--------------------------------+</span>

<span class="n">Event</span> <span class="n">triggers</span> <span class="n">campaign</span> <span class="n">state</span> <span class="n">updates</span><span class="p">:</span>
<span class="n">o</span> <span class="n">Calculate</span> <span class="n">dial</span> <span class="n">success</span> <span class="n">rate</span>
<span class="n">o</span> <span class="n">Move</span> <span class="n">to</span> <span class="nb">next</span> <span class="n">target</span>
<span class="n">o</span> <span class="n">Update</span> <span class="n">campaign</span> <span class="n">statistics</span>
</pre></div>
</div>
</section>
<section id="ai-voice-assistant-flow-pipecat">
<h3>AI Voice Assistant Flow (Pipecat)<a class="headerlink" href="#ai-voice-assistant-flow-pipecat" title="Link to this heading"></a></h3>
<p>VoIPBIN’s AI voice assistant uses a hybrid Go+Python architecture:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Pipecat</span> <span class="n">AI</span> <span class="n">Voice</span> <span class="n">Architecture</span><span class="p">:</span>

<span class="n">Asterisk</span>        <span class="n">pipecat</span><span class="o">-</span><span class="n">manager</span> <span class="p">(</span><span class="n">Go</span><span class="p">)</span>      <span class="n">pipecat</span><span class="o">-</span><span class="n">runner</span> <span class="p">(</span><span class="n">Python</span><span class="p">)</span>      <span class="n">LLM</span>
   <span class="o">|</span>                   <span class="o">|</span>                          <span class="o">|</span>                     <span class="o">|</span>
   <span class="o">|</span>                   <span class="o">|</span>                          <span class="o">|</span>                     <span class="o">|</span>
   <span class="o">|</span>  <span class="n">Audiosocket</span>      <span class="o">|</span>                          <span class="o">|</span>                     <span class="o">|</span>
   <span class="o">|</span>  <span class="p">(</span><span class="mi">8</span><span class="n">kHz</span> <span class="n">ulaw</span><span class="p">)</span>      <span class="o">|</span>                          <span class="o">|</span>                     <span class="o">|</span>
   <span class="o">+------------------&gt;|</span>                          <span class="o">|</span>                     <span class="o">|</span>
   <span class="o">|</span>                   <span class="o">|</span>                          <span class="o">|</span>                     <span class="o">|</span>
   <span class="o">|</span>                   <span class="o">|</span> <span class="n">WebSocket</span>                <span class="o">|</span>                     <span class="o">|</span>
   <span class="o">|</span>                   <span class="o">|</span> <span class="p">(</span><span class="mi">16</span><span class="n">kHz</span> <span class="n">PCM</span><span class="p">)</span>              <span class="o">|</span>                     <span class="o">|</span>
   <span class="o">|</span>                   <span class="o">+-------------------------&gt;|</span>                     <span class="o">|</span>
   <span class="o">|</span>                   <span class="o">|</span>                          <span class="o">|</span>                     <span class="o">|</span>
   <span class="o">|</span>                   <span class="o">|</span>                          <span class="o">|</span> <span class="n">STT</span><span class="p">:</span> <span class="n">Deepgram</span>       <span class="o">|</span>
   <span class="o">|</span>                   <span class="o">|</span>                          <span class="o">|</span> <span class="s2">&quot;What&#39;s the weather?&quot;</span><span class="o">|</span>
   <span class="o">|</span>                   <span class="o">|</span>                          <span class="o">+--------------------&gt;|</span>
   <span class="o">|</span>                   <span class="o">|</span>                          <span class="o">|</span>                     <span class="o">|</span>
   <span class="o">|</span>                   <span class="o">|</span>                          <span class="o">|&lt;--------------------+</span>
   <span class="o">|</span>                   <span class="o">|</span>                          <span class="o">|</span> <span class="n">LLM</span> <span class="n">Response</span>        <span class="o">|</span>
   <span class="o">|</span>                   <span class="o">|</span>                          <span class="o">|</span>                     <span class="o">|</span>
   <span class="o">|</span>                   <span class="o">|</span>                          <span class="o">|</span> <span class="n">TTS</span><span class="p">:</span> <span class="n">Generate</span> <span class="n">Audio</span> <span class="o">|</span>
   <span class="o">|</span>                   <span class="o">|</span>                          <span class="o">|</span>                     <span class="o">|</span>
   <span class="o">|</span>                   <span class="o">|&lt;-------------------------+</span>                     <span class="o">|</span>
   <span class="o">|</span>                   <span class="o">|</span> <span class="n">Audio</span> <span class="n">Response</span>           <span class="o">|</span>                     <span class="o">|</span>
   <span class="o">|</span>                   <span class="o">|</span>                          <span class="o">|</span>                     <span class="o">|</span>
   <span class="o">|&lt;------------------+</span>                          <span class="o">|</span>                     <span class="o">|</span>
   <span class="o">|</span> <span class="n">Play</span> <span class="n">to</span> <span class="n">Caller</span>    <span class="o">|</span>                          <span class="o">|</span>                     <span class="o">|</span>
   <span class="o">|</span>                   <span class="o">|</span>                          <span class="o">|</span>                     <span class="o">|</span>
</pre></div>
</div>
<p><strong>Audio Processing Pipeline:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Audio</span> <span class="n">Resampling</span><span class="p">:</span>

<span class="n">Asterisk</span>                 <span class="n">pipecat</span><span class="o">-</span><span class="n">manager</span>               <span class="n">pipecat</span><span class="o">-</span><span class="n">runner</span>
<span class="p">(</span><span class="mi">8</span><span class="n">kHz</span> <span class="n">ulaw</span><span class="p">)</span>             <span class="p">(</span><span class="n">Go</span> <span class="n">Resampler</span><span class="p">)</span>                <span class="p">(</span><span class="mi">16</span><span class="n">kHz</span> <span class="n">PCM</span><span class="p">)</span>
    <span class="o">|</span>                        <span class="o">|</span>                             <span class="o">|</span>
    <span class="o">|</span> <span class="n">Audiosocket</span>           <span class="o">|</span>                             <span class="o">|</span>
    <span class="o">|</span> <span class="p">(</span><span class="mi">8</span><span class="n">kHz</span> <span class="n">ulaw</span><span class="p">)</span>           <span class="o">|</span>                             <span class="o">|</span>
    <span class="o">+----------------------&gt;|</span>                             <span class="o">|</span>
    <span class="o">|</span>                       <span class="o">|</span>                             <span class="o">|</span>
    <span class="o">|</span>                       <span class="o">|</span> <span class="n">Resample</span>                    <span class="o">|</span>
    <span class="o">|</span>                       <span class="o">|</span> <span class="mi">8</span><span class="n">kHz</span> <span class="o">-&gt;</span> <span class="mi">16</span><span class="n">kHz</span>               <span class="o">|</span>
    <span class="o">|</span>                       <span class="o">|</span> <span class="n">ulaw</span> <span class="o">-&gt;</span> <span class="n">PCM</span>                 <span class="o">|</span>
    <span class="o">|</span>                       <span class="o">|</span>                             <span class="o">|</span>
    <span class="o">|</span>                       <span class="o">|</span> <span class="n">WebSocket</span>                   <span class="o">|</span>
    <span class="o">|</span>                       <span class="o">|</span> <span class="p">(</span><span class="n">Protobuf</span> <span class="n">frame</span><span class="p">)</span>            <span class="o">|</span>
    <span class="o">|</span>                       <span class="o">+----------------------------&gt;|</span>
    <span class="o">|</span>                       <span class="o">|</span>                             <span class="o">|</span>
    <span class="o">|</span>                       <span class="o">|</span> <span class="n">WebSocket</span>                   <span class="o">|</span>
    <span class="o">|</span>                       <span class="o">|</span> <span class="p">(</span><span class="n">Protobuf</span> <span class="n">response</span><span class="p">)</span>         <span class="o">|</span>
    <span class="o">|</span>                       <span class="o">|&lt;----------------------------+</span>
    <span class="o">|</span>                       <span class="o">|</span>                             <span class="o">|</span>
    <span class="o">|</span>                       <span class="o">|</span> <span class="n">Resample</span>                    <span class="o">|</span>
    <span class="o">|</span>                       <span class="o">|</span> <span class="mi">16</span><span class="n">kHz</span> <span class="o">-&gt;</span> <span class="mi">8</span><span class="n">kHz</span>               <span class="o">|</span>
    <span class="o">|</span>                       <span class="o">|</span> <span class="n">PCM</span> <span class="o">-&gt;</span> <span class="n">ulaw</span>                 <span class="o">|</span>
    <span class="o">|</span>                       <span class="o">|</span>                             <span class="o">|</span>
    <span class="o">|&lt;----------------------+</span>                             <span class="o">|</span>
    <span class="o">|</span> <span class="n">Audiosocket</span>           <span class="o">|</span>                             <span class="o">|</span>
    <span class="o">|</span> <span class="p">(</span><span class="mi">8</span><span class="n">kHz</span> <span class="n">ulaw</span><span class="p">)</span>           <span class="o">|</span>                             <span class="o">|</span>
    <span class="o">|</span>                       <span class="o">|</span>                             <span class="o">|</span>
</pre></div>
</div>
<p><strong>Why Hybrid Architecture:</strong></p>
<ul class="simple">
<li><p><strong>Go (pipecat-manager)</strong>: Efficient audio handling, low-latency resampling, integration with VoIPBIN RPC</p></li>
<li><p><strong>Python (pipecat-runner)</strong>: Rich AI/ML ecosystem, Pipecat framework, easy LLM integration</p></li>
</ul>
<p><strong>Protobuf Frame Format:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Frame</span> <span class="n">Message</span><span class="p">:</span>
<span class="o">+----------------------------------+</span>
<span class="o">|</span> <span class="nb">type</span><span class="p">:</span> <span class="n">FrameType</span>                  <span class="o">|</span>
<span class="o">|</span>   <span class="n">o</span> <span class="n">INPUT_AUDIO_RAW</span> <span class="p">(</span><span class="mi">16</span><span class="n">kHz</span> <span class="n">PCM</span><span class="p">)</span>  <span class="o">|</span>
<span class="o">|</span>   <span class="n">o</span> <span class="n">OUTPUT_AUDIO_RAW</span>             <span class="o">|</span>
<span class="o">|</span>   <span class="n">o</span> <span class="n">CONTROL</span> <span class="p">(</span><span class="n">start</span><span class="o">/</span><span class="n">stop</span><span class="p">)</span>         <span class="o">|</span>
<span class="o">|</span>   <span class="n">o</span> <span class="n">LLM_FUNCTION_CALL</span>            <span class="o">|</span>
<span class="o">|</span>   <span class="n">o</span> <span class="n">LLM_FUNCTION_CALL_RESULT</span>     <span class="o">|</span>
<span class="o">+----------------------------------+</span>
<span class="o">|</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span> <span class="p">(</span><span class="n">audio</span> <span class="n">samples</span><span class="p">)</span>      <span class="o">|</span>
<span class="o">+----------------------------------+</span>
<span class="o">|</span> <span class="n">timestamp</span><span class="p">:</span> <span class="n">int64</span>                 <span class="o">|</span>
<span class="o">+----------------------------------+</span>
</pre></div>
</div>
<p><strong>LLM Tool Calling:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Tool</span> <span class="n">Call</span> <span class="n">Flow</span><span class="p">:</span>

<span class="n">LLM</span>                    <span class="n">pipecat</span><span class="o">-</span><span class="n">runner</span>          <span class="n">pipecat</span><span class="o">-</span><span class="n">manager</span>        <span class="n">External</span> <span class="n">API</span>
 <span class="o">|</span>                          <span class="o">|</span>                        <span class="o">|</span>                    <span class="o">|</span>
 <span class="o">|</span> <span class="s2">&quot;Transfer to sales&quot;</span>      <span class="o">|</span>                        <span class="o">|</span>                    <span class="o">|</span>
 <span class="o">+-------------------------&gt;|</span>                        <span class="o">|</span>                    <span class="o">|</span>
 <span class="o">|</span>                          <span class="o">|</span>                        <span class="o">|</span>                    <span class="o">|</span>
 <span class="o">|</span>                          <span class="o">|</span> <span class="n">Frame</span><span class="p">:</span> <span class="n">LLM_FUNCTION_CALL</span>                    <span class="o">|</span>
 <span class="o">|</span>                          <span class="o">|</span> <span class="n">tool</span><span class="p">:</span> <span class="s2">&quot;transfer_call&quot;</span>  <span class="o">|</span>                    <span class="o">|</span>
 <span class="o">|</span>                          <span class="o">|</span> <span class="n">args</span><span class="p">:</span> <span class="p">{</span><span class="n">dept</span><span class="p">:</span> <span class="s2">&quot;sales&quot;</span><span class="p">}</span>  <span class="o">|</span>                    <span class="o">|</span>
 <span class="o">|</span>                          <span class="o">+-----------------------&gt;|</span>                    <span class="o">|</span>
 <span class="o">|</span>                          <span class="o">|</span>                        <span class="o">|</span>                    <span class="o">|</span>
 <span class="o">|</span>                          <span class="o">|</span>                        <span class="o">|</span> <span class="n">RPC</span><span class="p">:</span> <span class="n">Transfer</span>      <span class="o">|</span>
 <span class="o">|</span>                          <span class="o">|</span>                        <span class="o">|</span> <span class="n">Call</span>               <span class="o">|</span>
 <span class="o">|</span>                          <span class="o">|</span>                        <span class="o">+-------------------&gt;|</span>
 <span class="o">|</span>                          <span class="o">|</span>                        <span class="o">|</span>                    <span class="o">|</span>
 <span class="o">|</span>                          <span class="o">|</span>                        <span class="o">|&lt;-------------------+</span>
 <span class="o">|</span>                          <span class="o">|</span>                        <span class="o">|</span> <span class="n">Success</span>            <span class="o">|</span>
 <span class="o">|</span>                          <span class="o">|</span>                        <span class="o">|</span>                    <span class="o">|</span>
 <span class="o">|</span>                          <span class="o">|</span> <span class="n">Frame</span><span class="p">:</span> <span class="n">FUNCTION_CALL_RESULT</span>                 <span class="o">|</span>
 <span class="o">|</span>                          <span class="o">|</span> <span class="n">result</span><span class="p">:</span> <span class="s2">&quot;transferred&quot;</span>  <span class="o">|</span>                    <span class="o">|</span>
 <span class="o">|</span>                          <span class="o">|&lt;-----------------------+</span>                    <span class="o">|</span>
 <span class="o">|</span>                          <span class="o">|</span>                        <span class="o">|</span>                    <span class="o">|</span>
 <span class="o">|&lt;-------------------------+</span>                        <span class="o">|</span>                    <span class="o">|</span>
 <span class="o">|</span> <span class="s2">&quot;Transferred to sales&quot;</span>   <span class="o">|</span>                        <span class="o">|</span>                    <span class="o">|</span>
 <span class="o">|</span>                          <span class="o">|</span>                        <span class="o">|</span>                    <span class="o">|</span>
</pre></div>
</div>
<p><strong>Available AI Tools:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">transfer_call</span></code> - Transfer to another extension/queue</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">end_call</span></code> - End the conversation</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">send_sms</span></code> - Send SMS to caller</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">create_ticket</span></code> - Create support ticket</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lookup_customer</span></code> - Query CRM for customer info</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">schedule_callback</span></code> - Schedule callback appointment</p></li>
</ul>
</section>
<section id="call-transfer-sequence">
<h3>Call Transfer Sequence<a class="headerlink" href="#call-transfer-sequence" title="Link to this heading"></a></h3>
<p>Call transfers involve coordination between multiple services:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Blind</span> <span class="n">Transfer</span> <span class="n">Flow</span><span class="p">:</span>

<span class="n">Agent</span> <span class="n">A</span>      <span class="n">call</span><span class="o">-</span><span class="n">manager</span>    <span class="n">flow</span><span class="o">-</span><span class="n">manager</span>    <span class="n">Asterisk</span>       <span class="n">Agent</span> <span class="n">B</span>
   <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>
   <span class="o">|</span>  <span class="n">Transfer</span>    <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>
   <span class="o">|</span>  <span class="n">Request</span>     <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>
   <span class="o">+-------------&gt;|</span>              <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span> <span class="n">Create</span>       <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span> <span class="n">Transfer</span>     <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span> <span class="n">Record</span>       <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span> <span class="n">RPC</span><span class="p">:</span> <span class="n">Start</span>   <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span> <span class="n">Transfer</span> <span class="n">Flow</span><span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>
   <span class="o">|</span>              <span class="o">+-------------&gt;|</span>              <span class="o">|</span>              <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span> <span class="n">Action</span><span class="p">:</span>      <span class="o">|</span>              <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span> <span class="n">Redirect</span>     <span class="o">|</span>              <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>              <span class="o">+-------------&gt;|</span>              <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span> <span class="n">REFER</span>        <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>              <span class="o">+-------------&gt;|</span>
   <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>              <span class="o">|&lt;-------------+</span>
   <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span> <span class="mi">200</span> <span class="n">OK</span>       <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span> <span class="n">Event</span><span class="p">:</span>       <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>
   <span class="o">|</span> <span class="n">Disconnected</span> <span class="o">|</span> <span class="n">transfer_</span>    <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>
   <span class="o">|&lt;-------------+</span> <span class="n">completed</span>    <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span> <span class="n">RTP</span> <span class="n">Media</span>    <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>   <span class="n">Caller</span> <span class="o">&lt;------------------&gt;|</span>
   <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>
</pre></div>
</div>
<p><strong>Attended Transfer Flow:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Attended</span> <span class="n">Transfer</span><span class="p">:</span>

<span class="n">Agent</span> <span class="n">A</span>      <span class="n">call</span><span class="o">-</span><span class="n">manager</span>    <span class="n">Asterisk</span>      <span class="n">Agent</span> <span class="n">B</span>      <span class="n">Caller</span>
   <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>            <span class="o">|</span>            <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>            <span class="o">|</span>            <span class="o">|</span>
   <span class="o">|</span> <span class="n">Consult</span> <span class="n">B</span>    <span class="o">|</span>              <span class="o">|</span>            <span class="o">|</span>            <span class="o">|</span>
   <span class="o">+-------------&gt;|</span>              <span class="o">|</span>            <span class="o">|</span>            <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span> <span class="n">Create</span>       <span class="o">|</span>            <span class="o">|</span>            <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span> <span class="n">Consult</span> <span class="n">Call</span> <span class="o">|</span>            <span class="o">|</span>            <span class="o">|</span>
   <span class="o">|</span>              <span class="o">+-------------&gt;|</span>            <span class="o">|</span>            <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>              <span class="o">+-----------&gt;|</span>            <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>            <span class="o">|</span>            <span class="o">|</span>
   <span class="o">|&lt;-------</span> <span class="n">Consult</span> <span class="n">Active</span> <span class="o">----&gt;|</span>            <span class="o">|</span>            <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>            <span class="o">|</span>            <span class="o">|</span>
   <span class="o">|</span> <span class="p">(</span><span class="n">Discusses</span> <span class="k">with</span> <span class="n">B</span><span class="p">)</span>          <span class="o">|</span>            <span class="o">|</span>            <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>            <span class="o">|</span>            <span class="o">|</span>
   <span class="o">|</span> <span class="n">Complete</span>     <span class="o">|</span>              <span class="o">|</span>            <span class="o">|</span>            <span class="o">|</span>
   <span class="o">|</span> <span class="n">Transfer</span>     <span class="o">|</span>              <span class="o">|</span>            <span class="o">|</span>            <span class="o">|</span>
   <span class="o">+-------------&gt;|</span>              <span class="o">|</span>            <span class="o">|</span>            <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span> <span class="n">Bridge</span>       <span class="o">|</span>            <span class="o">|</span>            <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span> <span class="n">B</span> <span class="o">&lt;-&gt;</span> <span class="n">Caller</span> <span class="o">|</span>            <span class="o">|</span>            <span class="o">|</span>
   <span class="o">|</span>              <span class="o">+-------------&gt;|</span>            <span class="o">|</span>            <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>              <span class="o">|&lt;-----------------------&gt;|</span>
   <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>    <span class="n">RTP</span> <span class="n">Media</span>            <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>            <span class="o">|</span>            <span class="o">|</span>
   <span class="o">|</span> <span class="n">Disconnected</span> <span class="o">|</span>              <span class="o">|</span>            <span class="o">|</span>            <span class="o">|</span>
   <span class="o">|&lt;-------------+</span>              <span class="o">|</span>            <span class="o">|</span>            <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>            <span class="o">|</span>            <span class="o">|</span>
</pre></div>
</div>
</section>
<section id="queue-call-distribution">
<h3>Queue Call Distribution<a class="headerlink" href="#queue-call-distribution" title="Link to this heading"></a></h3>
<p>Queue management distributes calls to available agents:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Queue</span> <span class="n">Call</span> <span class="n">Flow</span><span class="p">:</span>

<span class="n">Caller</span>       <span class="n">flow</span><span class="o">-</span><span class="n">manager</span>    <span class="n">queue</span><span class="o">-</span><span class="n">manager</span>    <span class="n">agent</span><span class="o">-</span><span class="n">manager</span>    <span class="n">Agent</span>
   <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>                 <span class="o">|</span>             <span class="o">|</span>
   <span class="o">|</span> <span class="n">Incoming</span> <span class="n">Call</span><span class="o">|</span>              <span class="o">|</span>                 <span class="o">|</span>             <span class="o">|</span>
   <span class="o">+-------------&gt;|</span>              <span class="o">|</span>                 <span class="o">|</span>             <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>                 <span class="o">|</span>             <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span> <span class="n">Action</span><span class="p">:</span>      <span class="o">|</span>                 <span class="o">|</span>             <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span> <span class="n">queue_join</span>   <span class="o">|</span>                 <span class="o">|</span>             <span class="o">|</span>
   <span class="o">|</span>              <span class="o">+-------------&gt;|</span>                 <span class="o">|</span>             <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>                 <span class="o">|</span>             <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span> <span class="n">Get</span> <span class="n">Available</span>   <span class="o">|</span>             <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span> <span class="n">Agents</span>          <span class="o">|</span>             <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>              <span class="o">+----------------&gt;|</span>             <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>                 <span class="o">|</span>             <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>              <span class="o">|&lt;----------------+</span>             <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span> <span class="p">[</span><span class="n">agent1</span><span class="p">,</span> <span class="n">agent2</span><span class="p">]</span><span class="o">|</span>             <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>                 <span class="o">|</span>             <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span> <span class="n">Ring</span> <span class="n">Strategy</span>   <span class="o">|</span>             <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span> <span class="p">(</span><span class="nb">round</span><span class="o">-</span><span class="n">robin</span><span class="p">,</span>   <span class="o">|</span>             <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>  <span class="n">longest</span><span class="o">-</span><span class="n">idle</span><span class="p">)</span>  <span class="o">|</span>             <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>                 <span class="o">|</span>             <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span> <span class="n">Offer</span> <span class="n">Call</span>      <span class="o">|</span>             <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>              <span class="o">+------------------------------&gt;|</span>
   <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>                 <span class="o">|</span>             <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>              <span class="o">|&lt;------------------------------+</span>
   <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span> <span class="n">Agent</span> <span class="n">Accepts</span>   <span class="o">|</span>             <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>                 <span class="o">|</span>             <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|&lt;-------------+</span>                 <span class="o">|</span>             <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span> <span class="n">Exit</span> <span class="n">Queue</span>   <span class="o">|</span>                 <span class="o">|</span>             <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>                 <span class="o">|</span>             <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span> <span class="n">Action</span><span class="p">:</span>      <span class="o">|</span>                 <span class="o">|</span>             <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span> <span class="n">Connect</span>      <span class="o">|</span>                 <span class="o">|</span>             <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span> <span class="n">Agent</span><span class="o">&lt;-&gt;</span><span class="n">Caller</span>                 <span class="o">|</span>             <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>                 <span class="o">|</span>             <span class="o">|</span>
   <span class="o">|&lt;-------</span> <span class="n">Media</span> <span class="n">Connected</span> <span class="o">------------------------&gt;|</span>         <span class="o">|</span>
   <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>                 <span class="o">|</span>             <span class="o">|</span>
</pre></div>
</div>
<p><strong>Queue Features:</strong></p>
<ul class="simple">
<li><p><strong>Ring Strategies</strong>: round-robin, longest-idle, least-calls, ring-all</p></li>
<li><p><strong>Queue Timeout</strong>: Max wait time before alternative action</p></li>
<li><p><strong>Queue Music</strong>: Hold music or announcements while waiting</p></li>
<li><p><strong>Position Announcements</strong>: “You are caller number 3 in queue”</p></li>
<li><p><strong>Agent Wrap-up</strong>: Post-call processing time before next call</p></li>
</ul>
</section>
<section id="conference-join-sequence">
<h3>Conference Join Sequence<a class="headerlink" href="#conference-join-sequence" title="Link to this heading"></a></h3>
<p>Multi-party conferences use dedicated infrastructure:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Conference</span> <span class="n">Join</span> <span class="n">Flow</span><span class="p">:</span>

<span class="n">Participant</span>    <span class="n">flow</span><span class="o">-</span><span class="n">manager</span>    <span class="n">conf</span><span class="o">-</span><span class="n">manager</span>    <span class="n">Asterisk</span><span class="o">-</span><span class="n">Conf</span>
     <span class="o">|</span>              <span class="o">|</span>               <span class="o">|</span>                <span class="o">|</span>
     <span class="o">|</span> <span class="n">Call</span> <span class="n">Arrives</span> <span class="o">|</span>               <span class="o">|</span>                <span class="o">|</span>
     <span class="o">+-------------&gt;|</span>               <span class="o">|</span>                <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span>               <span class="o">|</span>                <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span> <span class="n">Action</span><span class="p">:</span>       <span class="o">|</span>                <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span> <span class="n">conference_join</span>               <span class="o">|</span>
     <span class="o">|</span>              <span class="o">+--------------&gt;|</span>                <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span>               <span class="o">|</span>                <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span>               <span class="o">|</span> <span class="n">Get</span><span class="o">/</span><span class="n">Create</span>     <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span>               <span class="o">|</span> <span class="n">Conference</span>     <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span>               <span class="o">+---------------&gt;|</span>
     <span class="o">|</span>              <span class="o">|</span>               <span class="o">|</span>                <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span>               <span class="o">|</span>  <span class="n">ARI</span><span class="p">:</span> <span class="n">Create</span>   <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span>               <span class="o">|</span>  <span class="n">Bridge</span>        <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span>               <span class="o">|&lt;---------------+</span>
     <span class="o">|</span>              <span class="o">|</span>               <span class="o">|</span>  <span class="n">bridge_id</span>     <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span>               <span class="o">|</span>                <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span>               <span class="o">|</span> <span class="n">ARI</span><span class="p">:</span> <span class="n">Add</span>       <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span>               <span class="o">|</span> <span class="n">Channel</span> <span class="n">to</span>     <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span>               <span class="o">|</span> <span class="n">Bridge</span>         <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span>               <span class="o">+---------------&gt;|</span>
     <span class="o">|</span>              <span class="o">|</span>               <span class="o">|</span>                <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|&lt;--------------+</span>                <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span> <span class="n">Participant</span>   <span class="o">|</span>                <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span> <span class="n">Joined</span>        <span class="o">|</span>                <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span>               <span class="o">|</span>                <span class="o">|</span>
     <span class="o">|</span> <span class="n">Audio</span> <span class="n">Mixed</span>  <span class="o">|</span>               <span class="o">|</span>                <span class="o">|</span>
     <span class="o">|&lt;--------------------------------------------&gt;|</span>
     <span class="o">|</span>              <span class="o">|</span>               <span class="o">|</span>                <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span> <span class="n">Event</span><span class="p">:</span>        <span class="o">|</span>                <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span> <span class="n">confbridge_</span>   <span class="o">|</span>                <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span> <span class="n">joined</span>        <span class="o">|</span>                <span class="o">|</span>
     <span class="o">|</span>              <span class="o">+--------------&gt;|</span>                <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span>               <span class="o">|</span>                <span class="o">|</span>
</pre></div>
</div>
<p><strong>Conference Events Published:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Conference</span> <span class="n">Events</span><span class="p">:</span>

<span class="n">confbridge_joined</span>
<span class="o">+----------------------------------+</span>
<span class="o">|</span> <span class="n">conference_id</span><span class="p">:</span> <span class="n">uuid</span>              <span class="o">|</span>
<span class="o">|</span> <span class="n">participant_id</span><span class="p">:</span> <span class="n">uuid</span>             <span class="o">|</span>
<span class="o">|</span> <span class="n">call_id</span><span class="p">:</span> <span class="n">uuid</span>                    <span class="o">|</span>
<span class="o">|</span> <span class="n">participant_count</span><span class="p">:</span> <span class="nb">int</span>           <span class="o">|</span>
<span class="o">+----------------------------------+</span>

<span class="n">confbridge_left</span>
<span class="o">+----------------------------------+</span>
<span class="o">|</span> <span class="n">conference_id</span><span class="p">:</span> <span class="n">uuid</span>              <span class="o">|</span>
<span class="o">|</span> <span class="n">participant_id</span><span class="p">:</span> <span class="n">uuid</span>             <span class="o">|</span>
<span class="o">|</span> <span class="n">reason</span><span class="p">:</span> <span class="s2">&quot;hangup&quot;</span> <span class="o">|</span> <span class="s2">&quot;kick&quot;</span>        <span class="o">|</span>
<span class="o">|</span> <span class="n">participant_count</span><span class="p">:</span> <span class="nb">int</span>           <span class="o">|</span>
<span class="o">+----------------------------------+</span>

<span class="n">confbridge_record_started</span>
<span class="o">+----------------------------------+</span>
<span class="o">|</span> <span class="n">conference_id</span><span class="p">:</span> <span class="n">uuid</span>              <span class="o">|</span>
<span class="o">|</span> <span class="n">recording_id</span><span class="p">:</span> <span class="n">uuid</span>               <span class="o">|</span>
<span class="o">+----------------------------------+</span>
</pre></div>
</div>
</section>
<section id="webhook-delivery-flow">
<h3>Webhook Delivery Flow<a class="headerlink" href="#webhook-delivery-flow" title="Link to this heading"></a></h3>
<p>Events trigger webhook notifications to customer endpoints:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Webhook</span> <span class="n">Delivery</span><span class="p">:</span>

<span class="n">call</span><span class="o">-</span><span class="n">manager</span>    <span class="n">RabbitMQ</span>     <span class="n">webhook</span><span class="o">-</span><span class="n">manager</span>    <span class="n">Customer</span> <span class="n">Endpoint</span>
     <span class="o">|</span>              <span class="o">|</span>               <span class="o">|</span>                   <span class="o">|</span>
     <span class="o">|</span> <span class="n">Event</span><span class="p">:</span>       <span class="o">|</span>               <span class="o">|</span>                   <span class="o">|</span>
     <span class="o">|</span> <span class="n">call_hungup</span>  <span class="o">|</span>               <span class="o">|</span>                   <span class="o">|</span>
     <span class="o">+-------------&gt;|</span>               <span class="o">|</span>                   <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span>               <span class="o">|</span>                   <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span> <span class="n">Fanout</span> <span class="n">to</span>     <span class="o">|</span>                   <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span> <span class="n">Subscribers</span>   <span class="o">|</span>                   <span class="o">|</span>
     <span class="o">|</span>              <span class="o">+--------------&gt;|</span>                   <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span>               <span class="o">|</span>                   <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span>               <span class="o">|</span> <span class="n">Lookup</span> <span class="n">Webhook</span>    <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span>               <span class="o">|</span> <span class="n">Config</span> <span class="k">for</span>        <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span>               <span class="o">|</span> <span class="n">Customer</span>          <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span>               <span class="o">|</span>                   <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span>               <span class="o">|</span> <span class="n">POST</span> <span class="n">Event</span>        <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span>               <span class="o">+------------------&gt;|</span>
     <span class="o">|</span>              <span class="o">|</span>               <span class="o">|</span>                   <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span>               <span class="o">|</span> <span class="n">Retry</span> <span class="n">on</span> <span class="n">Failure</span>  <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span>               <span class="o">|</span> <span class="p">(</span><span class="n">exponential</span>      <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span>               <span class="o">|</span>  <span class="n">backoff</span><span class="p">)</span>         <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span>               <span class="o">|</span>                   <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span>               <span class="o">|&lt;------------------+</span>
     <span class="o">|</span>              <span class="o">|</span>               <span class="o">|</span> <span class="mi">200</span> <span class="n">OK</span>            <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span>               <span class="o">|</span>                   <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span>               <span class="o">|</span> <span class="n">Mark</span> <span class="n">Delivered</span>    <span class="o">|</span>
     <span class="o">|</span>              <span class="o">|</span>               <span class="o">|</span>                   <span class="o">|</span>
</pre></div>
</div>
<p><strong>Webhook Retry Policy:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Retry</span> <span class="n">Strategy</span><span class="p">:</span>
<span class="o">+----------------------------------+</span>
<span class="o">|</span> <span class="n">Attempt</span> <span class="mi">1</span><span class="p">:</span>  <span class="n">Immediate</span>            <span class="o">|</span>
<span class="o">|</span> <span class="n">Attempt</span> <span class="mi">2</span><span class="p">:</span>  <span class="mi">1</span> <span class="n">minute</span> <span class="n">delay</span>       <span class="o">|</span>
<span class="o">|</span> <span class="n">Attempt</span> <span class="mi">3</span><span class="p">:</span>  <span class="mi">5</span> <span class="n">minutes</span> <span class="n">delay</span>      <span class="o">|</span>
<span class="o">|</span> <span class="n">Attempt</span> <span class="mi">4</span><span class="p">:</span>  <span class="mi">30</span> <span class="n">minutes</span> <span class="n">delay</span>     <span class="o">|</span>
<span class="o">|</span> <span class="n">Attempt</span> <span class="mi">5</span><span class="p">:</span>  <span class="mi">2</span> <span class="n">hours</span> <span class="n">delay</span>        <span class="o">|</span>
<span class="o">+----------------------------------+</span>
<span class="o">|</span> <span class="n">Max</span> <span class="n">Attempts</span><span class="p">:</span> <span class="mi">5</span>                  <span class="o">|</span>
<span class="o">|</span> <span class="n">Total</span> <span class="n">Window</span><span class="p">:</span> <span class="o">~</span><span class="mf">2.5</span> <span class="n">hours</span>         <span class="o">|</span>
<span class="o">+----------------------------------+</span>
</pre></div>
</div>
<p><strong>Webhook Payload:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">POST</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">customer</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">webhook</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">json</span>
<span class="n">X</span><span class="o">-</span><span class="n">VoIPBIN</span><span class="o">-</span><span class="n">Signature</span><span class="p">:</span> <span class="n">sha256</span><span class="o">=...</span>

<span class="p">{</span>
  <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;call_hungup&quot;</span><span class="p">,</span>
  <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2026-01-20T12:00:00.000Z&quot;</span><span class="p">,</span>
  <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;call-123&quot;</span><span class="p">,</span>
    <span class="s2">&quot;customer_id&quot;</span><span class="p">:</span> <span class="s2">&quot;customer-456&quot;</span><span class="p">,</span>
    <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;+15551234567&quot;</span><span class="p">,</span>
    <span class="s2">&quot;destination&quot;</span><span class="p">:</span> <span class="s2">&quot;+15559876543&quot;</span><span class="p">,</span>
    <span class="s2">&quot;duration&quot;</span><span class="p">:</span> <span class="mi">120</span><span class="p">,</span>
    <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;completed&quot;</span><span class="p">,</span>
    <span class="s2">&quot;hangup_cause&quot;</span><span class="p">:</span> <span class="s2">&quot;normal_clearing&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="architecture-deployment">
<span id="id8"></span><h2>Deployment Architecture<a class="headerlink" href="#architecture-deployment" title="Link to this heading"></a></h2>
<p>VoIPBIN runs on Google Cloud Platform (GCP) using Google Kubernetes Engine (GKE) for container orchestration. This section details the deployment topology, scaling strategies, and infrastructure components.</p>
<section id="infrastructure-overview">
<h3>Infrastructure Overview<a class="headerlink" href="#infrastructure-overview" title="Link to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">VoIPBIN</span> <span class="n">Production</span> <span class="n">Infrastructure</span><span class="p">:</span>

<span class="o">+------------------------------------------------------------------+</span>
<span class="o">|</span>                    <span class="n">Google</span> <span class="n">Cloud</span> <span class="n">Platform</span>                          <span class="o">|</span>
<span class="o">+------------------------------------------------------------------+</span>
<span class="o">|</span>                                                                    <span class="o">|</span>
<span class="o">|</span>  <span class="o">+------------------------+</span>    <span class="o">+------------------------+</span>         <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>   <span class="n">GKE</span> <span class="n">Cluster</span>          <span class="o">|</span>    <span class="o">|</span>   <span class="n">Cloud</span> <span class="n">SQL</span> <span class="p">(</span><span class="n">MySQL</span><span class="p">)</span>   <span class="o">|</span>         <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>   <span class="p">(</span><span class="n">Kubernetes</span><span class="p">)</span>         <span class="o">|</span>    <span class="o">|</span>   <span class="o">-</span> <span class="n">Primary</span>           <span class="o">|</span>         <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>                        <span class="o">|</span>    <span class="o">|</span>   <span class="o">-</span> <span class="n">Read</span> <span class="n">Replicas</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">|</span>         <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="mi">30</span><span class="o">+</span> <span class="n">Microservices</span>     <span class="o">|</span>    <span class="o">+------------------------+</span>         <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="mi">2</span> <span class="n">replicas</span> <span class="n">each</span>       <span class="o">|</span>                                       <span class="o">|</span>
<span class="o">|</span>  <span class="o">+------------------------+</span>    <span class="o">+------------------------+</span>         <span class="o">|</span>
<span class="o">|</span>                                <span class="o">|</span>   <span class="n">Memorystore</span> <span class="p">(</span><span class="n">Redis</span><span class="p">)</span> <span class="o">|</span>         <span class="o">|</span>
<span class="o">|</span>  <span class="o">+------------------------+</span>    <span class="o">|</span>   <span class="o">-</span> <span class="mi">16</span> <span class="n">GB</span> <span class="n">Instance</span>    <span class="o">|</span>         <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>   <span class="n">Compute</span> <span class="n">Engine</span> <span class="n">VMs</span>   <span class="o">|</span>    <span class="o">+------------------------+</span>         <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>   <span class="o">-</span> <span class="n">Kamailio</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>       <span class="o">|</span>                                       <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>   <span class="o">-</span> <span class="n">Asterisk</span> <span class="p">(</span><span class="mi">6</span><span class="o">+</span><span class="p">)</span>      <span class="o">|</span>    <span class="o">+------------------------+</span>         <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>   <span class="o">-</span> <span class="n">RTPEngine</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>      <span class="o">|</span>    <span class="o">|</span>   <span class="n">Cloud</span> <span class="n">Storage</span>       <span class="o">|</span>         <span class="o">|</span>
<span class="o">|</span>  <span class="o">+------------------------+</span>    <span class="o">|</span>   <span class="o">-</span> <span class="n">Recordings</span>        <span class="o">|</span>         <span class="o">|</span>
<span class="o">|</span>                                <span class="o">|</span>   <span class="o">-</span> <span class="n">Media</span> <span class="n">files</span>       <span class="o">|</span>         <span class="o">|</span>
<span class="o">|</span>  <span class="o">+------------------------+</span>    <span class="o">+------------------------+</span>         <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>   <span class="n">RabbitMQ</span> <span class="n">Cluster</span>     <span class="o">|</span>                                       <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>   <span class="p">(</span><span class="mi">3</span><span class="o">-</span><span class="n">node</span><span class="p">)</span>             <span class="o">|</span>    <span class="o">+------------------------+</span>         <span class="o">|</span>
<span class="o">|</span>  <span class="o">+------------------------+</span>    <span class="o">|</span>   <span class="n">Cloud</span> <span class="n">Load</span> <span class="n">Balancer</span> <span class="o">|</span>         <span class="o">|</span>
<span class="o">|</span>                                <span class="o">+------------------------+</span>         <span class="o">|</span>
<span class="o">|</span>                                                                    <span class="o">|</span>
<span class="o">+------------------------------------------------------------------+</span>
</pre></div>
</div>
</section>
<section id="kubernetes-architecture">
<h3>Kubernetes Architecture<a class="headerlink" href="#kubernetes-architecture" title="Link to this heading"></a></h3>
<p>All Go microservices run in Kubernetes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">GKE</span> <span class="n">Cluster</span> <span class="n">Configuration</span><span class="p">:</span>

<span class="o">+----------------------------------------------------------------+</span>
<span class="o">|</span>                     <span class="n">GKE</span> <span class="n">Cluster</span>                                 <span class="o">|</span>
<span class="o">+----------------------------------------------------------------+</span>
<span class="o">|</span>                                                                  <span class="o">|</span>
<span class="o">|</span>  <span class="n">Namespace</span><span class="p">:</span> <span class="n">production</span>                                           <span class="o">|</span>
<span class="o">|</span>  <span class="o">+-----------------------------------------------------------+</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>                                                           <span class="o">|</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="n">Deployment</span><span class="p">:</span> <span class="nb">bin</span><span class="o">-</span><span class="n">api</span><span class="o">-</span><span class="n">manager</span> <span class="p">(</span><span class="mi">2</span> <span class="n">replicas</span><span class="p">)</span>                 <span class="o">|</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">+----------------+</span>  <span class="o">+----------------+</span>                   <span class="o">|</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span> <span class="n">Pod</span> <span class="mi">1</span>          <span class="o">|</span>  <span class="o">|</span> <span class="n">Pod</span> <span class="mi">2</span>          <span class="o">|</span>                   <span class="o">|</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span> <span class="o">-</span> <span class="n">api</span><span class="o">-</span><span class="n">manager</span>  <span class="o">|</span>  <span class="o">|</span> <span class="o">-</span> <span class="n">api</span><span class="o">-</span><span class="n">manager</span>  <span class="o">|</span>                   <span class="o">|</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span> <span class="o">-</span> <span class="n">Port</span><span class="p">:</span> <span class="mi">443</span>    <span class="o">|</span>  <span class="o">|</span> <span class="o">-</span> <span class="n">Port</span><span class="p">:</span> <span class="mi">443</span>    <span class="o">|</span>                   <span class="o">|</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span> <span class="o">-</span> <span class="n">Port</span><span class="p">:</span> <span class="mi">9000</span>   <span class="o">|</span>  <span class="o">|</span> <span class="o">-</span> <span class="n">Port</span><span class="p">:</span> <span class="mi">9000</span>   <span class="o">|</span>                   <span class="o">|</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span> <span class="o">-</span> <span class="n">Port</span><span class="p">:</span> <span class="mi">2112</span>   <span class="o">|</span>  <span class="o">|</span> <span class="o">-</span> <span class="n">Port</span><span class="p">:</span> <span class="mi">2112</span>   <span class="o">|</span>                   <span class="o">|</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">+----------------+</span>  <span class="o">+----------------+</span>                   <span class="o">|</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>                                                           <span class="o">|</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="n">Deployment</span><span class="p">:</span> <span class="nb">bin</span><span class="o">-</span><span class="n">call</span><span class="o">-</span><span class="n">manager</span> <span class="p">(</span><span class="mi">2</span> <span class="n">replicas</span><span class="p">)</span>                <span class="o">|</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">+----------------+</span>  <span class="o">+----------------+</span>                   <span class="o">|</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">|</span> <span class="n">Pod</span> <span class="mi">1</span>          <span class="o">|</span>  <span class="o">|</span> <span class="n">Pod</span> <span class="mi">2</span>          <span class="o">|</span>                   <span class="o">|</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">+----------------+</span>  <span class="o">+----------------+</span>                   <span class="o">|</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>                                                           <span class="o">|</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">...</span> <span class="p">(</span><span class="mi">28</span> <span class="n">more</span> <span class="n">deployments</span><span class="p">,</span> <span class="n">each</span> <span class="k">with</span> <span class="mi">2</span> <span class="n">replicas</span><span class="p">)</span>          <span class="o">|</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>                                                           <span class="o">|</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="o">+-----------------------------------------------------------+</span>  <span class="o">|</span>
<span class="o">|</span>                                                                  <span class="o">|</span>
<span class="o">+----------------------------------------------------------------+</span>
</pre></div>
</div>
<p><strong>Standard Deployment Pattern:</strong></p>
<p>All services follow the same deployment pattern:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">apiVersion</span><span class="p">:</span> <span class="n">apps</span><span class="o">/</span><span class="n">v1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">Deployment</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="nb">bin</span><span class="o">-</span><span class="n">call</span><span class="o">-</span><span class="n">manager</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">replicas</span><span class="p">:</span> <span class="mi">2</span>
  <span class="n">selector</span><span class="p">:</span>
    <span class="n">matchLabels</span><span class="p">:</span>
      <span class="n">app</span><span class="p">:</span> <span class="nb">bin</span><span class="o">-</span><span class="n">call</span><span class="o">-</span><span class="n">manager</span>
  <span class="n">template</span><span class="p">:</span>
    <span class="n">spec</span><span class="p">:</span>
      <span class="n">containers</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="nb">bin</span><span class="o">-</span><span class="n">call</span><span class="o">-</span><span class="n">manager</span>
        <span class="n">image</span><span class="p">:</span> <span class="n">gcr</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">voipbin</span><span class="o">/</span><span class="nb">bin</span><span class="o">-</span><span class="n">call</span><span class="o">-</span><span class="n">manager</span><span class="p">:</span><span class="n">latest</span>
        <span class="n">ports</span><span class="p">:</span>
        <span class="o">-</span> <span class="n">containerPort</span><span class="p">:</span> <span class="mi">8080</span>      <span class="c1"># Health check</span>
        <span class="o">-</span> <span class="n">containerPort</span><span class="p">:</span> <span class="mi">2112</span>      <span class="c1"># Prometheus metrics</span>
        <span class="n">resources</span><span class="p">:</span>
          <span class="n">requests</span><span class="p">:</span>
            <span class="n">memory</span><span class="p">:</span> <span class="s2">&quot;256Mi&quot;</span>
            <span class="n">cpu</span><span class="p">:</span> <span class="s2">&quot;100m&quot;</span>
          <span class="n">limits</span><span class="p">:</span>
            <span class="n">memory</span><span class="p">:</span> <span class="s2">&quot;512Mi&quot;</span>
            <span class="n">cpu</span><span class="p">:</span> <span class="s2">&quot;500m&quot;</span>
        <span class="n">livenessProbe</span><span class="p">:</span>
          <span class="n">httpGet</span><span class="p">:</span>
            <span class="n">path</span><span class="p">:</span> <span class="o">/</span><span class="n">health</span>
            <span class="n">port</span><span class="p">:</span> <span class="mi">8080</span>
          <span class="n">initialDelaySeconds</span><span class="p">:</span> <span class="mi">30</span>
          <span class="n">periodSeconds</span><span class="p">:</span> <span class="mi">10</span>
        <span class="n">readinessProbe</span><span class="p">:</span>
          <span class="n">httpGet</span><span class="p">:</span>
            <span class="n">path</span><span class="p">:</span> <span class="o">/</span><span class="n">ready</span>
            <span class="n">port</span><span class="p">:</span> <span class="mi">8080</span>
          <span class="n">initialDelaySeconds</span><span class="p">:</span> <span class="mi">5</span>
          <span class="n">periodSeconds</span><span class="p">:</span> <span class="mi">5</span>
        <span class="n">env</span><span class="p">:</span>
        <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">DSN</span>
          <span class="n">valueFrom</span><span class="p">:</span>
            <span class="n">secretKeyRef</span><span class="p">:</span>
              <span class="n">name</span><span class="p">:</span> <span class="n">db</span><span class="o">-</span><span class="n">credentials</span>
              <span class="n">key</span><span class="p">:</span> <span class="n">dsn</span>
        <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">RABBIT_ADDR</span>
          <span class="n">valueFrom</span><span class="p">:</span>
            <span class="n">configMapKeyRef</span><span class="p">:</span>
              <span class="n">name</span><span class="p">:</span> <span class="n">app</span><span class="o">-</span><span class="n">config</span>
              <span class="n">key</span><span class="p">:</span> <span class="n">rabbit_addr</span>
</pre></div>
</div>
<p><strong>Pod Ports:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Service</span> <span class="n">Port</span> <span class="n">Configuration</span><span class="p">:</span>

<span class="nb">bin</span><span class="o">-</span><span class="n">api</span><span class="o">-</span><span class="n">manager</span><span class="p">:</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">Port</span> <span class="mi">443</span>   <span class="o">-</span> <span class="n">HTTPS</span> <span class="n">REST</span> <span class="n">API</span> <span class="p">(</span><span class="n">external</span><span class="p">)</span>   <span class="o">|</span>
<span class="o">|</span> <span class="n">Port</span> <span class="mi">9000</span>  <span class="o">-</span> <span class="n">Audiosocket</span> <span class="p">(</span><span class="n">media</span> <span class="n">stream</span><span class="p">)</span>  <span class="o">|</span>
<span class="o">|</span> <span class="n">Port</span> <span class="mi">2112</span>  <span class="o">-</span> <span class="n">Prometheus</span> <span class="n">metrics</span>          <span class="o">|</span>
<span class="o">+------------------------------------------+</span>

<span class="n">Other</span> <span class="n">Services</span><span class="p">:</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">Port</span> <span class="mi">8080</span>  <span class="o">-</span> <span class="n">Health</span><span class="o">/</span><span class="n">Ready</span> <span class="n">endpoints</span>      <span class="o">|</span>
<span class="o">|</span> <span class="n">Port</span> <span class="mi">2112</span>  <span class="o">-</span> <span class="n">Prometheus</span> <span class="n">metrics</span>          <span class="o">|</span>
<span class="o">+------------------------------------------+</span>
</pre></div>
</div>
</section>
<section id="service-scaling">
<h3>Service Scaling<a class="headerlink" href="#service-scaling" title="Link to this heading"></a></h3>
<p>VoIPBIN scales services based on demand:</p>
<p><strong>Horizontal Pod Autoscaler (HPA):</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">HPA</span> <span class="n">Configuration</span><span class="p">:</span>

<span class="n">apiVersion</span><span class="p">:</span> <span class="n">autoscaling</span><span class="o">/</span><span class="n">v2</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">HorizontalPodAutoscaler</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="nb">bin</span><span class="o">-</span><span class="n">call</span><span class="o">-</span><span class="n">manager</span><span class="o">-</span><span class="n">hpa</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">scaleTargetRef</span><span class="p">:</span>
    <span class="n">apiVersion</span><span class="p">:</span> <span class="n">apps</span><span class="o">/</span><span class="n">v1</span>
    <span class="n">kind</span><span class="p">:</span> <span class="n">Deployment</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">bin</span><span class="o">-</span><span class="n">call</span><span class="o">-</span><span class="n">manager</span>
  <span class="n">minReplicas</span><span class="p">:</span> <span class="mi">2</span>
  <span class="n">maxReplicas</span><span class="p">:</span> <span class="mi">10</span>
  <span class="n">metrics</span><span class="p">:</span>
  <span class="o">-</span> <span class="nb">type</span><span class="p">:</span> <span class="n">Resource</span>
    <span class="n">resource</span><span class="p">:</span>
      <span class="n">name</span><span class="p">:</span> <span class="n">cpu</span>
      <span class="n">target</span><span class="p">:</span>
        <span class="nb">type</span><span class="p">:</span> <span class="n">Utilization</span>
        <span class="n">averageUtilization</span><span class="p">:</span> <span class="mi">70</span>
  <span class="o">-</span> <span class="nb">type</span><span class="p">:</span> <span class="n">Resource</span>
    <span class="n">resource</span><span class="p">:</span>
      <span class="n">name</span><span class="p">:</span> <span class="n">memory</span>
      <span class="n">target</span><span class="p">:</span>
        <span class="nb">type</span><span class="p">:</span> <span class="n">Utilization</span>
        <span class="n">averageUtilization</span><span class="p">:</span> <span class="mi">80</span>
</pre></div>
</div>
<p><strong>Scaling Triggers:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Auto</span><span class="o">-</span><span class="n">Scaling</span> <span class="n">Strategy</span><span class="p">:</span>

<span class="o">+---------------------------------------------+</span>
<span class="o">|</span>  <span class="n">Metric</span>          <span class="o">|</span> <span class="n">Threshold</span> <span class="o">|</span> <span class="n">Action</span>       <span class="o">|</span>
<span class="o">+---------------------------------------------+</span>
<span class="o">|</span>  <span class="n">CPU</span> <span class="o">&gt;</span> <span class="mi">70</span><span class="o">%</span>       <span class="o">|</span> <span class="n">Scale</span> <span class="n">up</span>  <span class="o">|</span> <span class="o">+</span><span class="mi">1</span> <span class="n">replica</span>   <span class="o">|</span>
<span class="o">|</span>  <span class="n">CPU</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="o">%</span>       <span class="o">|</span> <span class="n">Scale</span> <span class="n">down</span><span class="o">|</span> <span class="o">-</span><span class="mi">1</span> <span class="n">replica</span>   <span class="o">|</span>
<span class="o">|</span>  <span class="n">Memory</span> <span class="o">&gt;</span> <span class="mi">80</span><span class="o">%</span>    <span class="o">|</span> <span class="n">Scale</span> <span class="n">up</span>  <span class="o">|</span> <span class="o">+</span><span class="mi">1</span> <span class="n">replica</span>   <span class="o">|</span>
<span class="o">|</span>  <span class="n">Queue</span> <span class="n">depth</span> <span class="o">&gt;</span><span class="mi">100</span><span class="o">|</span> <span class="n">Scale</span> <span class="n">up</span>  <span class="o">|</span> <span class="o">+</span><span class="mi">2</span> <span class="n">replicas</span>  <span class="o">|</span>
<span class="o">+---------------------------------------------+</span>

<span class="n">Scaling</span> <span class="n">Limits</span><span class="p">:</span>
<span class="o">+---------------------------------------------+</span>
<span class="o">|</span>  <span class="n">Service</span>             <span class="o">|</span> <span class="n">Min</span> <span class="o">|</span> <span class="n">Max</span>  <span class="o">|</span> <span class="n">Notes</span>   <span class="o">|</span>
<span class="o">+---------------------------------------------+</span>
<span class="o">|</span>  <span class="nb">bin</span><span class="o">-</span><span class="n">api</span><span class="o">-</span><span class="n">manager</span>     <span class="o">|</span> <span class="mi">2</span>   <span class="o">|</span> <span class="mi">20</span>   <span class="o">|</span> <span class="n">Gateway</span> <span class="o">|</span>
<span class="o">|</span>  <span class="nb">bin</span><span class="o">-</span><span class="n">call</span><span class="o">-</span><span class="n">manager</span>    <span class="o">|</span> <span class="mi">2</span>   <span class="o">|</span> <span class="mi">10</span>   <span class="o">|</span> <span class="n">Core</span>    <span class="o">|</span>
<span class="o">|</span>  <span class="nb">bin</span><span class="o">-</span><span class="n">flow</span><span class="o">-</span><span class="n">manager</span>    <span class="o">|</span> <span class="mi">2</span>   <span class="o">|</span> <span class="mi">10</span>   <span class="o">|</span> <span class="n">Core</span>    <span class="o">|</span>
<span class="o">|</span>  <span class="nb">bin</span><span class="o">-</span><span class="n">ai</span><span class="o">-</span><span class="n">manager</span>      <span class="o">|</span> <span class="mi">2</span>   <span class="o">|</span> <span class="mi">5</span>    <span class="o">|</span> <span class="n">GPU</span>     <span class="o">|</span>
<span class="o">|</span>  <span class="nb">bin</span><span class="o">-</span><span class="n">pipecat</span><span class="o">-</span><span class="n">manager</span> <span class="o">|</span> <span class="mi">2</span>   <span class="o">|</span> <span class="mi">8</span>    <span class="o">|</span> <span class="n">AI</span>      <span class="o">|</span>
<span class="o">|</span>  <span class="n">Other</span> <span class="n">services</span>      <span class="o">|</span> <span class="mi">2</span>   <span class="o">|</span> <span class="mi">5</span>    <span class="o">|</span> <span class="n">Standard</span><span class="o">|</span>
<span class="o">+---------------------------------------------+</span>
</pre></div>
</div>
</section>
<section id="voip-infrastructure">
<h3>VoIP Infrastructure<a class="headerlink" href="#voip-infrastructure" title="Link to this heading"></a></h3>
<p>VoIP components run on dedicated VMs for performance:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">VoIP</span> <span class="n">Component</span> <span class="n">Topology</span><span class="p">:</span>

<span class="o">+------------------------------------------------------------------+</span>
<span class="o">|</span>                      <span class="n">External</span> <span class="n">Traffic</span>                            <span class="o">|</span>
<span class="o">+------------------------------------------------------------------+</span>
                            <span class="o">|</span>
                            <span class="o">|</span> <span class="n">SIP</span> <span class="p">(</span><span class="n">UDP</span><span class="o">/</span><span class="n">TCP</span> <span class="mi">5060</span><span class="o">-</span><span class="mi">5061</span><span class="p">)</span>
                            <span class="n">v</span>
<span class="o">+------------------------------------------------------------------+</span>
<span class="o">|</span>                   <span class="n">Cloud</span> <span class="n">Load</span> <span class="n">Balancer</span>                            <span class="o">|</span>
<span class="o">|</span>                   <span class="p">(</span><span class="n">L4</span> <span class="o">-</span> <span class="n">TCP</span><span class="o">/</span><span class="n">UDP</span><span class="p">)</span>                                  <span class="o">|</span>
<span class="o">+------------------------------------------------------------------+</span>
            <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
            <span class="n">v</span>               <span class="n">v</span>               <span class="n">v</span>
<span class="o">+----------------+</span>  <span class="o">+----------------+</span>  <span class="o">+----------------+</span>
<span class="o">|</span>  <span class="n">Kamailio</span><span class="o">-</span><span class="mi">1</span>    <span class="o">|</span>  <span class="o">|</span>  <span class="n">Kamailio</span><span class="o">-</span><span class="mi">2</span>    <span class="o">|</span>  <span class="o">|</span>  <span class="n">Kamailio</span><span class="o">-</span><span class="mi">3</span>    <span class="o">|</span>
<span class="o">|</span>  <span class="p">(</span><span class="n">SIP</span> <span class="n">Proxy</span><span class="p">)</span>   <span class="o">|</span>  <span class="o">|</span>  <span class="p">(</span><span class="n">SIP</span> <span class="n">Proxy</span><span class="p">)</span>   <span class="o">|</span>  <span class="o">|</span>  <span class="p">(</span><span class="n">SIP</span> <span class="n">Proxy</span><span class="p">)</span>   <span class="o">|</span>
<span class="o">|</span>                <span class="o">|</span>  <span class="o">|</span>                <span class="o">|</span>  <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span>  <span class="n">n1</span><span class="o">-</span><span class="n">standard</span><span class="o">-</span><span class="mi">4</span> <span class="o">|</span>  <span class="o">|</span>  <span class="n">n1</span><span class="o">-</span><span class="n">standard</span><span class="o">-</span><span class="mi">4</span> <span class="o">|</span>  <span class="o">|</span>  <span class="n">n1</span><span class="o">-</span><span class="n">standard</span><span class="o">-</span><span class="mi">4</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">4</span> <span class="n">vCPU</span><span class="p">,</span> <span class="mi">15</span><span class="n">GB</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="mi">4</span> <span class="n">vCPU</span><span class="p">,</span> <span class="mi">15</span><span class="n">GB</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="mi">4</span> <span class="n">vCPU</span><span class="p">,</span> <span class="mi">15</span><span class="n">GB</span>  <span class="o">|</span>
<span class="o">+-------+--------+</span>  <span class="o">+-------+--------+</span>  <span class="o">+-------+--------+</span>
        <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>
        <span class="o">+-------------------+-------------------+</span>
                            <span class="o">|</span>
                            <span class="n">v</span>
<span class="o">+------------------------------------------------------------------+</span>
<span class="o">|</span>                   <span class="n">Internal</span> <span class="n">Load</span> <span class="n">Balancer</span>                          <span class="o">|</span>
<span class="o">+------------------------------------------------------------------+</span>
            <span class="o">|</span>               <span class="o">|</span>               <span class="o">|</span>
            <span class="n">v</span>               <span class="n">v</span>               <span class="n">v</span>
<span class="o">+----------------+</span>  <span class="o">+----------------+</span>  <span class="o">+----------------+</span>
<span class="o">|</span>  <span class="n">Asterisk</span><span class="o">-</span><span class="mi">1</span>    <span class="o">|</span>  <span class="o">|</span>  <span class="n">Asterisk</span><span class="o">-</span><span class="mi">2</span>    <span class="o">|</span>  <span class="o">|</span>  <span class="n">Asterisk</span><span class="o">-</span><span class="mi">3</span>    <span class="o">|</span>
<span class="o">|</span>  <span class="p">(</span><span class="n">Call</span> <span class="n">Farm</span><span class="p">)</span>   <span class="o">|</span>  <span class="o">|</span>  <span class="p">(</span><span class="n">Call</span> <span class="n">Farm</span><span class="p">)</span>   <span class="o">|</span>  <span class="o">|</span>  <span class="p">(</span><span class="n">Conf</span> <span class="n">Farm</span><span class="p">)</span>   <span class="o">|</span>
<span class="o">|</span>                <span class="o">|</span>  <span class="o">|</span>                <span class="o">|</span>  <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span>  <span class="n">n1</span><span class="o">-</span><span class="n">standard</span><span class="o">-</span><span class="mi">8</span> <span class="o">|</span>  <span class="o">|</span>  <span class="n">n1</span><span class="o">-</span><span class="n">standard</span><span class="o">-</span><span class="mi">8</span> <span class="o">|</span>  <span class="o">|</span>  <span class="n">n1</span><span class="o">-</span><span class="n">standard</span><span class="o">-</span><span class="mi">8</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">8</span> <span class="n">vCPU</span><span class="p">,</span> <span class="mi">30</span><span class="n">GB</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="mi">8</span> <span class="n">vCPU</span><span class="p">,</span> <span class="mi">30</span><span class="n">GB</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="mi">8</span> <span class="n">vCPU</span><span class="p">,</span> <span class="mi">30</span><span class="n">GB</span>  <span class="o">|</span>
<span class="o">+-------+--------+</span>  <span class="o">+-------+--------+</span>  <span class="o">+-------+--------+</span>
        <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>
        <span class="o">+-------------------+-------------------+</span>
                            <span class="o">|</span>
                            <span class="n">v</span>
<span class="o">+------------------------------------------------------------------+</span>
<span class="o">|</span>                     <span class="n">RTPEngine</span> <span class="n">Farm</span>                                <span class="o">|</span>
<span class="o">+------------------------------------------------------------------+</span>
<span class="o">|</span>  <span class="o">+----------------+</span>  <span class="o">+----------------+</span>  <span class="o">+----------------+</span>       <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="n">RTPEngine</span><span class="o">-</span><span class="mi">1</span>   <span class="o">|</span>  <span class="o">|</span>  <span class="n">RTPEngine</span><span class="o">-</span><span class="mi">2</span>   <span class="o">|</span>  <span class="o">|</span>  <span class="n">RTPEngine</span><span class="o">-</span><span class="mi">3</span>   <span class="o">|</span>       <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="n">n1</span><span class="o">-</span><span class="n">highcpu</span><span class="o">-</span><span class="mi">8</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="n">n1</span><span class="o">-</span><span class="n">highcpu</span><span class="o">-</span><span class="mi">8</span>  <span class="o">|</span>  <span class="o">|</span>  <span class="n">n1</span><span class="o">-</span><span class="n">highcpu</span><span class="o">-</span><span class="mi">8</span>  <span class="o">|</span>       <span class="o">|</span>
<span class="o">|</span>  <span class="o">+----------------+</span>  <span class="o">+----------------+</span>  <span class="o">+----------------+</span>       <span class="o">|</span>
<span class="o">+------------------------------------------------------------------+</span>
</pre></div>
</div>
<p><strong>VM Specifications:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">VoIP</span> <span class="n">VM</span> <span class="n">Sizing</span><span class="p">:</span>

<span class="n">Kamailio</span> <span class="n">Nodes</span> <span class="p">(</span><span class="n">SIP</span> <span class="n">Proxy</span><span class="p">):</span>
<span class="o">+-------------------------------------------+</span>
<span class="o">|</span> <span class="n">Machine</span> <span class="n">Type</span><span class="p">:</span>  <span class="n">n1</span><span class="o">-</span><span class="n">standard</span><span class="o">-</span><span class="mi">4</span>              <span class="o">|</span>
<span class="o">|</span> <span class="n">vCPUs</span><span class="p">:</span>         <span class="mi">4</span>                          <span class="o">|</span>
<span class="o">|</span> <span class="n">Memory</span><span class="p">:</span>        <span class="mi">15</span> <span class="n">GB</span>                      <span class="o">|</span>
<span class="o">|</span> <span class="n">Disk</span><span class="p">:</span>          <span class="mi">100</span> <span class="n">GB</span> <span class="n">SSD</span>                 <span class="o">|</span>
<span class="o">|</span> <span class="n">Network</span><span class="p">:</span>       <span class="mi">10</span> <span class="n">Gbps</span>                    <span class="o">|</span>
<span class="o">|</span> <span class="n">Capacity</span><span class="p">:</span>      <span class="o">~</span><span class="mi">5</span><span class="p">,</span><span class="mi">000</span> <span class="n">concurrent</span> <span class="n">calls</span>    <span class="o">|</span>
<span class="o">+-------------------------------------------+</span>

<span class="n">Asterisk</span> <span class="n">Nodes</span> <span class="p">(</span><span class="n">Media</span> <span class="n">Server</span><span class="p">):</span>
<span class="o">+-------------------------------------------+</span>
<span class="o">|</span> <span class="n">Machine</span> <span class="n">Type</span><span class="p">:</span>  <span class="n">n1</span><span class="o">-</span><span class="n">standard</span><span class="o">-</span><span class="mi">8</span>              <span class="o">|</span>
<span class="o">|</span> <span class="n">vCPUs</span><span class="p">:</span>         <span class="mi">8</span>                          <span class="o">|</span>
<span class="o">|</span> <span class="n">Memory</span><span class="p">:</span>        <span class="mi">30</span> <span class="n">GB</span>                      <span class="o">|</span>
<span class="o">|</span> <span class="n">Disk</span><span class="p">:</span>          <span class="mi">200</span> <span class="n">GB</span> <span class="n">SSD</span>                 <span class="o">|</span>
<span class="o">|</span> <span class="n">Network</span><span class="p">:</span>       <span class="mi">10</span> <span class="n">Gbps</span>                    <span class="o">|</span>
<span class="o">|</span> <span class="n">Capacity</span><span class="p">:</span>      <span class="o">~</span><span class="mi">500</span> <span class="n">concurrent</span> <span class="n">calls</span> <span class="n">each</span> <span class="o">|</span>
<span class="o">+-------------------------------------------+</span>

<span class="n">RTPEngine</span> <span class="n">Nodes</span> <span class="p">(</span><span class="n">Media</span> <span class="n">Proxy</span><span class="p">):</span>
<span class="o">+-------------------------------------------+</span>
<span class="o">|</span> <span class="n">Machine</span> <span class="n">Type</span><span class="p">:</span>  <span class="n">n1</span><span class="o">-</span><span class="n">highcpu</span><span class="o">-</span><span class="mi">8</span>               <span class="o">|</span>
<span class="o">|</span> <span class="n">vCPUs</span><span class="p">:</span>         <span class="mi">8</span>                          <span class="o">|</span>
<span class="o">|</span> <span class="n">Memory</span><span class="p">:</span>        <span class="mf">7.2</span> <span class="n">GB</span>                     <span class="o">|</span>
<span class="o">|</span> <span class="n">Disk</span><span class="p">:</span>          <span class="mi">50</span> <span class="n">GB</span> <span class="n">SSD</span>                  <span class="o">|</span>
<span class="o">|</span> <span class="n">Network</span><span class="p">:</span>       <span class="mi">10</span> <span class="n">Gbps</span>                    <span class="o">|</span>
<span class="o">|</span> <span class="n">Capacity</span><span class="p">:</span>      <span class="o">~</span><span class="mi">2</span><span class="p">,</span><span class="mi">000</span> <span class="n">media</span> <span class="n">streams</span> <span class="n">each</span>  <span class="o">|</span>
<span class="o">+-------------------------------------------+</span>
</pre></div>
</div>
</section>
<section id="database-infrastructure">
<h3>Database Infrastructure<a class="headerlink" href="#database-infrastructure" title="Link to this heading"></a></h3>
<p>Cloud SQL for MySQL provides managed database:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Cloud</span> <span class="n">SQL</span> <span class="n">Configuration</span><span class="p">:</span>

<span class="n">Primary</span> <span class="n">Instance</span><span class="p">:</span>
<span class="o">+-------------------------------------------+</span>
<span class="o">|</span> <span class="n">Instance</span><span class="p">:</span>      <span class="n">db</span><span class="o">-</span><span class="n">custom</span><span class="o">-</span><span class="mi">8</span><span class="o">-</span><span class="mi">32768</span>          <span class="o">|</span>
<span class="o">|</span> <span class="n">vCPUs</span><span class="p">:</span>         <span class="mi">8</span>                          <span class="o">|</span>
<span class="o">|</span> <span class="n">Memory</span><span class="p">:</span>        <span class="mi">32</span> <span class="n">GB</span>                      <span class="o">|</span>
<span class="o">|</span> <span class="n">Storage</span><span class="p">:</span>       <span class="mi">1</span> <span class="n">TB</span> <span class="n">SSD</span>                   <span class="o">|</span>
<span class="o">|</span> <span class="n">High</span> <span class="n">Avail</span><span class="p">:</span>    <span class="n">Regional</span> <span class="p">(</span><span class="n">failover</span><span class="p">)</span>        <span class="o">|</span>
<span class="o">|</span> <span class="n">Backups</span><span class="p">:</span>       <span class="n">Daily</span> <span class="n">automatic</span>            <span class="o">|</span>
<span class="o">+-------------------------------------------+</span>

<span class="n">Read</span> <span class="n">Replicas</span> <span class="p">(</span><span class="mi">3</span><span class="p">):</span>
<span class="o">+-------------------------------------------+</span>
<span class="o">|</span> <span class="n">Instance</span><span class="p">:</span>      <span class="n">db</span><span class="o">-</span><span class="n">custom</span><span class="o">-</span><span class="mi">4</span><span class="o">-</span><span class="mi">16384</span>          <span class="o">|</span>
<span class="o">|</span> <span class="n">vCPUs</span><span class="p">:</span>         <span class="mi">4</span>                          <span class="o">|</span>
<span class="o">|</span> <span class="n">Memory</span><span class="p">:</span>        <span class="mi">16</span> <span class="n">GB</span>                      <span class="o">|</span>
<span class="o">|</span> <span class="n">Storage</span><span class="p">:</span>       <span class="mi">1</span> <span class="n">TB</span> <span class="n">SSD</span>                   <span class="o">|</span>
<span class="o">|</span> <span class="n">Region</span><span class="p">:</span>        <span class="n">Same</span> <span class="k">as</span> <span class="n">primary</span>            <span class="o">|</span>
<span class="o">+-------------------------------------------+</span>

<span class="n">Replication</span> <span class="n">Architecture</span><span class="p">:</span>
<span class="o">+-------------------------------------------+</span>
<span class="o">|</span>                                           <span class="o">|</span>
<span class="o">|</span>  <span class="o">+-----------+</span>                            <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="n">Primary</span>  <span class="o">|&lt;--</span> <span class="n">All</span> <span class="n">Writes</span>              <span class="o">|</span>
<span class="o">|</span>  <span class="o">+-----------+</span>                            <span class="o">|</span>
<span class="o">|</span>       <span class="o">|</span>                                   <span class="o">|</span>
<span class="o">|</span>       <span class="o">|</span> <span class="n">Async</span> <span class="n">Replication</span>                 <span class="o">|</span>
<span class="o">|</span>       <span class="o">|</span>                                   <span class="o">|</span>
<span class="o">|</span>  <span class="o">+----+----+----+</span>                         <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>    <span class="o">|</span>    <span class="o">|</span>    <span class="o">|</span>                         <span class="o">|</span>
<span class="o">|</span>  <span class="n">v</span>    <span class="n">v</span>    <span class="n">v</span>    <span class="n">v</span>                         <span class="o">|</span>
<span class="o">|</span>  <span class="n">R1</span>   <span class="n">R2</span>   <span class="n">R3</span>   <span class="p">(</span><span class="n">Backups</span><span class="p">)</span>                 <span class="o">|</span>
<span class="o">|</span>  <span class="o">^</span>    <span class="o">^</span>    <span class="o">^</span>                              <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>    <span class="o">|</span>    <span class="o">|</span>                              <span class="o">|</span>
<span class="o">|</span>  <span class="o">+----+----+</span>                              <span class="o">|</span>
<span class="o">|</span>       <span class="o">|</span>                                   <span class="o">|</span>
<span class="o">|</span>       <span class="o">+---</span> <span class="n">Read</span> <span class="n">Traffic</span>                   <span class="o">|</span>
<span class="o">|</span>                                           <span class="o">|</span>
<span class="o">+-------------------------------------------+</span>
</pre></div>
</div>
</section>
<section id="cache-infrastructure">
<h3>Cache Infrastructure<a class="headerlink" href="#cache-infrastructure" title="Link to this heading"></a></h3>
<p>Memorystore for Redis provides caching:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Memorystore</span> <span class="n">Configuration</span><span class="p">:</span>

<span class="o">+-------------------------------------------+</span>
<span class="o">|</span> <span class="n">Tier</span><span class="p">:</span>          <span class="n">Standard</span>                   <span class="o">|</span>
<span class="o">|</span> <span class="n">Capacity</span><span class="p">:</span>      <span class="mi">16</span> <span class="n">GB</span>                      <span class="o">|</span>
<span class="o">|</span> <span class="n">Version</span><span class="p">:</span>       <span class="n">Redis</span> <span class="mf">6.</span><span class="n">x</span>                  <span class="o">|</span>
<span class="o">|</span> <span class="n">High</span> <span class="n">Avail</span><span class="p">:</span>    <span class="n">Yes</span> <span class="p">(</span><span class="n">failover</span> <span class="n">replica</span><span class="p">)</span>     <span class="o">|</span>
<span class="o">|</span> <span class="n">Max</span> <span class="n">Conn</span><span class="p">:</span>      <span class="mi">65</span><span class="p">,</span><span class="mi">000</span>                     <span class="o">|</span>
<span class="o">|</span> <span class="n">Network</span><span class="p">:</span>       <span class="n">Private</span> <span class="n">VPC</span>                <span class="o">|</span>
<span class="o">+-------------------------------------------+</span>

<span class="n">Cache</span> <span class="n">Distribution</span><span class="p">:</span>
<span class="o">+-------------------------------------------+</span>
<span class="o">|</span> <span class="n">Data</span> <span class="n">Type</span>         <span class="o">|</span> <span class="n">Approx</span> <span class="n">Size</span> <span class="o">|</span> <span class="n">TTL</span>     <span class="o">|</span>
<span class="o">+-------------------------------------------+</span>
<span class="o">|</span> <span class="n">Session</span> <span class="n">tokens</span>    <span class="o">|</span> <span class="mi">2</span> <span class="n">GB</span>        <span class="o">|</span> <span class="mi">1</span> <span class="n">hour</span>  <span class="o">|</span>
<span class="o">|</span> <span class="n">Call</span> <span class="n">records</span>      <span class="o">|</span> <span class="mi">4</span> <span class="n">GB</span>        <span class="o">|</span> <span class="mi">24</span> <span class="n">hours</span><span class="o">|</span>
<span class="o">|</span> <span class="n">Agent</span> <span class="n">status</span>      <span class="o">|</span> <span class="mi">1</span> <span class="n">GB</span>        <span class="o">|</span> <span class="mi">5</span> <span class="nb">min</span>   <span class="o">|</span>
<span class="o">|</span> <span class="n">Configuration</span>     <span class="o">|</span> <span class="mi">500</span> <span class="n">MB</span>      <span class="o">|</span> <span class="mi">1</span> <span class="n">hour</span>  <span class="o">|</span>
<span class="o">|</span> <span class="n">Queue</span> <span class="n">stats</span>       <span class="o">|</span> <span class="mi">500</span> <span class="n">MB</span>      <span class="o">|</span> <span class="mi">1</span> <span class="nb">min</span>   <span class="o">|</span>
<span class="o">|</span> <span class="n">Flow</span> <span class="n">definitions</span>  <span class="o">|</span> <span class="mi">2</span> <span class="n">GB</span>        <span class="o">|</span> <span class="mi">1</span> <span class="n">hour</span>  <span class="o">|</span>
<span class="o">|</span> <span class="n">Other</span>             <span class="o">|</span> <span class="mi">6</span> <span class="n">GB</span>        <span class="o">|</span> <span class="n">varies</span>  <span class="o">|</span>
<span class="o">+-------------------------------------------+</span>
</pre></div>
</div>
</section>
<section id="message-queue-infrastructure">
<h3>Message Queue Infrastructure<a class="headerlink" href="#message-queue-infrastructure" title="Link to this heading"></a></h3>
<p>RabbitMQ cluster for messaging:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">RabbitMQ</span> <span class="n">Cluster</span><span class="p">:</span>

<span class="o">+-------------------------------------------+</span>
<span class="o">|</span>  <span class="n">Node</span> <span class="mi">1</span> <span class="p">(</span><span class="n">Primary</span><span class="p">)</span>                         <span class="o">|</span>
<span class="o">|</span>  <span class="o">+----------------------------------+</span>     <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="n">Queues</span><span class="p">:</span> <span class="mi">50</span><span class="o">%</span> <span class="n">of</span> <span class="n">messages</span>         <span class="o">|</span>     <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="n">CPU</span><span class="p">:</span> <span class="mi">4</span> <span class="n">vCPU</span>                     <span class="o">|</span>     <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="n">Memory</span><span class="p">:</span> <span class="mi">16</span> <span class="n">GB</span>                   <span class="o">|</span>     <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="n">Disk</span><span class="p">:</span> <span class="mi">100</span> <span class="n">GB</span> <span class="n">SSD</span>                <span class="o">|</span>     <span class="o">|</span>
<span class="o">|</span>  <span class="o">+----------------------------------+</span>     <span class="o">|</span>
<span class="o">|</span>                                           <span class="o">|</span>
<span class="o">|</span>  <span class="n">Node</span> <span class="mi">2</span> <span class="p">(</span><span class="n">Mirror</span><span class="p">)</span>                          <span class="o">|</span>
<span class="o">|</span>  <span class="o">+----------------------------------+</span>     <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="n">Queues</span><span class="p">:</span> <span class="n">Mirrored</span> <span class="kn">from</span> <span class="nn">Node</span> <span class="mi">1</span>    <span class="o">|</span>     <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="n">CPU</span><span class="p">:</span> <span class="mi">4</span> <span class="n">vCPU</span>                     <span class="o">|</span>     <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="n">Memory</span><span class="p">:</span> <span class="mi">16</span> <span class="n">GB</span>                   <span class="o">|</span>     <span class="o">|</span>
<span class="o">|</span>  <span class="o">+----------------------------------+</span>     <span class="o">|</span>
<span class="o">|</span>                                           <span class="o">|</span>
<span class="o">|</span>  <span class="n">Node</span> <span class="mi">3</span> <span class="p">(</span><span class="n">Mirror</span><span class="p">)</span>                          <span class="o">|</span>
<span class="o">|</span>  <span class="o">+----------------------------------+</span>     <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="n">Queues</span><span class="p">:</span> <span class="n">Mirrored</span> <span class="kn">from</span> <span class="nn">Node</span> <span class="mi">1</span>    <span class="o">|</span>     <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="n">CPU</span><span class="p">:</span> <span class="mi">4</span> <span class="n">vCPU</span>                     <span class="o">|</span>     <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="n">Memory</span><span class="p">:</span> <span class="mi">16</span> <span class="n">GB</span>                   <span class="o">|</span>     <span class="o">|</span>
<span class="o">|</span>  <span class="o">+----------------------------------+</span>     <span class="o">|</span>
<span class="o">+-------------------------------------------+</span>

<span class="n">Queue</span> <span class="n">Mirroring</span> <span class="n">Policy</span><span class="p">:</span>
<span class="o">+-------------------------------------------+</span>
<span class="o">|</span> <span class="n">Pattern</span><span class="p">:</span> <span class="nb">bin</span><span class="o">-</span><span class="n">manager</span><span class="o">.*</span>                    <span class="o">|</span>
<span class="o">|</span> <span class="n">ha</span><span class="o">-</span><span class="n">mode</span><span class="p">:</span> <span class="nb">all</span>                              <span class="o">|</span>
<span class="o">|</span> <span class="n">ha</span><span class="o">-</span><span class="n">sync</span><span class="o">-</span><span class="n">mode</span><span class="p">:</span> <span class="n">automatic</span>                   <span class="o">|</span>
<span class="o">+-------------------------------------------+</span>
</pre></div>
</div>
</section>
<section id="network-architecture">
<h3>Network Architecture<a class="headerlink" href="#network-architecture" title="Link to this heading"></a></h3>
<p>VPC network isolates components:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">VPC</span> <span class="n">Network</span> <span class="n">Design</span><span class="p">:</span>

<span class="o">+------------------------------------------------------------------+</span>
<span class="o">|</span>                         <span class="n">VPC</span><span class="p">:</span> <span class="n">voipbin</span><span class="o">-</span><span class="n">prod</span>                        <span class="o">|</span>
<span class="o">+------------------------------------------------------------------+</span>
<span class="o">|</span>                                                                   <span class="o">|</span>
<span class="o">|</span>  <span class="n">Subnet</span><span class="p">:</span> <span class="n">public</span> <span class="p">(</span><span class="mf">10.0.0.0</span><span class="o">/</span><span class="mi">24</span><span class="p">)</span>                                     <span class="o">|</span>
<span class="o">|</span>  <span class="o">+-------------------------------------------------------------+</span> <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="n">Cloud</span> <span class="n">Load</span> <span class="n">Balancer</span>                                        <span class="o">|</span> <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="n">NAT</span> <span class="n">Gateway</span>                                                 <span class="o">|</span> <span class="o">|</span>
<span class="o">|</span>  <span class="o">+-------------------------------------------------------------+</span> <span class="o">|</span>
<span class="o">|</span>                                                                   <span class="o">|</span>
<span class="o">|</span>  <span class="n">Subnet</span><span class="p">:</span> <span class="n">kubernetes</span> <span class="p">(</span><span class="mf">10.0.1.0</span><span class="o">/</span><span class="mi">24</span><span class="p">)</span>                                 <span class="o">|</span>
<span class="o">|</span>  <span class="o">+-------------------------------------------------------------+</span> <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="n">GKE</span> <span class="n">Cluster</span> <span class="p">(</span><span class="nb">all</span> <span class="n">pods</span><span class="p">)</span>                                     <span class="o">|</span> <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="n">Internal</span> <span class="n">Load</span> <span class="n">Balancers</span>                                    <span class="o">|</span> <span class="o">|</span>
<span class="o">|</span>  <span class="o">+-------------------------------------------------------------+</span> <span class="o">|</span>
<span class="o">|</span>                                                                   <span class="o">|</span>
<span class="o">|</span>  <span class="n">Subnet</span><span class="p">:</span> <span class="n">voip</span> <span class="p">(</span><span class="mf">10.0.2.0</span><span class="o">/</span><span class="mi">24</span><span class="p">)</span>                                       <span class="o">|</span>
<span class="o">|</span>  <span class="o">+-------------------------------------------------------------+</span> <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="n">Kamailio</span> <span class="n">VMs</span>                                               <span class="o">|</span> <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="n">Asterisk</span> <span class="n">VMs</span>                                               <span class="o">|</span> <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="n">RTPEngine</span> <span class="n">VMs</span>                                              <span class="o">|</span> <span class="o">|</span>
<span class="o">|</span>  <span class="o">+-------------------------------------------------------------+</span> <span class="o">|</span>
<span class="o">|</span>                                                                   <span class="o">|</span>
<span class="o">|</span>  <span class="n">Subnet</span><span class="p">:</span> <span class="n">data</span> <span class="p">(</span><span class="mf">10.0.3.0</span><span class="o">/</span><span class="mi">24</span><span class="p">)</span>                                       <span class="o">|</span>
<span class="o">|</span>  <span class="o">+-------------------------------------------------------------+</span> <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="n">Cloud</span> <span class="n">SQL</span> <span class="p">(</span><span class="n">private</span> <span class="n">IP</span><span class="p">)</span>                                     <span class="o">|</span> <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="n">Memorystore</span> <span class="p">(</span><span class="n">private</span> <span class="n">IP</span><span class="p">)</span>                                   <span class="o">|</span> <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="n">RabbitMQ</span> <span class="n">Cluster</span>                                           <span class="o">|</span> <span class="o">|</span>
<span class="o">|</span>  <span class="o">+-------------------------------------------------------------+</span> <span class="o">|</span>
<span class="o">|</span>                                                                   <span class="o">|</span>
<span class="o">+------------------------------------------------------------------+</span>
</pre></div>
</div>
<p><strong>Firewall Rules:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Firewall</span> <span class="n">Configuration</span><span class="p">:</span>

<span class="n">Ingress</span> <span class="p">(</span><span class="n">External</span><span class="p">):</span>
<span class="o">+-------------------------------------------+</span>
<span class="o">|</span> <span class="n">Rule</span>              <span class="o">|</span> <span class="n">Ports</span>    <span class="o">|</span> <span class="n">Source</span>     <span class="o">|</span>
<span class="o">+-------------------------------------------+</span>
<span class="o">|</span> <span class="n">allow</span><span class="o">-</span><span class="n">https</span>       <span class="o">|</span> <span class="mi">443</span>      <span class="o">|</span> <span class="mf">0.0.0.0</span><span class="o">/</span><span class="mi">0</span>  <span class="o">|</span>
<span class="o">|</span> <span class="n">allow</span><span class="o">-</span><span class="n">sip</span>         <span class="o">|</span> <span class="mi">5060</span><span class="o">-</span><span class="mi">5061</span><span class="o">|</span> <span class="mf">0.0.0.0</span><span class="o">/</span><span class="mi">0</span>  <span class="o">|</span>
<span class="o">|</span> <span class="n">allow</span><span class="o">-</span><span class="n">rtp</span>         <span class="o">|</span> <span class="mi">10000</span><span class="o">-</span><span class="mi">60000</span><span class="o">|</span> <span class="mf">0.0.0.0</span><span class="o">/</span><span class="mi">0</span><span class="o">|</span>
<span class="o">+-------------------------------------------+</span>

<span class="n">Internal</span><span class="p">:</span>
<span class="o">+-------------------------------------------+</span>
<span class="o">|</span> <span class="n">Rule</span>              <span class="o">|</span> <span class="n">Ports</span>    <span class="o">|</span> <span class="n">Source</span>     <span class="o">|</span>
<span class="o">+-------------------------------------------+</span>
<span class="o">|</span> <span class="n">allow</span><span class="o">-</span><span class="n">k8s</span><span class="o">-</span><span class="n">internal</span><span class="o">|</span> <span class="nb">all</span>      <span class="o">|</span> <span class="mf">10.0.1.0</span><span class="o">/</span><span class="mi">24</span><span class="o">|</span>
<span class="o">|</span> <span class="n">allow</span><span class="o">-</span><span class="n">voip</span><span class="o">-</span><span class="n">internal</span><span class="o">|</span> <span class="nb">all</span>     <span class="o">|</span> <span class="mf">10.0.2.0</span><span class="o">/</span><span class="mi">24</span><span class="o">|</span>
<span class="o">|</span> <span class="n">allow</span><span class="o">-</span><span class="n">db</span><span class="o">-</span><span class="n">access</span>   <span class="o">|</span> <span class="mi">3306</span><span class="p">,</span><span class="mi">6379</span><span class="o">|</span> <span class="mf">10.0.1.0</span><span class="o">/</span><span class="mi">24</span><span class="o">|</span>
<span class="o">|</span> <span class="n">allow</span><span class="o">-</span><span class="n">rabbit</span>      <span class="o">|</span> <span class="mi">5672</span>     <span class="o">|</span> <span class="mf">10.0.1.0</span><span class="o">/</span><span class="mi">24</span><span class="o">|</span>
<span class="o">+-------------------------------------------+</span>
</pre></div>
</div>
</section>
<section id="load-balancing">
<h3>Load Balancing<a class="headerlink" href="#load-balancing" title="Link to this heading"></a></h3>
<p>Multiple load balancers route traffic:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Load</span> <span class="n">Balancer</span> <span class="n">Architecture</span><span class="p">:</span>

<span class="n">External</span> <span class="p">(</span><span class="n">L7</span> <span class="o">-</span> <span class="n">HTTPS</span><span class="p">):</span>
<span class="o">+-------------------------------------------+</span>
<span class="o">|</span>  <span class="n">api</span><span class="o">.</span><span class="n">voipbin</span><span class="o">.</span><span class="n">net</span>                          <span class="o">|</span>
<span class="o">|</span>  <span class="o">+----------------------------------+</span>     <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="n">Cloud</span> <span class="n">Load</span> <span class="n">Balancer</span> <span class="p">(</span><span class="n">HTTPS</span><span class="p">)</span>    <span class="o">|</span>     <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">-</span> <span class="n">SSL</span> <span class="n">termination</span>              <span class="o">|</span>     <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">-</span> <span class="n">Path</span> <span class="n">routing</span>                 <span class="o">|</span>     <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">-</span> <span class="n">Health</span> <span class="n">checks</span>                <span class="o">|</span>     <span class="o">|</span>
<span class="o">|</span>  <span class="o">+----------------------------------+</span>     <span class="o">|</span>
<span class="o">|</span>           <span class="o">|</span>                              <span class="o">|</span>
<span class="o">|</span>           <span class="n">v</span>                              <span class="o">|</span>
<span class="o">|</span>  <span class="o">+----------------------------------+</span>     <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="n">GKE</span> <span class="n">Ingress</span> <span class="o">-&gt;</span> <span class="n">api</span><span class="o">-</span><span class="n">manager</span>     <span class="o">|</span>     <span class="o">|</span>
<span class="o">|</span>  <span class="o">+----------------------------------+</span>     <span class="o">|</span>
<span class="o">+-------------------------------------------+</span>

<span class="n">External</span> <span class="p">(</span><span class="n">L4</span> <span class="o">-</span> <span class="n">SIP</span><span class="p">):</span>
<span class="o">+-------------------------------------------+</span>
<span class="o">|</span>  <span class="n">sip</span><span class="o">.</span><span class="n">voipbin</span><span class="o">.</span><span class="n">net</span>                          <span class="o">|</span>
<span class="o">|</span>  <span class="o">+----------------------------------+</span>     <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="n">Network</span> <span class="n">Load</span> <span class="n">Balancer</span> <span class="p">(</span><span class="n">TCP</span><span class="o">/</span><span class="n">UDP</span><span class="p">)</span><span class="o">|</span>     <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">-</span> <span class="n">Port</span> <span class="mi">5060</span> <span class="p">(</span><span class="n">UDP</span><span class="o">/</span><span class="n">TCP</span><span class="p">)</span>          <span class="o">|</span>     <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">-</span> <span class="n">Port</span> <span class="mi">5061</span> <span class="p">(</span><span class="n">TLS</span><span class="p">)</span>              <span class="o">|</span>     <span class="o">|</span>
<span class="o">|</span>  <span class="o">+----------------------------------+</span>     <span class="o">|</span>
<span class="o">|</span>           <span class="o">|</span>                              <span class="o">|</span>
<span class="o">|</span>           <span class="n">v</span>                              <span class="o">|</span>
<span class="o">|</span>  <span class="o">+----------------------------------+</span>     <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="n">Kamailio</span> <span class="n">Farm</span>                  <span class="o">|</span>     <span class="o">|</span>
<span class="o">|</span>  <span class="o">+----------------------------------+</span>     <span class="o">|</span>
<span class="o">+-------------------------------------------+</span>

<span class="n">Internal</span> <span class="p">(</span><span class="n">Services</span><span class="p">):</span>
<span class="o">+-------------------------------------------+</span>
<span class="o">|</span>  <span class="n">Kubernetes</span> <span class="n">Service</span> <span class="p">(</span><span class="n">ClusterIP</span><span class="p">)</span>          <span class="o">|</span>
<span class="o">|</span>  <span class="o">-</span> <span class="nb">bin</span><span class="o">-</span><span class="n">call</span><span class="o">-</span><span class="n">manager</span><span class="p">:</span><span class="mi">8080</span>                 <span class="o">|</span>
<span class="o">|</span>  <span class="o">-</span> <span class="nb">bin</span><span class="o">-</span><span class="n">flow</span><span class="o">-</span><span class="n">manager</span><span class="p">:</span><span class="mi">8080</span>                 <span class="o">|</span>
<span class="o">|</span>  <span class="o">-</span> <span class="o">...</span>                                   <span class="o">|</span>
<span class="o">+-------------------------------------------+</span>
</pre></div>
</div>
</section>
<section id="monitoring-stack">
<h3>Monitoring Stack<a class="headerlink" href="#monitoring-stack" title="Link to this heading"></a></h3>
<p>Prometheus and Grafana for observability:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Monitoring</span> <span class="n">Architecture</span><span class="p">:</span>

<span class="o">+-------------------------------------------+</span>
<span class="o">|</span>             <span class="n">Grafana</span> <span class="n">Dashboard</span>             <span class="o">|</span>
<span class="o">|</span>  <span class="o">+----------------------------------+</span>     <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="n">Service</span> <span class="n">Health</span>                 <span class="o">|</span>     <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="n">Call</span> <span class="n">Metrics</span>                   <span class="o">|</span>     <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="n">Queue</span> <span class="n">Depths</span>                   <span class="o">|</span>     <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="n">Error</span> <span class="n">Rates</span>                    <span class="o">|</span>     <span class="o">|</span>
<span class="o">|</span>  <span class="o">+----------------------------------+</span>     <span class="o">|</span>
<span class="o">+-------------------------------------------+</span>
                    <span class="o">^</span>
                    <span class="o">|</span>
<span class="o">+-------------------------------------------+</span>
<span class="o">|</span>               <span class="n">Prometheus</span>                  <span class="o">|</span>
<span class="o">|</span>  <span class="o">+----------------------------------+</span>     <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="n">Scrape</span> <span class="n">interval</span><span class="p">:</span> <span class="mi">15</span><span class="n">s</span>           <span class="o">|</span>     <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="n">Retention</span><span class="p">:</span> <span class="mi">30</span> <span class="n">days</span>             <span class="o">|</span>     <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="n">Storage</span><span class="p">:</span> <span class="mi">100</span> <span class="n">GB</span>                <span class="o">|</span>     <span class="o">|</span>
<span class="o">|</span>  <span class="o">+----------------------------------+</span>     <span class="o">|</span>
<span class="o">+-------------------------------------------+</span>
                    <span class="o">^</span>
                    <span class="o">|</span>
<span class="o">+-------+-------+-------+-------+-------+</span>
<span class="o">|</span>       <span class="o">|</span>       <span class="o">|</span>       <span class="o">|</span>       <span class="o">|</span>       <span class="o">|</span>
<span class="n">v</span>       <span class="n">v</span>       <span class="n">v</span>       <span class="n">v</span>       <span class="n">v</span>       <span class="n">v</span>
<span class="n">api</span>     <span class="n">call</span>    <span class="n">flow</span>    <span class="n">ai</span>      <span class="n">voip</span>   <span class="n">db</span>
<span class="p">:</span><span class="mi">2112</span>   <span class="p">:</span><span class="mi">2112</span>   <span class="p">:</span><span class="mi">2112</span>   <span class="p">:</span><span class="mi">2112</span>   <span class="p">:</span><span class="mi">9100</span>  <span class="p">:</span><span class="mi">9104</span>
</pre></div>
</div>
<p><strong>Key Metrics Collected:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Prometheus</span> <span class="n">Metrics</span><span class="p">:</span>

<span class="n">Service</span> <span class="n">Metrics</span> <span class="p">(</span><span class="n">port</span> <span class="mi">2112</span><span class="p">):</span>
<span class="o">+-------------------------------------------+</span>
<span class="o">|</span> <span class="n">voipbin_http_requests_total</span>               <span class="o">|</span>
<span class="o">|</span> <span class="n">voipbin_http_request_duration_seconds</span>     <span class="o">|</span>
<span class="o">|</span> <span class="n">voipbin_rpc_requests_total</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">voipbin_rpc_request_duration_seconds</span>      <span class="o">|</span>
<span class="o">|</span> <span class="n">voipbin_active_calls_gauge</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">voipbin_queue_depth_gauge</span>                 <span class="o">|</span>
<span class="o">+-------------------------------------------+</span>

<span class="n">Infrastructure</span> <span class="n">Metrics</span><span class="p">:</span>
<span class="o">+-------------------------------------------+</span>
<span class="o">|</span> <span class="n">container_cpu_usage_seconds_total</span>         <span class="o">|</span>
<span class="o">|</span> <span class="n">container_memory_usage_bytes</span>              <span class="o">|</span>
<span class="o">|</span> <span class="n">mysql_global_status_threads_connected</span>     <span class="o">|</span>
<span class="o">|</span> <span class="n">redis_connected_clients</span>                   <span class="o">|</span>
<span class="o">|</span> <span class="n">rabbitmq_queue_messages</span>                   <span class="o">|</span>
<span class="o">+-------------------------------------------+</span>
</pre></div>
</div>
</section>
<section id="deployment-pipeline">
<h3>Deployment Pipeline<a class="headerlink" href="#deployment-pipeline" title="Link to this heading"></a></h3>
<p>CI/CD with CircleCI:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Deployment</span> <span class="n">Pipeline</span><span class="p">:</span>

<span class="n">Developer</span>        <span class="n">GitHub</span>         <span class="n">CircleCI</span>         <span class="n">GKE</span>
    <span class="o">|</span>               <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>
    <span class="o">|</span> <span class="n">Push</span>          <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>
    <span class="o">+--------------&gt;|</span>              <span class="o">|</span>              <span class="o">|</span>
    <span class="o">|</span>               <span class="o">|</span> <span class="n">Webhook</span>      <span class="o">|</span>              <span class="o">|</span>
    <span class="o">|</span>               <span class="o">+-------------&gt;|</span>              <span class="o">|</span>
    <span class="o">|</span>               <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>
    <span class="o">|</span>               <span class="o">|</span>              <span class="o">|</span> <span class="mf">1.</span> <span class="n">Checkout</span>  <span class="o">|</span>
    <span class="o">|</span>               <span class="o">|</span>              <span class="o">|</span> <span class="mf">2.</span> <span class="n">Test</span>      <span class="o">|</span>
    <span class="o">|</span>               <span class="o">|</span>              <span class="o">|</span> <span class="mf">3.</span> <span class="n">Lint</span>      <span class="o">|</span>
    <span class="o">|</span>               <span class="o">|</span>              <span class="o">|</span> <span class="mf">4.</span> <span class="n">Build</span>     <span class="o">|</span>
    <span class="o">|</span>               <span class="o">|</span>              <span class="o">|</span> <span class="mf">5.</span> <span class="n">Push</span> <span class="n">Image</span><span class="o">|</span>
    <span class="o">|</span>               <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>
    <span class="o">|</span>               <span class="o">|</span>              <span class="o">|</span> <span class="p">(</span><span class="k">if</span> <span class="n">main</span><span class="p">)</span>    <span class="o">|</span>
    <span class="o">|</span>               <span class="o">|</span>              <span class="o">|</span> <span class="mf">6.</span> <span class="n">Deploy</span>    <span class="o">|</span>
    <span class="o">|</span>               <span class="o">|</span>              <span class="o">+-------------&gt;|</span>
    <span class="o">|</span>               <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>
    <span class="o">|</span>               <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span> <span class="n">Rolling</span>
    <span class="o">|</span>               <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span> <span class="n">Update</span>
    <span class="o">|</span>               <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>
    <span class="o">|</span>               <span class="o">|</span>              <span class="o">|&lt;-------------+</span>
    <span class="o">|</span>               <span class="o">|</span>              <span class="o">|</span> <span class="n">Deploy</span> <span class="n">Done</span>  <span class="o">|</span>
    <span class="o">|</span>               <span class="o">|</span>              <span class="o">|</span>              <span class="o">|</span>
</pre></div>
</div>
<p><strong>Rolling Update Strategy:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Deployment</span> <span class="n">Strategy</span><span class="p">:</span>

<span class="n">spec</span><span class="p">:</span>
  <span class="n">strategy</span><span class="p">:</span>
    <span class="nb">type</span><span class="p">:</span> <span class="n">RollingUpdate</span>
    <span class="n">rollingUpdate</span><span class="p">:</span>
      <span class="n">maxSurge</span><span class="p">:</span> <span class="mi">1</span>        <span class="c1"># Create 1 new pod at a time</span>
      <span class="n">maxUnavailable</span><span class="p">:</span> <span class="mi">0</span>  <span class="c1"># Never have 0 ready pods</span>

<span class="n">Update</span> <span class="n">Flow</span><span class="p">:</span>
<span class="o">+-------------------------------------------+</span>
<span class="o">|</span> <span class="mf">1.</span> <span class="n">New</span> <span class="n">pod</span> <span class="n">created</span> <span class="k">with</span> <span class="n">new</span> <span class="n">version</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">2.</span> <span class="n">Wait</span> <span class="k">for</span> <span class="n">readiness</span> <span class="n">probe</span> <span class="n">success</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">3.</span> <span class="n">Remove</span> <span class="n">old</span> <span class="n">pod</span> <span class="kn">from</span> <span class="nn">service</span>            <span class="o">|</span>
<span class="o">|</span> <span class="mf">4.</span> <span class="n">Terminate</span> <span class="n">old</span> <span class="n">pod</span>                      <span class="o">|</span>
<span class="o">|</span> <span class="mf">5.</span> <span class="n">Repeat</span> <span class="k">for</span> <span class="nb">all</span> <span class="n">replicas</span>                <span class="o">|</span>
<span class="o">+-------------------------------------------+</span>

<span class="n">Zero</span><span class="o">-</span><span class="n">Downtime</span><span class="p">:</span>
<span class="o">-</span> <span class="n">At</span> <span class="n">least</span> <span class="mi">1</span> <span class="n">pod</span> <span class="n">always</span> <span class="n">ready</span>
<span class="o">-</span> <span class="n">No</span> <span class="n">traffic</span> <span class="n">to</span> <span class="n">terminating</span> <span class="n">pods</span>
<span class="o">-</span> <span class="n">Graceful</span> <span class="n">shutdown</span> <span class="p">(</span><span class="n">SIGTERM</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="disaster-recovery">
<h3>Disaster Recovery<a class="headerlink" href="#disaster-recovery" title="Link to this heading"></a></h3>
<p>Multi-region resilience:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DR</span> <span class="n">Strategy</span><span class="p">:</span>

<span class="n">Primary</span> <span class="n">Region</span><span class="p">:</span> <span class="n">us</span><span class="o">-</span><span class="n">central1</span>
<span class="o">+-------------------------------------------+</span>
<span class="o">|</span>  <span class="n">GKE</span> <span class="n">Cluster</span> <span class="p">(</span><span class="n">Active</span><span class="p">)</span>                     <span class="o">|</span>
<span class="o">|</span>  <span class="n">Cloud</span> <span class="n">SQL</span> <span class="n">Primary</span>                        <span class="o">|</span>
<span class="o">|</span>  <span class="n">Memorystore</span>                              <span class="o">|</span>
<span class="o">|</span>  <span class="n">VoIP</span> <span class="n">VMs</span>                                 <span class="o">|</span>
<span class="o">+-------------------------------------------+</span>

<span class="n">DR</span> <span class="n">Region</span><span class="p">:</span> <span class="n">us</span><span class="o">-</span><span class="n">east1</span> <span class="p">(</span><span class="n">Standby</span><span class="p">)</span>
<span class="o">+-------------------------------------------+</span>
<span class="o">|</span>  <span class="n">GKE</span> <span class="n">Cluster</span> <span class="p">(</span><span class="n">Warm</span> <span class="n">Standby</span><span class="p">)</span>               <span class="o">|</span>
<span class="o">|</span>  <span class="n">Cloud</span> <span class="n">SQL</span> <span class="n">Replica</span>                        <span class="o">|</span>
<span class="o">|</span>  <span class="n">Memorystore</span> <span class="p">(</span><span class="n">Separate</span><span class="p">)</span>                   <span class="o">|</span>
<span class="o">|</span>  <span class="n">VoIP</span> <span class="n">VMs</span> <span class="p">(</span><span class="n">Ready</span> <span class="n">to</span> <span class="n">scale</span><span class="p">)</span>                <span class="o">|</span>
<span class="o">+-------------------------------------------+</span>

<span class="n">Recovery</span> <span class="n">Objectives</span><span class="p">:</span>
<span class="o">+-------------------------------------------+</span>
<span class="o">|</span> <span class="n">RTO</span> <span class="p">(</span><span class="n">Recovery</span> <span class="n">Time</span><span class="p">):</span>    <span class="o">&lt;</span> <span class="mi">30</span> <span class="n">minutes</span>      <span class="o">|</span>
<span class="o">|</span> <span class="n">RPO</span> <span class="p">(</span><span class="n">Data</span> <span class="n">Loss</span><span class="p">):</span>        <span class="o">&lt;</span> <span class="mi">5</span> <span class="n">minutes</span>       <span class="o">|</span>
<span class="o">+-------------------------------------------+</span>
</pre></div>
</div>
<p><strong>Failover Procedure:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DR</span> <span class="n">Failover</span> <span class="n">Steps</span><span class="p">:</span>

<span class="mf">1.</span> <span class="n">Detect</span> <span class="n">Failure</span>
   <span class="o">+----------------------------------+</span>
   <span class="o">|</span> <span class="o">-</span> <span class="n">Monitor</span> <span class="n">alerts</span> <span class="n">trigger</span>         <span class="o">|</span>
   <span class="o">|</span> <span class="o">-</span> <span class="n">Confirm</span> <span class="n">region</span> <span class="n">outage</span>          <span class="o">|</span>
   <span class="o">+----------------------------------+</span>

<span class="mf">2.</span> <span class="n">Database</span> <span class="n">Failover</span>
   <span class="o">+----------------------------------+</span>
   <span class="o">|</span> <span class="o">-</span> <span class="n">Promote</span> <span class="n">DR</span> <span class="n">replica</span> <span class="n">to</span> <span class="n">primary</span>  <span class="o">|</span>
   <span class="o">|</span> <span class="o">-</span> <span class="n">Update</span> <span class="n">connection</span> <span class="n">strings</span>      <span class="o">|</span>
   <span class="o">+----------------------------------+</span>

<span class="mf">3.</span> <span class="n">Traffic</span> <span class="n">Redirect</span>
   <span class="o">+----------------------------------+</span>
   <span class="o">|</span> <span class="o">-</span> <span class="n">Update</span> <span class="n">DNS</span> <span class="p">(</span><span class="n">Cloud</span> <span class="n">DNS</span><span class="p">)</span>         <span class="o">|</span>
   <span class="o">|</span> <span class="o">-</span> <span class="n">Route</span> <span class="n">traffic</span> <span class="n">to</span> <span class="n">DR</span> <span class="n">region</span>     <span class="o">|</span>
   <span class="o">+----------------------------------+</span>

<span class="mf">4.</span> <span class="n">Scale</span> <span class="n">DR</span> <span class="n">Resources</span>
   <span class="o">+----------------------------------+</span>
   <span class="o">|</span> <span class="o">-</span> <span class="n">Scale</span> <span class="n">GKE</span> <span class="n">deployments</span>          <span class="o">|</span>
   <span class="o">|</span> <span class="o">-</span> <span class="n">Start</span> <span class="n">additional</span> <span class="n">VoIP</span> <span class="n">VMs</span>      <span class="o">|</span>
   <span class="o">+----------------------------------+</span>

<span class="mf">5.</span> <span class="n">Verify</span> <span class="n">Services</span>
   <span class="o">+----------------------------------+</span>
   <span class="o">|</span> <span class="o">-</span> <span class="n">Health</span> <span class="n">checks</span> <span class="k">pass</span>             <span class="o">|</span>
   <span class="o">|</span> <span class="o">-</span> <span class="n">Test</span> <span class="n">critical</span> <span class="n">paths</span>            <span class="o">|</span>
   <span class="o">+----------------------------------+</span>
</pre></div>
</div>
</section>
<section id="cost-optimization">
<h3>Cost Optimization<a class="headerlink" href="#cost-optimization" title="Link to this heading"></a></h3>
<p>Resource efficiency strategies:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Cost</span> <span class="n">Optimization</span><span class="p">:</span>

<span class="n">Committed</span> <span class="n">Use</span> <span class="n">Discounts</span><span class="p">:</span>
<span class="o">+-------------------------------------------+</span>
<span class="o">|</span> <span class="n">GKE</span> <span class="n">nodes</span><span class="p">:</span>      <span class="mi">3</span><span class="o">-</span><span class="n">year</span> <span class="n">commitment</span> <span class="p">(</span><span class="mi">57</span><span class="o">%</span><span class="p">)</span>   <span class="o">|</span>
<span class="o">|</span> <span class="n">Cloud</span> <span class="n">SQL</span><span class="p">:</span>      <span class="mi">3</span><span class="o">-</span><span class="n">year</span> <span class="n">commitment</span> <span class="p">(</span><span class="mi">57</span><span class="o">%</span><span class="p">)</span>   <span class="o">|</span>
<span class="o">|</span> <span class="n">Memorystore</span><span class="p">:</span>    <span class="mi">1</span><span class="o">-</span><span class="n">year</span> <span class="n">commitment</span> <span class="p">(</span><span class="mi">25</span><span class="o">%</span><span class="p">)</span>   <span class="o">|</span>
<span class="o">+-------------------------------------------+</span>

<span class="n">Preemptible</span> <span class="n">VMs</span> <span class="p">(</span><span class="n">non</span><span class="o">-</span><span class="n">critical</span><span class="p">):</span>
<span class="o">+-------------------------------------------+</span>
<span class="o">|</span> <span class="n">CI</span><span class="o">/</span><span class="n">CD</span> <span class="n">runners</span><span class="p">:</span>  <span class="n">Preemptible</span> <span class="p">(</span><span class="mi">80</span><span class="o">%</span> <span class="n">savings</span><span class="p">)</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Batch</span> <span class="n">jobs</span><span class="p">:</span>     <span class="n">Preemptible</span>               <span class="o">|</span>
<span class="o">+-------------------------------------------+</span>

<span class="n">Right</span><span class="o">-</span><span class="n">sizing</span><span class="p">:</span>
<span class="o">+-------------------------------------------+</span>
<span class="o">|</span> <span class="n">Monthly</span> <span class="n">review</span> <span class="n">of</span> <span class="n">resource</span> <span class="n">utilization</span>    <span class="o">|</span>
<span class="o">|</span> <span class="n">Downsize</span> <span class="n">underutilized</span> <span class="n">instances</span>          <span class="o">|</span>
<span class="o">|</span> <span class="n">Upsize</span> <span class="n">bottlenecked</span> <span class="n">services</span>              <span class="o">|</span>
<span class="o">+-------------------------------------------+</span>

<span class="n">Auto</span><span class="o">-</span><span class="n">scaling</span><span class="p">:</span>
<span class="o">+-------------------------------------------+</span>
<span class="o">|</span> <span class="n">Scale</span> <span class="n">down</span> <span class="n">during</span> <span class="n">off</span><span class="o">-</span><span class="n">peak</span> <span class="n">hours</span>          <span class="o">|</span>
<span class="o">|</span> <span class="n">Scale</span> <span class="n">up</span> <span class="n">only</span> <span class="n">when</span> <span class="n">needed</span>                 <span class="o">|</span>
<span class="o">|</span> <span class="n">Set</span> <span class="n">appropriate</span> <span class="nb">min</span><span class="o">/</span><span class="nb">max</span> <span class="n">replicas</span>          <span class="o">|</span>
<span class="o">+-------------------------------------------+</span>
</pre></div>
</div>
</section>
</section>
<section id="security-architecture">
<span id="architecture-security"></span><h2>Security Architecture<a class="headerlink" href="#security-architecture" title="Link to this heading"></a></h2>
<p>VoIPBIN implements defense-in-depth security across all layers, from API authentication to data encryption. This section details the security architecture, authentication flows, and protection mechanisms.</p>
<section id="security-overview">
<h3>Security Overview<a class="headerlink" href="#security-overview" title="Link to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Security</span> <span class="n">Layers</span><span class="p">:</span>

<span class="o">+------------------------------------------------------------------+</span>
<span class="o">|</span>                      <span class="n">External</span> <span class="n">Clients</span>                            <span class="o">|</span>
<span class="o">+------------------------------------------------------------------+</span>
                            <span class="o">|</span>
                            <span class="n">v</span>
<span class="o">+------------------------------------------------------------------+</span>
<span class="o">|</span> <span class="n">Layer</span> <span class="mi">1</span><span class="p">:</span> <span class="n">Edge</span> <span class="n">Security</span>                                           <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="n">TLS</span> <span class="mf">1.3</span> <span class="n">encryption</span>                                            <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="n">DDoS</span> <span class="n">protection</span> <span class="p">(</span><span class="n">Cloud</span> <span class="n">Armor</span><span class="p">)</span>                                 <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="n">WAF</span> <span class="n">rules</span>                                                     <span class="o">|</span>
<span class="o">+------------------------------------------------------------------+</span>
                            <span class="o">|</span>
                            <span class="n">v</span>
<span class="o">+------------------------------------------------------------------+</span>
<span class="o">|</span> <span class="n">Layer</span> <span class="mi">2</span><span class="p">:</span> <span class="n">API</span> <span class="n">Gateway</span> <span class="p">(</span><span class="nb">bin</span><span class="o">-</span><span class="n">api</span><span class="o">-</span><span class="n">manager</span><span class="p">)</span>                           <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="n">JWT</span><span class="o">/</span><span class="n">AccessKey</span> <span class="n">authentication</span>                                  <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="n">Authorization</span> <span class="n">checks</span>                                          <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="n">Rate</span> <span class="n">limiting</span>                                                 <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="n">Input</span> <span class="n">validation</span>                                              <span class="o">|</span>
<span class="o">+------------------------------------------------------------------+</span>
                            <span class="o">|</span>
                            <span class="n">v</span>
<span class="o">+------------------------------------------------------------------+</span>
<span class="o">|</span> <span class="n">Layer</span> <span class="mi">3</span><span class="p">:</span> <span class="n">Internal</span> <span class="n">Services</span>                                       <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="n">Network</span> <span class="n">isolation</span> <span class="p">(</span><span class="n">VPC</span><span class="p">)</span>                                       <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="n">Service</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">service</span> <span class="n">trust</span>                                      <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="n">No</span> <span class="n">external</span> <span class="n">exposure</span>                                          <span class="o">|</span>
<span class="o">+------------------------------------------------------------------+</span>
                            <span class="o">|</span>
                            <span class="n">v</span>
<span class="o">+------------------------------------------------------------------+</span>
<span class="o">|</span> <span class="n">Layer</span> <span class="mi">4</span><span class="p">:</span> <span class="n">Data</span> <span class="n">Layer</span>                                              <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="n">Encryption</span> <span class="n">at</span> <span class="n">rest</span>                                            <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="n">Encrypted</span> <span class="n">connections</span>                                         <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="n">Access</span> <span class="n">controls</span>                                               <span class="o">|</span>
<span class="o">+------------------------------------------------------------------+</span>
</pre></div>
</div>
</section>
<section id="authentication-architecture">
<h3>Authentication Architecture<a class="headerlink" href="#authentication-architecture" title="Link to this heading"></a></h3>
<p>VoIPBIN supports two authentication methods: JWT tokens and Access Keys.</p>
<p><strong>Authentication Flow:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">JWT</span> <span class="n">Authentication</span> <span class="n">Flow</span><span class="p">:</span>

<span class="n">Client</span>                  <span class="n">API</span> <span class="n">Gateway</span>              <span class="n">Auth</span> <span class="n">Service</span>
   <span class="o">|</span>                        <span class="o">|</span>                         <span class="o">|</span>
   <span class="o">|</span> <span class="n">POST</span> <span class="o">/</span><span class="n">auth</span><span class="o">/</span><span class="n">login</span>       <span class="o">|</span>                         <span class="o">|</span>
   <span class="o">|</span> <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>   <span class="o">|</span>                         <span class="o">|</span>
   <span class="o">+-----------------------&gt;|</span>                         <span class="o">|</span>
   <span class="o">|</span>                        <span class="o">|</span>                         <span class="o">|</span>
   <span class="o">|</span>                        <span class="o">|</span> <span class="n">Validate</span> <span class="n">Credentials</span>    <span class="o">|</span>
   <span class="o">|</span>                        <span class="o">+------------------------&gt;|</span>
   <span class="o">|</span>                        <span class="o">|</span>                         <span class="o">|</span>
   <span class="o">|</span>                        <span class="o">|&lt;------------------------+</span>
   <span class="o">|</span>                        <span class="o">|</span> <span class="n">User</span> <span class="n">Valid</span> <span class="o">+</span> <span class="n">Permissions</span><span class="o">|</span>
   <span class="o">|</span>                        <span class="o">|</span>                         <span class="o">|</span>
   <span class="o">|</span>                        <span class="o">|</span> <span class="n">Generate</span> <span class="n">JWT</span> <span class="n">Token</span>      <span class="o">|</span>
   <span class="o">|</span>                        <span class="o">|</span> <span class="p">(</span><span class="n">HS256</span> <span class="n">signed</span><span class="p">)</span>          <span class="o">|</span>
   <span class="o">|</span>                        <span class="o">|</span>                         <span class="o">|</span>
   <span class="o">|&lt;-----------------------+</span>                         <span class="o">|</span>
   <span class="o">|</span> <span class="p">{</span> <span class="s2">&quot;token&quot;</span><span class="p">:</span> <span class="s2">&quot;eyJ...&quot;</span> <span class="p">}</span>  <span class="o">|</span>                         <span class="o">|</span>
   <span class="o">|</span>                        <span class="o">|</span>                         <span class="o">|</span>
   <span class="o">|</span>                        <span class="o">|</span>                         <span class="o">|</span>
   <span class="o">|</span> <span class="n">GET</span> <span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">calls</span>          <span class="o">|</span>                         <span class="o">|</span>
   <span class="o">|</span> <span class="n">Authorization</span><span class="p">:</span> <span class="n">Bearer</span> <span class="n">eyJ</span><span class="o">...</span>                     <span class="o">|</span>
   <span class="o">+-----------------------&gt;|</span>                         <span class="o">|</span>
   <span class="o">|</span>                        <span class="o">|</span>                         <span class="o">|</span>
   <span class="o">|</span>                        <span class="o">|</span> <span class="n">Validate</span> <span class="n">JWT</span><span class="p">:</span>           <span class="o">|</span>
   <span class="o">|</span>                        <span class="o">|</span> <span class="mf">1.</span> <span class="n">Verify</span> <span class="n">signature</span>     <span class="o">|</span>
   <span class="o">|</span>                        <span class="o">|</span> <span class="mf">2.</span> <span class="n">Check</span> <span class="n">expiration</span>     <span class="o">|</span>
   <span class="o">|</span>                        <span class="o">|</span> <span class="mf">3.</span> <span class="n">Extract</span> <span class="n">claims</span>       <span class="o">|</span>
   <span class="o">|</span>                        <span class="o">|</span>                         <span class="o">|</span>
   <span class="o">|</span>                        <span class="o">|</span> <span class="n">Route</span> <span class="n">to</span> <span class="n">call</span><span class="o">-</span><span class="n">manager</span>   <span class="o">|</span>
   <span class="o">|</span>                        <span class="o">|</span> <span class="p">(</span><span class="k">with</span> <span class="n">customer_id</span><span class="p">)</span>      <span class="o">|</span>
   <span class="o">|</span>                        <span class="o">|</span>                         <span class="o">|</span>
   <span class="o">|&lt;-----------------------+</span>                         <span class="o">|</span>
   <span class="o">|</span> <span class="p">{</span> <span class="n">calls</span><span class="p">:</span> <span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="p">}</span>       <span class="o">|</span>                         <span class="o">|</span>
   <span class="o">|</span>                        <span class="o">|</span>                         <span class="o">|</span>
</pre></div>
</div>
<p><strong>JWT Token Structure:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">JWT</span> <span class="n">Token</span> <span class="n">Claims</span><span class="p">:</span>

<span class="n">Header</span><span class="p">:</span>
<span class="p">{</span>
  <span class="s2">&quot;alg&quot;</span><span class="p">:</span> <span class="s2">&quot;HS256&quot;</span><span class="p">,</span>
  <span class="s2">&quot;typ&quot;</span><span class="p">:</span> <span class="s2">&quot;JWT&quot;</span>
<span class="p">}</span>

<span class="n">Payload</span><span class="p">:</span>
<span class="p">{</span>
  <span class="s2">&quot;customer_id&quot;</span><span class="p">:</span> <span class="s2">&quot;uuid&quot;</span><span class="p">,</span>      <span class="o">//</span> <span class="n">Customer</span> <span class="n">UUID</span>
  <span class="s2">&quot;agent_id&quot;</span><span class="p">:</span> <span class="s2">&quot;uuid&quot;</span><span class="p">,</span>         <span class="o">//</span> <span class="n">Agent</span> <span class="n">UUID</span> <span class="p">(</span><span class="n">optional</span><span class="p">)</span>
  <span class="s2">&quot;permissions&quot;</span><span class="p">:</span> <span class="p">[</span>            <span class="o">//</span> <span class="n">Permission</span> <span class="nb">list</span>
    <span class="s2">&quot;customer_admin&quot;</span><span class="p">,</span>
    <span class="s2">&quot;call_create&quot;</span><span class="p">,</span>
    <span class="s2">&quot;call_read&quot;</span>
  <span class="p">],</span>
  <span class="s2">&quot;iat&quot;</span><span class="p">:</span> <span class="mi">1706000000</span><span class="p">,</span>          <span class="o">//</span> <span class="n">Issued</span> <span class="n">at</span>
  <span class="s2">&quot;exp&quot;</span><span class="p">:</span> <span class="mi">1706003600</span>           <span class="o">//</span> <span class="n">Expires</span> <span class="p">(</span><span class="mi">1</span> <span class="n">hour</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">Signature</span><span class="p">:</span>
<span class="n">HMACSHA256</span><span class="p">(</span>
  <span class="n">base64UrlEncode</span><span class="p">(</span><span class="n">header</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span>
  <span class="n">base64UrlEncode</span><span class="p">(</span><span class="n">payload</span><span class="p">),</span>
  <span class="n">secret</span>
<span class="p">)</span>
</pre></div>
</div>
<p><strong>Access Key Authentication:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Access</span> <span class="n">Key</span> <span class="n">Flow</span><span class="p">:</span>

<span class="n">Client</span>                  <span class="n">API</span> <span class="n">Gateway</span>
   <span class="o">|</span>                        <span class="o">|</span>
   <span class="o">|</span> <span class="n">GET</span> <span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">calls</span>          <span class="o">|</span>
   <span class="o">|</span> <span class="n">Authorization</span><span class="p">:</span> <span class="n">AccessKey</span> <span class="n">ak_xxxxx</span>
   <span class="o">+-----------------------&gt;|</span>
   <span class="o">|</span>                        <span class="o">|</span>
   <span class="o">|</span>                        <span class="o">|</span> <span class="n">Lookup</span> <span class="n">Access</span> <span class="n">Key</span><span class="p">:</span>
   <span class="o">|</span>                        <span class="o">|</span> <span class="mf">1.</span> <span class="n">Find</span> <span class="ow">in</span> <span class="n">database</span>
   <span class="o">|</span>                        <span class="o">|</span> <span class="mf">2.</span> <span class="n">Verify</span> <span class="ow">not</span> <span class="n">expired</span>
   <span class="o">|</span>                        <span class="o">|</span> <span class="mf">3.</span> <span class="n">Check</span> <span class="n">permissions</span>
   <span class="o">|</span>                        <span class="o">|</span> <span class="mf">4.</span> <span class="n">Get</span> <span class="n">customer_id</span>
   <span class="o">|</span>                        <span class="o">|</span>
   <span class="o">|</span>                        <span class="o">|</span> <span class="n">Route</span> <span class="n">to</span> <span class="n">call</span><span class="o">-</span><span class="n">manager</span>
   <span class="o">|</span>                        <span class="o">|</span> <span class="p">(</span><span class="k">with</span> <span class="n">customer_id</span><span class="p">)</span>
   <span class="o">|</span>                        <span class="o">|</span>
   <span class="o">|&lt;-----------------------+</span>
   <span class="o">|</span> <span class="p">{</span> <span class="n">calls</span><span class="p">:</span> <span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="p">}</span>       <span class="o">|</span>
   <span class="o">|</span>                        <span class="o">|</span>
</pre></div>
</div>
<p><strong>Access Key Structure:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Access</span> <span class="n">Key</span><span class="p">:</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">Format</span><span class="p">:</span> <span class="n">ak_</span><span class="o">&lt;</span><span class="mi">32</span><span class="o">-</span><span class="n">character</span><span class="o">-</span><span class="n">random</span><span class="o">-</span><span class="n">string</span><span class="o">&gt;</span>  <span class="o">|</span>
<span class="o">|</span> <span class="n">Example</span><span class="p">:</span> <span class="n">ak_a1b2c3d4e5f6g7h8i9j0k1l2m3n4</span><span class="o">|</span>
<span class="o">+------------------------------------------+</span>

<span class="n">Database</span> <span class="n">Record</span><span class="p">:</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="nb">id</span><span class="p">:</span>           <span class="n">UUID</span>                       <span class="o">|</span>
<span class="o">|</span> <span class="n">customer_id</span><span class="p">:</span>  <span class="n">UUID</span>                       <span class="o">|</span>
<span class="o">|</span> <span class="n">key_hash</span><span class="p">:</span>     <span class="n">SHA256</span> <span class="nb">hash</span> <span class="n">of</span> <span class="n">key</span>         <span class="o">|</span>
<span class="o">|</span> <span class="n">permissions</span><span class="p">:</span>  <span class="n">JSON</span> <span class="n">array</span>                 <span class="o">|</span>
<span class="o">|</span> <span class="n">tm_expire</span><span class="p">:</span>    <span class="n">Expiration</span> <span class="n">timestamp</span>       <span class="o">|</span>
<span class="o">|</span> <span class="n">tm_create</span><span class="p">:</span>    <span class="n">Creation</span> <span class="n">timestamp</span>         <span class="o">|</span>
<span class="o">+------------------------------------------+</span>
</pre></div>
</div>
</section>
<section id="authorization-model">
<h3>Authorization Model<a class="headerlink" href="#authorization-model" title="Link to this heading"></a></h3>
<p>VoIPBIN uses role-based access control (RBAC):</p>
<p><strong>Permission Hierarchy:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Permission</span> <span class="n">Structure</span><span class="p">:</span>

<span class="n">Customer</span> <span class="n">Level</span><span class="p">:</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">customer_admin</span>                           <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="n">Full</span> <span class="n">access</span> <span class="n">to</span> <span class="nb">all</span> <span class="n">customer</span> <span class="n">resources</span><span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="n">Can</span> <span class="n">manage</span> <span class="n">agents</span> <span class="ow">and</span> <span class="n">access</span> <span class="n">keys</span>    <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="n">Can</span> <span class="n">view</span> <span class="n">billing</span>                     <span class="o">|</span>
<span class="o">+------------------------------------------+</span>

<span class="n">Manager</span> <span class="n">Level</span><span class="p">:</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">customer_manager</span>                         <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="n">Most</span> <span class="n">customer</span> <span class="n">operations</span>             <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="n">Cannot</span> <span class="n">access</span> <span class="n">billing</span>                <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="n">Cannot</span> <span class="n">delete</span> <span class="n">customer</span>               <span class="o">|</span>
<span class="o">+------------------------------------------+</span>

<span class="n">Agent</span> <span class="n">Level</span><span class="p">:</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">agent_user</span>                               <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="n">Access</span> <span class="n">own</span> <span class="n">resources</span> <span class="n">only</span>            <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="n">Can</span> <span class="n">handle</span> <span class="n">calls</span><span class="o">/</span><span class="n">chats</span>               <span class="o">|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="n">Limited</span> <span class="n">to</span> <span class="n">assigned</span> <span class="n">queues</span>           <span class="o">|</span>
<span class="o">+------------------------------------------+</span>
</pre></div>
</div>
<p><strong>Authorization Check Flow:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Authorization in API Gateway:

Request Arrives
     |
     v
+------------------+
| Parse Auth Header|
| (JWT or AccessKey)|
+--------+---------+
         |
         v
+------------------+
| Validate Token   |
| Extract Claims   |
+--------+---------+
         |
         v
+------------------+
| Get Resource     |
| from Backend     |
+--------+---------+
         |
         v
+------------------+
| Check Permission:|
| resource.customer_id
| == token.customer_id?
+--------+---------+
         |
    +----+----+
    |         |
    v         v
 Allowed   Forbidden
 (200 OK)  (403)
</pre></div>
</div>
<p><strong>CRITICAL: Auth at Gateway Only</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Authentication</span> <span class="n">Boundary</span><span class="p">:</span>

<span class="n">External</span>                 <span class="n">API</span> <span class="n">Gateway</span>            <span class="n">Internal</span> <span class="n">Services</span>
   <span class="o">|</span>                         <span class="o">|</span>                        <span class="o">|</span>
   <span class="o">|</span>  <span class="n">With</span> <span class="n">Auth</span> <span class="n">Token</span>        <span class="o">|</span>                        <span class="o">|</span>
   <span class="o">+------------------------&gt;|</span>                        <span class="o">|</span>
   <span class="o">|</span>                         <span class="o">|</span> <span class="n">Validate</span>               <span class="o">|</span>
   <span class="o">|</span>                         <span class="o">|</span> <span class="n">Token</span>                  <span class="o">|</span>
   <span class="o">|</span>                         <span class="o">|</span>                        <span class="o">|</span>
   <span class="o">|</span>                         <span class="o">|</span> <span class="n">RPC</span> <span class="p">(</span><span class="n">no</span> <span class="n">token</span><span class="p">)</span>         <span class="o">|</span>
   <span class="o">|</span>                         <span class="o">+-----------------------&gt;|</span>
   <span class="o">|</span>                         <span class="o">|</span>                        <span class="o">|</span>
   <span class="o">|</span>                         <span class="o">|</span> <span class="n">Internal</span> <span class="n">services</span>      <span class="o">|</span>
   <span class="o">|</span>                         <span class="o">|</span> <span class="n">TRUST</span> <span class="n">API</span> <span class="n">Gateway</span>      <span class="o">|</span>
   <span class="o">|</span>                         <span class="o">|</span>                        <span class="o">|</span>
   <span class="o">|</span>                         <span class="o">|&lt;-----------------------+</span>
   <span class="o">|</span>                         <span class="o">|</span> <span class="n">Response</span>               <span class="o">|</span>
   <span class="o">|&lt;------------------------+</span>                        <span class="o">|</span>
   <span class="o">|</span>                         <span class="o">|</span>                        <span class="o">|</span>

<span class="n">IMPORTANT</span><span class="p">:</span>
<span class="o">+------------------------------------------------+</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">JWT</span> <span class="n">validation</span> <span class="n">happens</span> <span class="n">ONLY</span> <span class="ow">in</span> <span class="n">api</span><span class="o">-</span><span class="n">manager</span>   <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Internal</span> <span class="n">services</span> <span class="n">DO</span> <span class="n">NOT</span> <span class="n">validate</span> <span class="n">tokens</span>     <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Internal</span> <span class="n">services</span> <span class="n">TRUST</span> <span class="n">customer_id</span> <span class="kn">from</span> <span class="nn">RPC</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">This</span> <span class="n">simplifies</span> <span class="n">internal</span> <span class="n">service</span> <span class="n">logic</span>       <span class="o">|</span>
<span class="o">+------------------------------------------------+</span>
</pre></div>
</div>
</section>
<section id="transport-security">
<h3>Transport Security<a class="headerlink" href="#transport-security" title="Link to this heading"></a></h3>
<p>All communication encrypted:</p>
<p><strong>External TLS:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TLS</span> <span class="n">Configuration</span><span class="p">:</span>

<span class="n">api</span><span class="o">.</span><span class="n">voipbin</span><span class="o">.</span><span class="n">net</span><span class="p">:</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">Protocol</span><span class="p">:</span>     <span class="n">TLS</span> <span class="mf">1.3</span> <span class="p">(</span><span class="n">minimum</span> <span class="n">TLS</span> <span class="mf">1.2</span><span class="p">)</span>  <span class="o">|</span>
<span class="o">|</span> <span class="n">Cipher</span><span class="p">:</span>       <span class="n">ECDHE</span><span class="o">-</span><span class="n">RSA</span><span class="o">-</span><span class="n">AES256</span><span class="o">-</span><span class="n">GCM</span><span class="o">-</span><span class="n">SHA384</span><span class="o">|</span>
<span class="o">|</span> <span class="n">Certificate</span><span class="p">:</span>  <span class="n">Let</span><span class="s1">&#39;s Encrypt (auto-renew)|</span>
<span class="o">|</span> <span class="n">HSTS</span><span class="p">:</span>         <span class="n">Enabled</span> <span class="p">(</span><span class="nb">max</span><span class="o">-</span><span class="n">age</span><span class="o">=</span><span class="mi">31536000</span><span class="p">)</span> <span class="o">|</span>
<span class="o">+------------------------------------------+</span>

<span class="n">SIP</span> <span class="n">TLS</span> <span class="p">(</span><span class="n">sip</span><span class="o">.</span><span class="n">voipbin</span><span class="o">.</span><span class="n">net</span><span class="p">:</span><span class="mi">5061</span><span class="p">):</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">Protocol</span><span class="p">:</span>     <span class="n">TLS</span> <span class="mf">1.2</span><span class="o">+</span>                   <span class="o">|</span>
<span class="o">|</span> <span class="n">Certificate</span><span class="p">:</span>  <span class="n">Let</span><span class="s1">&#39;s Encrypt              |</span>
<span class="o">|</span> <span class="n">Client</span> <span class="n">Auth</span><span class="p">:</span>  <span class="n">Optional</span>                   <span class="o">|</span>
<span class="o">+------------------------------------------+</span>
</pre></div>
</div>
<p><strong>Internal Encryption:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Internal</span> <span class="n">Communications</span><span class="p">:</span>

<span class="n">Kubernetes</span> <span class="n">Pod</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">Pod</span><span class="p">:</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">Network</span> <span class="n">Policies</span> <span class="n">enforce</span> <span class="n">isolation</span>       <span class="o">|</span>
<span class="o">|</span> <span class="n">Internal</span> <span class="n">traffic</span> <span class="n">within</span> <span class="n">VPC</span> <span class="n">only</span>         <span class="o">|</span>
<span class="o">|</span> <span class="n">No</span> <span class="n">TLS</span> <span class="n">required</span> <span class="p">(</span><span class="n">trusted</span> <span class="n">network</span><span class="p">)</span>        <span class="o">|</span>
<span class="o">+------------------------------------------+</span>

<span class="n">Database</span> <span class="n">Connections</span><span class="p">:</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">Cloud</span> <span class="n">SQL</span><span class="p">:</span>    <span class="n">SSL</span> <span class="n">required</span>               <span class="o">|</span>
<span class="o">|</span> <span class="n">Redis</span><span class="p">:</span>        <span class="n">In</span><span class="o">-</span><span class="n">transit</span> <span class="n">encryption</span>      <span class="o">|</span>
<span class="o">|</span> <span class="n">RabbitMQ</span><span class="p">:</span>     <span class="n">TLS</span> <span class="n">between</span> <span class="n">nodes</span>          <span class="o">|</span>
<span class="o">+------------------------------------------+</span>
</pre></div>
</div>
<p><strong>SRTP for Media:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Media</span> <span class="n">Encryption</span><span class="p">:</span>

<span class="n">WebRTC</span> <span class="n">Calls</span><span class="p">:</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">Protocol</span><span class="p">:</span>     <span class="n">SRTP</span> <span class="p">(</span><span class="n">DTLS</span><span class="o">-</span><span class="n">SRTP</span><span class="p">)</span>           <span class="o">|</span>
<span class="o">|</span> <span class="n">Key</span> <span class="n">Exchange</span><span class="p">:</span> <span class="n">DTLS</span> <span class="mf">1.2</span>                   <span class="o">|</span>
<span class="o">|</span> <span class="n">Cipher</span><span class="p">:</span>       <span class="n">AES_CM_128_HMAC_SHA1_80</span>    <span class="o">|</span>
<span class="o">+------------------------------------------+</span>

<span class="n">SIP</span> <span class="n">TLS</span> <span class="n">Calls</span><span class="p">:</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">Signaling</span><span class="p">:</span>    <span class="n">SIP</span> <span class="n">over</span> <span class="n">TLS</span>               <span class="o">|</span>
<span class="o">|</span> <span class="n">Media</span><span class="p">:</span>        <span class="n">SRTP</span> <span class="p">(</span><span class="n">negotiated</span> <span class="n">via</span> <span class="n">SDP</span><span class="p">)</span>  <span class="o">|</span>
<span class="o">+------------------------------------------+</span>

<span class="n">PSTN</span> <span class="n">Calls</span><span class="p">:</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">Internal</span><span class="p">:</span>     <span class="n">SRTP</span> <span class="n">within</span> <span class="n">VoIPBIN</span>        <span class="o">|</span>
<span class="o">|</span> <span class="n">To</span> <span class="n">Carrier</span><span class="p">:</span>   <span class="n">Depends</span> <span class="n">on</span> <span class="n">carrier</span> <span class="n">support</span> <span class="o">|</span>
<span class="o">+------------------------------------------+</span>
</pre></div>
</div>
</section>
<section id="secrets-management">
<h3>Secrets Management<a class="headerlink" href="#secrets-management" title="Link to this heading"></a></h3>
<p>Kubernetes secrets store sensitive data:</p>
<p><strong>Secret Types:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Kubernetes</span> <span class="n">Secrets</span><span class="p">:</span>

<span class="n">Database</span> <span class="n">Credentials</span><span class="p">:</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">Secret</span><span class="p">:</span> <span class="n">db</span><span class="o">-</span><span class="n">credentials</span>                   <span class="o">|</span>
<span class="o">|</span> <span class="n">Keys</span><span class="p">:</span>                                    <span class="o">|</span>
<span class="o">|</span>   <span class="o">-</span> <span class="n">dsn</span><span class="p">:</span> <span class="n">mysql</span><span class="p">:</span><span class="o">//</span><span class="n">user</span><span class="p">:</span><span class="k">pass</span><span class="nd">@host</span><span class="o">/</span><span class="n">db</span>       <span class="o">|</span>
<span class="o">|</span>   <span class="o">-</span> <span class="n">username</span><span class="p">:</span> <span class="n">voipbin_app</span>                <span class="o">|</span>
<span class="o">|</span>   <span class="o">-</span> <span class="n">password</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">encrypted</span><span class="o">&gt;</span>                <span class="o">|</span>
<span class="o">+------------------------------------------+</span>

<span class="n">JWT</span> <span class="n">Signing</span> <span class="n">Key</span><span class="p">:</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">Secret</span><span class="p">:</span> <span class="n">jwt</span><span class="o">-</span><span class="n">secret</span>                       <span class="o">|</span>
<span class="o">|</span> <span class="n">Keys</span><span class="p">:</span>                                    <span class="o">|</span>
<span class="o">|</span>   <span class="o">-</span> <span class="n">key</span><span class="p">:</span> <span class="o">&lt;</span><span class="mi">256</span><span class="o">-</span><span class="n">bit</span> <span class="n">random</span> <span class="n">key</span><span class="o">&gt;</span>            <span class="o">|</span>
<span class="o">+------------------------------------------+</span>

<span class="n">API</span> <span class="n">Keys</span> <span class="p">(</span><span class="n">External</span> <span class="n">Services</span><span class="p">):</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">Secret</span><span class="p">:</span> <span class="n">external</span><span class="o">-</span><span class="n">api</span><span class="o">-</span><span class="n">keys</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">Keys</span><span class="p">:</span>                                    <span class="o">|</span>
<span class="o">|</span>   <span class="o">-</span> <span class="n">deepgram_api_key</span>                     <span class="o">|</span>
<span class="o">|</span>   <span class="o">-</span> <span class="n">openai_api_key</span>                       <span class="o">|</span>
<span class="o">|</span>   <span class="o">-</span> <span class="n">twilio_api_key</span>                       <span class="o">|</span>
<span class="o">+------------------------------------------+</span>

<span class="n">SSL</span> <span class="n">Certificates</span><span class="p">:</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">Secret</span><span class="p">:</span> <span class="n">ssl</span><span class="o">-</span><span class="n">certs</span>                        <span class="o">|</span>
<span class="o">|</span> <span class="n">Keys</span><span class="p">:</span>                                    <span class="o">|</span>
<span class="o">|</span>   <span class="o">-</span> <span class="n">tls</span><span class="o">.</span><span class="n">crt</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">certificate</span><span class="o">&gt;</span>               <span class="o">|</span>
<span class="o">|</span>   <span class="o">-</span> <span class="n">tls</span><span class="o">.</span><span class="n">key</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">private</span> <span class="n">key</span><span class="o">&gt;</span>               <span class="o">|</span>
<span class="o">+------------------------------------------+</span>
</pre></div>
</div>
<p><strong>Secret Injection:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Pod</span> <span class="n">Secret</span> <span class="n">Configuration</span><span class="p">:</span>

<span class="n">spec</span><span class="p">:</span>
  <span class="n">containers</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="nb">bin</span><span class="o">-</span><span class="n">api</span><span class="o">-</span><span class="n">manager</span>
    <span class="n">env</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">DSN</span>
      <span class="n">valueFrom</span><span class="p">:</span>
        <span class="n">secretKeyRef</span><span class="p">:</span>
          <span class="n">name</span><span class="p">:</span> <span class="n">db</span><span class="o">-</span><span class="n">credentials</span>
          <span class="n">key</span><span class="p">:</span> <span class="n">dsn</span>
    <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">JWT_KEY</span>
      <span class="n">valueFrom</span><span class="p">:</span>
        <span class="n">secretKeyRef</span><span class="p">:</span>
          <span class="n">name</span><span class="p">:</span> <span class="n">jwt</span><span class="o">-</span><span class="n">secret</span>
          <span class="n">key</span><span class="p">:</span> <span class="n">key</span>
    <span class="n">volumeMounts</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">ssl</span><span class="o">-</span><span class="n">certs</span>
      <span class="n">mountPath</span><span class="p">:</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">ssl</span><span class="o">/</span><span class="n">voipbin</span>
      <span class="n">readOnly</span><span class="p">:</span> <span class="n">true</span>
  <span class="n">volumes</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">ssl</span><span class="o">-</span><span class="n">certs</span>
    <span class="n">secret</span><span class="p">:</span>
      <span class="n">secretName</span><span class="p">:</span> <span class="n">ssl</span><span class="o">-</span><span class="n">certs</span>
</pre></div>
</div>
<p><strong>Base64 Encoding:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CLI</span> <span class="n">Flag</span> <span class="n">Pattern</span><span class="p">:</span>

<span class="n">Some</span> <span class="n">services</span> <span class="n">accept</span> <span class="n">base64</span><span class="o">-</span><span class="n">encoded</span> <span class="n">secrets</span> <span class="n">via</span> <span class="n">CLI</span><span class="p">:</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="o">-</span><span class="n">ssl_cert_base64</span><span class="o">=&lt;</span><span class="n">base64</span><span class="o">-</span><span class="n">encoded</span><span class="o">-</span><span class="n">cert</span><span class="o">&gt;</span>   <span class="o">|</span>
<span class="o">|</span> <span class="o">-</span><span class="n">ssl_private_base64</span><span class="o">=&lt;</span><span class="n">base64</span><span class="o">-</span><span class="n">encoded</span><span class="o">-</span><span class="n">key</span><span class="o">&gt;</span> <span class="o">|</span>
<span class="o">+------------------------------------------+</span>

<span class="n">Why</span> <span class="n">Base64</span><span class="p">:</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Allows</span> <span class="n">passing</span> <span class="n">binary</span> <span class="n">data</span> <span class="n">via</span> <span class="n">env</span> <span class="nb">vars</span><span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Avoids</span> <span class="n">special</span> <span class="n">character</span> <span class="n">issues</span>        <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Decoded</span> <span class="n">at</span> <span class="n">runtime</span> <span class="ow">in</span> <span class="n">application</span>      <span class="o">|</span>
<span class="o">+------------------------------------------+</span>
</pre></div>
</div>
</section>
<section id="network-security">
<h3>Network Security<a class="headerlink" href="#network-security" title="Link to this heading"></a></h3>
<p>VPC and firewall protection:</p>
<p><strong>Network Isolation:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Network</span> <span class="n">Segmentation</span><span class="p">:</span>

<span class="o">+------------------------------------------------------------------+</span>
<span class="o">|</span>                     <span class="n">VPC</span><span class="p">:</span> <span class="n">voipbin</span><span class="o">-</span><span class="n">prod</span>                            <span class="o">|</span>
<span class="o">+------------------------------------------------------------------+</span>
<span class="o">|</span>                                                                   <span class="o">|</span>
<span class="o">|</span>  <span class="n">DMZ</span> <span class="p">(</span><span class="n">Public</span> <span class="n">Subnet</span><span class="p">):</span>                                             <span class="o">|</span>
<span class="o">|</span>  <span class="o">+-------------------------------------------------------------+</span> <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="n">Cloud</span> <span class="n">Load</span> <span class="n">Balancer</span> <span class="p">(</span><span class="n">External</span> <span class="n">IP</span><span class="p">)</span>                          <span class="o">|</span> <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">-</span> <span class="n">Only</span> <span class="n">port</span> <span class="mi">443</span> <span class="p">(</span><span class="n">HTTPS</span><span class="p">)</span>                                    <span class="o">|</span> <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">-</span> <span class="n">Only</span> <span class="n">port</span> <span class="mi">5060</span><span class="o">/</span><span class="mi">5061</span> <span class="p">(</span><span class="n">SIP</span><span class="p">)</span>                                <span class="o">|</span> <span class="o">|</span>
<span class="o">|</span>  <span class="o">+-------------------------------------------------------------+</span> <span class="o">|</span>
<span class="o">|</span>                              <span class="o">|</span>                                    <span class="o">|</span>
<span class="o">|</span>                              <span class="o">|</span> <span class="n">Internal</span> <span class="n">Only</span>                      <span class="o">|</span>
<span class="o">|</span>                              <span class="n">v</span>                                    <span class="o">|</span>
<span class="o">|</span>  <span class="n">Application</span> <span class="n">Subnet</span><span class="p">:</span>                                              <span class="o">|</span>
<span class="o">|</span>  <span class="o">+-------------------------------------------------------------+</span> <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="n">GKE</span> <span class="n">Pods</span> <span class="p">(</span><span class="n">No</span> <span class="n">external</span> <span class="n">IPs</span><span class="p">)</span>                                 <span class="o">|</span> <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="n">VoIP</span> <span class="n">VMs</span> <span class="p">(</span><span class="n">Internal</span> <span class="n">IPs</span><span class="p">)</span>                                    <span class="o">|</span> <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="o">-</span> <span class="n">Outbound</span> <span class="n">via</span> <span class="n">NAT</span> <span class="n">Gateway</span> <span class="n">only</span>                            <span class="o">|</span> <span class="o">|</span>
<span class="o">|</span>  <span class="o">+-------------------------------------------------------------+</span> <span class="o">|</span>
<span class="o">|</span>                              <span class="o">|</span>                                    <span class="o">|</span>
<span class="o">|</span>                              <span class="n">v</span>                                    <span class="o">|</span>
<span class="o">|</span>  <span class="n">Data</span> <span class="n">Subnet</span><span class="p">:</span>                                                     <span class="o">|</span>
<span class="o">|</span>  <span class="o">+-------------------------------------------------------------+</span> <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="n">Cloud</span> <span class="n">SQL</span> <span class="p">(</span><span class="n">Private</span> <span class="n">IP</span> <span class="n">only</span><span class="p">)</span>                                <span class="o">|</span> <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="n">Memorystore</span> <span class="p">(</span><span class="n">Private</span> <span class="n">IP</span> <span class="n">only</span><span class="p">)</span>                              <span class="o">|</span> <span class="o">|</span>
<span class="o">|</span>  <span class="o">|</span>  <span class="n">RabbitMQ</span> <span class="p">(</span><span class="n">Private</span> <span class="n">IP</span> <span class="n">only</span><span class="p">)</span>                                 <span class="o">|</span> <span class="o">|</span>
<span class="o">|</span>  <span class="o">+-------------------------------------------------------------+</span> <span class="o">|</span>
<span class="o">|</span>                                                                   <span class="o">|</span>
<span class="o">+------------------------------------------------------------------+</span>
</pre></div>
</div>
<p><strong>Firewall Rules:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Cloud</span> <span class="n">Firewall</span><span class="p">:</span>

<span class="n">Ingress</span> <span class="p">(</span><span class="n">Allow</span><span class="p">):</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">Rule</span><span class="p">:</span> <span class="n">allow</span><span class="o">-</span><span class="n">https</span>                        <span class="o">|</span>
<span class="o">|</span> <span class="n">Source</span><span class="p">:</span> <span class="mf">0.0.0.0</span><span class="o">/</span><span class="mi">0</span>                        <span class="o">|</span>
<span class="o">|</span> <span class="n">Target</span><span class="p">:</span> <span class="n">Load</span> <span class="n">Balancer</span>                    <span class="o">|</span>
<span class="o">|</span> <span class="n">Ports</span><span class="p">:</span> <span class="n">TCP</span> <span class="mi">443</span>                           <span class="o">|</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">Rule</span><span class="p">:</span> <span class="n">allow</span><span class="o">-</span><span class="n">sip</span>                          <span class="o">|</span>
<span class="o">|</span> <span class="n">Source</span><span class="p">:</span> <span class="n">Carrier</span> <span class="n">IPs</span> <span class="p">(</span><span class="n">whitelist</span><span class="p">)</span>          <span class="o">|</span>
<span class="o">|</span> <span class="n">Target</span><span class="p">:</span> <span class="n">Kamailio</span> <span class="n">VMs</span>                     <span class="o">|</span>
<span class="o">|</span> <span class="n">Ports</span><span class="p">:</span> <span class="n">UDP</span><span class="o">/</span><span class="n">TCP</span> <span class="mi">5060</span><span class="p">,</span> <span class="n">TCP</span> <span class="mi">5061</span>            <span class="o">|</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">Rule</span><span class="p">:</span> <span class="n">allow</span><span class="o">-</span><span class="n">rtp</span>                          <span class="o">|</span>
<span class="o">|</span> <span class="n">Source</span><span class="p">:</span> <span class="mf">0.0.0.0</span><span class="o">/</span><span class="mi">0</span>                        <span class="o">|</span>
<span class="o">|</span> <span class="n">Target</span><span class="p">:</span> <span class="n">RTPEngine</span> <span class="n">VMs</span>                    <span class="o">|</span>
<span class="o">|</span> <span class="n">Ports</span><span class="p">:</span> <span class="n">UDP</span> <span class="mi">10000</span><span class="o">-</span><span class="mi">60000</span>                   <span class="o">|</span>
<span class="o">+------------------------------------------+</span>

<span class="n">Egress</span> <span class="p">(</span><span class="n">Default</span> <span class="n">Allow</span><span class="p">):</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">All</span> <span class="n">outbound</span> <span class="n">traffic</span> <span class="n">allowed</span>             <span class="o">|</span>
<span class="o">|</span> <span class="n">NAT</span> <span class="n">Gateway</span> <span class="k">for</span> <span class="n">external</span> <span class="n">access</span>          <span class="o">|</span>
<span class="o">+------------------------------------------+</span>

<span class="n">Deny</span> <span class="p">(</span><span class="n">Default</span><span class="p">):</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">All</span> <span class="n">other</span> <span class="n">ingress</span> <span class="n">denied</span> <span class="n">by</span> <span class="n">default</span>      <span class="o">|</span>
<span class="o">+------------------------------------------+</span>
</pre></div>
</div>
<p><strong>Kubernetes Network Policies:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Pod</span> <span class="n">Network</span> <span class="n">Policy</span><span class="p">:</span>

<span class="n">apiVersion</span><span class="p">:</span> <span class="n">networking</span><span class="o">.</span><span class="n">k8s</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">v1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">NetworkPolicy</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">api</span><span class="o">-</span><span class="n">manager</span><span class="o">-</span><span class="n">policy</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">podSelector</span><span class="p">:</span>
    <span class="n">matchLabels</span><span class="p">:</span>
      <span class="n">app</span><span class="p">:</span> <span class="nb">bin</span><span class="o">-</span><span class="n">api</span><span class="o">-</span><span class="n">manager</span>
  <span class="n">policyTypes</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">Ingress</span>
  <span class="o">-</span> <span class="n">Egress</span>
  <span class="n">ingress</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">from</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">ipBlock</span><span class="p">:</span>
        <span class="n">cidr</span><span class="p">:</span> <span class="mf">10.0.0.0</span><span class="o">/</span><span class="mi">16</span>    <span class="c1"># Internal VPC only</span>
    <span class="n">ports</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">port</span><span class="p">:</span> <span class="mi">443</span>
    <span class="o">-</span> <span class="n">port</span><span class="p">:</span> <span class="mi">9000</span>
    <span class="o">-</span> <span class="n">port</span><span class="p">:</span> <span class="mi">2112</span>
  <span class="n">egress</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">to</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">ipBlock</span><span class="p">:</span>
        <span class="n">cidr</span><span class="p">:</span> <span class="mf">10.0.0.0</span><span class="o">/</span><span class="mi">16</span>    <span class="c1"># Internal VPC</span>
  <span class="o">-</span> <span class="n">to</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">ipBlock</span><span class="p">:</span>
        <span class="n">cidr</span><span class="p">:</span> <span class="mf">0.0.0.0</span><span class="o">/</span><span class="mi">0</span>      <span class="c1"># External (for webhooks)</span>
    <span class="n">ports</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">port</span><span class="p">:</span> <span class="mi">443</span>
</pre></div>
</div>
</section>
<section id="input-validation">
<h3>Input Validation<a class="headerlink" href="#input-validation" title="Link to this heading"></a></h3>
<p>All inputs validated at API boundary:</p>
<p><strong>Validation Layers:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Input</span> <span class="n">Validation</span> <span class="n">Stack</span><span class="p">:</span>

<span class="mf">1.</span> <span class="n">OpenAPI</span> <span class="n">Schema</span> <span class="n">Validation</span><span class="p">:</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="o">-</span> <span class="n">Required</span> <span class="n">fields</span> <span class="n">present</span>                <span class="o">|</span>
<span class="o">|</span> <span class="o">-</span> <span class="n">Field</span> <span class="n">types</span> <span class="n">correct</span> <span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">etc</span><span class="p">)</span><span class="o">|</span>
<span class="o">|</span> <span class="o">-</span> <span class="n">Enum</span> <span class="n">values</span> <span class="n">valid</span>                      <span class="o">|</span>
<span class="o">|</span> <span class="o">-</span> <span class="n">String</span> <span class="n">length</span> <span class="n">limits</span>                   <span class="o">|</span>
<span class="o">+------------------------------------------+</span>

<span class="mf">2.</span> <span class="n">Business</span> <span class="n">Logic</span> <span class="n">Validation</span><span class="p">:</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="o">-</span> <span class="n">Phone</span> <span class="n">number</span> <span class="nb">format</span> <span class="p">(</span><span class="o">+</span><span class="n">E</span><span class="mf">.164</span><span class="p">)</span>           <span class="o">|</span>
<span class="o">|</span> <span class="o">-</span> <span class="n">UUID</span> <span class="nb">format</span>                            <span class="o">|</span>
<span class="o">|</span> <span class="o">-</span> <span class="n">Resource</span> <span class="n">exists</span>                        <span class="o">|</span>
<span class="o">|</span> <span class="o">-</span> <span class="n">Sufficient</span> <span class="n">balance</span>                     <span class="o">|</span>
<span class="o">+------------------------------------------+</span>

<span class="mf">3.</span> <span class="n">SQL</span> <span class="n">Injection</span> <span class="n">Prevention</span><span class="p">:</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="o">-</span> <span class="n">Parameterized</span> <span class="n">queries</span> <span class="n">only</span>             <span class="o">|</span>
<span class="o">|</span> <span class="o">-</span> <span class="n">No</span> <span class="n">string</span> <span class="n">concatenation</span> <span class="k">for</span> <span class="n">SQL</span>        <span class="o">|</span>
<span class="o">|</span> <span class="o">-</span> <span class="n">ORM</span> <span class="k">with</span> <span class="n">escaping</span> <span class="p">(</span><span class="n">Squirrel</span><span class="p">)</span>           <span class="o">|</span>
<span class="o">+------------------------------------------+</span>
</pre></div>
</div>
<p><strong>Parameterized Query Example:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Safe Query Pattern:

// CORRECT - Parameterized
query := sq.Select(&quot;*&quot;).
    From(&quot;calls&quot;).
    Where(sq.Eq{&quot;customer_id&quot;: customerID}).
    Where(sq.Eq{&quot;id&quot;: callID})

// Generated SQL:
// SELECT * FROM calls
// WHERE customer_id = ? AND id = ?
// Parameters: [customerID, callID]

// WRONG - String concatenation (NEVER DO THIS)
// query := &quot;SELECT * FROM calls WHERE id = &#39;&quot; + callID + &quot;&#39;&quot;
</pre></div>
</div>
</section>
<section id="rate-limiting">
<h3>Rate Limiting<a class="headerlink" href="#rate-limiting" title="Link to this heading"></a></h3>
<p>Protect against abuse:</p>
<p><strong>Rate Limit Configuration:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Rate</span> <span class="n">Limiting</span> <span class="n">Strategy</span><span class="p">:</span>

<span class="n">Global</span> <span class="n">Limits</span> <span class="p">(</span><span class="n">per</span> <span class="n">customer</span><span class="p">):</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">Endpoint</span>              <span class="o">|</span> <span class="n">Limit</span>            <span class="o">|</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">API</span> <span class="n">requests</span>          <span class="o">|</span> <span class="mi">1000</span><span class="o">/</span><span class="n">minute</span>      <span class="o">|</span>
<span class="o">|</span> <span class="n">Call</span> <span class="n">creation</span>         <span class="o">|</span> <span class="mi">100</span><span class="o">/</span><span class="n">minute</span>       <span class="o">|</span>
<span class="o">|</span> <span class="n">SMS</span> <span class="n">sending</span>           <span class="o">|</span> <span class="mi">100</span><span class="o">/</span><span class="n">minute</span>       <span class="o">|</span>
<span class="o">|</span> <span class="n">Login</span> <span class="n">attempts</span>        <span class="o">|</span> <span class="mi">10</span><span class="o">/</span><span class="n">minute</span>        <span class="o">|</span>
<span class="o">+------------------------------------------+</span>

<span class="n">Burst</span> <span class="n">Handling</span><span class="p">:</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">Token</span> <span class="n">bucket</span> <span class="n">algorithm</span>                   <span class="o">|</span>
<span class="o">|</span> <span class="n">Bucket</span> <span class="n">size</span><span class="p">:</span> <span class="mi">2</span><span class="n">x</span> <span class="n">rate</span> <span class="n">limit</span>               <span class="o">|</span>
<span class="o">|</span> <span class="n">Refill</span> <span class="n">rate</span><span class="p">:</span> <span class="n">Rate</span> <span class="n">limit</span> <span class="n">per</span> <span class="n">second</span>       <span class="o">|</span>
<span class="o">+------------------------------------------+</span>

<span class="n">Response</span> <span class="n">on</span> <span class="n">Limit</span><span class="p">:</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">Status</span><span class="p">:</span> <span class="mi">429</span> <span class="n">Too</span> <span class="n">Many</span> <span class="n">Requests</span>            <span class="o">|</span>
<span class="o">|</span> <span class="n">Header</span><span class="p">:</span> <span class="n">Retry</span><span class="o">-</span><span class="n">After</span><span class="p">:</span> <span class="mi">60</span>                  <span class="o">|</span>
<span class="o">|</span> <span class="n">Body</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;rate_limit_exceeded&quot;</span><span class="p">}</span>   <span class="o">|</span>
<span class="o">+------------------------------------------+</span>
</pre></div>
</div>
<p><strong>DDoS Protection:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Cloud</span> <span class="n">Armor</span> <span class="n">Configuration</span><span class="p">:</span>

<span class="n">WAF</span> <span class="n">Rules</span><span class="p">:</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">Rule</span><span class="p">:</span> <span class="n">block</span><span class="o">-</span><span class="n">known</span><span class="o">-</span><span class="n">attackers</span>              <span class="o">|</span>
<span class="o">|</span> <span class="o">-</span> <span class="n">Block</span> <span class="n">IPs</span> <span class="kn">from</span> <span class="nn">threat</span> <span class="n">intelligence</span>     <span class="o">|</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">Rule</span><span class="p">:</span> <span class="n">rate</span><span class="o">-</span><span class="n">limit</span><span class="o">-</span><span class="n">by</span><span class="o">-</span><span class="n">ip</span>                   <span class="o">|</span>
<span class="o">|</span> <span class="o">-</span> <span class="mi">10</span><span class="p">,</span><span class="mi">000</span> <span class="n">requests</span><span class="o">/</span><span class="n">minute</span> <span class="n">per</span> <span class="n">IP</span>          <span class="o">|</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">Rule</span><span class="p">:</span> <span class="n">geo</span><span class="o">-</span><span class="n">restrict</span> <span class="p">(</span><span class="n">optional</span><span class="p">)</span>            <span class="o">|</span>
<span class="o">|</span> <span class="o">-</span> <span class="n">Allow</span> <span class="n">specific</span> <span class="n">countries</span> <span class="n">only</span>          <span class="o">|</span>
<span class="o">+------------------------------------------+</span>

<span class="n">Adaptive</span> <span class="n">Protection</span><span class="p">:</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="o">-</span> <span class="n">ML</span><span class="o">-</span><span class="n">based</span> <span class="n">attack</span> <span class="n">detection</span>              <span class="o">|</span>
<span class="o">|</span> <span class="o">-</span> <span class="n">Automatic</span> <span class="n">rule</span> <span class="n">suggestions</span>             <span class="o">|</span>
<span class="o">|</span> <span class="o">-</span> <span class="n">Alert</span> <span class="n">on</span> <span class="n">anomalies</span>                     <span class="o">|</span>
<span class="o">+------------------------------------------+</span>
</pre></div>
</div>
</section>
<section id="audit-logging">
<h3>Audit Logging<a class="headerlink" href="#audit-logging" title="Link to this heading"></a></h3>
<p>Complete audit trail:</p>
<p><strong>Logged Events:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Audit</span> <span class="n">Log</span> <span class="n">Events</span><span class="p">:</span>

<span class="n">Authentication</span><span class="p">:</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Login</span> <span class="n">success</span><span class="o">/</span><span class="n">failure</span>                  <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Logout</span>                                 <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Token</span> <span class="n">refresh</span>                          <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Access</span> <span class="n">key</span> <span class="n">creation</span><span class="o">/</span><span class="n">revocation</span>         <span class="o">|</span>
<span class="o">+------------------------------------------+</span>

<span class="n">Resource</span> <span class="n">Operations</span><span class="p">:</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Create</span> <span class="p">(</span><span class="n">who</span><span class="p">,</span> <span class="n">what</span><span class="p">,</span> <span class="n">when</span><span class="p">)</span>               <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Update</span> <span class="p">(</span><span class="n">who</span><span class="p">,</span> <span class="n">what</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">,</span> <span class="n">when</span><span class="p">)</span>     <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Delete</span> <span class="p">(</span><span class="n">who</span><span class="p">,</span> <span class="n">what</span><span class="p">,</span> <span class="n">when</span><span class="p">)</span>               <span class="o">|</span>
<span class="o">+------------------------------------------+</span>

<span class="n">Security</span> <span class="n">Events</span><span class="p">:</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Permission</span> <span class="n">denied</span> <span class="n">attempts</span>             <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Rate</span> <span class="n">limit</span> <span class="n">exceeded</span>                    <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Invalid</span> <span class="n">token</span> <span class="n">attempts</span>                 <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Suspicious</span> <span class="n">activity</span> <span class="n">patterns</span>           <span class="o">|</span>
<span class="o">+------------------------------------------+</span>
</pre></div>
</div>
<p><strong>Log Format:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Audit</span> <span class="n">Log</span> <span class="n">Entry</span><span class="p">:</span>

<span class="p">{</span>
  <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2026-01-20T12:00:00.000Z&quot;</span><span class="p">,</span>
  <span class="s2">&quot;event_type&quot;</span><span class="p">:</span> <span class="s2">&quot;resource_created&quot;</span><span class="p">,</span>
  <span class="s2">&quot;customer_id&quot;</span><span class="p">:</span> <span class="s2">&quot;uuid&quot;</span><span class="p">,</span>
  <span class="s2">&quot;agent_id&quot;</span><span class="p">:</span> <span class="s2">&quot;uuid&quot;</span><span class="p">,</span>
  <span class="s2">&quot;resource_type&quot;</span><span class="p">:</span> <span class="s2">&quot;call&quot;</span><span class="p">,</span>
  <span class="s2">&quot;resource_id&quot;</span><span class="p">:</span> <span class="s2">&quot;uuid&quot;</span><span class="p">,</span>
  <span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;create&quot;</span><span class="p">,</span>
  <span class="s2">&quot;source_ip&quot;</span><span class="p">:</span> <span class="s2">&quot;192.168.1.100&quot;</span><span class="p">,</span>
  <span class="s2">&quot;user_agent&quot;</span><span class="p">:</span> <span class="s2">&quot;VoIPBIN-SDK/1.0&quot;</span><span class="p">,</span>
  <span class="s2">&quot;request_id&quot;</span><span class="p">:</span> <span class="s2">&quot;uuid&quot;</span><span class="p">,</span>
  <span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;+15551234567&quot;</span><span class="p">,</span>
    <span class="s2">&quot;destination&quot;</span><span class="p">:</span> <span class="s2">&quot;+15559876543&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="data-protection">
<h3>Data Protection<a class="headerlink" href="#data-protection" title="Link to this heading"></a></h3>
<p>Protecting sensitive data:</p>
<p><strong>Data Classification:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Data</span> <span class="n">Sensitivity</span> <span class="n">Levels</span><span class="p">:</span>

<span class="n">Public</span><span class="p">:</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">API</span> <span class="n">documentation</span>                      <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Service</span> <span class="n">status</span>                         <span class="o">|</span>
<span class="o">+------------------------------------------+</span>

<span class="n">Internal</span><span class="p">:</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Call</span> <span class="n">metadata</span> <span class="p">(</span><span class="n">IDs</span><span class="p">,</span> <span class="n">timestamps</span><span class="p">)</span>        <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Flow</span> <span class="n">definitions</span>                       <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Configuration</span>                          <span class="o">|</span>
<span class="o">+------------------------------------------+</span>

<span class="n">Confidential</span><span class="p">:</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Customer</span> <span class="n">PII</span> <span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">emails</span><span class="p">)</span>           <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Phone</span> <span class="n">numbers</span>                          <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Call</span> <span class="n">recordings</span>                        <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Chat</span> <span class="n">transcripts</span>                       <span class="o">|</span>
<span class="o">+------------------------------------------+</span>

<span class="n">Restricted</span><span class="p">:</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Passwords</span> <span class="p">(</span><span class="n">hashed</span><span class="p">,</span> <span class="n">never</span> <span class="n">stored</span> <span class="n">plain</span><span class="p">)</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">API</span> <span class="n">keys</span>                               <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">JWT</span> <span class="n">signing</span> <span class="n">keys</span>                       <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Database</span> <span class="n">credentials</span>                   <span class="o">|</span>
<span class="o">+------------------------------------------+</span>
</pre></div>
</div>
<p><strong>Encryption at Rest:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Data</span> <span class="n">Encryption</span><span class="p">:</span>

<span class="n">Cloud</span> <span class="n">SQL</span><span class="p">:</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">Encryption</span><span class="p">:</span> <span class="n">AES</span><span class="o">-</span><span class="mi">256</span>                      <span class="o">|</span>
<span class="o">|</span> <span class="n">Key</span> <span class="n">Management</span><span class="p">:</span> <span class="n">Google</span><span class="o">-</span><span class="n">managed</span>           <span class="o">|</span>
<span class="o">|</span> <span class="n">Automatic</span> <span class="n">encryption</span> <span class="n">of</span> <span class="nb">all</span> <span class="n">data</span>         <span class="o">|</span>
<span class="o">+------------------------------------------+</span>

<span class="n">Cloud</span> <span class="n">Storage</span> <span class="p">(</span><span class="n">Recordings</span><span class="p">):</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">Encryption</span><span class="p">:</span> <span class="n">AES</span><span class="o">-</span><span class="mi">256</span>                      <span class="o">|</span>
<span class="o">|</span> <span class="n">Key</span> <span class="n">Management</span><span class="p">:</span> <span class="n">Customer</span><span class="o">-</span><span class="n">managed</span> <span class="p">(</span><span class="n">CMEK</span><span class="p">)</span>  <span class="o">|</span>
<span class="o">|</span> <span class="n">Per</span><span class="o">-</span><span class="nb">object</span> <span class="n">encryption</span>                    <span class="o">|</span>
<span class="o">+------------------------------------------+</span>

<span class="n">Redis</span> <span class="p">(</span><span class="n">Memorystore</span><span class="p">):</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">Encryption</span><span class="p">:</span> <span class="n">AES</span><span class="o">-</span><span class="mi">256</span>                      <span class="o">|</span>
<span class="o">|</span> <span class="n">In</span><span class="o">-</span><span class="n">transit</span> <span class="n">encryption</span> <span class="n">enabled</span>            <span class="o">|</span>
<span class="o">+------------------------------------------+</span>
</pre></div>
</div>
<p><strong>Data Retention:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Retention</span> <span class="n">Policies</span><span class="p">:</span>

<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">Data</span> <span class="n">Type</span>        <span class="o">|</span> <span class="n">Retention</span> <span class="o">|</span> <span class="n">Deletion</span>  <span class="o">|</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">Call</span> <span class="n">records</span>     <span class="o">|</span> <span class="mi">2</span> <span class="n">years</span>   <span class="o">|</span> <span class="n">Soft</span>      <span class="o">|</span>
<span class="o">|</span> <span class="n">Call</span> <span class="n">recordings</span>  <span class="o">|</span> <span class="mi">90</span> <span class="n">days</span>   <span class="o">|</span> <span class="n">Hard</span>      <span class="o">|</span>
<span class="o">|</span> <span class="n">Chat</span> <span class="n">messages</span>    <span class="o">|</span> <span class="mi">1</span> <span class="n">year</span>    <span class="o">|</span> <span class="n">Soft</span>      <span class="o">|</span>
<span class="o">|</span> <span class="n">Audit</span> <span class="n">logs</span>       <span class="o">|</span> <span class="mi">7</span> <span class="n">years</span>   <span class="o">|</span> <span class="n">Hard</span>      <span class="o">|</span>
<span class="o">|</span> <span class="n">Session</span> <span class="n">tokens</span>   <span class="o">|</span> <span class="mi">1</span> <span class="n">hour</span>    <span class="o">|</span> <span class="n">Automatic</span> <span class="o">|</span>
<span class="o">+------------------------------------------+</span>

<span class="n">Soft</span> <span class="n">Delete</span><span class="p">:</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">tm_delete</span> <span class="nb">set</span> <span class="n">to</span> <span class="n">deletion</span> <span class="n">time</span>           <span class="o">|</span>
<span class="o">|</span> <span class="n">Data</span> <span class="n">remains</span> <span class="ow">in</span> <span class="n">DB</span> <span class="n">but</span> <span class="ow">not</span> <span class="n">returned</span>      <span class="o">|</span>
<span class="o">|</span> <span class="n">Can</span> <span class="n">be</span> <span class="n">restored</span> <span class="k">if</span> <span class="n">needed</span>                <span class="o">|</span>
<span class="o">+------------------------------------------+</span>
</pre></div>
</div>
</section>
<section id="compliance">
<h3>Compliance<a class="headerlink" href="#compliance" title="Link to this heading"></a></h3>
<p>Security standards adherence:</p>
<p><strong>Security Standards:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Compliance</span> <span class="n">Framework</span><span class="p">:</span>

<span class="n">SOC</span> <span class="mi">2</span> <span class="n">Type</span> <span class="n">II</span><span class="p">:</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Security</span> <span class="n">controls</span> <span class="n">documented</span>           <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Annual</span> <span class="n">audit</span>                           <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Continuous</span> <span class="n">monitoring</span>                  <span class="o">|</span>
<span class="o">+------------------------------------------+</span>

<span class="n">GDPR</span><span class="p">:</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Data</span> <span class="n">subject</span> <span class="n">rights</span> <span class="n">supported</span>          <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Data</span> <span class="n">portability</span> <span class="n">APIs</span>                  <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Right</span> <span class="n">to</span> <span class="n">deletion</span> <span class="n">implemented</span>          <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">EU</span> <span class="n">data</span> <span class="n">residency</span> <span class="n">option</span>               <span class="o">|</span>
<span class="o">+------------------------------------------+</span>

<span class="n">HIPAA</span> <span class="p">(</span><span class="n">Optional</span><span class="p">):</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">BAA</span> <span class="n">available</span> <span class="k">for</span> <span class="n">healthcare</span> <span class="n">customers</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">PHI</span> <span class="n">handling</span> <span class="n">procedures</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Audit</span> <span class="n">controls</span>                         <span class="o">|</span>
<span class="o">+------------------------------------------+</span>

<span class="n">PCI</span> <span class="n">DSS</span><span class="p">:</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">No</span> <span class="n">credit</span> <span class="n">card</span> <span class="n">data</span> <span class="n">stored</span>             <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Payment</span> <span class="n">via</span> <span class="n">Stripe</span> <span class="p">(</span><span class="n">PCI</span> <span class="n">compliant</span><span class="p">)</span>     <span class="o">|</span>
<span class="o">+------------------------------------------+</span>
</pre></div>
</div>
</section>
<section id="security-best-practices">
<h3>Security Best Practices<a class="headerlink" href="#security-best-practices" title="Link to this heading"></a></h3>
<p>Development and operations security:</p>
<p><strong>Development:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Secure</span> <span class="n">Development</span><span class="p">:</span>

<span class="n">Code</span> <span class="n">Review</span><span class="p">:</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">All</span> <span class="n">changes</span> <span class="n">peer</span><span class="o">-</span><span class="n">reviewed</span>              <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Security</span> <span class="n">checklist</span> <span class="k">for</span> <span class="n">PRs</span>             <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Automated</span> <span class="n">security</span> <span class="n">scanning</span> <span class="p">(</span><span class="n">SAST</span><span class="p">)</span>     <span class="o">|</span>
<span class="o">+------------------------------------------+</span>

<span class="n">Dependency</span> <span class="n">Management</span><span class="p">:</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Regular</span> <span class="n">dependency</span> <span class="n">updates</span>             <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Vulnerability</span> <span class="n">scanning</span> <span class="p">(</span><span class="n">Snyk</span><span class="o">/</span><span class="n">Dependabot</span><span class="p">)</span><span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">No</span> <span class="n">known</span> <span class="n">vulnerable</span> <span class="n">dependencies</span>       <span class="o">|</span>
<span class="o">+------------------------------------------+</span>

<span class="n">Secret</span> <span class="n">Handling</span><span class="p">:</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">No</span> <span class="n">secrets</span> <span class="ow">in</span> <span class="n">code</span> <span class="ow">or</span> <span class="n">git</span>              <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Environment</span> <span class="n">variables</span> <span class="k">for</span> <span class="n">config</span>       <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Secret</span> <span class="n">rotation</span> <span class="n">procedures</span>             <span class="o">|</span>
<span class="o">+------------------------------------------+</span>
</pre></div>
</div>
<p><strong>Operations:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Security</span> <span class="n">Operations</span><span class="p">:</span>

<span class="n">Access</span> <span class="n">Control</span><span class="p">:</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Least</span> <span class="n">privilege</span> <span class="n">principle</span>              <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">MFA</span> <span class="k">for</span> <span class="nb">all</span> <span class="n">admin</span> <span class="n">access</span>               <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Regular</span> <span class="n">access</span> <span class="n">reviews</span>                 <span class="o">|</span>
<span class="o">+------------------------------------------+</span>

<span class="n">Incident</span> <span class="n">Response</span><span class="p">:</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Documented</span> <span class="n">incident</span> <span class="n">procedures</span>         <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">On</span><span class="o">-</span><span class="n">call</span> <span class="n">rotation</span>                       <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Post</span><span class="o">-</span><span class="n">incident</span> <span class="n">reviews</span>                  <span class="o">|</span>
<span class="o">+------------------------------------------+</span>

<span class="n">Monitoring</span><span class="p">:</span>
<span class="o">+------------------------------------------+</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Real</span><span class="o">-</span><span class="n">time</span> <span class="n">security</span> <span class="n">alerts</span>              <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Failed</span> <span class="n">login</span> <span class="n">monitoring</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Anomaly</span> <span class="n">detection</span>                      <span class="o">|</span>
<span class="o">+------------------------------------------+</span>
</pre></div>
</div>
</section>
</section>
</section>

</main>
                        <nav aria-label="Page navigation" class="py-4 my-5 clearfix font-weight-bold border-top">
    <a class="float-left" href="trunk.html" title="Previous">
        <span aria-hidden="true">←&nbsp;</span>Trunk
    </a>
    <a class="float-right" href="websocket.html" title="Next">
        Websocket <span aria-hidden="true">&nbsp;→</span>
    </a>
</nav>
                    </div>
                    
                    <nav class="col-12 col-lg-3 pb-4">
                        <div class="sticky-top toc page-toc" aria-labelledby="page-toc-heading">
                            <p class="font-weight-bold" id="page-toc-heading">Page contents</p>
                            <ul>
<li><a class="reference internal" href="#">Architecture</a><ul>
<li><a class="reference internal" href="#overview">Overview</a><ul>
<li><a class="reference internal" href="#high-level-system-architecture">High-Level System Architecture</a></li>
<li><a class="reference internal" href="#architectural-layers">Architectural Layers</a></li>
<li><a class="reference internal" href="#core-design-principles">Core Design Principles</a></li>
<li><a class="reference internal" href="#communication-channels">Communication Channels</a></li>
<li><a class="reference internal" href="#integration-capabilities">Integration Capabilities</a></li>
<li><a class="reference internal" href="#key-architectural-benefits">Key Architectural Benefits</a></li>
<li><a class="reference internal" href="#service-dependencies">Service Dependencies</a></li>
<li><a class="reference internal" href="#technology-stack">Technology Stack</a></li>
</ul>
</li>
<li><a class="reference internal" href="#backend-microservices">Backend Microservices</a><ul>
<li><a class="reference internal" href="#microservices-organization">Microservices Organization</a></li>
<li><a class="reference internal" href="#service-characteristics">Service Characteristics</a></li>
<li><a class="reference internal" href="#api-gateway-bin-api-manager">API Gateway - bin-api-manager</a></li>
<li><a class="reference internal" href="#special-service-architectures">Special Service Architectures</a></li>
<li><a class="reference internal" href="#service-independence">Service Independence</a></li>
<li><a class="reference internal" href="#service-communication-patterns">Service Communication Patterns</a></li>
<li><a class="reference internal" href="#service-discovery-and-configuration">Service Discovery and Configuration</a></li>
<li><a class="reference internal" href="#health-monitoring">Health Monitoring</a></li>
<li><a class="reference internal" href="#error-handling-and-resilience">Error Handling and Resilience</a></li>
<li><a class="reference internal" href="#deployment-architecture">Deployment Architecture</a></li>
<li><a class="reference internal" href="#monitoring-and-observability">Monitoring and Observability</a></li>
<li><a class="reference internal" href="#best-practices">Best Practices</a></li>
</ul>
</li>
<li><a class="reference internal" href="#inter-service-communication">Inter-Service Communication</a><ul>
<li><a class="reference internal" href="#communication-patterns-overview">Communication Patterns Overview</a></li>
<li><a class="reference internal" href="#rabbitmq-rpc-pattern">RabbitMQ RPC Pattern</a></li>
<li><a class="reference internal" href="#rabbitmq-pub-sub-pattern">RabbitMQ Pub/Sub Pattern</a></li>
<li><a class="reference internal" href="#zeromq-event-streaming">ZeroMQ Event Streaming</a></li>
<li><a class="reference internal" href="#websocket-communication">WebSocket Communication</a></li>
<li><a class="reference internal" href="#message-reliability">Message Reliability</a></li>
<li><a class="reference internal" href="#message-ordering">Message Ordering</a></li>
<li><a class="reference internal" href="#error-handling-and-retries">Error Handling and Retries</a></li>
<li><a class="reference internal" href="#performance-optimization">Performance Optimization</a></li>
<li><a class="reference internal" href="#monitoring-and-debugging">Monitoring and Debugging</a></li>
<li><a class="reference internal" href="#id3">Best Practices</a></li>
</ul>
</li>
<li><a class="reference internal" href="#data-architecture">Data Architecture</a><ul>
<li><a class="reference internal" href="#data-layer-overview">Data Layer Overview</a></li>
<li><a class="reference internal" href="#mysql-database">MySQL Database</a></li>
<li><a class="reference internal" href="#database-migrations">Database Migrations</a></li>
<li><a class="reference internal" href="#redis-cache">Redis Cache</a></li>
<li><a class="reference internal" href="#session-management">Session Management</a></li>
<li><a class="reference internal" href="#data-consistency">Data Consistency</a></li>
<li><a class="reference internal" href="#data-backup-and-recovery">Data Backup and Recovery</a></li>
<li><a class="reference internal" href="#performance-monitoring">Performance Monitoring</a></li>
<li><a class="reference internal" href="#scalability-considerations">Scalability Considerations</a></li>
<li><a class="reference internal" href="#id4">Best Practices</a></li>
</ul>
</li>
<li><a class="reference internal" href="#data-flow-diagrams">Data Flow Diagrams</a><ul>
<li><a class="reference internal" href="#end-to-end-request-flow">End-to-End Request Flow</a></li>
<li><a class="reference internal" href="#event-publishing-flow">Event Publishing Flow</a></li>
<li><a class="reference internal" href="#real-time-data-flow-websocket">Real-Time Data Flow (WebSocket)</a></li>
<li><a class="reference internal" href="#media-stream-data-flow">Media Stream Data Flow</a></li>
<li><a class="reference internal" href="#database-write-flow">Database Write Flow</a></li>
<li><a class="reference internal" href="#campaign-execution-data-flow">Campaign Execution Data Flow</a></li>
<li><a class="reference internal" href="#transcription-data-flow">Transcription Data Flow</a></li>
<li><a class="reference internal" href="#webhook-delivery-data-flow">Webhook Delivery Data Flow</a></li>
<li><a class="reference internal" href="#data-synchronization-patterns">Data Synchronization Patterns</a></li>
</ul>
</li>
<li><a class="reference internal" href="#real-time-communication-rtc">Real-Time Communication (RTC)</a><ul>
<li><a class="reference internal" href="#voip-stack-overview">VoIP Stack Overview</a></li>
<li><a class="reference internal" href="#kamailio-sip-edge-router">Kamailio - SIP Edge Router</a></li>
<li><a class="reference internal" href="#asterisk-media-and-call-processing">Asterisk - Media and Call Processing</a></li>
<li><a class="reference internal" href="#rtpengine-media-proxy-and-transcoding">RTPEngine - Media Proxy and Transcoding</a></li>
<li><a class="reference internal" href="#conference-architecture">Conference Architecture</a><ul>
<li><a class="reference internal" href="#conference-flow">Conference Flow</a></li>
<li><a class="reference internal" href="#calls-as-conferences">1:1 Calls as Conferences</a></li>
</ul>
</li>
<li><a class="reference internal" href="#sip-session-recovery">SIP Session Recovery</a><ul>
<li><a class="reference internal" href="#how-it-works">How It Works</a></li>
<li><a class="reference internal" href="#detailed-steps">Detailed Steps</a></li>
<li><a class="reference internal" href="#asterisk-patch-for-recovery">Asterisk Patch for Recovery</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#system-request-flows">System Request Flows</a><ul>
<li><a class="reference internal" href="#request-flow-overview">Request Flow Overview</a></li>
<li><a class="reference internal" href="#flow-1-create-call-simple">Flow 1: Create Call (Simple)</a></li>
<li><a class="reference internal" href="#flow-2-get-call-with-caching">Flow 2: Get Call with Caching</a></li>
<li><a class="reference internal" href="#flow-3-call-with-event-broadcasting">Flow 3: Call with Event Broadcasting</a></li>
<li><a class="reference internal" href="#flow-4-complex-multi-service-flow">Flow 4: Complex Multi-Service Flow</a></li>
<li><a class="reference internal" href="#flow-5-real-time-event-notification">Flow 5: Real-Time Event Notification</a></li>
<li><a class="reference internal" href="#flow-6-error-handling-flow">Flow 6: Error Handling Flow</a></li>
<li><a class="reference internal" href="#id7">Performance Optimization</a></li>
<li><a class="reference internal" href="#best-practices-for-developers">Best Practices for Developers</a></li>
<li><a class="reference internal" href="#debugging-request-flows">Debugging Request Flows</a></li>
<li><a class="reference internal" href="#summary">Summary</a></li>
</ul>
</li>
<li><a class="reference internal" href="#call-flow-sequences">Call Flow Sequences</a><ul>
<li><a class="reference internal" href="#inbound-call-flow">Inbound Call Flow</a></li>
<li><a class="reference internal" href="#outbound-campaign-flow">Outbound Campaign Flow</a></li>
<li><a class="reference internal" href="#ai-voice-assistant-flow-pipecat">AI Voice Assistant Flow (Pipecat)</a></li>
<li><a class="reference internal" href="#call-transfer-sequence">Call Transfer Sequence</a></li>
<li><a class="reference internal" href="#queue-call-distribution">Queue Call Distribution</a></li>
<li><a class="reference internal" href="#conference-join-sequence">Conference Join Sequence</a></li>
<li><a class="reference internal" href="#webhook-delivery-flow">Webhook Delivery Flow</a></li>
</ul>
</li>
<li><a class="reference internal" href="#architecture-deployment">Deployment Architecture</a><ul>
<li><a class="reference internal" href="#infrastructure-overview">Infrastructure Overview</a></li>
<li><a class="reference internal" href="#kubernetes-architecture">Kubernetes Architecture</a></li>
<li><a class="reference internal" href="#service-scaling">Service Scaling</a></li>
<li><a class="reference internal" href="#voip-infrastructure">VoIP Infrastructure</a></li>
<li><a class="reference internal" href="#database-infrastructure">Database Infrastructure</a></li>
<li><a class="reference internal" href="#cache-infrastructure">Cache Infrastructure</a></li>
<li><a class="reference internal" href="#message-queue-infrastructure">Message Queue Infrastructure</a></li>
<li><a class="reference internal" href="#network-architecture">Network Architecture</a></li>
<li><a class="reference internal" href="#load-balancing">Load Balancing</a></li>
<li><a class="reference internal" href="#monitoring-stack">Monitoring Stack</a></li>
<li><a class="reference internal" href="#deployment-pipeline">Deployment Pipeline</a></li>
<li><a class="reference internal" href="#disaster-recovery">Disaster Recovery</a></li>
<li><a class="reference internal" href="#cost-optimization">Cost Optimization</a></li>
</ul>
</li>
<li><a class="reference internal" href="#security-architecture">Security Architecture</a><ul>
<li><a class="reference internal" href="#security-overview">Security Overview</a></li>
<li><a class="reference internal" href="#authentication-architecture">Authentication Architecture</a></li>
<li><a class="reference internal" href="#authorization-model">Authorization Model</a></li>
<li><a class="reference internal" href="#transport-security">Transport Security</a></li>
<li><a class="reference internal" href="#secrets-management">Secrets Management</a></li>
<li><a class="reference internal" href="#network-security">Network Security</a></li>
<li><a class="reference internal" href="#input-validation">Input Validation</a></li>
<li><a class="reference internal" href="#rate-limiting">Rate Limiting</a></li>
<li><a class="reference internal" href="#audit-logging">Audit Logging</a></li>
<li><a class="reference internal" href="#data-protection">Data Protection</a></li>
<li><a class="reference internal" href="#compliance">Compliance</a></li>
<li><a class="reference internal" href="#security-best-practices">Security Best Practices</a></li>
</ul>
</li>
</ul>
</li>
</ul>

                        </div>
                    </nav>
                    
                </div>
            </div>
        </div>
    </div>
    <footer class="container-fluid bg-primary text-light">
        <div class="container">
            <div class="row">
        <div class="col p-4">
            
                <nav aria-label="Footer">
                    <ul class="nav justify-content-center mb-2">
                        
                            
                            
                            <li class="nav-item"><a class="nav-link text-light"  href="http://voipbin.net">About Us</a></li>
                        
                            
                            
                            <li class="nav-item"><a class="nav-link text-light"  href="http://voipbin.net">Contact</a></li>
                        
                    </ul>
                </nav>
            
            <div class="text-center">
                    &copy; Copyright 2026, VoIPBIN
            </div>
            <div class="text-center text-white-50 font-italic mt-3">
                <small>
                    Created using
                    <a class="text-white" href="https://github.com/wagtail/sphinx_wagtail_theme" rel="nofollow" target="_blank">
                        Sphinx Wagtail Theme 6.5.0
                    </a>
                    and
                    <a class="text-white" href="https://www.sphinx-doc.org/" rel="nofollow" target="_blank">
                        Sphinx 7.2.6
                    </a>
                </small>
            </div>
        </div>
    </div>
        </div>
    </footer>
        <script src="_static/jquery.js?v=8dae8fb0"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=5929fcd5"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="_static/copybutton.js?v=f281be69"></script>
        <script type="text/javascript" src="_static/dist/theme.js"></script>
        <script type="text/javascript" src="_static/dist/vendor.js"></script>
        <script type="text/javascript" src="_static/searchtools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script type="text/javascript">
            document.addEventListener('DOMContentLoaded', function() { Search.loadIndex("searchindex.js"); });
        </script>
        <script type="text/javascript" id="searchindexloader"></script>
    </body>
</html>