<!DOCTYPE html>
<html class="no-js" lang="en" data-content_root="./">
<head>
    <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
        <title>System Request Flows &mdash; voipbin  documentation</title>
    
    <link rel="stylesheet" type="text/css" href="_static/dist/fontawesome.css" />
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=8e8a900e" />
      <link rel="stylesheet" type="text/css" href="_static/dist/theme.css?v=310cf088" />
      <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
            <link rel="index" title="Index" href="genindex.html" />
            <link rel="search" title="Search" href="search.html" />
            <link rel="top" title="voipbin  documentation" href="#" />
    </head>
<body>
    <script type="text/javascript" src="_static/dist/blocking.js"></script>
    <header class="container-fluid bg-primary">
        <a class="btn btn-sm btn-light skip-to-content-link" href="#main">Skip to content</a>
        <div class="container-fluid">
            <div class="navbar navbar-expand-lg navbar-dark font-weight-bold">
                    <a href="intro.html"
                        title="voipbin"
                        class="logo navbar-brand"
                    >
                        <img src="_static/images/voipbin-high-resolution-logo-white-transparent.png" width="45" height="80" alt="voipbin"
                            class="logo-img"
                        />
                        VoIPBin Documentation
                    </a>
                
                
                    <div class="collapse navbar-collapse justify-content-end">
                        <ul class="navbar-nav">
                            
                                
                                
                                <li class="nav-item"><a class="nav-link"  href="http://voipbin.net">Project</a></li>
                            
                                
                                
                                <li class="nav-item"><a class="nav-link"  href="https://admin.voipbin.net">Admin</a></li>
                            
                        </ul>
                    </div>
                
                <button class="navbar-toggler btn btn-primary d-lg-none" type="button" data-toggle="collapse" data-target="#collapseSidebar" aria-expanded="false" aria-controls="collapseExample">
                    <span class="navbar-toggler-icon"></span>
                    <span class="sr-only">menu</span>
                </button>
            </div>
        </div>
    </header>
    <div class="container-fluid">
        <div class="row">
            <aside class="col-12 col-lg-3 sidebar-container">
                <div id="collapseSidebar" class="collapse sticky-top d-lg-block pt-5 pr-lg-4">
<div id="searchbox" class="searchbox mb-6 px-1" role="search">
    <form id="search-form" action="search.html" autocomplete="off" method="get" role="search">
        <div class="input-group">
            <div class="input-group-prepend">
                <div class="input-group-text border-right-0 bg-white py-3 pl-3 pr-2"><span class="fas fa-search"></span></div>
            </div>
            <input class="form-control py-3 pr-3 pl-1 h-100 border-left-0" type="search" name="q" placeholder="Search documentation" aria-label="Search documentation" id="searchinput" />
        </div>
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
    </form>
</div><div class="site-toc">
    <nav class="toc mt-3" aria-label="Main menu">
        <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="accesskey.html">Accesskey</a></li>
<li class="toctree-l1"><a class="reference internal" href="sdk.html">SDK(Software Development Kit)</a></li>
<li class="toctree-l1"><a class="reference internal" href="restful_api.html">RESTful API(Application Programming Interface)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Core Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="flow.html">Flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="flow.html#activeflow">Activeflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="variable.html">Variable</a></li>
<li class="toctree-l1"><a class="reference internal" href="webhook.html">Webhook</a></li>
<li class="toctree-l1"><a class="reference internal" href="common.html">Common</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Voice &amp; Real-Time</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="call.html">Call</a></li>
<li class="toctree-l1"><a class="reference internal" href="conference.html">Conference</a></li>
<li class="toctree-l1"><a class="reference internal" href="queue.html">Queue</a></li>
<li class="toctree-l1"><a class="reference internal" href="recording.html">Recording</a></li>
<li class="toctree-l1"><a class="reference internal" href="transcribe.html">Transcribe</a></li>
<li class="toctree-l1"><a class="reference internal" href="mediastream.html">Mediastream</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Messaging</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="message.html">Message</a></li>
<li class="toctree-l1"><a class="reference internal" href="email.html">Email</a></li>
<li class="toctree-l1"><a class="reference internal" href="talk.html">Talk</a></li>
<li class="toctree-l1"><a class="reference internal" href="conversation.html">Conversation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">AI &amp; Automation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="ai.html">AI</a></li>
<li class="toctree-l1"><a class="reference internal" href="campaign.html">Campaign</a></li>
<li class="toctree-l1"><a class="reference internal" href="outdial.html">Outdial</a></li>
<li class="toctree-l1"><a class="reference internal" href="outplan.html">Outplan</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Resources &amp; Management</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="number.html">Number</a></li>
<li class="toctree-l1"><a class="reference internal" href="agent.html">Agent</a></li>
<li class="toctree-l1"><a class="reference internal" href="contact.html">Contact</a></li>
<li class="toctree-l1"><a class="reference internal" href="customer.html">Customer</a></li>
<li class="toctree-l1"><a class="reference internal" href="billing_account.html">Billing Account</a></li>
<li class="toctree-l1"><a class="reference internal" href="storage.html">Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="tag.html">Tag</a></li>
<li class="toctree-l1"><a class="reference internal" href="provider.html">Provider</a></li>
<li class="toctree-l1"><a class="reference internal" href="route.html">Route</a></li>
<li class="toctree-l1"><a class="reference internal" href="extension.html">Extension</a></li>
<li class="toctree-l1"><a class="reference internal" href="trunk.html">Trunk</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Architecture (Deep Dive)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="websocket.html">Websocket</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Help &amp; Support</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="support.html">Support</a></li>
</ul>

    </nav>
    <template data-toggle-item-template>
        <button class="btn btn-sm btn-link toctree-expand" type="button">
            <span class="sr-only">Toggle menu contents</span>
        </button>
    </template>
</div>
                    <div class="d-lg-none border-bottom">
                        
                    </div>
                </div>
            </aside>
            <div class="col-12 col-lg-9 pt-5">
                <header class="row align-items-baseline">
                    <div class="col">
                        <nav aria-label="breadcrumb">
    <ol class="breadcrumb m-0 p-0 bg-transparent">
        <li class="breadcrumb-item"><a href="index.html">Docs</a></li>
        <li class="breadcrumb-item active" aria-current="page">System Request Flows</li>
    </ol>
</nav>
                    </div>
                    <div class="col-sm-12 col-lg-auto mt-3 mt-lg-3">
                        <noscript>
                            <p>JavaScript is required to toggle light/dark mode..</p>
                        </noscript>
                        <button id="wagtail-theme" class="btn btn-sm btn-light text-decoration-none" type="button">
                            <span class="dark-only"><i class="fas fa-sun"></i> Light mode</span>
                            <span class="light-only"><i class="fas fa-moon"></i> Dark mode</span>
                        </button>
    <a class="btn btn-sm btn-light text-decoration-none" href="_sources/architecture_flow.rst.txt" rel="nofollow">
        <span class="btn-icon"><span class="fas fa-code"></span></span>
        <span class="btn-text">View source</span>
    </a>
                        
                    </div>
                </header>
                <div class="row" >
                    <div class="col-12">
                        <hr class="w-100 my-4">
                    </div>
                </div>
                <div class="row">
                    <div class="col-12 col-lg-9 order-last order-lg-first rst-content">
                        <main role="main" id="main">
    <section id="system-request-flows">
<span id="architecture-flow"></span><h1>System Request Flows<a class="headerlink" href="#system-request-flows" title="Link to this heading"></a></h1>
<p>This section demonstrates how requests flow through VoIPBIN’s architecture from client to backend services and back. Understanding these flows helps developers build integrations and debug issues.</p>
<section id="request-flow-overview">
<h2>Request Flow Overview<a class="headerlink" href="#request-flow-overview" title="Link to this heading"></a></h2>
<p>All external requests follow this general pattern:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Complete</span> <span class="n">Request</span> <span class="n">Flow</span><span class="p">:</span>

<span class="n">Client</span> <span class="n">App</span>          <span class="n">API</span> <span class="n">Gateway</span>         <span class="n">Message</span> <span class="n">Queue</span>       <span class="n">Backend</span> <span class="n">Service</span>      <span class="n">Data</span> <span class="n">Layer</span>
    <span class="o">|</span>                   <span class="o">|</span>                    <span class="o">|</span>                     <span class="o">|</span>                  <span class="o">|</span>
    <span class="o">|</span>  <span class="n">HTTP</span> <span class="n">Request</span>     <span class="o">|</span>                    <span class="o">|</span>                     <span class="o">|</span>                  <span class="o">|</span>
    <span class="o">+------------------&gt;|</span>                    <span class="o">|</span>                     <span class="o">|</span>                  <span class="o">|</span>
    <span class="o">|</span>                   <span class="o">|</span>  <span class="mf">1.</span> <span class="n">Authenticate</span>   <span class="o">|</span>                     <span class="o">|</span>                  <span class="o">|</span>
    <span class="o">|</span>                   <span class="o">|</span>  <span class="mf">2.</span> <span class="n">Authorize</span>      <span class="o">|</span>                     <span class="o">|</span>                  <span class="o">|</span>
    <span class="o">|</span>                   <span class="o">|</span>  <span class="mf">3.</span> <span class="n">Validate</span>       <span class="o">|</span>                     <span class="o">|</span>                  <span class="o">|</span>
    <span class="o">|</span>                   <span class="o">|</span>                    <span class="o">|</span>                     <span class="o">|</span>                  <span class="o">|</span>
    <span class="o">|</span>                   <span class="o">|</span>  <span class="n">RPC</span> <span class="n">Request</span>       <span class="o">|</span>                     <span class="o">|</span>                  <span class="o">|</span>
    <span class="o">|</span>                   <span class="o">+-------------------&gt;|</span>                     <span class="o">|</span>                  <span class="o">|</span>
    <span class="o">|</span>                   <span class="o">|</span>                    <span class="o">|</span>  <span class="n">Dequeue</span>            <span class="o">|</span>                  <span class="o">|</span>
    <span class="o">|</span>                   <span class="o">|</span>                    <span class="o">+--------------------&gt;|</span>                  <span class="o">|</span>
    <span class="o">|</span>                   <span class="o">|</span>                    <span class="o">|</span>                     <span class="o">|</span>  <span class="n">Query</span>           <span class="o">|</span>
    <span class="o">|</span>                   <span class="o">|</span>                    <span class="o">|</span>                     <span class="o">+-----------------&gt;|</span>
    <span class="o">|</span>                   <span class="o">|</span>                    <span class="o">|</span>                     <span class="o">|</span>                  <span class="o">|</span>
    <span class="o">|</span>                   <span class="o">|</span>                    <span class="o">|</span>                     <span class="o">|</span>  <span class="n">Result</span>          <span class="o">|</span>
    <span class="o">|</span>                   <span class="o">|</span>                    <span class="o">|</span>                     <span class="o">|&lt;-----------------+</span>
    <span class="o">|</span>                   <span class="o">|</span>                    <span class="o">|</span>  <span class="n">Response</span>           <span class="o">|</span>                  <span class="o">|</span>
    <span class="o">|</span>                   <span class="o">|</span>                    <span class="o">|&lt;--------------------+</span>                  <span class="o">|</span>
    <span class="o">|</span>                   <span class="o">|</span>  <span class="n">RPC</span> <span class="n">Response</span>      <span class="o">|</span>                     <span class="o">|</span>                  <span class="o">|</span>
    <span class="o">|</span>                   <span class="o">|&lt;-------------------+</span>                     <span class="o">|</span>                  <span class="o">|</span>
    <span class="o">|</span>  <span class="n">JSON</span> <span class="n">Response</span>    <span class="o">|</span>                    <span class="o">|</span>                     <span class="o">|</span>                  <span class="o">|</span>
    <span class="o">|&lt;------------------+</span>                    <span class="o">|</span>                     <span class="o">|</span>                  <span class="o">|</span>
    <span class="o">|</span>                   <span class="o">|</span>                    <span class="o">|</span>                     <span class="o">|</span>                  <span class="o">|</span>
</pre></div>
</div>
</section>
<section id="flow-1-create-call-simple">
<h2>Flow 1: Create Call (Simple)<a class="headerlink" href="#flow-1-create-call-simple" title="Link to this heading"></a></h2>
<p>This flow shows how a basic call creation request flows through the system.</p>
<p><strong>Step-by-Step Flow:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>1. Client Request:

Client Application
    |
    |  POST /v1.0/calls
    |  Authorization: Bearer eyJhbGc...
    |  Content-Type: application/json
    |
    |  {
    |    &quot;source&quot;: {&quot;type&quot;: &quot;tel&quot;, &quot;target&quot;: &quot;+15551234567&quot;},
    |    &quot;destinations&quot;: [{&quot;type&quot;: &quot;tel&quot;, &quot;target&quot;: &quot;+15559876543&quot;}]
    |  }
    |
    v

2. API Gateway (bin-api-manager):

+-------------------------------------------------+
|  a) Extract JWT token                           |
|     → token = &quot;eyJhbGc...&quot;                      |
|                                                 |
|  b) Validate JWT signature                      |
|     → customer_id = &quot;customer-123&quot;              |
|     → agent_id = &quot;agent-456&quot;                    |
|                                                 |
|  c) Check permissions                           |
|     → hasPermission(customer-123, &quot;call.create&quot;)|
|     → ✓ Allowed                                 |
|                                                 |
|  d) Validate request body                       |
|     → Source phone valid                        |
|     → Destination phone valid                   |
|     → ✓ Valid                                   |
|                                                 |
|  e) Build RPC message                           |
|     {                                           |
|       &quot;route&quot;: &quot;POST /v1/calls&quot;,                |
|       &quot;headers&quot;: {                              |
|         &quot;customer_id&quot;: &quot;customer-123&quot;,          |
|         &quot;agent_id&quot;: &quot;agent-456&quot;                 |
|       },                                        |
|       &quot;body&quot;: {...}                             |
|     }                                           |
|                                                 |
|  f) Send to RabbitMQ                            |
|     → Queue: bin-manager.call.request           |
+-------------------------------------------------+
    |
    v

3. RabbitMQ:

+------------------------------------------------+
|  a) Receive message                            |
|     → Queue: bin-manager.call.request          |
|                                                |
|  b) Route to available consumer                |
|     → bin-call-manager instance 2 (of 3)       |
+------------------------------------------------+
    |
    v

4. Call Manager (bin-call-manager):

+-------------------------------------------------+
|  a) Receive RPC message                         |
|     → Parse route: POST /v1/calls               |
|     → Extract customer_id, agent_id             |
|                                                 |
|  b) Validate business logic                     |
|     → Check billing balance                     |
|     → ✓ Sufficient funds                        |
|                                                 |
|  c) Create call record                          |
|     → Generate call_id = &quot;call-789&quot;             |
|     → INSERT INTO calls (...)                   |
|     → Status: &quot;initiating&quot;                      |
|                                                 |
|  d) Initiate SIP call                           |
|     → Send to bin-rtc-manager                   |
|     → Request Asterisk channel creation         |
|                                                 |
|  e) Update call status                          |
|     → UPDATE calls SET status=&#39;ringing&#39; WHERE...|
|                                                 |
|  f) Publish event                               |
|     → Event: call.created                       |
|     → RabbitMQ exchange: call.events            |
|                                                 |
|  g) Build response                              |
|     {                                           |
|       &quot;id&quot;: &quot;call-789&quot;,                         |
|       &quot;status&quot;: &quot;ringing&quot;,                      |
|       &quot;source&quot;: &quot;+15551234567&quot;,                 |
|       &quot;destination&quot;: &quot;+15559876543&quot;,            |
|       &quot;tm_create&quot;: &quot;2026-01-20T12:00:00.000Z&quot;   |
|     }                                           |
|                                                 |
|  h) Send RPC response                           |
|     → Reply to: reply_to queue                  |
+-------------------------------------------------+
    |
    v

5. RabbitMQ (Response):

+------------------------------------------------+
|  a) Deliver response to API Gateway            |
|     → Queue: amq.gen-xyz (reply_to)            |
+------------------------------------------------+
    |
    v

6. API Gateway (Response):

+------------------------------------------------+
|  a) Receive RPC response                       |
|     → status_code: 200                         |
|     → body: {...}                              |
|                                                |
|  b) Format HTTP response                       |
|     → HTTP 201 Created                         |
|     → Content-Type: application/json           |
+------------------------------------------------+
    |
    v

7. Client Response:

HTTP/1.1 201 Created
Content-Type: application/json

{
  &quot;id&quot;: &quot;call-789&quot;,
  &quot;status&quot;: &quot;ringing&quot;,
  &quot;source&quot;: &quot;+15551234567&quot;,
  &quot;destination&quot;: &quot;+15559876543&quot;,
  &quot;tm_create&quot;: &quot;2026-01-20T12:00:00.000Z&quot;
}
</pre></div>
</div>
<p><strong>Timing Breakdown:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Component</span>               <span class="n">Time</span>      <span class="n">Cumulative</span>
<span class="o">---------------------------------------------</span>
<span class="n">API</span> <span class="n">Gateway</span> <span class="n">auth</span>        <span class="mi">5</span><span class="n">ms</span>       <span class="mi">5</span><span class="n">ms</span>
<span class="n">RabbitMQ</span> <span class="n">routing</span>        <span class="mi">2</span><span class="n">ms</span>       <span class="mi">7</span><span class="n">ms</span>
<span class="n">Call</span> <span class="n">Manager</span> <span class="n">logic</span>      <span class="mi">30</span><span class="n">ms</span>      <span class="mi">37</span><span class="n">ms</span>
<span class="n">Database</span> <span class="n">insert</span>         <span class="mi">8</span><span class="n">ms</span>       <span class="mi">45</span><span class="n">ms</span>
<span class="n">RTC</span> <span class="n">Manager</span> <span class="n">SIP</span> <span class="n">setup</span>   <span class="mi">50</span><span class="n">ms</span>      <span class="mi">95</span><span class="n">ms</span>
<span class="n">Response</span> <span class="n">routing</span>        <span class="mi">5</span><span class="n">ms</span>       <span class="mi">100</span><span class="n">ms</span>
<span class="o">---------------------------------------------</span>
<span class="n">Total</span>                   <span class="mi">100</span><span class="n">ms</span>
</pre></div>
</div>
</section>
<section id="flow-2-get-call-with-caching">
<h2>Flow 2: Get Call with Caching<a class="headerlink" href="#flow-2-get-call-with-caching" title="Link to this heading"></a></h2>
<p>This flow demonstrates cache-aside pattern for reading data.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>1. Client Request:

GET /v1.0/calls/call-789
Authorization: Bearer eyJhbGc...

    |
    v

2. API Gateway:

+------------------------------------------------+
|  • Authenticate (5ms)                          |
|  • Build RPC message                           |
|  • Send to bin-manager.call.request            |
+------------------------------------------------+
    |
    v

3. Call Manager:

+------------------------------------------------+
|  a) Check Redis cache first                    |
|     key = &quot;call:call-789&quot;                      |
|                                                |
|     GET call:call-789                          |
|     → Cache HIT! (90% of requests)             |
|     → Return cached data (2ms)                 |
|                                                |
|     OR                                         |
|                                                |
|     → Cache MISS (10% of requests)             |
|                                                |
|  b) If cache miss, query MySQL                 |
|     SELECT * FROM calls WHERE id=&#39;call-789&#39;    |
|     → Query time: 10ms                         |
|                                                |
|  c) Store in Redis for next time               |
|     SET call:call-789 {...} EX 300  # 5 min    |
|     → Store time: 2ms                          |
|                                                |
|  d) Check authorization                        |
|     if call.customer_id != jwt.customer_id:    |
|       return 404 (not 403, for security)       |
|                                                |
|  e) Return response                            |
+------------------------------------------------+
    |
    v

4. Response Times:

Cache Hit Path:  ~12ms total
• API Gateway: 5ms
• Redis lookup: 2ms
• Response: 5ms

Cache Miss Path: ~27ms total
• API Gateway: 5ms
• Redis lookup: 2ms (miss)
• MySQL query: 10ms
• Redis store: 2ms
• Response: 5ms
• Authorization: 3ms
</pre></div>
</div>
</section>
<section id="flow-3-call-with-event-broadcasting">
<h2>Flow 3: Call with Event Broadcasting<a class="headerlink" href="#flow-3-call-with-event-broadcasting" title="Link to this heading"></a></h2>
<p>This flow shows asynchronous event publishing to multiple subscribers.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Call State Change Flow:

1. Call Answered (in bin-call-manager):

+------------------------------------------------+
|  a) Receive SIP 200 OK from Asterisk           |
|     → Call answered                            |
|                                                |
|  b) Update database                            |
|     UPDATE calls                               |
|     SET status=&#39;active&#39;, tm_answer=NOW()       |
|     WHERE id=&#39;call-789&#39;                        |
|                                                |
|  c) Invalidate cache                           |
|     DEL call:call-789                          |
|                                                |
|  d) Publish event to RabbitMQ                  |
|     Exchange: call.events                      |
|     Event: call.answered                       |
|     {                                          |
|       &quot;event_type&quot;: &quot;call.answered&quot;,           |
|       &quot;call_id&quot;: &quot;call-789&quot;,                   |
|       &quot;timestamp&quot;: &quot;2026-01-20T12:00:05.000Z&quot;  |
|     }                                          |
|                                                |
|  e) Publish to ZeroMQ (fast path)              |
|     Topic: &quot;call.state&quot;                        |
|     {                                          |
|       &quot;call_id&quot;: &quot;call-789&quot;,                   |
|       &quot;status&quot;: &quot;active&quot;                       |
|     }                                          |
+------------------------------------------------+
    |
    |
    +----------------------+----------------------+----------------------+
    |                      |                      |                      |
    v                      v                      v                      v

2a. Billing Manager    2b. Webhook Manager   2c. Talk Manager      2d. Agent Manager

+----------------+    +----------------+    +----------------+   +----------------+
| Start billing  |    | Send webhook   |    | Update agent   |   | Update agent   |
| for call       |    | to customer    |    | dashboard      |   | stats          |
|                |    | endpoint       |    | via WebSocket  |   |                |
| • Calculate    |    |                |    |                |   | • Active calls |
|   charges      |    | POST https://  |    | {              |   | • Talk time    |
| • Create       |    | customer.com/  |    |   &quot;event&quot;:     |   | • Status       |
|   billing      |    | webhook        |    |   &quot;call.       |   |                |
|   record       |    |                |    |   answered&quot;,   |   |                |
|                |    | {              |    |   &quot;call_id&quot;:   |   |                |
| INSERT INTO    |    |   &quot;event_type&quot;:|    |   &quot;call-789&quot;   |   |                |
| billings       |    |   &quot;call.       |    | }              |   |                |
| (...)          |    |   answered&quot;,   |    |                |   |                |
|                |    |   ...          |    |                |   |                |
|                |    | }              |    |                |   |                |
+----------------+    +----------------+    +----------------+   +----------------+

All subscribers process event independently and concurrently
</pre></div>
</div>
</section>
<section id="flow-4-complex-multi-service-flow">
<h2>Flow 4: Complex Multi-Service Flow<a class="headerlink" href="#flow-4-complex-multi-service-flow" title="Link to this heading"></a></h2>
<p>This flow demonstrates a complex operation involving multiple services.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Conference Join with Flow Execution:

Client                API Gateway         Flow Manager        Conference Mgr      Call Manager
  |                       |                    |                    |                  |
  |  POST /conferences/   |                    |                    |                  |
  |  conf-123/join        |                    |                    |                  |
  +----------------------&gt;|                    |                    |                  |
  |                       |  Auth + RPC        |                    |                  |
  |                       +-------------------&gt;|                    |                  |
  |                       |                    |                    |                  |
  |                       |                    |  1. Get Conference |                  |
  |                       |                    +-------------------&gt;|                  |
  |                       |                    |                    |  [conf data]     |
  |                       |                    |&lt;-------------------+                  |
  |                       |                    |                    |                  |
  |                       |                    |  2. Get Flow       |                  |
  |                       |                    |  (from conf)       |                  |
  |                       |                    |                    |                  |
  |                       |                    |  3. Execute Flow   |                  |
  |                       |                    |  Actions:          |                  |
  |                       |                    |                    |                  |
  |                       |                    |  Action 1: Answer  |                  |
  |                       |                    +--------------------------------------&gt;|
  |                       |                    |                    |                  |
  |                       |                    |  Action 2: Talk    |                  |
  |                       |                    |  &quot;Welcome to conf&quot; |                  |
  |                       |                    +--------------------------------------&gt;|
  |                       |                    |                    |                  |
  |                       |                    |  Action 3: Join    |                  |
  |                       |                    |  Conference        |                  |
  |                       |                    +-------------------&gt;|                  |
  |                       |                    |                    |  Add participant |
  |                       |                    |                    |  to bridge       |
  |                       |                    |&lt;-------------------+                  |
  |                       |                    |                    |                  |
  |                       |  Response          |                    |                  |
  |                       |&lt;-------------------+                    |                  |
  |  Success              |                    |                    |                  |
  |&lt;----------------------+                    |                    |                  |
  |                       |                    |                    |                  |

Services Involved:
• API Gateway (authentication, routing)
• Flow Manager (orchestration)
• Conference Manager (conference state)
• Call Manager (call handling)
• RTC Manager (not shown, handles SIP/media)

Total Time: ~200ms
• Gateway: 5ms
• Conference lookup: 10ms
• Flow execution: 150ms (multiple actions)
• Conference join: 30ms
• Response: 5ms
</pre></div>
</div>
</section>
<section id="flow-5-real-time-event-notification">
<h2>Flow 5: Real-Time Event Notification<a class="headerlink" href="#flow-5-real-time-event-notification" title="Link to this heading"></a></h2>
<p>This flow shows how real-time events reach clients via WebSocket.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Real-Time Call Status Updates:

1. Client Subscribes:

Client (Browser)        API Gateway (WebSocket)    Backend Services
    |                           |                       |
    |  WebSocket Connect        |                       |
    +--------------------------&gt;|                       |
    |  wss://api.voipbin.net/ws |                       |
    |  ?token=eyJhbGc...        |                       |
    |                           |  Validate JWT         |
    |                           |  → customer_id: 123   |
    |                           |                       |
    |  Subscribe                |                       |
    |  {                        |                       |
    |    &quot;type&quot;: &quot;subscribe&quot;,   |                       |
    |    &quot;topics&quot;: [            |                       |
    |      &quot;customer_id:123:    |                       |
    |       call:*&quot;             |                       |
    |    ]                      |                       |
    |  }                        |                       |
    +--------------------------&gt;|                       |
    |                           |  Register             |
    |                           |  subscription         |
    |                           |                       |
    |  ACK                      |                       |
    |&lt;--------------------------+                       |
    |                           |                       |

2. Event Occurs:

Call Manager                RabbitMQ/ZMQ          API Gateway (WS)      Client
    |                           |                       |                  |
    |  Call status changed      |                       |                  |
    |  (answered)               |                       |                  |
    |                           |                       |                  |
    |  Publish event            |                       |                  |
    +--------------------------&gt;|                       |                  |
    |  {                        |                       |                  |
    |    &quot;event&quot;: &quot;call.        |                       |                  |
    |     answered&quot;,            |                       |                  |
    |    &quot;customer_id&quot;: &quot;123&quot;,  |                       |                  |
    |    &quot;call_id&quot;: &quot;call-789&quot;  |                       |                  |
    |  }                        |                       |                  |
    |                           |                       |                  |
    |                           |  Fanout to            |                  |
    |                           |  subscribers          |                  |
    |                           +----------------------&gt;|                  |
    |                           |                       |  Match topic     |
    |                           |                       |  filter          |
    |                           |                       |                  |
    |                           |                       |  Push to client  |
    |                           |                       +-----------------&gt;|
    |                           |                       |                  |
    |                           |                       |  {               |
    |                           |                       |    &quot;event_type&quot;: |
    |                           |                       |    &quot;call.        |
    |                           |                       |    answered&quot;,    |
    |                           |                       |    &quot;call_id&quot;:    |
    |                           |                       |    &quot;call-789&quot;,   |
    |                           |                       |    &quot;timestamp&quot;:  |
    |                           |                       |    &quot;...&quot;         |
    |                           |                       |  }               |

Latency: &lt; 100ms from event to client notification
</pre></div>
</div>
</section>
<section id="flow-6-error-handling-flow">
<h2>Flow 6: Error Handling Flow<a class="headerlink" href="#flow-6-error-handling-flow" title="Link to this heading"></a></h2>
<p>This flow demonstrates error handling and retry logic.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Failed Request with Retry:

1. Initial Request (Fails):

API Gateway         Call Manager        Database
    |                   |                   |
    |  RPC: Create Call |                   |
    +------------------&gt;|                   |
    |                   |  INSERT INTO      |
    |                   |  calls (...)      |
    |                   +------------------&gt;|
    |                   |                   X  Connection lost
    |                   |                   |
    |                   |  ← Error          |
    |                   |&lt;------------------+
    |                   |                   |
    |                   |  Retry (1s delay) |
    |                   |                   |

2. Automatic Retry (Attempt 2):

    |                   |  Reconnect        |
    |                   +------------------&gt;|
    |                   |                   |
    |                   |  INSERT INTO      |
    |                   |  calls (...)      |
    |                   +------------------&gt;|
    |                   |                   ✓  Success
    |                   |                   |
    |                   |  Success          |
    |                   |&lt;------------------+
    |                   |                   |
    |  Success          |                   |
    |&lt;------------------+                   |
    |                   |                   |

3. Permanent Error (No Retry):

API Gateway         Call Manager        Billing Manager
    |                   |                   |
    |  RPC: Create Call |                   |
    +------------------&gt;|                   |
    |                   |  Check balance    |
    |                   +------------------&gt;|
    |                   |                   |
    |                   |  Insufficient     |
    |                   |  balance          |
    |                   |&lt;------------------+
    |                   |                   |
    |  Error 402        |  Don&#39;t retry      |
    |  Payment Required |  (permanent error)|
    |&lt;------------------+                   |
    |                   |                   |

Error Categories:
• Transient → Retry (network, timeout, connection)
• Permanent → Don&#39;t retry (invalid data, permissions)
• Business → Return error (insufficient balance)
</pre></div>
</div>
</section>
<section id="performance-optimization">
<h2>Performance Optimization<a class="headerlink" href="#performance-optimization" title="Link to this heading"></a></h2>
<p>VoIPBIN optimizes flow performance through several techniques:</p>
<p><strong>Parallel Processing</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Sequential</span> <span class="n">vs</span> <span class="n">Parallel</span><span class="p">:</span>

<span class="n">Sequential</span> <span class="p">(</span><span class="n">Slow</span><span class="p">):</span>           <span class="n">Parallel</span> <span class="p">(</span><span class="n">Fast</span><span class="p">):</span>
<span class="o">+----------+</span>                 <span class="o">+----------+</span>
<span class="o">|</span> <span class="n">Task</span> <span class="n">A</span>   <span class="o">|</span> <span class="mi">50</span><span class="n">ms</span>            <span class="o">|</span> <span class="n">Task</span> <span class="n">A</span>   <span class="o">|</span> <span class="mi">50</span><span class="n">ms</span>
<span class="o">+----+-----+</span>                 <span class="o">+----+-----+</span>
     <span class="o">|</span>                            <span class="o">|</span>
     <span class="n">v</span>                            <span class="o">|</span>
<span class="o">+----------+</span>                      <span class="o">|</span>
<span class="o">|</span> <span class="n">Task</span> <span class="n">B</span>   <span class="o">|</span> <span class="mi">50</span><span class="n">ms</span>                 <span class="o">+-------------+</span>
<span class="o">+----+-----+</span>                      <span class="o">|</span>             <span class="o">|</span>
     <span class="o">|</span>                            <span class="n">v</span>             <span class="n">v</span>
     <span class="n">v</span>                        <span class="o">+----------+</span> <span class="o">+----------+</span>
<span class="o">+----------+</span>                  <span class="o">|</span> <span class="n">Task</span> <span class="n">B</span>   <span class="o">|</span> <span class="o">|</span> <span class="n">Task</span> <span class="n">C</span>   <span class="o">|</span>
<span class="o">|</span> <span class="n">Task</span> <span class="n">C</span>   <span class="o">|</span> <span class="mi">50</span><span class="n">ms</span>             <span class="o">|</span> <span class="mi">50</span><span class="n">ms</span>     <span class="o">|</span> <span class="o">|</span> <span class="mi">50</span><span class="n">ms</span>     <span class="o">|</span>
<span class="o">+----------+</span>                  <span class="o">+----------+</span> <span class="o">+----------+</span>

<span class="n">Total</span><span class="p">:</span> <span class="mi">150</span><span class="n">ms</span>                 <span class="n">Total</span><span class="p">:</span> <span class="mi">50</span><span class="n">ms</span> <span class="p">(</span><span class="mi">3</span><span class="n">x</span> <span class="n">faster</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Caching Strategy</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Without Cache:               With Cache:
Every request → DB           First request → DB
Query time: 10ms             Query time: 10ms
                             Cache for 5 minutes

                             Subsequent requests → Cache
                             Query time: 2ms

1000 requests = 10s          1000 requests = 2s (5x faster)
</pre></div>
</div>
<p><strong>Connection Pooling</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>No Pooling:                  With Pooling:
Each request:                Each request:
• Connect: 20ms              • Get from pool: 1ms
• Query: 10ms                • Query: 10ms
• Disconnect: 5ms            • Return to pool: 1ms
Total: 35ms                  Total: 12ms (3x faster)
</pre></div>
</div>
</section>
<section id="best-practices-for-developers">
<h2>Best Practices for Developers<a class="headerlink" href="#best-practices-for-developers" title="Link to this heading"></a></h2>
<p><strong>When Integrating with VoIPBIN:</strong></p>
<ol class="arabic simple">
<li><p><strong>Always Include Authentication</strong>
- Include JWT token in Authorization header
- Handle 401 responses (refresh token)</p></li>
<li><p><strong>Handle Asynchronous Operations</strong>
- Many operations are asynchronous
- Use webhooks or WebSocket for notifications
- Poll with reasonable intervals if needed</p></li>
<li><p><strong>Implement Retry Logic</strong>
- Retry on 5xx errors
- Use exponential backoff
- Don’t retry on 4xx errors</p></li>
<li><p><strong>Subscribe to Events</strong>
- Use WebSocket for real-time updates
- Configure webhooks for important events
- Handle duplicate events gracefully</p></li>
<li><p><strong>Optimize Requests</strong>
- Use pagination for lists
- Request only needed fields
- Cache responses when appropriate</p></li>
<li><p><strong>Monitor Performance</strong>
- Track response times
- Alert on high error rates
- Monitor webhook delivery</p></li>
</ol>
</section>
<section id="debugging-request-flows">
<h2>Debugging Request Flows<a class="headerlink" href="#debugging-request-flows" title="Link to this heading"></a></h2>
<p><strong>Using Correlation IDs:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span> <span class="n">Tracing</span><span class="p">:</span>

<span class="mf">1.</span> <span class="n">Client</span> <span class="n">sends</span> <span class="n">request</span> <span class="k">with</span> <span class="n">X</span><span class="o">-</span><span class="n">Request</span><span class="o">-</span><span class="n">ID</span> <span class="n">header</span><span class="p">:</span>
   <span class="n">POST</span> <span class="o">/</span><span class="n">v1</span><span class="mf">.0</span><span class="o">/</span><span class="n">calls</span>
   <span class="n">X</span><span class="o">-</span><span class="n">Request</span><span class="o">-</span><span class="n">ID</span><span class="p">:</span> <span class="n">req</span><span class="o">-</span><span class="n">abc</span><span class="o">-</span><span class="mi">123</span>

<span class="mf">2.</span> <span class="n">API</span> <span class="n">Gateway</span> <span class="n">logs</span><span class="p">:</span>
   <span class="p">[</span><span class="n">req</span><span class="o">-</span><span class="n">abc</span><span class="o">-</span><span class="mi">123</span><span class="p">]</span> <span class="n">Authenticated</span> <span class="n">customer</span><span class="o">-</span><span class="mi">123</span>
   <span class="p">[</span><span class="n">req</span><span class="o">-</span><span class="n">abc</span><span class="o">-</span><span class="mi">123</span><span class="p">]</span> <span class="n">Sending</span> <span class="n">RPC</span> <span class="n">to</span> <span class="n">call</span><span class="o">-</span><span class="n">manager</span>

<span class="mf">3.</span> <span class="n">Call</span> <span class="n">Manager</span> <span class="n">logs</span><span class="p">:</span>
   <span class="p">[</span><span class="n">req</span><span class="o">-</span><span class="n">abc</span><span class="o">-</span><span class="mi">123</span><span class="p">]</span> <span class="n">Creating</span> <span class="n">call</span> <span class="n">record</span>
   <span class="p">[</span><span class="n">req</span><span class="o">-</span><span class="n">abc</span><span class="o">-</span><span class="mi">123</span><span class="p">]</span> <span class="n">Call</span> <span class="n">created</span><span class="p">:</span> <span class="n">call</span><span class="o">-</span><span class="mi">789</span>

<span class="mf">4.</span> <span class="n">Search</span> <span class="n">logs</span> <span class="n">by</span> <span class="n">correlation</span> <span class="n">ID</span> <span class="n">to</span> <span class="n">trace</span> <span class="n">full</span> <span class="n">flow</span>
</pre></div>
</div>
<p><strong>Common Issues:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Issue: 401 Unauthorized
→ Check JWT token validity
→ Ensure token not expired
→ Verify customer_id matches resource

Issue: 404 Not Found
→ May be authorization failure (returns 404 for security)
→ Check customer_id ownership
→ Verify resource exists

Issue: 500 Internal Server Error
→ Backend service error
→ Check logs with correlation ID
→ May require retry

Issue: Slow Response
→ Check cache hit rate
→ Review database query performance
→ Monitor service health
</pre></div>
</div>
</section>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Link to this heading"></a></h2>
<p>VoIPBIN’s request flows are designed for:</p>
<ul class="simple">
<li><p><strong>Performance</strong>: Caching, connection pooling, parallel processing</p></li>
<li><p><strong>Reliability</strong>: Retry logic, circuit breakers, health checks</p></li>
<li><p><strong>Scalability</strong>: Stateless services, horizontal scaling, queue-based communication</p></li>
<li><p><strong>Observability</strong>: Correlation IDs, distributed tracing, comprehensive logging</p></li>
<li><p><strong>Security</strong>: Gateway authentication, authorization checks, encrypted communication</p></li>
</ul>
<p>Understanding these flows helps developers build efficient integrations and troubleshoot issues effectively.</p>
</section>
</section>

</main>
                        
                    </div>
                    
                    <nav class="col-12 col-lg-3 pb-4">
                        <div class="sticky-top toc page-toc" aria-labelledby="page-toc-heading">
                            <p class="font-weight-bold" id="page-toc-heading">Page contents</p>
                            <ul>
<li><a class="reference internal" href="#">System Request Flows</a><ul>
<li><a class="reference internal" href="#request-flow-overview">Request Flow Overview</a></li>
<li><a class="reference internal" href="#flow-1-create-call-simple">Flow 1: Create Call (Simple)</a></li>
<li><a class="reference internal" href="#flow-2-get-call-with-caching">Flow 2: Get Call with Caching</a></li>
<li><a class="reference internal" href="#flow-3-call-with-event-broadcasting">Flow 3: Call with Event Broadcasting</a></li>
<li><a class="reference internal" href="#flow-4-complex-multi-service-flow">Flow 4: Complex Multi-Service Flow</a></li>
<li><a class="reference internal" href="#flow-5-real-time-event-notification">Flow 5: Real-Time Event Notification</a></li>
<li><a class="reference internal" href="#flow-6-error-handling-flow">Flow 6: Error Handling Flow</a></li>
<li><a class="reference internal" href="#performance-optimization">Performance Optimization</a></li>
<li><a class="reference internal" href="#best-practices-for-developers">Best Practices for Developers</a></li>
<li><a class="reference internal" href="#debugging-request-flows">Debugging Request Flows</a></li>
<li><a class="reference internal" href="#summary">Summary</a></li>
</ul>
</li>
</ul>

                        </div>
                    </nav>
                    
                </div>
            </div>
        </div>
    </div>
    <footer class="container-fluid bg-primary text-light">
        <div class="container">
            <div class="row">
        <div class="col p-4">
            
                <nav aria-label="Footer">
                    <ul class="nav justify-content-center mb-2">
                        
                            
                            
                            <li class="nav-item"><a class="nav-link text-light"  href="http://voipbin.net">About Us</a></li>
                        
                            
                            
                            <li class="nav-item"><a class="nav-link text-light"  href="http://voipbin.net">Contact</a></li>
                        
                    </ul>
                </nav>
            
            <div class="text-center">
                    &copy; Copyright 2026, VoIPBIN
            </div>
            <div class="text-center text-white-50 font-italic mt-3">
                <small>
                    Created using
                    <a class="text-white" href="https://github.com/wagtail/sphinx_wagtail_theme" rel="nofollow" target="_blank">
                        Sphinx Wagtail Theme 6.5.0
                    </a>
                    and
                    <a class="text-white" href="https://www.sphinx-doc.org/" rel="nofollow" target="_blank">
                        Sphinx 9.1.0
                    </a>
                </small>
            </div>
        </div>
    </div>
        </div>
    </footer>
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=5929fcd5"></script>
        <script src="_static/doctools.js?v=fd6eb6e6"></script>
        <script src="_static/sphinx_highlight.js?v=6ffebe34"></script>
        <script src="_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="_static/copybutton.js?v=f281be69"></script>
        <script type="text/javascript" src="_static/dist/theme.js"></script>
        <script type="text/javascript" src="_static/dist/vendor.js"></script>
        <script type="text/javascript" src="_static/searchtools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script type="text/javascript">
            document.addEventListener('DOMContentLoaded', function() { Search.loadIndex("searchindex.js"); });
        </script>
        <script type="text/javascript" id="searchindexloader"></script>
    </body>
</html>