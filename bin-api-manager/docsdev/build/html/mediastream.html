<!DOCTYPE html>
<html class="no-js" lang="en" data-content_root="./">
<head>
    <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
        <title>Mediastream &mdash; voipbin  documentation</title>
    
    <link rel="stylesheet" type="text/css" href="_static/dist/fontawesome.css" />
      <link rel="stylesheet" type="text/css" href="_static/dist/theme.css?v=310cf088" />
      <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
            <link rel="index" title="Index" href="genindex.html" />
            <link rel="search" title="Search" href="search.html" />
            <link rel="top" title="voipbin  documentation" href="#" />
            <link rel="next" title="Message" href="message.html" />
            <link rel="prev" title="Transcribe" href="transcribe.html" />
    </head>
<body>
    <script type="text/javascript" src="_static/dist/blocking.js"></script>
    <header class="container-fluid bg-primary">
        <a class="btn btn-sm btn-light skip-to-content-link" href="#main">Skip to content</a>
        <div class="container-fluid">
            <div class="navbar navbar-expand-lg navbar-dark font-weight-bold">
                    <a href="intro.html"
                        title="voipbin"
                        class="logo navbar-brand"
                    >
                        <img src="_static/images/voipbin-high-resolution-logo-white-transparent.png" width="45" height="80" alt="voipbin"
                            class="logo-img"
                        />
                        VoIPBin Documentation
                    </a>
                
                
                    <div class="collapse navbar-collapse justify-content-end">
                        <ul class="navbar-nav">
                            
                                
                                
                                <li class="nav-item"><a class="nav-link"  href="http://voipbin.net">Project</a></li>
                            
                                
                                
                                <li class="nav-item"><a class="nav-link"  href="https://admin.voipbin.net">Admin</a></li>
                            
                        </ul>
                    </div>
                
                <button class="navbar-toggler btn btn-primary d-lg-none" type="button" data-toggle="collapse" data-target="#collapseSidebar" aria-expanded="false" aria-controls="collapseExample">
                    <span class="navbar-toggler-icon"></span>
                    <span class="sr-only">menu</span>
                </button>
            </div>
        </div>
    </header>
    <div class="container-fluid">
        <div class="row">
            <aside class="col-12 col-lg-3 sidebar-container">
                <div id="collapseSidebar" class="collapse sticky-top d-lg-block pt-5 pr-lg-4">
<div id="searchbox" class="searchbox mb-6 px-1" role="search">
    <form id="search-form" action="search.html" autocomplete="off" method="get" role="search">
        <div class="input-group">
            <div class="input-group-prepend">
                <div class="input-group-text border-right-0 bg-white py-3 pl-3 pr-2"><span class="fas fa-search"></span></div>
            </div>
            <input class="form-control py-3 pr-3 pl-1 h-100 border-left-0" type="search" name="q" placeholder="Search documentation" aria-label="Search documentation" id="searchinput" />
        </div>
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
    </form>
</div><div class="site-toc">
    <nav class="toc mt-3" aria-label="Main menu">
        <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="accesskey.html">Accesskey</a></li>
<li class="toctree-l1"><a class="reference internal" href="sdk.html">SDK(Software Development Kit)</a></li>
<li class="toctree-l1"><a class="reference internal" href="restful_api.html">RESTful API(Application Programming Interface)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Core Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="flow.html">Flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="flow.html#activeflow">Activeflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="variable.html">Variable</a></li>
<li class="toctree-l1"><a class="reference internal" href="webhook.html">Webhook</a></li>
<li class="toctree-l1"><a class="reference internal" href="common.html">Common</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Voice &amp; Real-Time</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="call.html">Call</a></li>
<li class="toctree-l1"><a class="reference internal" href="conference.html">Conference</a></li>
<li class="toctree-l1"><a class="reference internal" href="queue.html">Queue</a></li>
<li class="toctree-l1"><a class="reference internal" href="recording.html">Recording</a></li>
<li class="toctree-l1"><a class="reference internal" href="transcribe.html">Transcribe</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Mediastream</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Messaging</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="message.html">Message</a></li>
<li class="toctree-l1"><a class="reference internal" href="email.html">Email</a></li>
<li class="toctree-l1"><a class="reference internal" href="talk.html">Talk</a></li>
<li class="toctree-l1"><a class="reference internal" href="conversation.html">Conversation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">AI &amp; Automation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="ai.html">AI</a></li>
<li class="toctree-l1"><a class="reference internal" href="campaign.html">Campaign</a></li>
<li class="toctree-l1"><a class="reference internal" href="outdial.html">Outdial</a></li>
<li class="toctree-l1"><a class="reference internal" href="outplan.html">Outplan</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Resources &amp; Management</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="number.html">Number</a></li>
<li class="toctree-l1"><a class="reference internal" href="agent.html">Agent</a></li>
<li class="toctree-l1"><a class="reference internal" href="customer.html">Customer</a></li>
<li class="toctree-l1"><a class="reference internal" href="billing_account.html">Billing Account</a></li>
<li class="toctree-l1"><a class="reference internal" href="storage.html">Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="tag.html">Tag</a></li>
<li class="toctree-l1"><a class="reference internal" href="provider.html">Provider</a></li>
<li class="toctree-l1"><a class="reference internal" href="route.html">Route</a></li>
<li class="toctree-l1"><a class="reference internal" href="extension.html">Extension</a></li>
<li class="toctree-l1"><a class="reference internal" href="trunk.html">Trunk</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Architecture (Deep Dive)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="websocket.html">Websocket</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Help &amp; Support</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="support.html">Support</a></li>
</ul>

    </nav>
    <template data-toggle-item-template>
        <button class="btn btn-sm btn-link toctree-expand" type="button">
            <span class="sr-only">Toggle menu contents</span>
        </button>
    </template>
</div>
                    <div class="d-lg-none border-bottom">
                        
                    </div>
                </div>
            </aside>
            <div class="col-12 col-lg-9 pt-5">
                <header class="row align-items-baseline">
                    <div class="col">
                        <nav aria-label="breadcrumb">
    <ol class="breadcrumb m-0 p-0 bg-transparent">
        <li class="breadcrumb-item"><a href="index.html">Docs</a></li>
        <li class="breadcrumb-item active" aria-current="page">Mediastream</li>
    </ol>
</nav>
                    </div>
                    <div class="col-sm-12 col-lg-auto mt-3 mt-lg-3">
                        <noscript>
                            <p>JavaScript is required to toggle light/dark mode..</p>
                        </noscript>
                        <button id="wagtail-theme" class="btn btn-sm btn-light text-decoration-none" type="button">
                            <span class="dark-only"><i class="fas fa-sun"></i> Light mode</span>
                            <span class="light-only"><i class="fas fa-moon"></i> Dark mode</span>
                        </button>
    <a class="btn btn-sm btn-light text-decoration-none" href="_sources/mediastream.rst.txt" rel="nofollow">
        <span class="btn-icon"><span class="fas fa-code"></span></span>
        <span class="btn-text">View source</span>
    </a>
                        
                    </div>
                </header>
                <div class="row" >
                    <div class="col-12">
                        <hr class="w-100 my-4">
                    </div>
                </div>
                <div class="row">
                    <div class="col-12 col-lg-9 order-last order-lg-first rst-content">
                        <main role="main" id="main">
    <section id="mediastream">
<h1>Mediastream<a class="headerlink" href="#mediastream" title="Link to this heading"></a></h1>
<section id="overview">
<span id="mediastream-overview"></span><h2>Overview<a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<p>VoIPBIN’s Media Stream API provides direct access to call and conference audio via WebSocket connections. Instead of relying on SIP signaling for media control, you can stream audio bidirectionally with your applications for real-time processing, AI integration, custom IVR, and more.</p>
<p>With the Media Stream API you can:</p>
<ul class="simple">
<li><p>Stream live call audio to your application in real-time</p></li>
<li><p>Inject audio into calls and conferences</p></li>
<li><p>Build AI voice assistants with direct audio access</p></li>
<li><p>Create custom speech recognition pipelines</p></li>
<li><p>Implement real-time audio analysis and monitoring</p></li>
</ul>
<section id="how-media-streaming-works">
<h3>How Media Streaming Works<a class="headerlink" href="#how-media-streaming-works" title="Link to this heading"></a></h3>
<p>When you connect to a media stream, VoIPBIN establishes a WebSocket connection that carries audio data directly between the call/conference and your application.</p>
<p><strong>Media Stream Architecture</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Traditional</span> <span class="n">VoIP</span><span class="p">:</span>                   <span class="n">VoIPBIN</span> <span class="n">Media</span> <span class="n">Stream</span><span class="p">:</span>
<span class="o">+-------+</span>   <span class="n">SIP</span>   <span class="o">+-------+</span>         <span class="o">+-------+</span>   <span class="n">WebSocket</span>  <span class="o">+----------+</span>
<span class="o">|</span> <span class="n">Phone</span> <span class="o">|&lt;-------&gt;|</span><span class="n">VoIPBIN</span><span class="o">|</span>         <span class="o">|</span> <span class="n">Call</span>  <span class="o">|&lt;============&gt;|</span> <span class="n">Your</span> <span class="n">App</span> <span class="o">|</span>
<span class="o">+-------+</span>         <span class="o">+-------+</span>         <span class="o">+-------+</span>              <span class="o">+----------+</span>
     <span class="p">(</span><span class="n">signaling</span> <span class="n">only</span><span class="p">)</span>                    <span class="p">(</span><span class="n">direct</span> <span class="n">audio</span> <span class="n">access</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Key Differences from Traditional VoIP</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Aspect</p></th>
<th class="head"><p>Traditional SIP</p></th>
<th class="head"><p>Media Streaming</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Audio Access</p></td>
<td><p>Via RTP to SIP endpoints</p></td>
<td><p>Direct WebSocket to your app</p></td>
</tr>
<tr class="row-odd"><td><p>Control</p></td>
<td><p>SIP signaling</p></td>
<td><p>API and WebSocket</p></td>
</tr>
<tr class="row-even"><td><p>Integration</p></td>
<td><p>Requires SIP stack</p></td>
<td><p>Simple WebSocket client</p></td>
</tr>
<tr class="row-odd"><td><p>Use Cases</p></td>
<td><p>Phone-to-phone calls</p></td>
<td><p>AI, custom IVR, analysis</p></td>
</tr>
</tbody>
</table>
<p><strong>System Components</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+--------+</span>                                              <span class="o">+-----------+</span>
<span class="o">|</span>  <span class="n">Call</span>  <span class="o">|&lt;-------</span> <span class="n">RTP</span> <span class="o">-------&gt;+</span>                        <span class="o">|</span>           <span class="o">|</span>
<span class="o">+--------+</span>                     <span class="o">|</span>                        <span class="o">|</span>  <span class="n">Your</span>     <span class="o">|</span>
                          <span class="o">+----+-----+</span>                  <span class="o">|</span>  <span class="n">App</span>      <span class="o">|</span>
                          <span class="o">|</span> <span class="n">VoIPBIN</span>  <span class="o">|&lt;==</span> <span class="n">WebSocket</span> <span class="o">===&gt;|</span>           <span class="o">|</span>
                          <span class="o">|</span> <span class="n">Media</span>    <span class="o">|</span>                  <span class="o">|</span> <span class="o">-</span> <span class="n">AI</span><span class="o">/</span><span class="n">ML</span>   <span class="o">|</span>
                          <span class="o">|</span> <span class="n">Bridge</span>   <span class="o">|</span>                  <span class="o">|</span> <span class="o">-</span> <span class="n">STT</span><span class="o">/</span><span class="n">TTS</span> <span class="o">|</span>
<span class="o">+------------+</span>            <span class="o">+----+-----+</span>                  <span class="o">|</span> <span class="o">-</span> <span class="n">IVR</span>     <span class="o">|</span>
<span class="o">|</span> <span class="n">Conference</span> <span class="o">|&lt;--</span> <span class="n">RTP</span> <span class="o">---&gt;+</span>                             <span class="o">|</span>           <span class="o">|</span>
<span class="o">+------------+</span>                                          <span class="o">+-----------+</span>
</pre></div>
</div>
<p>The Media Bridge handles protocol conversion between RTP (VoIP standard) and WebSocket (web standard), enabling any WebSocket-capable application to process call audio.</p>
</section>
<section id="streaming-modes">
<h3>Streaming Modes<a class="headerlink" href="#streaming-modes" title="Link to this heading"></a></h3>
<p>VoIPBIN supports two streaming modes based on your application’s needs.</p>
<p><strong>Bi-Directional Streaming</strong></p>
<p>Your application both receives and sends audio through the same WebSocket connection.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+----------+</span>                              <span class="o">+----------+</span>
<span class="o">|</span>          <span class="o">|=======</span> <span class="n">audio</span> <span class="n">IN</span> <span class="o">============&gt;|</span>          <span class="o">|</span>
<span class="o">|</span> <span class="n">VoIPBIN</span>  <span class="o">|</span>                              <span class="o">|</span> <span class="n">Your</span> <span class="n">App</span> <span class="o">|</span>
<span class="o">|</span>          <span class="o">|&lt;======</span> <span class="n">audio</span> <span class="n">OUT</span> <span class="o">============|</span>          <span class="o">|</span>
<span class="o">+----------+</span>                              <span class="o">+----------+</span>
</pre></div>
</div>
<p><strong>Initiate via API:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>GET https://api.voipbin.net/v1.0/calls/&lt;call-id&gt;/media_stream?encapsulation=rtp&amp;token=&lt;token&gt;
</pre></div>
</div>
<p><strong>Use cases:</strong>
- AI voice assistants (listen and respond)
- Interactive IVR systems
- Real-time audio processing with feedback
- Call bridging to custom systems</p>
<p><strong>Uni-Directional Streaming</strong></p>
<p>VoIPBIN receives audio from your server and plays it to the call. Your app sends audio but doesn’t receive call audio.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+----------+</span>                              <span class="o">+----------+</span>
<span class="o">|</span>          <span class="o">|</span>                              <span class="o">|</span>          <span class="o">|</span>
<span class="o">|</span> <span class="n">VoIPBIN</span>  <span class="o">|&lt;======</span> <span class="n">audio</span> <span class="n">only</span> <span class="o">===========|</span> <span class="n">Your</span> <span class="n">App</span> <span class="o">|</span>
<span class="o">|</span>          <span class="o">|</span>                              <span class="o">|</span>          <span class="o">|</span>
<span class="o">+----------+</span>                              <span class="o">+----------+</span>
</pre></div>
</div>
<p><strong>Initiate via Flow Action:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;external_media_start&quot;</span><span class="p">,</span>
    <span class="s2">&quot;option&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;wss://your-server.com/audio&quot;</span><span class="p">,</span>
        <span class="s2">&quot;encapsulation&quot;</span><span class="p">:</span> <span class="s2">&quot;audiosocket&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>See detail <a class="reference internal" href="flow_struct_action.html#flow-struct-action-external-media-start"><span class="std std-ref">here</span></a>.</p>
<p><strong>Use cases:</strong>
- Custom music on hold
- Pre-recorded message playback
- Text-to-speech from external service
- Audio announcements</p>
<p><strong>Mode Comparison</strong></p>
</section>
<section id="encapsulation-types">
<h3>Encapsulation Types<a class="headerlink" href="#encapsulation-types" title="Link to this heading"></a></h3>
<p>VoIPBIN supports three encapsulation types for different integration scenarios.</p>
<p><strong>Decision Guide</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>                  What&#39;s your use case?
                         |
        +----------------+----------------+
        |                                 |
  Standard VoIP                      Simple audio
  integration?                       processing?
        |                                 |
  +-----+-----+                     +-----+-----+
  |           |                     |           |
 Yes         No                    Yes         No
  |           |                     |           |
  v           |                     v           |
[RTP]         |                   [SLN]         |
              |                                 |
         Asterisk                               |
         integration?                           |
              |                                 |
        +-----+-----+                           |
        |           |                           |
       Yes         No                           |
        |           |                           |
        v           +---------------------------+
  [AudioSocket]                 |
                                v
                          [RTP default]
</pre></div>
</div>
<p><strong>RTP (Real-time Transport Protocol)</strong></p>
<p>The standard protocol for audio/video over IP networks.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+------------------+------------------+</span>
<span class="o">|</span>   <span class="n">RTP</span> <span class="n">Header</span>     <span class="o">|</span>   <span class="n">Audio</span> <span class="n">Payload</span>  <span class="o">|</span>
<span class="o">|</span>   <span class="p">(</span><span class="mi">12</span> <span class="nb">bytes</span><span class="p">)</span>     <span class="o">|</span>   <span class="p">(</span><span class="mi">160</span> <span class="nb">bytes</span><span class="p">)</span>    <span class="o">|</span>
<span class="o">+------------------+------------------+</span>
</pre></div>
</div>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Specification</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Protocol</p></td>
<td><p>RTP over WebSocket</p></td>
</tr>
<tr class="row-odd"><td><p>Codec</p></td>
<td><p>G.711 μ-law (ulaw)</p></td>
</tr>
<tr class="row-even"><td><p>Sample Rate</p></td>
<td><p>8 kHz</p></td>
</tr>
<tr class="row-odd"><td><p>Bit Depth</p></td>
<td><p>16-bit</p></td>
</tr>
<tr class="row-even"><td><p>Channels</p></td>
<td><p>Mono</p></td>
</tr>
<tr class="row-odd"><td><p>Packet Size</p></td>
<td><p>172 bytes (12 header + 160 payload = 20ms)</p></td>
</tr>
</tbody>
</table>
<p><strong>Best for:</strong> Standard VoIP tools, industry compatibility, existing RTP processing pipelines.</p>
<p><strong>SLN (Signed Linear)</strong></p>
<p>Raw audio without protocol overhead.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+----------------------------------+</span>
<span class="o">|</span>   <span class="n">Raw</span> <span class="n">PCM</span> <span class="n">Audio</span> <span class="n">Data</span>             <span class="o">|</span>
<span class="o">|</span>   <span class="p">(</span><span class="n">no</span> <span class="n">headers</span><span class="p">,</span> <span class="n">no</span> <span class="n">padding</span><span class="p">)</span>       <span class="o">|</span>
<span class="o">+----------------------------------+</span>
</pre></div>
</div>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Specification</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Format</p></td>
<td><p>Raw PCM, signed linear</p></td>
</tr>
<tr class="row-odd"><td><p>Sample Rate</p></td>
<td><p>8 kHz</p></td>
</tr>
<tr class="row-even"><td><p>Bit Depth</p></td>
<td><p>16-bit signed</p></td>
</tr>
<tr class="row-odd"><td><p>Channels</p></td>
<td><p>Mono</p></td>
</tr>
<tr class="row-even"><td><p>Byte Order</p></td>
<td><p>Native</p></td>
</tr>
</tbody>
</table>
<p><strong>Best for:</strong> Minimal overhead, simple audio processing, direct PCM access without parsing.</p>
<p><strong>AudioSocket</strong></p>
<p>Asterisk-specific protocol designed for simple audio streaming.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+------------------+------------------+</span>
<span class="o">|</span> <span class="n">AudioSocket</span> <span class="n">Hdr</span>  <span class="o">|</span>   <span class="n">PCM</span> <span class="n">Audio</span>      <span class="o">|</span>
<span class="o">+------------------+------------------+</span>
</pre></div>
</div>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Specification</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Protocol</p></td>
<td><p>Asterisk AudioSocket</p></td>
</tr>
<tr class="row-odd"><td><p>Format</p></td>
<td><p>PCM little-endian</p></td>
</tr>
<tr class="row-even"><td><p>Sample Rate</p></td>
<td><p>8 kHz</p></td>
</tr>
<tr class="row-odd"><td><p>Bit Depth</p></td>
<td><p>16-bit</p></td>
</tr>
<tr class="row-even"><td><p>Channels</p></td>
<td><p>Mono</p></td>
</tr>
<tr class="row-odd"><td><p>Chunk Size</p></td>
<td><p>320 bytes (20ms of audio)</p></td>
</tr>
</tbody>
</table>
<p><strong>Best for:</strong> Asterisk integration, simple streaming with minimal overhead.</p>
<p>See <a class="reference external" href="https://docs.asterisk.org/Configuration/Channel-Drivers/AudioSocket/">Asterisk AudioSocket Documentation</a> for protocol details.</p>
<p><strong>Encapsulation Comparison</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Aspect</p></th>
<th class="head"><p>RTP</p></th>
<th class="head"><p>SLN</p></th>
<th class="head"><p>AudioSocket</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Headers</p></td>
<td><p>12 bytes</p></td>
<td><p>None</p></td>
<td><p>Protocol header</p></td>
</tr>
<tr class="row-odd"><td><p>Compatibility</p></td>
<td><p>Industry standard</p></td>
<td><p>Simple</p></td>
<td><p>Asterisk</p></td>
</tr>
<tr class="row-even"><td><p>Overhead</p></td>
<td><p>Low</p></td>
<td><p>Minimal</p></td>
<td><p>Low</p></td>
</tr>
<tr class="row-odd"><td><p>Parsing Required</p></td>
<td><p>Yes (RTP)</p></td>
<td><p>No</p></td>
<td><p>Yes (AudioSocket)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="supported-resources">
<h3>Supported Resources<a class="headerlink" href="#supported-resources" title="Link to this heading"></a></h3>
<p>Media streaming is available for both calls and conferences.</p>
<p><strong>Call Media Streaming</strong></p>
<p>Stream audio from a single call.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>GET https://api.voipbin.net/v1.0/calls/&lt;call-id&gt;/media_stream?encapsulation=&lt;type&gt;&amp;token=&lt;token&gt;
</pre></div>
</div>
<p><strong>Audio contains:</strong> Both parties’ audio mixed together.</p>
<p><strong>Conference Media Streaming</strong></p>
<p>Stream audio from a conference with multiple participants.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>GET https://api.voipbin.net/v1.0/conferences/&lt;conference-id&gt;/media_stream?encapsulation=&lt;type&gt;&amp;token=&lt;token&gt;
</pre></div>
</div>
<p><strong>Audio contains:</strong> All participants’ audio mixed together.</p>
<p><strong>Resource Comparison</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Aspect</p></th>
<th class="head"><p>Call</p></th>
<th class="head"><p>Conference</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Audio Source</p></td>
<td><p>Two-party conversation</p></td>
<td><p>Multi-party conversation</p></td>
</tr>
<tr class="row-odd"><td><p>Audio Mix</p></td>
<td><p>Caller + callee</p></td>
<td><p>All participants</p></td>
</tr>
<tr class="row-even"><td><p>Audio Injection</p></td>
<td><p>Heard by both parties</p></td>
<td><p>Heard by all participants</p></td>
</tr>
<tr class="row-odd"><td><p>Use Case</p></td>
<td><p>1:1 AI assistant</p></td>
<td><p>Conference monitoring/recording</p></td>
</tr>
</tbody>
</table>
</section>
<section id="connection-lifecycle">
<h3>Connection Lifecycle<a class="headerlink" href="#connection-lifecycle" title="Link to this heading"></a></h3>
<p>Understanding the WebSocket connection lifecycle helps build robust streaming applications.</p>
<p><strong>Connection Flow</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Your</span> <span class="n">App</span>                         <span class="n">VoIPBIN</span>
    <span class="o">|</span>                               <span class="o">|</span>
    <span class="o">|</span> <span class="n">GET</span> <span class="o">/</span><span class="n">calls</span><span class="o">/</span><span class="p">{</span><span class="nb">id</span><span class="p">}</span><span class="o">/</span><span class="n">media_stream</span>  <span class="o">|</span>
    <span class="o">+------------------------------&gt;|</span>
    <span class="o">|</span>                               <span class="o">|</span>
    <span class="o">|</span> <span class="mi">101</span> <span class="n">Switching</span> <span class="n">Protocols</span>       <span class="o">|</span>
    <span class="o">|&lt;------------------------------+</span>
    <span class="o">|</span>                               <span class="o">|</span>
    <span class="o">|&lt;=======</span> <span class="n">audio</span> <span class="n">frames</span> <span class="o">========&gt;|</span>  <span class="p">(</span><span class="n">bi</span><span class="o">-</span><span class="n">directional</span><span class="p">)</span>
    <span class="o">|&lt;=======</span> <span class="n">audio</span> <span class="n">frames</span> <span class="o">========&gt;|</span>
    <span class="o">|&lt;=======</span> <span class="n">audio</span> <span class="n">frames</span> <span class="o">========&gt;|</span>
    <span class="o">|</span>                               <span class="o">|</span>
    <span class="o">|</span> <span class="n">close</span><span class="p">()</span> <span class="ow">or</span> <span class="n">call</span> <span class="n">ends</span>          <span class="o">|</span>
    <span class="o">+------------------------------&gt;|</span>
    <span class="o">|</span>                               <span class="o">|</span>
</pre></div>
</div>
<p><strong>Connection States</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">connecting</span> <span class="o">---&gt;</span> <span class="nb">open</span> <span class="o">---&gt;</span> <span class="n">streaming</span> <span class="o">---&gt;</span> <span class="n">closing</span> <span class="o">---&gt;</span> <span class="n">closed</span>
                               <span class="o">|</span>
                               <span class="n">v</span>
                          <span class="p">(</span><span class="n">call</span> <span class="n">ends</span><span class="p">)</span>
                               <span class="o">|</span>
                               <span class="n">v</span>
                            <span class="n">closed</span>
</pre></div>
</div>
<p><strong>State Descriptions</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>State</p></th>
<th class="head"><p>What’s happening</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>connecting</p></td>
<td><p>WebSocket handshake in progress</p></td>
</tr>
<tr class="row-odd"><td><p>open</p></td>
<td><p>Connection established, ready for audio</p></td>
</tr>
<tr class="row-even"><td><p>streaming</p></td>
<td><p>Audio frames being sent/received</p></td>
</tr>
<tr class="row-odd"><td><p>closing</p></td>
<td><p>Graceful shutdown initiated</p></td>
</tr>
<tr class="row-even"><td><p>closed</p></td>
<td><p>Connection terminated</p></td>
</tr>
</tbody>
</table>
<p><strong>Connection Termination</strong></p>
<p>The WebSocket connection closes when:</p>
<ul class="simple">
<li><p>Your application closes the connection</p></li>
<li><p>The call or conference ends</p></li>
<li><p>Network failure occurs</p></li>
<li><p>Authentication token expires</p></li>
</ul>
</section>
<section id="integration-patterns">
<h3>Integration Patterns<a class="headerlink" href="#integration-patterns" title="Link to this heading"></a></h3>
<p>Common patterns for integrating media streaming with your applications.</p>
<p><strong>Pattern 1: AI Voice Assistant</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Call</span> <span class="n">Audio</span>         <span class="n">Your</span> <span class="n">App</span>           <span class="n">AI</span> <span class="n">Service</span>
    <span class="o">|</span>                  <span class="o">|</span>                   <span class="o">|</span>
    <span class="o">|====</span><span class="n">audio</span><span class="o">====&gt;</span>    <span class="o">|</span>                   <span class="o">|</span>
    <span class="o">|</span>                  <span class="o">|</span> <span class="n">STT</span>               <span class="o">|</span>
    <span class="o">|</span>                  <span class="o">+------------------&gt;|</span>
    <span class="o">|</span>                  <span class="o">|</span>                   <span class="o">|</span>
    <span class="o">|</span>                  <span class="o">|</span> <span class="n">AI</span> <span class="n">response</span>       <span class="o">|</span>
    <span class="o">|</span>                  <span class="o">|&lt;------------------+</span>
    <span class="o">|</span>                  <span class="o">|</span>                   <span class="o">|</span>
    <span class="o">|</span>                  <span class="o">|</span> <span class="n">TTS</span>               <span class="o">|</span>
    <span class="o">|</span>    <span class="o">&lt;====</span><span class="n">audio</span><span class="o">====+</span>                   <span class="o">|</span>
    <span class="o">|</span>                  <span class="o">|</span>                   <span class="o">|</span>
</pre></div>
</div>
<p><strong>Pattern 2: Real-Time Monitoring</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Call</span> <span class="n">Audio</span>         <span class="n">Your</span> <span class="n">App</span>           <span class="n">Dashboard</span>
    <span class="o">|</span>                  <span class="o">|</span>                   <span class="o">|</span>
    <span class="o">|====</span><span class="n">audio</span><span class="o">====&gt;</span>    <span class="o">|</span>                   <span class="o">|</span>
    <span class="o">|</span>                  <span class="o">|</span> <span class="n">analyze</span>           <span class="o">|</span>
    <span class="o">|</span>                  <span class="o">+------------------&gt;|</span>
    <span class="o">|</span>                  <span class="o">|</span>    <span class="n">sentiment</span><span class="p">,</span>     <span class="o">|</span>
    <span class="o">|</span>                  <span class="o">|</span>    <span class="n">keywords</span><span class="p">,</span>      <span class="o">|</span>
    <span class="o">|</span>                  <span class="o">|</span>    <span class="n">quality</span>        <span class="o">|</span>
    <span class="o">|</span>                  <span class="o">|</span>                   <span class="o">|</span>
</pre></div>
</div>
<p><strong>Pattern 3: Custom IVR</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Call</span> <span class="n">Audio</span>         <span class="n">Your</span> <span class="n">App</span>           <span class="n">Logic</span> <span class="n">Engine</span>
    <span class="o">|</span>                  <span class="o">|</span>                   <span class="o">|</span>
    <span class="o">|====</span><span class="n">audio</span><span class="o">====&gt;</span>    <span class="o">|</span>                   <span class="o">|</span>
    <span class="o">|</span>                  <span class="o">|</span> <span class="n">detect</span> <span class="n">DTMF</span><span class="o">/</span><span class="n">speech</span><span class="o">|</span>
    <span class="o">|</span>                  <span class="o">+------------------&gt;|</span>
    <span class="o">|</span>                  <span class="o">|</span>                   <span class="o">|</span>
    <span class="o">|</span>                  <span class="o">|</span> <span class="nb">next</span> <span class="n">action</span>       <span class="o">|</span>
    <span class="o">|</span>                  <span class="o">|&lt;------------------+</span>
    <span class="o">|</span>                  <span class="o">|</span>                   <span class="o">|</span>
    <span class="o">|</span>    <span class="o">&lt;====</span><span class="n">prompt</span><span class="o">===+</span>                   <span class="o">|</span>
    <span class="o">|</span>                  <span class="o">|</span>                   <span class="o">|</span>
</pre></div>
</div>
<p><strong>Pattern 4: Recording with Processing</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Call</span> <span class="n">Audio</span>         <span class="n">Your</span> <span class="n">App</span>           <span class="n">Storage</span>
    <span class="o">|</span>                  <span class="o">|</span>                   <span class="o">|</span>
    <span class="o">|====</span><span class="n">audio</span><span class="o">====&gt;</span>    <span class="o">|</span>                   <span class="o">|</span>
    <span class="o">|</span>                  <span class="o">|</span> <span class="n">process</span>           <span class="o">|</span>
    <span class="o">|</span>                  <span class="o">|</span> <span class="p">(</span><span class="nb">filter</span><span class="p">,</span> <span class="n">enhance</span><span class="p">)</span> <span class="o">|</span>
    <span class="o">|</span>                  <span class="o">|</span>                   <span class="o">|</span>
    <span class="o">|</span>                  <span class="o">|</span> <span class="n">store</span>             <span class="o">|</span>
    <span class="o">|</span>                  <span class="o">+------------------&gt;|</span>
    <span class="o">|</span>                  <span class="o">|</span>                   <span class="o">|</span>
</pre></div>
</div>
<p>For working code examples of these patterns, see the <a class="reference internal" href="mediastream_tutorial.html#mediastream-tutorial"><span class="std std-ref">Media Stream Tutorial</span></a>.</p>
</section>
<section id="best-practices">
<h3>Best Practices<a class="headerlink" href="#best-practices" title="Link to this heading"></a></h3>
<p><strong>1. Audio Timing</strong></p>
<ul class="simple">
<li><p>Send audio in consistent 20ms chunks</p></li>
<li><p>Maintain proper timing to avoid audio gaps or overlaps</p></li>
<li><p>Buffer incoming audio to handle network jitter</p></li>
</ul>
<p><strong>2. Connection Management</strong></p>
<ul class="simple">
<li><p>Implement automatic reconnection for dropped connections</p></li>
<li><p>Handle the <code class="docutils literal notranslate"><span class="pre">onclose</span></code> event gracefully</p></li>
<li><p>Close connections when no longer needed</p></li>
</ul>
<p><strong>3. Resource Efficiency</strong></p>
<ul class="simple">
<li><p>Process audio asynchronously to avoid blocking</p></li>
<li><p>Use appropriate buffer sizes (typically 320 bytes for 20ms)</p></li>
<li><p>Monitor memory usage for long-running streams</p></li>
</ul>
<p><strong>4. Error Handling</strong></p>
<ul class="simple">
<li><p>Log connection errors for debugging</p></li>
<li><p>Implement exponential backoff for reconnection attempts</p></li>
<li><p>Handle authentication failures gracefully</p></li>
</ul>
</section>
<section id="troubleshooting">
<h3>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Link to this heading"></a></h3>
<p><strong>Connection Issues</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Symptom</p></th>
<th class="head"><p>Solution</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Connection refused</p></td>
<td><p>Verify call/conference is active and
in “progressing” status</p></td>
</tr>
<tr class="row-odd"><td><p>401 Unauthorized</p></td>
<td><p>Check API token is valid and has permissions</p></td>
</tr>
<tr class="row-even"><td><p>Connection drops</p></td>
<td><p>Implement reconnection logic; check network
stability</p></td>
</tr>
</tbody>
</table>
<p><strong>Audio Issues</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Symptom</p></th>
<th class="head"><p>Solution</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>No audio received</p></td>
<td><p>Verify call is answered and audio is flowing;
check encapsulation type</p></td>
</tr>
<tr class="row-odd"><td><p>Audio quality poor</p></td>
<td><p>Check network latency; verify correct audio
format; monitor packet loss</p></td>
</tr>
<tr class="row-even"><td><p>Audio choppy</p></td>
<td><p>Implement jitter buffer; send in consistent
20ms chunks; check CPU usage</p></td>
</tr>
<tr class="row-odd"><td><p>Can’t send audio</p></td>
<td><p>Use binary WebSocket frames; verify audio
format matches encapsulation type</p></td>
</tr>
</tbody>
</table>
</section>
<section id="related-documentation">
<h3>Related Documentation<a class="headerlink" href="#related-documentation" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference internal" href="mediastream_tutorial.html#mediastream-tutorial"><span class="std std-ref">Media Stream Tutorial</span></a> - Code examples and use cases</p></li>
<li><p><a class="reference internal" href="call_overview.html#call-overview"><span class="std std-ref">Call Overview</span></a> - Call lifecycle and states</p></li>
<li><p><a class="reference internal" href="conference_overview.html#conference-overview"><span class="std std-ref">Conference Overview</span></a> - Conference management</p></li>
<li><p><a class="reference internal" href="flow_struct_action.html#flow-struct-action-external-media-start"><span class="std std-ref">Flow Actions</span></a> - External media flow action</p></li>
</ul>
</section>
</section>
<section id="tutorial">
<span id="mediastream-tutorial"></span><h2>Tutorial<a class="headerlink" href="#tutorial" title="Link to this heading"></a></h2>
<section id="bi-directional-media-streaming-for-calls">
<h3>Bi-Directional Media Streaming for Calls<a class="headerlink" href="#bi-directional-media-streaming-for-calls" title="Link to this heading"></a></h3>
<p>Connect to a call’s media stream via WebSocket to send and receive audio in real-time. This allows you to build custom audio processing applications without SIP signaling.</p>
<p><strong>Establish WebSocket Connection:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>GET https://api.voipbin.net/v1.0/calls/&lt;call-id&gt;/media_stream?encapsulation=rtp&amp;token=&lt;YOUR_AUTH_TOKEN&gt;
</pre></div>
</div>
<p><strong>Example:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>GET https://api.voipbin.net/v1.0/calls/652af662-eb45-11ee-b1a5-6fde165f9226/media_stream?encapsulation=rtp&amp;token=&lt;YOUR_AUTH_TOKEN&gt;
</pre></div>
</div>
<p>This creates a bi-directional WebSocket connection where you can:
- <strong>Receive audio</strong> from the call (what the other party is saying)
- <strong>Send audio</strong> to the call (inject audio into the conversation)</p>
</section>
<section id="bi-directional-media-streaming-for-conferences">
<h3>Bi-Directional Media Streaming for Conferences<a class="headerlink" href="#bi-directional-media-streaming-for-conferences" title="Link to this heading"></a></h3>
<p>Access a conference’s media stream to monitor or participate in the conference audio.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>GET https://api.voipbin.net/v1.0/conferences/&lt;conference-id&gt;/media_stream?encapsulation=rtp&amp;token=&lt;YOUR_AUTH_TOKEN&gt;
</pre></div>
</div>
<p><strong>Example:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>GET https://api.voipbin.net/v1.0/conferences/1ed12456-eb4b-11ee-bba8-1bfb2838807a/media_stream?encapsulation=rtp&amp;token=&lt;YOUR_AUTH_TOKEN&gt;
</pre></div>
</div>
<p>This allows you to:
- Listen to all conference participants
- Inject audio into the conference
- Build custom conference recording or analysis tools</p>
</section>
<section id="id1">
<h3>Encapsulation Types<a class="headerlink" href="#id1" title="Link to this heading"></a></h3>
<p>VoIPBIN supports three encapsulation types for media streaming:</p>
<p><strong>1. RTP (Real-time Transport Protocol)</strong></p>
<p>Standard protocol for audio/video over IP networks.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>?encapsulation=rtp
</pre></div>
</div>
<p><strong>Use cases:</strong>
- Standard VoIP integration
- Compatible with most audio processing tools
- Industry-standard protocol</p>
<p><strong>2. SLN (Signed Linear Mono)</strong></p>
<p>Raw audio stream without headers or padding.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>?encapsulation=sln
</pre></div>
</div>
<p><strong>Use cases:</strong>
- Minimal overhead needed
- Simple audio processing
- Direct PCM audio access</p>
<p><strong>3. AudioSocket</strong></p>
<p>Asterisk-specific protocol for simple audio streaming.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>?encapsulation=audiosocket
</pre></div>
</div>
<p><strong>Use cases:</strong>
- Asterisk integration
- Low-overhead streaming
- Simple audio applications</p>
<p><strong>Codec:</strong> All formats use <strong>16-bit, 8kHz, mono</strong> audio (ulaw for RTP/SLN, PCM little-endian for AudioSocket)</p>
</section>
<section id="websocket-client-examples">
<h3>WebSocket Client Examples<a class="headerlink" href="#websocket-client-examples" title="Link to this heading"></a></h3>
<p><strong>Python Example (RTP Streaming):</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">websocket</span>
<span class="kn">import</span> <span class="nn">struct</span>

<span class="k">def</span> <span class="nf">on_message</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Receive audio data from the call&quot;&quot;&quot;</span>
    <span class="c1"># message contains RTP packets</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">message</span><span class="p">)</span><span class="si">}</span><span class="s2"> bytes of audio&quot;</span><span class="p">)</span>

    <span class="c1"># Process audio here</span>
    <span class="c1"># - Save to file</span>
    <span class="c1"># - Run speech recognition</span>
    <span class="c1"># - Analyze audio</span>
    <span class="n">process_audio</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">on_open</span><span class="p">(</span><span class="n">ws</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Connection established, can start sending audio&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Media stream connected&quot;</span><span class="p">)</span>

    <span class="c1"># Send audio to the call</span>
    <span class="c1"># audio_data should be RTP packets</span>
    <span class="n">audio_data</span> <span class="o">=</span> <span class="n">generate_audio</span><span class="p">()</span>
    <span class="n">ws</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">audio_data</span><span class="p">,</span> <span class="n">opcode</span><span class="o">=</span><span class="n">websocket</span><span class="o">.</span><span class="n">ABNF</span><span class="o">.</span><span class="n">OPCODE_BINARY</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">on_error</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="n">error</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">on_close</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="n">close_status_code</span><span class="p">,</span> <span class="n">close_msg</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connection closed: </span><span class="si">{</span><span class="n">close_status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Connect to media stream</span>
<span class="n">call_id</span> <span class="o">=</span> <span class="s2">&quot;652af662-eb45-11ee-b1a5-6fde165f9226&quot;</span>
<span class="n">token</span> <span class="o">=</span> <span class="s2">&quot;&lt;YOUR_AUTH_TOKEN&gt;&quot;</span>
<span class="n">ws_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;wss://api.voipbin.net/v1.0/calls/</span><span class="si">{</span><span class="n">call_id</span><span class="si">}</span><span class="s2">/media_stream?encapsulation=rtp&amp;token=</span><span class="si">{</span><span class="n">token</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="n">ws</span> <span class="o">=</span> <span class="n">websocket</span><span class="o">.</span><span class="n">WebSocketApp</span><span class="p">(</span>
    <span class="n">ws_url</span><span class="p">,</span>
    <span class="n">on_open</span><span class="o">=</span><span class="n">on_open</span><span class="p">,</span>
    <span class="n">on_message</span><span class="o">=</span><span class="n">on_message</span><span class="p">,</span>
    <span class="n">on_error</span><span class="o">=</span><span class="n">on_error</span><span class="p">,</span>
    <span class="n">on_close</span><span class="o">=</span><span class="n">on_close</span>
<span class="p">)</span>

<span class="n">ws</span><span class="o">.</span><span class="n">run_forever</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">process_audio</span><span class="p">(</span><span class="n">rtp_packet</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process received RTP audio&quot;&quot;&quot;</span>
    <span class="c1"># Extract payload from RTP packet</span>
    <span class="c1"># RTP header is typically 12 bytes</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="n">rtp_packet</span><span class="p">[</span><span class="mi">12</span><span class="p">:]</span>

    <span class="c1"># Save or process audio</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;received_audio.raw&#39;</span><span class="p">,</span> <span class="s1">&#39;ab&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">generate_audio</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate RTP packets to send&quot;&quot;&quot;</span>
    <span class="c1"># This is a simplified example</span>
    <span class="c1"># In production, properly construct RTP packets</span>

    <span class="c1"># Read audio file</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;audio_to_inject.raw&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">audio_data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">160</span><span class="p">)</span>  <span class="c1"># 20ms of 8kHz audio</span>

    <span class="c1"># Construct RTP header (simplified)</span>
    <span class="c1"># In production, use a proper RTP library</span>
    <span class="k">return</span> <span class="n">audio_data</span>
</pre></div>
</div>
<p><strong>JavaScript Example (Browser):</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>const callId = &#39;652af662-eb45-11ee-b1a5-6fde165f9226&#39;;
const token = &#39;&lt;YOUR_AUTH_TOKEN&gt;&#39;;
const wsUrl = `wss://api.voipbin.net/v1.0/calls/${callId}/media_stream?encapsulation=rtp&amp;token=${token}`;

const ws = new WebSocket(wsUrl);
ws.binaryType = &#39;arraybuffer&#39;;

ws.onopen = function() {
    console.log(&#39;Media stream connected&#39;);

    // Send audio to the call
    const audioData = generateAudio();
    ws.send(audioData);
};

ws.onmessage = function(event) {
    // Receive audio from the call
    const audioData = event.data;
    console.log(`Received ${audioData.byteLength} bytes`);

    // Process audio
    processAudio(new Uint8Array(audioData));
};

ws.onerror = function(error) {
    console.error(&#39;WebSocket error:&#39;, error);
};

ws.onclose = function() {
    console.log(&#39;Media stream closed&#39;);
};

function processAudio(audioBuffer) {
    // Process received audio
    // - Play through Web Audio API
    // - Run speech recognition
    // - Visualize audio
}

function generateAudio() {
    // Generate audio to send
    // Returns ArrayBuffer with RTP packets
    return new ArrayBuffer(172); // RTP packet size
}
</pre></div>
</div>
<p><strong>Node.js Example (AudioSocket):</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>const WebSocket = require(&#39;ws&#39;);
const fs = require(&#39;fs&#39;);

const callId = &#39;652af662-eb45-11ee-b1a5-6fde165f9226&#39;;
const token = &#39;&lt;YOUR_AUTH_TOKEN&gt;&#39;;
const wsUrl = `wss://api.voipbin.net/v1.0/calls/${callId}/media_stream?encapsulation=audiosocket&amp;token=${token}`;

const ws = new WebSocket(wsUrl);

ws.on(&#39;open&#39;, function() {
    console.log(&#39;AudioSocket connected&#39;);

    // Send audio file
    const audioFile = fs.readFileSync(&#39;audio.pcm&#39;);

    // Send in chunks (20ms = 320 bytes for 16-bit 8kHz mono)
    const chunkSize = 320;
    for (let i = 0; i &lt; audioFile.length; i += chunkSize) {
        const chunk = audioFile.slice(i, i + chunkSize);
        ws.send(chunk);
    }
});

ws.on(&#39;message&#39;, function(data) {
    // Receive audio from call
    console.log(`Received ${data.length} bytes`);

    // Save received audio
    fs.appendFileSync(&#39;received_audio.pcm&#39;, data);
});

ws.on(&#39;error&#39;, function(error) {
    console.error(&#39;Error:&#39;, error);
});

ws.on(&#39;close&#39;, function() {
    console.log(&#39;AudioSocket closed&#39;);
});
</pre></div>
</div>
</section>
<section id="uni-directional-streaming-with-flow-action">
<h3>Uni-Directional Streaming with Flow Action<a class="headerlink" href="#uni-directional-streaming-with-flow-action" title="Link to this heading"></a></h3>
<p>For sending audio to a call without receiving audio back, use the <code class="docutils literal notranslate"><span class="pre">external_media_start</span></code> flow action.</p>
<p><strong>Create Call with External Media:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ curl --location --request POST &#39;https://api.voipbin.net/v1.0/calls?token=&lt;YOUR_AUTH_TOKEN&gt;&#39; \
    --header &#39;Content-Type: application/json&#39; \
    --data-raw &#39;{
        &quot;source&quot;: {
            &quot;type&quot;: &quot;tel&quot;,
            &quot;target&quot;: &quot;+15551234567&quot;
        },
        &quot;destinations&quot;: [
            {
                &quot;type&quot;: &quot;tel&quot;,
                &quot;target&quot;: &quot;+15559876543&quot;
            }
        ],
        &quot;actions&quot;: [
            {
                &quot;type&quot;: &quot;answer&quot;
            },
            {
                &quot;type&quot;: &quot;external_media_start&quot;,
                &quot;option&quot;: {
                    &quot;url&quot;: &quot;wss://your-media-server.com/audio-stream&quot;,
                    &quot;encapsulation&quot;: &quot;audiosocket&quot;
                }
            }
        ]
    }&#39;
</pre></div>
</div>
<p>This creates a uni-directional stream where VoIPBIN:
1. Establishes the call
2. Connects to your media server via WebSocket
3. Receives audio from your server
4. Plays that audio to the call participant</p>
<p><strong>Your media server receives:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>WebSocket connection from VoIPBIN
→ Send audio chunks (PCM format for AudioSocket)
→ VoIPBIN plays audio to call
</pre></div>
</div>
</section>
<section id="common-use-cases">
<h3>Common Use Cases<a class="headerlink" href="#common-use-cases" title="Link to this heading"></a></h3>
<p><strong>1. Real-Time Speech Recognition:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Python example</span>
<span class="k">def</span> <span class="nf">on_message</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
    <span class="c1"># Extract audio from RTP packet</span>
    <span class="n">audio</span> <span class="o">=</span> <span class="n">extract_audio</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="c1"># Send to speech recognition API</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">speech_to_text</span><span class="p">(</span><span class="n">audio</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Recognized: </span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Store transcription</span>
    <span class="n">save_transcription</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>2. Audio Injection / IVR Replacement:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Node.js example</span>
<span class="n">ws</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="s1">&#39;open&#39;</span><span class="p">,</span> <span class="n">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="o">//</span> <span class="n">Play</span> <span class="n">custom</span> <span class="n">audio</span> <span class="n">prompts</span>
    <span class="n">const</span> <span class="n">prompt1</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">readFileSync</span><span class="p">(</span><span class="s1">&#39;welcome.pcm&#39;</span><span class="p">);</span>
    <span class="n">ws</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">prompt1</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">Wait</span> <span class="k">for</span> <span class="n">DTMF</span> <span class="ow">or</span> <span class="n">speech</span>
    <span class="o">//</span> <span class="n">Then</span> <span class="n">play</span> <span class="nb">next</span> <span class="n">prompt</span>
<span class="p">});</span>
</pre></div>
</div>
<p><strong>3. Conference Recording:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Python example</span>
<span class="k">def</span> <span class="nf">on_message</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
    <span class="c1"># Save all conference audio</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;conference_</span><span class="si">{</span><span class="n">conference_id</span><span class="si">}</span><span class="s1">.raw&#39;</span><span class="p">,</span> <span class="s1">&#39;ab&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">extract_audio</span><span class="p">(</span><span class="n">message</span><span class="p">))</span>
</pre></div>
</div>
<p><strong>4. Real-Time Audio Analysis:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">on_message</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
    <span class="n">audio</span> <span class="o">=</span> <span class="n">extract_audio</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="c1"># Detect emotion</span>
    <span class="n">emotion</span> <span class="o">=</span> <span class="n">analyze_emotion</span><span class="p">(</span><span class="n">audio</span><span class="p">)</span>

    <span class="c1"># Detect keywords</span>
    <span class="k">if</span> <span class="n">detect_keyword</span><span class="p">(</span><span class="n">audio</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;help&#39;</span><span class="p">,</span> <span class="s1">&#39;urgent&#39;</span><span class="p">]):</span>
        <span class="n">alert_supervisor</span><span class="p">()</span>

    <span class="c1"># Calculate audio quality</span>
    <span class="n">quality</span> <span class="o">=</span> <span class="n">measure_quality</span><span class="p">(</span><span class="n">audio</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>5. Custom Music on Hold:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ws</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="s1">&#39;open&#39;</span><span class="p">,</span> <span class="n">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="o">//</span> <span class="n">Play</span> <span class="n">custom</span> <span class="n">music</span> <span class="ow">or</span> <span class="n">messages</span>
    <span class="n">const</span> <span class="n">music</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">readFileSync</span><span class="p">(</span><span class="s1">&#39;hold_music.pcm&#39;</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">Loop</span> <span class="n">music</span> <span class="k">while</span> <span class="n">call</span> <span class="ow">is</span> <span class="n">on</span> <span class="n">hold</span>
    <span class="n">setInterval</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="n">ws</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">music</span><span class="p">);</span>
    <span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p><strong>6. AI-Powered Voice Assistant:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ws</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">function</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">//</span> <span class="n">Receive</span> <span class="n">customer</span> <span class="n">audio</span>
    <span class="n">const</span> <span class="n">audio</span> <span class="o">=</span> <span class="n">extractAudio</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">Send</span> <span class="n">to</span> <span class="n">AI</span> <span class="k">for</span> <span class="n">processing</span>
    <span class="n">const</span> <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">aiProcess</span><span class="p">(</span><span class="n">audio</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">Convert</span> <span class="n">AI</span> <span class="n">response</span> <span class="n">to</span> <span class="n">audio</span>
    <span class="n">const</span> <span class="n">responseAudio</span> <span class="o">=</span> <span class="n">textToSpeech</span><span class="p">(</span><span class="n">response</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">Send</span> <span class="n">back</span> <span class="n">to</span> <span class="n">call</span>
    <span class="n">ws</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">responseAudio</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
</section>
<section id="audio-format-details">
<h3>Audio Format Details<a class="headerlink" href="#audio-format-details" title="Link to this heading"></a></h3>
<p><strong>RTP Format:</strong>
- Codec: ulaw (G.711 μ-law)
- Sample rate: 8 kHz
- Bits: 16-bit
- Channels: Mono
- Packet size: 160 bytes payload (20ms audio)</p>
<p><strong>SLN Format:</strong>
- Raw PCM audio
- No headers or padding
- Sample rate: 8 kHz
- Bits: 16-bit signed
- Channels: Mono</p>
<p><strong>AudioSocket Format:</strong>
- PCM little-endian
- Sample rate: 8 kHz
- Bits: 16-bit
- Channels: Mono
- Chunk size: 320 bytes (20ms of audio)</p>
</section>
<section id="id2">
<h3>Best Practices<a class="headerlink" href="#id2" title="Link to this heading"></a></h3>
<p><strong>1. Buffer Management:</strong>
- Maintain audio buffers to handle jitter
- Send audio in consistent 20ms chunks
- Don’t send too fast or too slow</p>
<p><strong>2. Error Handling:</strong>
- Implement reconnection logic
- Handle WebSocket disconnections gracefully
- Log errors for debugging</p>
<p><strong>3. Audio Quality:</strong>
- Use proper RTP packet construction
- Maintain correct timing for audio chunks
- Monitor for packet loss</p>
<p><strong>4. Resource Management:</strong>
- Close WebSocket when done
- Don’t leave connections open indefinitely
- Clean up audio buffers and files</p>
<p><strong>5. Testing:</strong>
- Test with various network conditions
- Verify audio quality with real calls
- Monitor latency and packet loss</p>
<p><strong>6. Security:</strong>
- Use WSS (secure WebSocket) in production
- Validate authentication tokens
- Encrypt sensitive audio data</p>
</section>
<section id="id3">
<h3>Connection Lifecycle<a class="headerlink" href="#id3" title="Link to this heading"></a></h3>
<p><strong>1. Establish Connection:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>GET /v1.0/calls/&lt;call-id&gt;/media_stream?encapsulation=rtp&amp;token=&lt;token&gt;
</pre></div>
</div>
<p><strong>2. WebSocket Upgrade:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span> <span class="mi">101</span> <span class="n">Switching</span> <span class="n">Protocols</span>
<span class="n">Upgrade</span><span class="p">:</span> <span class="n">websocket</span>
<span class="n">Connection</span><span class="p">:</span> <span class="n">Upgrade</span>
</pre></div>
</div>
<p><strong>3. Bi-Directional Communication:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Client ←→ VoIPBIN
- Send audio: Binary frames with RTP packets
- Receive audio: Binary frames with RTP packets
</pre></div>
</div>
<p><strong>4. Close Connection:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ws</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="id4">
<h3>Troubleshooting<a class="headerlink" href="#id4" title="Link to this heading"></a></h3>
<p><strong>Common Issues:</strong></p>
<p><strong>No audio received:</strong>
- Check WebSocket connection is established
- Verify call is active and answered
- Ensure correct encapsulation type</p>
<p><strong>Audio quality poor:</strong>
- Check network latency
- Verify audio format matches requirements
- Monitor packet loss</p>
<p><strong>Connection drops:</strong>
- Implement reconnection logic
- Check firewall rules for WebSocket
- Verify authentication token is valid</p>
<p><strong>Can’t send audio:</strong>
- Ensure binary frames are used (not text)
- Verify audio format is correct
- Check audio chunk size (typically 20ms)</p>
<p>For more information about media stream configuration, see <a class="reference internal" href="mediastream_overview.html#mediastream-overview"><span class="std std-ref">Media Stream Overview</span></a>.</p>
</section>
</section>
</section>

</main>
                        <nav aria-label="Page navigation" class="py-4 my-5 clearfix font-weight-bold border-top">
    <a class="float-left" href="transcribe.html" title="Previous">
        <span aria-hidden="true">←&nbsp;</span>Transcribe
    </a>
    <a class="float-right" href="message.html" title="Next">
        Message <span aria-hidden="true">&nbsp;→</span>
    </a>
</nav>
                    </div>
                    
                    <nav class="col-12 col-lg-3 pb-4">
                        <div class="sticky-top toc page-toc" aria-labelledby="page-toc-heading">
                            <p class="font-weight-bold" id="page-toc-heading">Page contents</p>
                            <ul>
<li><a class="reference internal" href="#">Mediastream</a><ul>
<li><a class="reference internal" href="#overview">Overview</a><ul>
<li><a class="reference internal" href="#how-media-streaming-works">How Media Streaming Works</a></li>
<li><a class="reference internal" href="#streaming-modes">Streaming Modes</a></li>
<li><a class="reference internal" href="#encapsulation-types">Encapsulation Types</a></li>
<li><a class="reference internal" href="#supported-resources">Supported Resources</a></li>
<li><a class="reference internal" href="#connection-lifecycle">Connection Lifecycle</a></li>
<li><a class="reference internal" href="#integration-patterns">Integration Patterns</a></li>
<li><a class="reference internal" href="#best-practices">Best Practices</a></li>
<li><a class="reference internal" href="#troubleshooting">Troubleshooting</a></li>
<li><a class="reference internal" href="#related-documentation">Related Documentation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tutorial">Tutorial</a><ul>
<li><a class="reference internal" href="#bi-directional-media-streaming-for-calls">Bi-Directional Media Streaming for Calls</a></li>
<li><a class="reference internal" href="#bi-directional-media-streaming-for-conferences">Bi-Directional Media Streaming for Conferences</a></li>
<li><a class="reference internal" href="#id1">Encapsulation Types</a></li>
<li><a class="reference internal" href="#websocket-client-examples">WebSocket Client Examples</a></li>
<li><a class="reference internal" href="#uni-directional-streaming-with-flow-action">Uni-Directional Streaming with Flow Action</a></li>
<li><a class="reference internal" href="#common-use-cases">Common Use Cases</a></li>
<li><a class="reference internal" href="#audio-format-details">Audio Format Details</a></li>
<li><a class="reference internal" href="#id2">Best Practices</a></li>
<li><a class="reference internal" href="#id3">Connection Lifecycle</a></li>
<li><a class="reference internal" href="#id4">Troubleshooting</a></li>
</ul>
</li>
</ul>
</li>
</ul>

                        </div>
                    </nav>
                    
                </div>
            </div>
        </div>
    </div>
    <footer class="container-fluid bg-primary text-light">
        <div class="container">
            <div class="row">
        <div class="col p-4">
            
                <nav aria-label="Footer">
                    <ul class="nav justify-content-center mb-2">
                        
                            
                            
                            <li class="nav-item"><a class="nav-link text-light"  href="http://voipbin.net">About Us</a></li>
                        
                            
                            
                            <li class="nav-item"><a class="nav-link text-light"  href="http://voipbin.net">Contact</a></li>
                        
                    </ul>
                </nav>
            
            <div class="text-center">
                    &copy; Copyright 2026, VoIPBIN
            </div>
            <div class="text-center text-white-50 font-italic mt-3">
                <small>
                    Created using
                    <a class="text-white" href="https://github.com/wagtail/sphinx_wagtail_theme" rel="nofollow" target="_blank">
                        Sphinx Wagtail Theme 6.5.0
                    </a>
                    and
                    <a class="text-white" href="https://www.sphinx-doc.org/" rel="nofollow" target="_blank">
                        Sphinx 7.2.6
                    </a>
                </small>
            </div>
        </div>
    </div>
        </div>
    </footer>
        <script src="_static/jquery.js?v=8dae8fb0"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=5929fcd5"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="_static/copybutton.js?v=f281be69"></script>
        <script type="text/javascript" src="_static/dist/theme.js"></script>
        <script type="text/javascript" src="_static/dist/vendor.js"></script>
        <script type="text/javascript" src="_static/searchtools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script type="text/javascript">
            document.addEventListener('DOMContentLoaded', function() { Search.loadIndex("searchindex.js"); });
        </script>
        <script type="text/javascript" id="searchindexloader"></script>
    </body>
</html>