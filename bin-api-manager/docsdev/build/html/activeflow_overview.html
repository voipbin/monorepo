<!DOCTYPE html>
<html class="no-js" lang="en" data-content_root="./">
<head>
    <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
        <title>Overview &mdash; voipbin  documentation</title>
    
    <link rel="stylesheet" type="text/css" href="_static/dist/fontawesome.css" />
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=8e8a900e" />
      <link rel="stylesheet" type="text/css" href="_static/dist/theme.css?v=310cf088" />
      <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
            <link rel="index" title="Index" href="genindex.html" />
            <link rel="search" title="Search" href="search.html" />
            <link rel="top" title="voipbin  documentation" href="#" />
    </head>
<body>
    <script type="text/javascript" src="_static/dist/blocking.js"></script>
    <header class="container-fluid bg-primary">
        <a class="btn btn-sm btn-light skip-to-content-link" href="#main">Skip to content</a>
        <div class="container-fluid">
            <div class="navbar navbar-expand-lg navbar-dark font-weight-bold">
                    <a href="intro.html"
                        title="voipbin"
                        class="logo navbar-brand"
                    >
                        <img src="_static/images/voipbin-high-resolution-logo-white-transparent.png" width="45" height="80" alt="voipbin"
                            class="logo-img"
                        />
                        VoIPBin Documentation
                    </a>
                
                
                    <div class="collapse navbar-collapse justify-content-end">
                        <ul class="navbar-nav">
                            
                                
                                
                                <li class="nav-item"><a class="nav-link"  href="http://voipbin.net">Project</a></li>
                            
                                
                                
                                <li class="nav-item"><a class="nav-link"  href="https://admin.voipbin.net">Admin</a></li>
                            
                        </ul>
                    </div>
                
                <button class="navbar-toggler btn btn-primary d-lg-none" type="button" data-toggle="collapse" data-target="#collapseSidebar" aria-expanded="false" aria-controls="collapseExample">
                    <span class="navbar-toggler-icon"></span>
                    <span class="sr-only">menu</span>
                </button>
            </div>
        </div>
    </header>
    <div class="container-fluid">
        <div class="row">
            <aside class="col-12 col-lg-3 sidebar-container">
                <div id="collapseSidebar" class="collapse sticky-top d-lg-block pt-5 pr-lg-4">
<div id="searchbox" class="searchbox mb-6 px-1" role="search">
    <form id="search-form" action="search.html" autocomplete="off" method="get" role="search">
        <div class="input-group">
            <div class="input-group-prepend">
                <div class="input-group-text border-right-0 bg-white py-3 pl-3 pr-2"><span class="fas fa-search"></span></div>
            </div>
            <input class="form-control py-3 pr-3 pl-1 h-100 border-left-0" type="search" name="q" placeholder="Search documentation" aria-label="Search documentation" id="searchinput" />
        </div>
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
    </form>
</div><div class="site-toc">
    <nav class="toc mt-3" aria-label="Main menu">
        <ul>
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="common.html">Common</a></li>
<li class="toctree-l1"><a class="reference internal" href="restful_api.html">RESTful API(Application Programming Interface)</a></li>
<li class="toctree-l1"><a class="reference internal" href="sdk.html">SDK(Software Development Kit)</a></li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="accesskey.html">Accesskey</a></li>
<li class="toctree-l1"><a class="reference internal" href="flow.html">Flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="activeflow.html">Activeflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="call.html">Call</a></li>
<li class="toctree-l1"><a class="reference internal" href="message.html">Message</a></li>
<li class="toctree-l1"><a class="reference internal" href="email.html">Email</a></li>
<li class="toctree-l1"><a class="reference internal" href="agent.html">Agent</a></li>
<li class="toctree-l1"><a class="reference internal" href="conference.html">Conference</a></li>
<li class="toctree-l1"><a class="reference internal" href="mediastream.html">Mediastream</a></li>
<li class="toctree-l1"><a class="reference internal" href="conversation.html">Conversation</a></li>
<li class="toctree-l1"><a class="reference internal" href="extension.html">Extension</a></li>
<li class="toctree-l1"><a class="reference internal" href="number.html">Number</a></li>
<li class="toctree-l1"><a class="reference internal" href="queue.html">Queue</a></li>
<li class="toctree-l1"><a class="reference internal" href="recording.html">Recording</a></li>
<li class="toctree-l1"><a class="reference internal" href="tag.html">Tag</a></li>
<li class="toctree-l1"><a class="reference internal" href="campaign.html">Campaign</a></li>
<li class="toctree-l1"><a class="reference internal" href="outdial.html">Outdial</a></li>
<li class="toctree-l1"><a class="reference internal" href="outplan.html">Outplan</a></li>
<li class="toctree-l1"><a class="reference internal" href="webhook.html">Webhook</a></li>
<li class="toctree-l1"><a class="reference internal" href="customer.html">Customer</a></li>
<li class="toctree-l1"><a class="reference internal" href="chat.html">Chat</a></li>
<li class="toctree-l1"><a class="reference internal" href="talk.html">Talk</a></li>
<li class="toctree-l1"><a class="reference internal" href="ai.html">AI</a></li>
<li class="toctree-l1"><a class="reference internal" href="provider.html">Provider</a></li>
<li class="toctree-l1"><a class="reference internal" href="route.html">Route</a></li>
<li class="toctree-l1"><a class="reference internal" href="variable.html">Variable</a></li>
<li class="toctree-l1"><a class="reference internal" href="websocket.html">Websocket</a></li>
<li class="toctree-l1"><a class="reference internal" href="trunk.html">Trunk</a></li>
<li class="toctree-l1"><a class="reference internal" href="billing_account.html">Billing Account</a></li>
<li class="toctree-l1"><a class="reference internal" href="storage.html">Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="transcribe.html">Transcribe</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
</ul>

    </nav>
    <template data-toggle-item-template>
        <button class="btn btn-sm btn-link toctree-expand" type="button">
            <span class="sr-only">Toggle menu contents</span>
        </button>
    </template>
</div>
                    <div class="d-lg-none border-bottom">
                        
                    </div>
                </div>
            </aside>
            <div class="col-12 col-lg-9 pt-5">
                <header class="row align-items-baseline">
                    <div class="col">
                        <nav aria-label="breadcrumb">
    <ol class="breadcrumb m-0 p-0 bg-transparent">
        <li class="breadcrumb-item"><a href="index.html">Docs</a></li>
        <li class="breadcrumb-item active" aria-current="page">Overview</li>
    </ol>
</nav>
                    </div>
                    <div class="col-sm-12 col-lg-auto mt-3 mt-lg-3">
                        <noscript>
                            <p>JavaScript is required to toggle light/dark mode..</p>
                        </noscript>
                        <button id="wagtail-theme" class="btn btn-sm btn-light text-decoration-none" type="button">
                            <span class="dark-only"><i class="fas fa-sun"></i> Light mode</span>
                            <span class="light-only"><i class="fas fa-moon"></i> Dark mode</span>
                        </button>
    <a class="btn btn-sm btn-light text-decoration-none" href="_sources/activeflow_overview.rst.txt" rel="nofollow">
        <span class="btn-icon"><span class="fas fa-code"></span></span>
        <span class="btn-text">View source</span>
    </a>
                        
                    </div>
                </header>
                <div class="row" >
                    <div class="col-12">
                        <hr class="w-100 my-4">
                    </div>
                </div>
                <div class="row">
                    <div class="col-12 col-lg-9 order-last order-lg-first rst-content">
                        <main role="main" id="main">
    <section id="overview">
<span id="activeflow-overview"></span><h1>Overview<a class="headerlink" href="#overview" title="Link to this heading"></a></h1>
<p>The activeflow is a dynamic entity within the VoIPBIN system that plays a vital role in representing the real-time state of a registered flow. As the flow is executed, it generates an activeflow, which contains an action cursor and relevant status information. This activeflow serves as a control interface, providing efficient management and flexibility during flow execution.</p>
<p>In essence, the activeflow concept is a powerful tool that facilitates the smooth and flexible execution of registered flows. Its dynamic nature allows for real-time updates, ensuring that users can monitor and manage the flow execution efficiently.</p>
<p>By providing real-time status updates and a flexible control interface, the activeflow becomes a valuable tool for businesses to efficiently manage complex workflows and automate their critical processes. The stop functionality adds an extra layer of control and adaptability, allowing users to make informed decisions and optimize their flow executions as required.</p>
<section id="flow-vs-activeflow">
<h2>Flow vs ActiveFlow<a class="headerlink" href="#flow-vs-activeflow" title="Link to this heading"></a></h2>
<p>Understanding the difference between a Flow and an ActiveFlow is essential for working with VoIPBIN.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+-------------------------------------------------------------------------+</span>
<span class="o">|</span>                        <span class="n">Flow</span> <span class="n">vs</span> <span class="n">ActiveFlow</span>                                <span class="o">|</span>
<span class="o">+-------------------------------------------------------------------------+</span>

<span class="n">Flow</span> <span class="p">(</span><span class="n">Template</span><span class="p">)</span>                         <span class="n">ActiveFlow</span> <span class="p">(</span><span class="n">Running</span> <span class="n">Instance</span><span class="p">)</span>
<span class="o">+-------------------------+</span>            <span class="o">+---------------------------------+</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Static</span> <span class="n">definition</span>     <span class="o">|</span>            <span class="o">|</span> <span class="n">o</span> <span class="n">Dynamic</span> <span class="n">execution</span> <span class="n">state</span>       <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Reusable</span> <span class="n">template</span>     <span class="o">|</span>            <span class="o">|</span> <span class="n">o</span> <span class="n">One</span><span class="o">-</span><span class="n">time</span> <span class="n">instance</span>             <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">Stored</span> <span class="ow">in</span> <span class="n">database</span>    <span class="o">|</span>            <span class="o">|</span> <span class="n">o</span> <span class="n">Tracks</span> <span class="n">current</span> <span class="n">position</span>       <span class="o">|</span>
<span class="o">|</span> <span class="n">o</span> <span class="n">No</span> <span class="n">execution</span> <span class="n">state</span>    <span class="o">|</span>            <span class="o">|</span> <span class="n">o</span> <span class="n">Contains</span> <span class="n">variables</span>            <span class="o">|</span>
<span class="o">|</span>                         <span class="o">|</span>            <span class="o">|</span> <span class="n">o</span> <span class="n">Linked</span> <span class="n">to</span> <span class="n">call</span><span class="o">/</span><span class="n">conversation</span>   <span class="o">|</span>
<span class="o">+-------------------------+</span>            <span class="o">+---------------------------------+</span>
           <span class="o">|</span>                                        <span class="o">^</span>
           <span class="o">|</span>     <span class="n">When</span> <span class="n">triggered</span>                     <span class="o">|</span>
           <span class="o">+----------------------------------------+</span>
                    <span class="n">Creates</span>
</pre></div>
</div>
<p><strong>Analogy</strong>: A Flow is like a recipe book. An ActiveFlow is like actually cooking that recipe - you track which step you’re on, what ingredients you’ve used, and the current state of the dish.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Flow</span> <span class="p">(</span><span class="n">Recipe</span> <span class="n">Book</span><span class="p">)</span>                    <span class="n">ActiveFlow</span> <span class="p">(</span><span class="n">Cooking</span> <span class="n">Session</span><span class="p">)</span>
<span class="o">+--------------------+</span>               <span class="o">+--------------------------------+</span>
<span class="o">|</span> <span class="n">Step</span> <span class="mi">1</span><span class="p">:</span> <span class="n">Answer</span>     <span class="o">|</span>               <span class="o">|</span> <span class="n">Step</span> <span class="mi">1</span><span class="p">:</span> <span class="n">Answer</span> <span class="p">(</span><span class="n">done</span><span class="p">)</span>          <span class="o">|</span>
<span class="o">|</span> <span class="n">Step</span> <span class="mi">2</span><span class="p">:</span> <span class="n">Talk</span>       <span class="o">|</span>   <span class="o">------&gt;</span>     <span class="o">|</span> <span class="n">Step</span> <span class="mi">2</span><span class="p">:</span> <span class="n">Talk</span> <span class="o">&lt;--</span> <span class="n">current</span>       <span class="o">|</span>
<span class="o">|</span> <span class="n">Step</span> <span class="mi">3</span><span class="p">:</span> <span class="n">Branch</span>     <span class="o">|</span>               <span class="o">|</span> <span class="n">Step</span> <span class="mi">3</span><span class="p">:</span> <span class="n">Branch</span> <span class="p">(</span><span class="n">pending</span><span class="p">)</span>       <span class="o">|</span>
<span class="o">|</span> <span class="n">Step</span> <span class="mi">4</span><span class="p">:</span> <span class="n">Hangup</span>     <span class="o">|</span>               <span class="o">|</span> <span class="n">Step</span> <span class="mi">4</span><span class="p">:</span> <span class="n">Hangup</span> <span class="p">(</span><span class="n">pending</span><span class="p">)</span>       <span class="o">|</span>
<span class="o">+--------------------+</span>               <span class="o">|</span>                                <span class="o">|</span>
                                     <span class="o">|</span> <span class="n">Variables</span><span class="p">:</span>                     <span class="o">|</span>
                                     <span class="o">|</span>   <span class="n">caller_id</span><span class="p">:</span> <span class="s2">&quot;+1234567890&quot;</span>     <span class="o">|</span>
                                     <span class="o">|</span>   <span class="n">digits</span><span class="p">:</span> <span class="s2">&quot;2&quot;</span>                  <span class="o">|</span>
                                     <span class="o">+--------------------------------+</span>
</pre></div>
</div>
</section>
<section id="activeflow-states">
<h2>ActiveFlow States<a class="headerlink" href="#activeflow-states" title="Link to this heading"></a></h2>
<p>An activeflow has two possible states during its lifecycle:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+------------+</span>                              <span class="o">+------------+</span>
<span class="o">|</span>  <span class="n">running</span>   <span class="o">|-----------------------------&gt;|</span>   <span class="n">ended</span>    <span class="o">|</span>
<span class="o">+------------+</span>                              <span class="o">+------------+</span>
      <span class="o">|</span>                                            <span class="o">|</span>
      <span class="o">|</span>                                            <span class="o">|</span>
<span class="n">Actions</span> <span class="n">executing</span>                           <span class="n">Final</span> <span class="n">state</span>
<span class="n">Cursor</span> <span class="n">moving</span>                               <span class="n">No</span> <span class="n">more</span> <span class="n">changes</span>
<span class="n">Variables</span> <span class="n">updating</span>                          <span class="n">History</span> <span class="n">preserved</span>
</pre></div>
</div>
</section>
<section id="execution">
<h2>Execution<a class="headerlink" href="#execution" title="Link to this heading"></a></h2>
<p>The activeflow’s significance lies in its ability to manage complex workflows and automate business processes effectively. As the flow progresses through its various stages, the activeflow dynamically represents its current state. This representation provides valuable insights into the flow’s progress and status, enabling efficient and informed management of its execution.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+-----------------------------------------------------------------------+</span>
<span class="o">|</span>                     <span class="n">ActiveFlow</span> <span class="n">Execution</span> <span class="n">Model</span>                         <span class="o">|</span>
<span class="o">+-----------------------------------------------------------------------+</span>

<span class="n">Incoming</span> <span class="n">Call</span>           <span class="n">ActiveFlow</span> <span class="n">Created</span>            <span class="n">Execution</span> <span class="n">Begins</span>
     <span class="o">|</span>                        <span class="o">|</span>                            <span class="o">|</span>
     <span class="n">v</span>                        <span class="n">v</span>                            <span class="n">v</span>
<span class="o">+---------+</span>              <span class="o">+---------+</span>                 <span class="o">+-------------+</span>
<span class="o">|</span>  <span class="n">CALL</span>   <span class="o">|-------------&gt;|</span>  <span class="n">NEW</span>    <span class="o">|----------------&gt;|</span>  <span class="n">RUNNING</span>    <span class="o">|</span>
<span class="o">|</span> <span class="n">arrives</span> <span class="o">|</span>              <span class="o">|</span> <span class="n">instance</span><span class="o">|</span>                 <span class="o">|</span>  <span class="n">actions</span>    <span class="o">|</span>
<span class="o">+---------+</span>              <span class="o">+---------+</span>                 <span class="o">+------+------+</span>
                              <span class="o">|</span>                            <span class="o">|</span>
                              <span class="o">|</span>                            <span class="n">v</span>
                              <span class="o">|</span>                      <span class="o">+-----------+</span>
                              <span class="o">|</span>  <span class="n">Variables</span> <span class="nb">set</span><span class="p">:</span>      <span class="o">|</span>  <span class="n">cursor</span>   <span class="o">|</span>
                              <span class="o">|</span>  <span class="n">o</span> <span class="n">reference_type</span>    <span class="o">|</span>  <span class="n">moves</span>    <span class="o">|--+</span>
                              <span class="o">|</span>  <span class="n">o</span> <span class="n">reference_id</span>      <span class="o">+-----------+</span>  <span class="o">|</span>
                              <span class="o">|</span>  <span class="n">o</span> <span class="n">customer_id</span>                      <span class="o">|</span>
                              <span class="o">|</span>  <span class="n">o</span> <span class="n">flow_id</span>                          <span class="o">|</span>
                              <span class="o">+-------------------------------------+</span>
</pre></div>
</div>
<img alt="_images/activeflow_overview_execution.png" src="_images/activeflow_overview_execution.png" />
</section>
<section id="how-the-cursor-works">
<h2>How the Cursor Works<a class="headerlink" href="#how-the-cursor-works" title="Link to this heading"></a></h2>
<p>The activeflow maintains a “cursor” that tracks the current position in the flow:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Action</span> <span class="n">Array</span><span class="p">:</span>
<span class="o">+---------+</span>   <span class="o">+---------+</span>   <span class="o">+---------+</span>   <span class="o">+---------+</span>   <span class="o">+---------+</span>
<span class="o">|</span> <span class="n">answer</span>  <span class="o">|</span>   <span class="o">|</span>  <span class="n">talk</span>   <span class="o">|</span>   <span class="o">|</span> <span class="n">digits</span>  <span class="o">|</span>   <span class="o">|</span> <span class="n">branch</span>  <span class="o">|</span>   <span class="o">|</span> <span class="n">hangup</span>  <span class="o">|</span>
<span class="o">|</span> <span class="n">index</span><span class="p">:</span><span class="mi">0</span> <span class="o">|</span>   <span class="o">|</span> <span class="n">index</span><span class="p">:</span><span class="mi">1</span> <span class="o">|</span>   <span class="o">|</span> <span class="n">index</span><span class="p">:</span><span class="mi">2</span> <span class="o">|</span>   <span class="o">|</span> <span class="n">index</span><span class="p">:</span><span class="mi">3</span> <span class="o">|</span>   <span class="o">|</span> <span class="n">index</span><span class="p">:</span><span class="mi">4</span> <span class="o">|</span>
<span class="o">+---------+</span>   <span class="o">+---------+</span>   <span class="o">+---------+</span>   <span class="o">+---------+</span>   <span class="o">+---------+</span>
                   <span class="o">^</span>
                   <span class="o">|</span>
                <span class="n">current_action</span> <span class="p">(</span><span class="n">cursor</span> <span class="ow">is</span> <span class="n">here</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Cursor Movement Rules:</strong></p>
<ol class="arabic simple">
<li><p><strong>Sequential</strong>: By default, cursor moves to the next action in array order</p></li>
<li><p><strong>Jump</strong>: Actions like <code class="docutils literal notranslate"><span class="pre">goto</span></code> and <code class="docutils literal notranslate"><span class="pre">branch</span></code> can jump to any action by ID</p></li>
<li><p><strong>Nested</strong>: Some actions push a new stack (queue_join, ai_talk), cursor enters nested stack</p></li>
<li><p><strong>Return</strong>: When nested stack completes, cursor returns to original position</p></li>
</ol>
</section>
<section id="stack-based-execution">
<h2>Stack-Based Execution<a class="headerlink" href="#stack-based-execution" title="Link to this heading"></a></h2>
<p>ActiveFlows use a stack-based model to handle nested flows (like queue wait flows or AI conversations):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+-----------------------------------------------------------------------+</span>
<span class="o">|</span>                       <span class="n">Stack</span><span class="o">-</span><span class="n">Based</span> <span class="n">Execution</span>                            <span class="o">|</span>
<span class="o">+-----------------------------------------------------------------------+</span>

<span class="n">Main</span> <span class="n">Stack</span>                          <span class="n">Nested</span> <span class="n">Stack</span> <span class="p">(</span><span class="kn">from</span><span class="w"> </span><span class="nn">queue_join</span><span class="p">)</span>
<span class="o">+---------------------+</span>            <span class="o">+---------------------------------+</span>
<span class="o">|</span> <span class="mf">1.</span> <span class="n">answer</span>           <span class="o">|</span>            <span class="o">|</span>                                 <span class="o">|</span>
<span class="o">|</span> <span class="mf">2.</span> <span class="n">queue_join</span> <span class="o">======+============&gt;</span> <span class="n">wait_flow</span> <span class="n">actions</span><span class="p">:</span>              <span class="o">|</span>
<span class="o">|</span> <span class="mf">3.</span> <span class="n">talk</span> <span class="s2">&quot;connected&quot;</span> <span class="o">|</span>            <span class="o">|</span>   <span class="n">o</span> <span class="n">talk</span> <span class="s2">&quot;Please hold...&quot;</span>       <span class="o">|</span>
<span class="o">|</span> <span class="mf">4.</span> <span class="n">hangup</span>           <span class="o">|</span>            <span class="o">|</span>   <span class="n">o</span> <span class="n">play</span> <span class="n">music</span><span class="o">.</span><span class="n">mp3</span>              <span class="o">|</span>
<span class="o">+---------------------+</span>            <span class="o">|</span>   <span class="n">o</span> <span class="p">(</span><span class="n">loops</span> <span class="n">until</span> <span class="n">agent</span> <span class="n">answers</span><span class="p">)</span> <span class="o">|</span>
       <span class="o">^</span>                           <span class="o">+---------------------------------+</span>
       <span class="o">|</span>                                         <span class="o">|</span>
       <span class="o">|</span>    <span class="n">When</span> <span class="n">agent</span> <span class="n">answers</span><span class="p">,</span>                  <span class="o">|</span>
       <span class="o">+-----------------------------------------+</span>
             <span class="k">return</span> <span class="n">to</span> <span class="n">main</span> <span class="n">stack</span>
</pre></div>
</div>
<p><strong>Stack Map Structure:</strong></p>
<p>The activeflow maintains a <code class="docutils literal notranslate"><span class="pre">stack_map</span></code> that tracks all stacks:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">stack_map</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;main&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">actions</span><span class="p">:</span> <span class="p">[</span><span class="o">...</span><span class="p">],</span>
        <span class="n">current_index</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">return_stack</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span>
        <span class="n">return_action</span><span class="p">:</span> <span class="n">null</span>
    <span class="p">},</span>
    <span class="s2">&quot;queue-wait-abc123&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">actions</span><span class="p">:</span> <span class="p">[</span><span class="o">...</span><span class="n">wait</span> <span class="n">flow</span> <span class="n">actions</span><span class="o">...</span><span class="p">],</span>
        <span class="n">current_index</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">return_stack</span><span class="p">:</span> <span class="s2">&quot;main&quot;</span><span class="p">,</span>
        <span class="n">return_action</span><span class="p">:</span> <span class="s2">&quot;talk connected&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="reference-types">
<h2>Reference Types<a class="headerlink" href="#reference-types" title="Link to this heading"></a></h2>
<p>Each activeflow is linked to a reference - the entity that triggered it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+--------------------------------------------------------------------+</span>
<span class="o">|</span>                    <span class="n">ActiveFlow</span> <span class="n">Reference</span> <span class="n">Types</span>                       <span class="o">|</span>
<span class="o">+--------------------------------------------------------------------+</span>
</pre></div>
</div>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Reference Type</p></th>
<th class="head"><p>When it’s used</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>call</p></td>
<td><p>Flow was triggered by an incoming or outgoing call</p></td>
</tr>
<tr class="row-odd"><td><p>conversation</p></td>
<td><p>Flow was triggered by a message in a conversation</p></td>
</tr>
<tr class="row-even"><td><p>api</p></td>
<td><p>Flow was triggered directly via API call</p></td>
</tr>
<tr class="row-odd"><td><p>campaign</p></td>
<td><p>Flow was triggered by an outbound campaign</p></td>
</tr>
<tr class="row-even"><td><p>transcribe</p></td>
<td><p>Flow was triggered for transcription processing</p></td>
</tr>
<tr class="row-odd"><td><p>recording</p></td>
<td><p>Flow was triggered for recording processing</p></td>
</tr>
<tr class="row-even"><td><p>ai</p></td>
<td><p>Flow was triggered for AI processing</p></td>
</tr>
</tbody>
</table>
<p><strong>Reference Impact on Actions:</strong></p>
<p>The reference type determines which actions are available:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Reference</span><span class="p">:</span> <span class="n">call</span>                     <span class="n">Reference</span><span class="p">:</span> <span class="n">api</span>
<span class="o">+-------------------------+</span>        <span class="o">+-------------------------+</span>
<span class="o">|</span> <span class="p">(</span><span class="n">check</span><span class="p">)</span> <span class="n">answer</span>          <span class="o">|</span>        <span class="o">|</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">answer</span> <span class="p">(</span><span class="n">no</span> <span class="n">call</span><span class="p">)</span>    <span class="o">|</span>
<span class="o">|</span> <span class="p">(</span><span class="n">check</span><span class="p">)</span> <span class="n">talk</span>            <span class="o">|</span>        <span class="o">|</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">talk</span> <span class="p">(</span><span class="n">no</span> <span class="n">media</span><span class="p">)</span>     <span class="o">|</span>
<span class="o">|</span> <span class="p">(</span><span class="n">check</span><span class="p">)</span> <span class="n">digits_receive</span>  <span class="o">|</span>        <span class="o">|</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">digits_receive</span>      <span class="o">|</span>
<span class="o">|</span> <span class="p">(</span><span class="n">check</span><span class="p">)</span> <span class="n">recording_start</span> <span class="o">|</span>        <span class="o">|</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">recording_start</span>     <span class="o">|</span>
<span class="o">|</span> <span class="p">(</span><span class="n">check</span><span class="p">)</span> <span class="n">message_send</span>    <span class="o">|</span>        <span class="o">|</span> <span class="p">(</span><span class="n">check</span><span class="p">)</span> <span class="n">message_send</span>    <span class="o">|</span>
<span class="o">|</span> <span class="p">(</span><span class="n">check</span><span class="p">)</span> <span class="n">email_send</span>      <span class="o">|</span>        <span class="o">|</span> <span class="p">(</span><span class="n">check</span><span class="p">)</span> <span class="n">email_send</span>      <span class="o">|</span>
<span class="o">|</span> <span class="p">(</span><span class="n">check</span><span class="p">)</span> <span class="n">webhook_send</span>    <span class="o">|</span>        <span class="o">|</span> <span class="p">(</span><span class="n">check</span><span class="p">)</span> <span class="n">webhook_send</span>    <span class="o">|</span>
<span class="o">|</span> <span class="p">(</span><span class="n">check</span><span class="p">)</span> <span class="n">variable_set</span>    <span class="o">|</span>        <span class="o">|</span> <span class="p">(</span><span class="n">check</span><span class="p">)</span> <span class="n">variable_set</span>    <span class="o">|</span>
<span class="o">+-------------------------+</span>        <span class="o">+-------------------------+</span>
</pre></div>
</div>
<p>When an action is not available for the reference type, it is skipped and execution continues to the next action.</p>
</section>
<section id="status-and-control-interface">
<h2>Status and Control interface<a class="headerlink" href="#status-and-control-interface" title="Link to this heading"></a></h2>
<p>The activeflow includes essential status information that allows users to monitor the flow’s progress closely. This information encompasses details about the activeflow’s current state, including completed and pending actions. Additionally, the activeflow offers a control interface that empowers users to manage the execution process. This interface enables actions such as stopping the activeflow at any point and modifying its configuration or parameters as needed.</p>
<p><strong>Control API Endpoints:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+-----------------------------------------------------------------------+</span>
<span class="o">|</span>                    <span class="n">ActiveFlow</span> <span class="n">Control</span> <span class="n">Interface</span>                        <span class="o">|</span>
<span class="o">+-----------------------------------------------------------------------+</span>

<span class="n">GET</span> <span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">activeflows</span><span class="o">/</span><span class="p">{</span><span class="nb">id</span><span class="p">}</span>
<span class="o">+--</span> <span class="n">View</span> <span class="n">current</span> <span class="n">state</span>
<span class="o">+--</span> <span class="n">See</span> <span class="n">current_action</span>
<span class="o">+--</span> <span class="n">Review</span> <span class="n">executed_actions</span>
<span class="o">+--</span> <span class="n">Check</span> <span class="n">variables</span>

<span class="n">POST</span> <span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">activeflows</span><span class="o">/</span><span class="p">{</span><span class="nb">id</span><span class="p">}</span><span class="o">/</span><span class="n">execute</span>
<span class="o">+--</span> <span class="n">Resume</span> <span class="n">a</span> <span class="n">blocked</span> <span class="n">flow</span>
<span class="o">+--</span> <span class="n">Push</span> <span class="n">new</span> <span class="n">actions</span>
<span class="o">+--</span> <span class="n">Continue</span> <span class="n">execution</span>

<span class="n">POST</span> <span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">activeflows</span><span class="o">/</span><span class="p">{</span><span class="nb">id</span><span class="p">}</span><span class="o">/</span><span class="n">stop</span>
<span class="o">+--</span> <span class="n">Immediately</span> <span class="n">stop</span> <span class="n">execution</span>
<span class="o">+--</span> <span class="n">Status</span> <span class="n">changes</span> <span class="n">to</span> <span class="s2">&quot;ended&quot;</span>
<span class="o">+--</span> <span class="n">Triggers</span> <span class="n">on_complete_flow</span> <span class="k">if</span> <span class="nb">set</span>
</pre></div>
</div>
</section>
<section id="activeflow-lifecycle">
<h2>Activeflow Lifecycle<a class="headerlink" href="#activeflow-lifecycle" title="Link to this heading"></a></h2>
<p>The activeflow executes the actions until one of the following conditions is met:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+-----------------------------------------------------------------------+</span>
<span class="o">|</span>                  <span class="n">ActiveFlow</span> <span class="n">Termination</span> <span class="n">Conditions</span>                     <span class="o">|</span>
<span class="o">+-----------------------------------------------------------------------+</span>

<span class="n">Condition</span> <span class="mi">1</span><span class="p">:</span> <span class="n">End</span> <span class="n">of</span> <span class="n">Actions</span>
<span class="o">+---+</span>   <span class="o">+---+</span>   <span class="o">+---+</span>   <span class="o">+---------+</span>
<span class="o">|</span> <span class="mi">1</span> <span class="o">|--&gt;|</span> <span class="mi">2</span> <span class="o">|--&gt;|</span> <span class="mi">3</span> <span class="o">|--&gt;|</span>  <span class="n">DONE</span>   <span class="o">|</span>  <span class="o">-&gt;</span> <span class="n">Status</span><span class="p">:</span> <span class="n">ended</span>
<span class="o">+---+</span>   <span class="o">+---+</span>   <span class="o">+---+</span>   <span class="o">+---------+</span>

<span class="n">Condition</span> <span class="mi">2</span><span class="p">:</span> <span class="n">Stop</span> <span class="n">Action</span>
<span class="o">+---+</span>   <span class="o">+---+</span>   <span class="o">+------+</span>
<span class="o">|</span> <span class="mi">1</span> <span class="o">|--&gt;|</span> <span class="mi">2</span> <span class="o">|--&gt;|</span> <span class="n">stop</span> <span class="o">|</span>  <span class="o">-&gt;</span> <span class="n">Status</span><span class="p">:</span> <span class="n">ended</span>
<span class="o">+---+</span>   <span class="o">+---+</span>   <span class="o">+------+</span>

<span class="n">Condition</span> <span class="mi">3</span><span class="p">:</span> <span class="n">Reference</span> <span class="n">Ends</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="p">,</span> <span class="n">call</span> <span class="n">hangup</span><span class="p">)</span>
<span class="o">+---+</span>   <span class="o">+---+</span>   <span class="o">+---+</span>
<span class="o">|</span> <span class="mi">1</span> <span class="o">|--&gt;|</span> <span class="mi">2</span> <span class="o">|--&gt;|</span> <span class="n">X</span> <span class="o">|</span>  <span class="o">-&gt;</span> <span class="n">Call</span> <span class="n">hangup</span> <span class="o">-&gt;</span> <span class="n">Status</span><span class="p">:</span> <span class="n">ended</span>
<span class="o">+---+</span>   <span class="o">+---+</span>   <span class="o">+---+</span>

<span class="n">Condition</span> <span class="mi">4</span><span class="p">:</span> <span class="n">API</span> <span class="n">Stop</span> <span class="n">Request</span>
<span class="o">+---+</span>   <span class="o">+---+</span>   <span class="o">+---+</span>
<span class="o">|</span> <span class="mi">1</span> <span class="o">|--&gt;|</span> <span class="mi">2</span> <span class="o">|--&gt;|</span> <span class="mi">3</span> <span class="o">|</span>  <span class="o">+</span> <span class="n">POST</span> <span class="o">/</span><span class="n">stop</span> <span class="o">-&gt;</span> <span class="n">Status</span><span class="p">:</span> <span class="n">ended</span>
<span class="o">+---+</span>   <span class="o">+---+</span>   <span class="o">+---+</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Main Service Type Completion:</strong> The activeflow continues executing flow actions until the primary service type is completed. For instance, in the case of a call service, actions will be executed until the call is hung up.</p></li>
<li><p><strong>Stop Action Execution:</strong> Execution ceases if an action with the type “stop” is encountered in the flow.</p></li>
<li><p><strong>User-Initiated Interruption:</strong> Users can actively interrupt their activeflow by sending a POST request to the endpoint: <a class="reference external" href="https://api.voipbin.net/v1/activeflows">https://api.voipbin.net/v1/activeflows</a>/&lt;activeflow-id&gt;/stop.</p></li>
</ul>
</section>
<section id="variable-management">
<h2>Variable Management<a class="headerlink" href="#variable-management" title="Link to this heading"></a></h2>
<p>Each activeflow maintains its own set of variables that persist throughout execution:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+-----------------------------------------------------------------------+</span>
<span class="o">|</span>                    <span class="n">ActiveFlow</span> <span class="n">Variable</span> <span class="n">Storage</span>                         <span class="o">|</span>
<span class="o">+-----------------------------------------------------------------------+</span>

<span class="n">ActiveFlow</span><span class="p">:</span> <span class="n">abc</span><span class="o">-</span><span class="mi">123</span><span class="o">-</span><span class="k">def</span>
<span class="o">+-----------------------------------------------------------------------+</span>
<span class="o">|</span> <span class="n">Variables</span> <span class="n">Map</span>                                                          <span class="o">|</span>
<span class="o">+---------------------------------+-------------------------------------+</span>
<span class="o">|</span> <span class="n">voipbin</span><span class="o">.</span><span class="n">activeflow</span><span class="o">.</span><span class="n">id</span>           <span class="o">|</span> <span class="s2">&quot;abc-123-def&quot;</span>                     <span class="o">|</span>
<span class="o">|</span> <span class="n">voipbin</span><span class="o">.</span><span class="n">activeflow</span><span class="o">.</span><span class="n">reference_id</span> <span class="o">|</span> <span class="s2">&quot;call-456&quot;</span>                        <span class="o">|</span>
<span class="o">|</span> <span class="n">voipbin</span><span class="o">.</span><span class="n">call</span><span class="o">.</span><span class="n">digits</span>             <span class="o">|</span> <span class="s2">&quot;2&quot;</span>                               <span class="o">|</span>
<span class="o">|</span> <span class="n">voipbin</span><span class="o">.</span><span class="n">call</span><span class="o">.</span><span class="n">caller_id</span>          <span class="o">|</span> <span class="s2">&quot;+14155551234&quot;</span>                    <span class="o">|</span>
<span class="o">|</span> <span class="n">customer</span><span class="o">.</span><span class="n">language</span>               <span class="o">|</span> <span class="s2">&quot;en-US&quot;</span>                           <span class="o">|</span>
<span class="o">|</span> <span class="n">customer</span><span class="o">.</span><span class="n">tier</span>                   <span class="o">|</span> <span class="s2">&quot;premium&quot;</span>                         <span class="o">|</span>
<span class="o">+---------------------------------+-------------------------------------+</span>
</pre></div>
</div>
<p><strong>Variable Lifecycle:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>1. Created when activeflow starts (built-in variables)
      |
      v
2. Updated by actions (digits_receive, variable_set, fetch)
      |
      v
3. Read by actions (branch, condition_variable, talk with ${var})
      |
      v
4. Inherited by on_complete_flow (if configured)
      |
      v
5. Preserved in database when activeflow ends
</pre></div>
</div>
</section>
<section id="executed-actions">
<h2>Executed Actions<a class="headerlink" href="#executed-actions" title="Link to this heading"></a></h2>
<p>Within the CPaaS environment, flows can be complex, incorporating various service types such as call, SMS, chat, and more. Handling history logs for these diverse services requires a structured approach.</p>
<p>VoIPBIN simplifies the tracking of executed actions by providing a comprehensive history log within the activeflow. Unlike traditional telephony services with straightforward flows, CPaaS services demand a more flexible approach due to their diverse nature.</p>
<p>In VoIPBIN, each action in the activeflow defines a distinct step in the service’s behavior. This ensures clarity in tracking the sequence of actions performed.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+-----------------------------------------------------------------------+</span>
<span class="o">|</span>                    <span class="n">Executed</span> <span class="n">Actions</span> <span class="n">History</span>                            <span class="o">|</span>
<span class="o">+-----------------------------------------------------------------------+</span>

<span class="n">Time</span> <span class="o">----------------------------------------------------------------------&gt;</span>

<span class="o">+----------+</span>   <span class="o">+----------+</span>   <span class="o">+----------+</span>   <span class="o">+----------+</span>
<span class="o">|</span> <span class="n">answer</span>   <span class="o">|--&gt;|</span> <span class="n">talk</span>     <span class="o">|--&gt;|</span> <span class="n">connect</span>  <span class="o">|--&gt;|</span> <span class="n">message</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">10</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">|</span>   <span class="o">|</span> <span class="mi">10</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">02</span> <span class="o">|</span>   <span class="o">|</span> <span class="mi">10</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">15</span> <span class="o">|</span>   <span class="o">|</span> <span class="mi">10</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">45</span> <span class="o">|</span>
<span class="o">+----------+</span>   <span class="o">+----------+</span>   <span class="o">+----------+</span>   <span class="o">+----------+</span>
     <span class="n">v</span>              <span class="n">v</span>              <span class="n">v</span>              <span class="n">v</span>
<span class="o">+---------------------------------------------------------+</span>
<span class="o">|</span>              <span class="n">executed_actions</span> <span class="n">array</span>                      <span class="o">|</span>
<span class="o">+---------------------------------------------------------+</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;executed_actions&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;connect&quot;</span><span class="p">,</span>
            <span class="s2">&quot;option&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;tel&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;+821021656521&quot;</span>
                <span class="p">},</span>
                <span class="s2">&quot;destinations&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;tel&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;+821021546521&quot;</span>
                    <span class="p">}</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;605f5650-ba92-4dcd-bdac-91fcf6260939&quot;</span><span class="p">,</span>
            <span class="s2">&quot;next_id&quot;</span><span class="p">:</span> <span class="s2">&quot;00000000-0000-0000-0000-000000000000&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;message_send&quot;</span><span class="p">,</span>
            <span class="s2">&quot;option&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;hello, this is a test message.&quot;</span><span class="p">,</span>
                <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;tel&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;+821021656521&quot;</span>
                <span class="p">},</span>
                <span class="s2">&quot;destinations&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;tel&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;+31616818985&quot;</span>
                    <span class="p">}</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>With the detailed information provided in the executed_actions array, customers can easily review and understand the history logs of their CPaaS services.</p>
</section>
<section id="on-complete-flow">
<h2>On Complete Flow<a class="headerlink" href="#on-complete-flow" title="Link to this heading"></a></h2>
<p>When an activeflow ends, it can trigger another flow automatically:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+-----------------------------------------------------------------------+</span>
<span class="o">|</span>                    <span class="n">On</span> <span class="n">Complete</span> <span class="n">Flow</span> <span class="n">Chain</span>                              <span class="o">|</span>
<span class="o">+-----------------------------------------------------------------------+</span>

<span class="n">ActiveFlow</span> <span class="n">A</span>                             <span class="n">ActiveFlow</span> <span class="n">B</span>
<span class="o">+-------------------------+</span>             <span class="o">+-------------------------+</span>
<span class="o">|</span> <span class="n">on_complete_flow_id</span><span class="p">:</span> <span class="n">B</span>  <span class="o">|</span>             <span class="o">|</span> <span class="n">Created</span> <span class="n">automatically</span>   <span class="o">|</span>
<span class="o">|</span>                         <span class="o">|</span>             <span class="o">|</span>                         <span class="o">|</span>
<span class="o">|</span> <span class="n">status</span><span class="p">:</span> <span class="s2">&quot;ended&quot;</span>         <span class="o">|------------&gt;|</span> <span class="n">status</span><span class="p">:</span> <span class="s2">&quot;running&quot;</span>       <span class="o">|</span>
<span class="o">|</span>                         <span class="o">|</span>             <span class="o">|</span>                         <span class="o">|</span>
<span class="o">|</span> <span class="n">Variables</span><span class="p">:</span>              <span class="o">|</span>  <span class="n">inherited</span>  <span class="o">|</span> <span class="n">Variables</span><span class="p">:</span>              <span class="o">|</span>
<span class="o">|</span>   <span class="n">call_id</span><span class="p">:</span> <span class="s2">&quot;123&quot;</span>        <span class="o">|------------&gt;|</span>   <span class="n">call_id</span><span class="p">:</span> <span class="s2">&quot;123&quot;</span>        <span class="o">|</span>
<span class="o">|</span>   <span class="n">recording_id</span><span class="p">:</span> <span class="s2">&quot;456&quot;</span>   <span class="o">|</span>             <span class="o">|</span>   <span class="n">recording_id</span><span class="p">:</span> <span class="s2">&quot;456&quot;</span>   <span class="o">|</span>
<span class="o">+-------------------------+</span>             <span class="o">+-------------------------+</span>
</pre></div>
</div>
<p><strong>Key Behaviors:</strong></p>
<ul class="simple">
<li><p>New activeflow is created with a new ID</p></li>
<li><p>Variables are copied from parent to child</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reference_activeflow_id</span></code> is set to parent’s ID (tracks the chain)</p></li>
<li><p>Maximum chain depth is 5 (prevents infinite loops)</p></li>
</ul>
</section>
<section id="error-handling">
<h2>Error Handling<a class="headerlink" href="#error-handling" title="Link to this heading"></a></h2>
<p>ActiveFlows handle errors gracefully to ensure reliable execution:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+-----------------------------------------------------------------------+</span>
<span class="o">|</span>                    <span class="n">Error</span> <span class="n">Handling</span> <span class="n">Scenarios</span>                            <span class="o">|</span>
<span class="o">+-----------------------------------------------------------------------+</span>

<span class="n">Scenario</span><span class="p">:</span> <span class="n">Action</span> <span class="n">fails</span>
<span class="o">+---+</span>   <span class="o">+---+</span>   <span class="o">+-----+</span>   <span class="o">+---+</span>
<span class="o">|</span> <span class="mi">1</span> <span class="o">|--&gt;|</span> <span class="mi">2</span> <span class="o">|--&gt;|</span> <span class="n">ERR</span> <span class="o">|--&gt;|</span> <span class="mi">4</span> <span class="o">|</span>  <span class="p">(</span><span class="n">skip</span> <span class="n">failed</span> <span class="n">action</span><span class="p">,</span> <span class="k">continue</span><span class="p">)</span>
<span class="o">+---+</span>   <span class="o">+---+</span>   <span class="o">+-----+</span>   <span class="o">+---+</span>

<span class="n">Scenario</span><span class="p">:</span> <span class="n">Critical</span> <span class="n">failure</span>
<span class="o">+---+</span>   <span class="o">+---+</span>   <span class="o">+-----+</span>
<span class="o">|</span> <span class="mi">1</span> <span class="o">|--&gt;|</span> <span class="mi">2</span> <span class="o">|--&gt;|</span> <span class="n">ERR</span> <span class="o">|</span>  <span class="o">-&gt;</span> <span class="n">Status</span><span class="p">:</span> <span class="n">ended</span> <span class="p">(</span><span class="n">flow</span> <span class="n">stops</span><span class="p">)</span>
<span class="o">+---+</span>   <span class="o">+---+</span>   <span class="o">+-----+</span>

<span class="n">Scenario</span><span class="p">:</span> <span class="n">Max</span> <span class="n">iterations</span> <span class="n">exceeded</span>
<span class="o">+---+</span>   <span class="o">+---+</span>   <span class="o">+---+</span>   <span class="o">+---+</span>
<span class="o">|</span> <span class="mi">1</span> <span class="o">|&lt;-&gt;|</span> <span class="mi">2</span> <span class="o">|&lt;-&gt;|</span> <span class="mi">3</span> <span class="o">|&lt;-&gt;|</span> <span class="n">X</span> <span class="o">|</span>  <span class="o">-&gt;</span> <span class="n">Infinite</span> <span class="n">loop</span> <span class="n">detected</span><span class="p">,</span> <span class="n">stop</span>
<span class="o">+---+</span>   <span class="o">+---+</span>   <span class="o">+---+</span>   <span class="o">+---+</span>
</pre></div>
</div>
<p><strong>Safety Limits:</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Limit</p></th>
<th class="head"><p>Value</p></th>
<th class="head"><p>Purpose</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Max iterations per cycle</p></td>
<td><p>1000</p></td>
<td><p>Prevents infinite loops in goto/branch</p></td>
</tr>
<tr class="row-odd"><td><p>Max total execute calls</p></td>
<td><p>100</p></td>
<td><p>Prevents runaway execution</p></td>
</tr>
<tr class="row-even"><td><p>Max on_complete chain depth</p></td>
<td><p>5</p></td>
<td><p>Prevents infinite flow chaining</p></td>
</tr>
</tbody>
</table>
</section>
<section id="common-use-cases">
<h2>Common Use Cases<a class="headerlink" href="#common-use-cases" title="Link to this heading"></a></h2>
<p><strong>Use Case 1: IVR Menu with History Tracking</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+--------------------------------------------------------------------+</span>
<span class="o">|</span> <span class="n">executed_actions</span> <span class="n">shows</span> <span class="n">the</span> <span class="n">complete</span> <span class="n">journey</span><span class="p">:</span>                        <span class="o">|</span>
<span class="o">|</span>                                                                     <span class="o">|</span>
<span class="o">|</span> <span class="mf">1.</span> <span class="n">answer</span> <span class="o">--&gt;</span> <span class="mf">2.</span> <span class="n">talk</span> <span class="s2">&quot;Welcome&quot;</span> <span class="o">--&gt;</span> <span class="mf">3.</span> <span class="n">digits</span> <span class="s2">&quot;2&quot;</span> <span class="o">--&gt;</span> <span class="mf">4.</span> <span class="n">branch</span>    <span class="o">|</span>
<span class="o">|</span>      <span class="o">--&gt;</span> <span class="mf">5.</span> <span class="n">talk</span> <span class="s2">&quot;Support&quot;</span> <span class="o">--&gt;</span> <span class="mf">6.</span> <span class="n">queue_join</span> <span class="o">--&gt;</span> <span class="mf">7.</span> <span class="n">connect</span> <span class="n">agent</span>  <span class="o">|</span>
<span class="o">+--------------------------------------------------------------------+</span>
</pre></div>
</div>
<p><strong>Use Case 2: Post-Call Processing</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Call</span> <span class="n">Flow</span> <span class="n">ActiveFlow</span>                <span class="n">After</span> <span class="n">Call</span> <span class="n">Work</span> <span class="n">ActiveFlow</span>
<span class="o">+----------------------+</span>           <span class="o">+------------------------------+</span>
<span class="o">|</span> <span class="n">answer</span>               <span class="o">|</span>           <span class="o">|</span> <span class="n">fetch</span> <span class="n">recording</span>              <span class="o">|</span>
<span class="o">|</span> <span class="n">talk</span>                 <span class="o">|</span>           <span class="o">|</span> <span class="n">ai_summarize</span>                 <span class="o">|</span>
<span class="o">|</span> <span class="n">connect</span> <span class="n">to</span> <span class="n">agent</span>     <span class="o">|</span>           <span class="o">|</span> <span class="n">webhook_send</span> <span class="n">summary</span>         <span class="o">|</span>
<span class="o">|</span> <span class="p">(</span><span class="n">call</span> <span class="n">ends</span><span class="p">)</span>          <span class="o">|----------&gt;|</span> <span class="n">email_send</span> <span class="n">transcript</span>        <span class="o">|</span>
<span class="o">|</span>                      <span class="o">|</span>           <span class="o">|</span>                              <span class="o">|</span>
<span class="o">|</span> <span class="n">on_complete</span><span class="p">:</span> <span class="s2">&quot;acw&quot;</span>   <span class="o">|</span>           <span class="o">|</span> <span class="n">Inherits</span><span class="p">:</span> <span class="n">recording_id</span><span class="p">,</span>      <span class="o">|</span>
<span class="o">+----------------------+</span>           <span class="o">|</span>           <span class="n">call_id</span>            <span class="o">|</span>
                                   <span class="o">+------------------------------+</span>
</pre></div>
</div>
<p><strong>Use Case 3: Debugging Flow Execution</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">GET</span> <span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">activeflows</span><span class="o">/</span><span class="p">{</span><span class="nb">id</span><span class="p">}</span>

<span class="n">Response</span> <span class="n">shows</span><span class="p">:</span>
<span class="p">{</span>
    <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;running&quot;</span><span class="p">,</span>
    <span class="s2">&quot;current_action&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;digits_receive&quot;</span><span class="p">,</span>
        <span class="s2">&quot;option&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;duration&quot;</span><span class="p">:</span> <span class="mi">5000</span> <span class="p">}</span>
    <span class="p">},</span>
    <span class="s2">&quot;executed_actions&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;answer&quot;</span><span class="p">,</span> <span class="o">...</span> <span class="p">},</span>
        <span class="p">{</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;talk&quot;</span><span class="p">,</span> <span class="s2">&quot;option&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Welcome&quot;</span> <span class="p">}</span> <span class="p">}</span>
    <span class="p">],</span>
    <span class="s2">&quot;variables&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;voipbin.call.caller_id&quot;</span><span class="p">:</span> <span class="s2">&quot;+14155551234&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="o">-&gt;</span> <span class="n">You</span> <span class="n">can</span> <span class="n">see</span> <span class="n">exactly</span> <span class="n">where</span> <span class="n">the</span> <span class="n">flow</span> <span class="ow">is</span> <span class="ow">and</span> <span class="n">what</span> <span class="n">has</span> <span class="n">happened</span>
</pre></div>
</div>
</section>
</section>

</main>
                        
                    </div>
                    
                    <nav class="col-12 col-lg-3 pb-4">
                        <div class="sticky-top toc page-toc" aria-labelledby="page-toc-heading">
                            <p class="font-weight-bold" id="page-toc-heading">Page contents</p>
                            <ul>
<li><a class="reference internal" href="#">Overview</a><ul>
<li><a class="reference internal" href="#flow-vs-activeflow">Flow vs ActiveFlow</a></li>
<li><a class="reference internal" href="#activeflow-states">ActiveFlow States</a></li>
<li><a class="reference internal" href="#execution">Execution</a></li>
<li><a class="reference internal" href="#how-the-cursor-works">How the Cursor Works</a></li>
<li><a class="reference internal" href="#stack-based-execution">Stack-Based Execution</a></li>
<li><a class="reference internal" href="#reference-types">Reference Types</a></li>
<li><a class="reference internal" href="#status-and-control-interface">Status and Control interface</a></li>
<li><a class="reference internal" href="#activeflow-lifecycle">Activeflow Lifecycle</a></li>
<li><a class="reference internal" href="#variable-management">Variable Management</a></li>
<li><a class="reference internal" href="#executed-actions">Executed Actions</a></li>
<li><a class="reference internal" href="#on-complete-flow">On Complete Flow</a></li>
<li><a class="reference internal" href="#error-handling">Error Handling</a></li>
<li><a class="reference internal" href="#common-use-cases">Common Use Cases</a></li>
</ul>
</li>
</ul>

                        </div>
                    </nav>
                    
                </div>
            </div>
        </div>
    </div>
    <footer class="container-fluid bg-primary text-light">
        <div class="container">
            <div class="row">
        <div class="col p-4">
            
                <nav aria-label="Footer">
                    <ul class="nav justify-content-center mb-2">
                        
                            
                            
                            <li class="nav-item"><a class="nav-link text-light"  href="http://voipbin.net">About Us</a></li>
                        
                            
                            
                            <li class="nav-item"><a class="nav-link text-light"  href="http://voipbin.net">Contact</a></li>
                        
                    </ul>
                </nav>
            
            <div class="text-center">
                    &copy; Copyright 2024, Sungtae Kim
            </div>
            <div class="text-center text-white-50 font-italic mt-3">
                <small>
                    Created using
                    <a class="text-white" href="https://github.com/wagtail/sphinx_wagtail_theme" rel="nofollow" target="_blank">
                        Sphinx Wagtail Theme 6.5.0
                    </a>
                    and
                    <a class="text-white" href="https://www.sphinx-doc.org/" rel="nofollow" target="_blank">
                        Sphinx 9.1.0
                    </a>
                </small>
            </div>
        </div>
    </div>
        </div>
    </footer>
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=5929fcd5"></script>
        <script src="_static/doctools.js?v=fd6eb6e6"></script>
        <script src="_static/sphinx_highlight.js?v=6ffebe34"></script>
        <script src="_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="_static/copybutton.js?v=f281be69"></script>
        <script type="text/javascript" src="_static/dist/theme.js"></script>
        <script type="text/javascript" src="_static/dist/vendor.js"></script>
        <script type="text/javascript" src="_static/searchtools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script type="text/javascript">
            document.addEventListener('DOMContentLoaded', function() { Search.loadIndex("searchindex.js"); });
        </script>
        <script type="text/javascript" id="searchindexloader"></script>
    </body>
</html>