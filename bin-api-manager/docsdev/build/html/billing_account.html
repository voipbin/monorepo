<!DOCTYPE html>
<html class="no-js" lang="en" data-content_root="./">
<head>
    <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
        <title>Billing Account &mdash; voipbin  documentation</title>
    
    <link rel="stylesheet" type="text/css" href="_static/dist/fontawesome.css" />
      <link rel="stylesheet" type="text/css" href="_static/dist/theme.css?v=310cf088" />
      <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
            <link rel="index" title="Index" href="genindex.html" />
            <link rel="search" title="Search" href="search.html" />
            <link rel="top" title="voipbin  documentation" href="#" />
            <link rel="next" title="Storage" href="storage.html" />
            <link rel="prev" title="Customer" href="customer.html" />
    </head>
<body>
    <script type="text/javascript" src="_static/dist/blocking.js"></script>
    <header class="container-fluid bg-primary">
        <a class="btn btn-sm btn-light skip-to-content-link" href="#main">Skip to content</a>
        <div class="container-fluid">
            <div class="navbar navbar-expand-lg navbar-dark font-weight-bold">
                    <a href="intro.html"
                        title="voipbin"
                        class="logo navbar-brand"
                    >
                        <img src="_static/images/voipbin-high-resolution-logo-white-transparent.png" width="45" height="80" alt="voipbin"
                            class="logo-img"
                        />
                        VoIPBin Documentation
                    </a>
                
                
                    <div class="collapse navbar-collapse justify-content-end">
                        <ul class="navbar-nav">
                            
                                
                                
                                <li class="nav-item"><a class="nav-link"  href="http://voipbin.net">Project</a></li>
                            
                                
                                
                                <li class="nav-item"><a class="nav-link"  href="https://admin.voipbin.net">Admin</a></li>
                            
                        </ul>
                    </div>
                
                <button class="navbar-toggler btn btn-primary d-lg-none" type="button" data-toggle="collapse" data-target="#collapseSidebar" aria-expanded="false" aria-controls="collapseExample">
                    <span class="navbar-toggler-icon"></span>
                    <span class="sr-only">menu</span>
                </button>
            </div>
        </div>
    </header>
    <div class="container-fluid">
        <div class="row">
            <aside class="col-12 col-lg-3 sidebar-container">
                <div id="collapseSidebar" class="collapse sticky-top d-lg-block pt-5 pr-lg-4">
<div id="searchbox" class="searchbox mb-6 px-1" role="search">
    <form id="search-form" action="search.html" autocomplete="off" method="get" role="search">
        <div class="input-group">
            <div class="input-group-prepend">
                <div class="input-group-text border-right-0 bg-white py-3 pl-3 pr-2"><span class="fas fa-search"></span></div>
            </div>
            <input class="form-control py-3 pr-3 pl-1 h-100 border-left-0" type="search" name="q" placeholder="Search documentation" aria-label="Search documentation" id="searchinput" />
        </div>
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
    </form>
</div><div class="site-toc">
    <nav class="toc mt-3" aria-label="Main menu">
        <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="accesskey.html">Accesskey</a></li>
<li class="toctree-l1"><a class="reference internal" href="sdk.html">SDK(Software Development Kit)</a></li>
<li class="toctree-l1"><a class="reference internal" href="restful_api.html">RESTful API(Application Programming Interface)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Core Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="flow.html">Flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="flow.html#activeflow">Activeflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="variable.html">Variable</a></li>
<li class="toctree-l1"><a class="reference internal" href="webhook.html">Webhook</a></li>
<li class="toctree-l1"><a class="reference internal" href="common.html">Common</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Voice &amp; Real-Time</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="call.html">Call</a></li>
<li class="toctree-l1"><a class="reference internal" href="conference.html">Conference</a></li>
<li class="toctree-l1"><a class="reference internal" href="queue.html">Queue</a></li>
<li class="toctree-l1"><a class="reference internal" href="recording.html">Recording</a></li>
<li class="toctree-l1"><a class="reference internal" href="transcribe.html">Transcribe</a></li>
<li class="toctree-l1"><a class="reference internal" href="mediastream.html">Mediastream</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Messaging</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="message.html">Message</a></li>
<li class="toctree-l1"><a class="reference internal" href="email.html">Email</a></li>
<li class="toctree-l1"><a class="reference internal" href="talk.html">Talk</a></li>
<li class="toctree-l1"><a class="reference internal" href="conversation.html">Conversation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">AI &amp; Automation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="ai.html">AI</a></li>
<li class="toctree-l1"><a class="reference internal" href="campaign.html">Campaign</a></li>
<li class="toctree-l1"><a class="reference internal" href="outdial.html">Outdial</a></li>
<li class="toctree-l1"><a class="reference internal" href="outplan.html">Outplan</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Resources &amp; Management</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="number.html">Number</a></li>
<li class="toctree-l1"><a class="reference internal" href="agent.html">Agent</a></li>
<li class="toctree-l1"><a class="reference internal" href="contact.html">Contact</a></li>
<li class="toctree-l1"><a class="reference internal" href="customer.html">Customer</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Billing Account</a></li>
<li class="toctree-l1"><a class="reference internal" href="storage.html">Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="tag.html">Tag</a></li>
<li class="toctree-l1"><a class="reference internal" href="provider.html">Provider</a></li>
<li class="toctree-l1"><a class="reference internal" href="route.html">Route</a></li>
<li class="toctree-l1"><a class="reference internal" href="extension.html">Extension</a></li>
<li class="toctree-l1"><a class="reference internal" href="trunk.html">Trunk</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Architecture (Deep Dive)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="websocket.html">Websocket</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Help &amp; Support</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="support.html">Support</a></li>
</ul>

    </nav>
    <template data-toggle-item-template>
        <button class="btn btn-sm btn-link toctree-expand" type="button">
            <span class="sr-only">Toggle menu contents</span>
        </button>
    </template>
</div>
                    <div class="d-lg-none border-bottom">
                        
                    </div>
                </div>
            </aside>
            <div class="col-12 col-lg-9 pt-5">
                <header class="row align-items-baseline">
                    <div class="col">
                        <nav aria-label="breadcrumb">
    <ol class="breadcrumb m-0 p-0 bg-transparent">
        <li class="breadcrumb-item"><a href="index.html">Docs</a></li>
        <li class="breadcrumb-item active" aria-current="page">Billing Account</li>
    </ol>
</nav>
                    </div>
                    <div class="col-sm-12 col-lg-auto mt-3 mt-lg-3">
                        <noscript>
                            <p>JavaScript is required to toggle light/dark mode..</p>
                        </noscript>
                        <button id="wagtail-theme" class="btn btn-sm btn-light text-decoration-none" type="button">
                            <span class="dark-only"><i class="fas fa-sun"></i> Light mode</span>
                            <span class="light-only"><i class="fas fa-moon"></i> Dark mode</span>
                        </button>
    <a class="btn btn-sm btn-light text-decoration-none" href="_sources/billing_account.rst.txt" rel="nofollow">
        <span class="btn-icon"><span class="fas fa-code"></span></span>
        <span class="btn-text">View source</span>
    </a>
                        
                    </div>
                </header>
                <div class="row" >
                    <div class="col-12">
                        <hr class="w-100 my-4">
                    </div>
                </div>
                <div class="row">
                    <div class="col-12 col-lg-9 order-last order-lg-first rst-content">
                        <main role="main" id="main">
    <section id="billing-account">
<h1>Billing Account<a class="headerlink" href="#billing-account" title="Link to this heading"></a></h1>
<p>Manage account billing, balance tracking, and credit usage. Billing accounts hold the prepaid credit balance that is consumed by chargeable operations such as calls, messages, and number purchases.</p>
<p><strong>API Reference:</strong> <a class="reference external" href="https://api.voipbin.net/redoc/#tag/Billing">Billing endpoints</a></p>
<section id="overview">
<span id="billing-account-overview"></span><h2>Overview<a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>AI Context</strong></p>
<ul class="simple">
<li><p><strong>Complexity:</strong> Medium</p></li>
<li><p><strong>Cost:</strong> Free (reading billing data incurs no charges; adding balance is an admin-only operation)</p></li>
<li><p><strong>Async:</strong> No. All billing account operations are synchronous and return immediately. Balance changes from service usage (calls, SMS) happen asynchronously as services are consumed.</p></li>
</ul>
</div>
<p>VoIPBIN’s Billing Account API provides balance management, token tracking, and usage monitoring for your account. The billing system uses a State+Ledger architecture where the <strong>account</strong> holds the live state (current balance and tokens) and the <strong>billings</strong> table records every transaction as an immutable ledger entry with signed deltas and post-transaction snapshots.</p>
<p>With the Billing Account API you can:</p>
<ul class="simple">
<li><p>Check current credit balance and token balance</p></li>
<li><p>View billing history as a ledger of transactions</p></li>
<li><p>Add funds to your account (admin only)</p></li>
<li><p>View rate information for different service types</p></li>
<li><p>Monitor usage and charges</p></li>
<li><p>Track all transactions via the immutable billing ledger</p></li>
</ul>
<section id="how-billing-works">
<h3>How Billing Works<a class="headerlink" href="#how-billing-works" title="Link to this heading"></a></h3>
<p>VoIPBIN uses a hybrid billing model with two cost mechanisms: <strong>token balance</strong> and <strong>credit balance</strong>.</p>
<p>Each plan tier includes a monthly allocation of tokens that cover certain service types (virtual number calls and SMS). When tokens are exhausted, usage overflows to the credit balance. PSTN calls and number purchases are always charged to the credit balance.</p>
<p>All monetary values are stored as <strong>int64 micros</strong> (1 USD = 1,000,000 micros) to prevent floating-point rounding errors.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>AI Implementation Hint</strong></p>
<p>The <code class="docutils literal notranslate"><span class="pre">balance_credit</span></code> field is in micros (int64), not dollars. To convert: divide by 1,000,000 for USD (e.g., <code class="docutils literal notranslate"><span class="pre">69772630</span></code> micros = $69.77). When displaying balance to users, always convert from micros to the currency unit. When estimating costs, multiply the rate in micros by the number of billable units.</p>
</div>
<p><strong>Billing Architecture</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>+-----------------------------------------------------------------------+
|                     State + Ledger Architecture                       |
+-----------------------------------------------------------------------+

+-------------------+     +-------------------+
|  Account (State)  |     |  Billings (Ledger)|
|  balance_token    |     |  Immutable entries |
|  balance_credit   |     |  with deltas and   |
+--------+----------+     |  snapshots         |
         |                +--------+----------+
         |                         |
         | live state              | transaction history
         v                         v
+--------+----------+     +--------+----------+
|                   |     |                   |
v                   v     v                   v
+----------+   +----------+   +----------+   +----------+
| VN Calls |   |   SMS    |   |PSTN Calls|   | Numbers  |
| 1 tok/min|   |10 tok/msg|   | per min  |   | per num  |
+----------+   +----------+   +----------+   +----------+
     |              |              |              |
     | token first  | token first  |              |
     | then credit  | then credit  | credit only  | credit only
     v              v              v              v
+---------+    +---------+    +---------+    +---------+
|$0.001   |    | $0.008  |    |$0.006 ot|    |  $5.00  |
| /minute |    | /message|    |$0.0045 in|   | /number |
+---------+    +---------+    +---------+    +---------+
</pre></div>
</div>
<p><strong>Key Components</strong></p>
<ul class="simple">
<li><p><strong>Account State</strong>: The <code class="docutils literal notranslate"><span class="pre">billing_accounts</span></code> table holds the live <code class="docutils literal notranslate"><span class="pre">balance_credit</span></code> (int64 micros) and <code class="docutils literal notranslate"><span class="pre">balance_token</span></code> (int64). This is the single source of truth for current balances.</p></li>
<li><p><strong>Billing Ledger</strong>: The <code class="docutils literal notranslate"><span class="pre">billing_billings</span></code> table records every transaction as an immutable entry with signed deltas (<code class="docutils literal notranslate"><span class="pre">amount_token</span></code>, <code class="docutils literal notranslate"><span class="pre">amount_credit</span></code>) and post-transaction snapshots (<code class="docutils literal notranslate"><span class="pre">balance_token_snapshot</span></code>, <code class="docutils literal notranslate"><span class="pre">balance_credit_snapshot</span></code>).</p></li>
<li><p><strong>Monthly Token Top-Up</strong>: Tokens are replenished monthly via a cron-driven top-up process. The top-up is recorded as a <code class="docutils literal notranslate"><span class="pre">top_up</span></code> transaction in the ledger.</p></li>
<li><p><strong>Token-Eligible Services</strong>: VN calls (1 token/minute) and SMS (10 tokens/message) consume tokens first, then overflow to credits.</p></li>
<li><p><strong>Credit-Only Services</strong>: PSTN calls and number purchases always use credits directly.</p></li>
<li><p><strong>Free Services</strong>: Extension-to-extension calls and direct extension calls incur no charges.</p></li>
</ul>
<p><strong>Token Top-Up Process</strong></p>
<p>Token replenishment happens via an automated monthly cron process:</p>
<ol class="arabic simple">
<li><p><strong>Selection</strong>: The system selects accounts where <code class="docutils literal notranslate"><span class="pre">tm_next_topup</span> <span class="pre">&lt;=</span> <span class="pre">NOW()</span></code>.</p></li>
<li><p><strong>State Update</strong>: The account’s <code class="docutils literal notranslate"><span class="pre">balance_token</span></code> is set to the plan’s allocation. <code class="docutils literal notranslate"><span class="pre">tm_last_topup</span></code> and <code class="docutils literal notranslate"><span class="pre">tm_next_topup</span></code> are updated.</p></li>
<li><p><strong>Ledger Entry</strong>: A billing record is inserted with <code class="docutils literal notranslate"><span class="pre">transaction_type:</span> <span class="pre">top_up</span></code> and <code class="docutils literal notranslate"><span class="pre">reference_type:</span> <span class="pre">monthly_allowance</span></code>, recording the positive token delta and the resulting balance snapshot.</p></li>
</ol>
<p>The <code class="docutils literal notranslate"><span class="pre">tm_next_topup</span></code> field on the account indicates when the next top-up is scheduled.</p>
</section>
<section id="plan-tiers">
<h3>Plan Tiers<a class="headerlink" href="#plan-tiers" title="Link to this heading"></a></h3>
<p>Each billing account is assigned a plan tier that determines both resource creation limits and monthly token allocations. New accounts default to the <strong>free</strong> tier.</p>
<p><strong>Monthly Token Allocations</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Plan</p></th>
<th class="head"><p>Free</p></th>
<th class="head"><p>Basic</p></th>
<th class="head"><p>Professional</p></th>
<th class="head"><p>Unlimited</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Tokens per month</p></td>
<td><p>100</p></td>
<td><p>1,000</p></td>
<td><p>10,000</p></td>
<td><p>unlimited</p></td>
</tr>
</tbody>
</table>
<p>Tokens are replenished at the scheduled top-up date. The current token balance is available in the <code class="docutils literal notranslate"><span class="pre">balance_token</span></code> field of the account.</p>
<p><strong>Resource Limits</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Resource</p></th>
<th class="head"><p>Free</p></th>
<th class="head"><p>Basic</p></th>
<th class="head"><p>Professional</p></th>
<th class="head"><p>Unlimited</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Extensions</p></td>
<td><p>5</p></td>
<td><p>50</p></td>
<td><p>500</p></td>
<td><p>unlimited</p></td>
</tr>
<tr class="row-odd"><td><p>Agents</p></td>
<td><p>5</p></td>
<td><p>50</p></td>
<td><p>500</p></td>
<td><p>unlimited</p></td>
</tr>
<tr class="row-even"><td><p>Queues</p></td>
<td><p>2</p></td>
<td><p>10</p></td>
<td><p>100</p></td>
<td><p>unlimited</p></td>
</tr>
<tr class="row-odd"><td><p>Conferences</p></td>
<td><p>2</p></td>
<td><p>10</p></td>
<td><p>100</p></td>
<td><p>unlimited</p></td>
</tr>
<tr class="row-even"><td><p>Trunks</p></td>
<td><p>1</p></td>
<td><p>5</p></td>
<td><p>50</p></td>
<td><p>unlimited</p></td>
</tr>
<tr class="row-odd"><td><p>Virtual Numbers</p></td>
<td><p>5</p></td>
<td><p>50</p></td>
<td><p>500</p></td>
<td><p>unlimited</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>When a resource limit is reached, further creation of that resource type is denied.</p></li>
<li><p>Only platform admins can change a customer’s plan tier.</p></li>
<li><p>The current plan tier is returned in the <code class="docutils literal notranslate"><span class="pre">plan_type</span></code> field of the billing account.</p></li>
</ul>
</section>
<section id="rate-structure">
<span id="billing-account-rate-structure"></span><h3>Rate Structure<a class="headerlink" href="#rate-structure" title="Link to this heading"></a></h3>
<p>VoIPBIN uses per-minute billing for calls (rounded up to the next whole minute) and per-unit billing for other services.</p>
<p><strong>Token Rates</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Service</p></th>
<th class="head"><p>Token Cost</p></th>
<th class="head"><p>Unit</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>VN Calls</p></td>
<td><p>1 token</p></td>
<td><p>Per minute (ceiling-rounded)</p></td>
</tr>
<tr class="row-odd"><td><p>SMS Messages</p></td>
<td><p>10 tokens</p></td>
<td><p>Per message</p></td>
</tr>
</tbody>
</table>
<p><strong>Credit Rates (Overflow and Credit-Only)</strong></p>
<p>All credit rates are stored internally as int64 micros.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Service</p></th>
<th class="head"><p>Rate (USD)</p></th>
<th class="head"><p>Rate (micros)</p></th>
<th class="head"><p>Unit</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>VN Calls (overflow)</p></td>
<td><p>$0.001</p></td>
<td><p>1,000</p></td>
<td><p>Per minute</p></td>
</tr>
<tr class="row-odd"><td><p>PSTN Outgoing Calls</p></td>
<td><p>$0.0060</p></td>
<td><p>6,000</p></td>
<td><p>Per minute</p></td>
</tr>
<tr class="row-even"><td><p>PSTN Incoming Calls</p></td>
<td><p>$0.0045</p></td>
<td><p>4,500</p></td>
<td><p>Per minute</p></td>
</tr>
<tr class="row-odd"><td><p>SMS (overflow)</p></td>
<td><p>$0.008</p></td>
<td><p>8,000</p></td>
<td><p>Per message</p></td>
</tr>
<tr class="row-even"><td><p>Number Purchase</p></td>
<td><p>$5.00</p></td>
<td><p>5,000,000</p></td>
<td><p>Per number</p></td>
</tr>
<tr class="row-odd"><td><p>Number Renewal</p></td>
<td><p>$5.00</p></td>
<td><p>5,000,000</p></td>
<td><p>Per number</p></td>
</tr>
<tr class="row-even"><td><p>Extension Calls</p></td>
<td><p>Free</p></td>
<td><p>0</p></td>
<td><p>No charge</p></td>
</tr>
</tbody>
</table>
<p><strong>How Token Consumption Works</strong></p>
<p>When a token-eligible service is used (VN call or SMS):</p>
<ol class="arabic simple">
<li><p>The system checks the account’s <code class="docutils literal notranslate"><span class="pre">balance_token</span></code>.</p></li>
<li><p>If tokens are available, they are consumed first.</p></li>
<li><p>If tokens are partially available, the available tokens are consumed and the remainder overflows to credits.</p></li>
<li><p>If no tokens remain, the full cost is charged to credits.</p></li>
</ol>
<p>Each transaction is recorded in the billing ledger with the token and credit amounts as signed deltas.</p>
<p><strong>Rate Calculation Examples</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">VN</span> <span class="n">Call</span> <span class="p">(</span><span class="mi">2</span> <span class="n">minutes</span> <span class="mi">15</span> <span class="n">seconds</span><span class="p">)</span> <span class="k">with</span> <span class="n">tokens</span> <span class="n">available</span><span class="p">:</span>
<span class="o">+--------------------------------------------+</span>
<span class="o">|</span> <span class="n">Duration</span><span class="p">:</span> <span class="mi">2</span> <span class="nb">min</span> <span class="mi">15</span> <span class="n">sec</span> <span class="o">-&gt;</span> <span class="mi">3</span> <span class="n">minutes</span>        <span class="o">|</span>
<span class="o">|</span> <span class="p">(</span><span class="n">ceiling</span><span class="o">-</span><span class="n">rounded</span> <span class="n">to</span> <span class="nb">next</span> <span class="n">whole</span> <span class="n">minute</span><span class="p">)</span>      <span class="o">|</span>
<span class="o">|</span> <span class="n">Token</span> <span class="n">cost</span><span class="p">:</span> <span class="mi">3</span> <span class="n">x</span> <span class="mi">1</span> <span class="o">=</span> <span class="mi">3</span> <span class="n">tokens</span>               <span class="o">|</span>
<span class="o">|</span> <span class="n">Credit</span> <span class="n">cost</span><span class="p">:</span> <span class="mi">0</span> <span class="n">micros</span> <span class="p">(</span><span class="n">covered</span> <span class="n">by</span> <span class="n">tokens</span><span class="p">)</span>   <span class="o">|</span>
<span class="o">|</span> <span class="n">Ledger</span> <span class="n">entry</span><span class="p">:</span>                               <span class="o">|</span>
<span class="o">|</span>   <span class="n">amount_token</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span>                          <span class="o">|</span>
<span class="o">|</span>   <span class="n">amount_credit</span><span class="p">:</span> <span class="mi">0</span>                          <span class="o">|</span>
<span class="o">+--------------------------------------------+</span>

<span class="n">VN</span> <span class="n">Call</span> <span class="p">(</span><span class="mi">5</span> <span class="n">minutes</span><span class="p">)</span> <span class="k">with</span> <span class="n">NO</span> <span class="n">tokens</span> <span class="n">remaining</span><span class="p">:</span>
<span class="o">+--------------------------------------------+</span>
<span class="o">|</span> <span class="n">Duration</span><span class="p">:</span> <span class="mi">5</span> <span class="n">minutes</span>                         <span class="o">|</span>
<span class="o">|</span> <span class="n">Token</span> <span class="n">cost</span><span class="p">:</span> <span class="mi">0</span> <span class="p">(</span><span class="n">exhausted</span><span class="p">)</span>                   <span class="o">|</span>
<span class="o">|</span> <span class="n">Credit</span> <span class="n">cost</span><span class="p">:</span> <span class="mi">5</span> <span class="n">x</span> <span class="mi">1</span><span class="p">,</span><span class="mi">000</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span><span class="mi">000</span> <span class="n">micros</span>      <span class="o">|</span>
<span class="o">|</span> <span class="n">Ledger</span> <span class="n">entry</span><span class="p">:</span>                               <span class="o">|</span>
<span class="o">|</span>   <span class="n">amount_token</span><span class="p">:</span> <span class="mi">0</span>                           <span class="o">|</span>
<span class="o">|</span>   <span class="n">amount_credit</span><span class="p">:</span> <span class="o">-</span><span class="mi">5000</span>                      <span class="o">|</span>
<span class="o">+--------------------------------------------+</span>

<span class="n">PSTN</span> <span class="n">Outgoing</span> <span class="n">Call</span> <span class="p">(</span><span class="mi">2</span> <span class="n">minutes</span> <span class="mi">30</span> <span class="n">seconds</span><span class="p">):</span>
<span class="o">+--------------------------------------------+</span>
<span class="o">|</span> <span class="n">Duration</span><span class="p">:</span> <span class="mi">2</span> <span class="nb">min</span> <span class="mi">30</span> <span class="n">sec</span> <span class="o">-&gt;</span> <span class="mi">3</span> <span class="n">minutes</span>        <span class="o">|</span>
<span class="o">|</span> <span class="p">(</span><span class="n">ceiling</span><span class="o">-</span><span class="n">rounded</span> <span class="n">to</span> <span class="nb">next</span> <span class="n">whole</span> <span class="n">minute</span><span class="p">)</span>      <span class="o">|</span>
<span class="o">|</span> <span class="n">Credit</span> <span class="n">cost</span><span class="p">:</span> <span class="mi">3</span> <span class="n">x</span> <span class="mi">6</span><span class="p">,</span><span class="mi">000</span> <span class="o">=</span> <span class="mi">18</span><span class="p">,</span><span class="mi">000</span> <span class="n">micros</span>     <span class="o">|</span>
<span class="o">|</span> <span class="n">Ledger</span> <span class="n">entry</span><span class="p">:</span>                               <span class="o">|</span>
<span class="o">|</span>   <span class="n">amount_token</span><span class="p">:</span> <span class="mi">0</span>                           <span class="o">|</span>
<span class="o">|</span>   <span class="n">amount_credit</span><span class="p">:</span> <span class="o">-</span><span class="mi">18000</span>                     <span class="o">|</span>
<span class="o">+--------------------------------------------+</span>

<span class="n">Monthly</span> <span class="n">Token</span> <span class="n">Top</span><span class="o">-</span><span class="n">Up</span> <span class="p">(</span><span class="n">Free</span> <span class="n">plan</span><span class="p">):</span>
<span class="o">+--------------------------------------------+</span>
<span class="o">|</span> <span class="n">Transaction</span> <span class="nb">type</span><span class="p">:</span> <span class="n">top_up</span>                    <span class="o">|</span>
<span class="o">|</span> <span class="n">Reference</span> <span class="nb">type</span><span class="p">:</span> <span class="n">monthly_allowance</span>           <span class="o">|</span>
<span class="o">|</span> <span class="n">Ledger</span> <span class="n">entry</span><span class="p">:</span>                               <span class="o">|</span>
<span class="o">|</span>   <span class="n">amount_token</span><span class="p">:</span> <span class="o">+</span><span class="mi">100</span>                        <span class="o">|</span>
<span class="o">|</span>   <span class="n">amount_credit</span><span class="p">:</span> <span class="mi">0</span>                          <span class="o">|</span>
<span class="o">|</span>   <span class="n">balance_token_snapshot</span><span class="p">:</span> <span class="mi">100</span>               <span class="o">|</span>
<span class="o">+--------------------------------------------+</span>
</pre></div>
</div>
<p>Note: Rates are subject to change. Check the API for current pricing.</p>
</section>
<section id="managing-balance">
<h3>Managing Balance<a class="headerlink" href="#managing-balance" title="Link to this heading"></a></h3>
<p>Check and manage your account balance.</p>
<p><strong>Check Balance</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ curl -X GET &#39;https://api.voipbin.net/v1.0/billing_accounts?token=&lt;token&gt;&#39;
</pre></div>
</div>
<p><strong>Response:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;billing-uuid-123&quot;</span><span class="p">,</span>
    <span class="s2">&quot;customer_id&quot;</span><span class="p">:</span> <span class="s2">&quot;customer-uuid-456&quot;</span><span class="p">,</span>
    <span class="s2">&quot;plan_type&quot;</span><span class="p">:</span> <span class="s2">&quot;free&quot;</span><span class="p">,</span>
    <span class="s2">&quot;balance_credit&quot;</span><span class="p">:</span> <span class="mi">150500000</span><span class="p">,</span>
    <span class="s2">&quot;balance_token&quot;</span><span class="p">:</span> <span class="mi">650</span><span class="p">,</span>
    <span class="s2">&quot;tm_last_topup&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-01-01T00:00:00Z&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tm_next_topup&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-02-01T00:00:00Z&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tm_create&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-01-01T00:00:00Z&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tm_update&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-01-15T10:30:00Z&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">balance_credit</span></code> is in micros (150500000 = $150.50). The <code class="docutils literal notranslate"><span class="pre">balance_token</span></code> is the current token count.</p>
<p><strong>View Billing Ledger</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ curl -X GET &#39;https://api.voipbin.net/v1.0/billings?token=&lt;token&gt;&amp;page_size=10&#39;
</pre></div>
</div>
<p>Returns a paginated list of billing ledger entries showing all transactions (usage, top-ups, adjustments).</p>
<p><strong>Add Balance (Admin Only)</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ curl -X POST &#39;https://api.voipbin.net/v1.0/billing_accounts/&lt;account-id&gt;/balance_add_force?token=&lt;token&gt;&#39; \
    --header &#39;Content-Type: application/json&#39; \
    --data &#39;{
        &quot;balance&quot;: 100.00
    }&#39;
</pre></div>
</div>
<p>Note: Balance addition is restricted to users with admin permissions for security.</p>
</section>
<section id="balance-lifecycle">
<h3>Balance Lifecycle<a class="headerlink" href="#balance-lifecycle" title="Link to this heading"></a></h3>
<p>Account balance changes through specific operations. Token balances are replenished monthly via the automated top-up process.</p>
<p><strong>Balance and Token Flow</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+-------------------+</span>     <span class="o">+-------------------+</span>
<span class="o">|</span> <span class="n">Add</span> <span class="n">Balance</span>       <span class="o">|</span>     <span class="o">|</span> <span class="n">Monthly</span> <span class="n">Top</span><span class="o">-</span><span class="n">Up</span>    <span class="o">|</span>
<span class="o">|</span> <span class="p">(</span><span class="n">admin</span> <span class="n">only</span><span class="p">)</span>      <span class="o">|</span>     <span class="o">|</span> <span class="p">(</span><span class="n">automated</span> <span class="n">cron</span><span class="p">)</span>  <span class="o">|</span>
<span class="o">+--------+----------+</span>     <span class="o">+--------+----------+</span>
         <span class="o">|</span>                         <span class="o">|</span>
         <span class="n">v</span>                         <span class="n">v</span>
<span class="o">+-------------------+</span>     <span class="o">+-------------------+</span>
<span class="o">|</span>  <span class="n">balance_credit</span>   <span class="o">|</span>     <span class="o">|</span>  <span class="n">balance_token</span>    <span class="o">|</span>
<span class="o">|</span>  <span class="mi">150</span><span class="p">,</span><span class="mi">500</span><span class="p">,</span><span class="mi">000</span>      <span class="o">|</span>     <span class="o">|</span>      <span class="mi">100</span>          <span class="o">|</span>
<span class="o">+--------+----------+</span>     <span class="o">+--------+----------+</span>
         <span class="o">|</span>                         <span class="o">|</span>
         <span class="o">|</span> <span class="n">PSTN</span> <span class="n">calls</span><span class="p">,</span>             <span class="o">|</span> <span class="n">VN</span> <span class="n">calls</span><span class="p">,</span>
         <span class="o">|</span> <span class="n">numbers</span><span class="p">,</span>                <span class="o">|</span> <span class="n">SMS</span>
         <span class="o">|</span> <span class="n">overflow</span>                <span class="o">|</span>
         <span class="n">v</span>                         <span class="n">v</span>
<span class="o">+-------------------+</span>     <span class="o">+-------------------+</span>
<span class="o">|</span>   <span class="n">Credit</span> <span class="n">Charges</span>  <span class="o">|</span>     <span class="o">|</span>  <span class="n">Token</span> <span class="n">Usage</span>      <span class="o">|</span>
<span class="o">|</span> <span class="o">-</span> <span class="mi">18000</span> <span class="n">PSTN</span> <span class="n">call</span> <span class="o">|</span>     <span class="o">|</span> <span class="o">-</span> <span class="mi">3</span> <span class="n">tokens</span> <span class="n">call</span>   <span class="o">|</span>
<span class="o">|</span> <span class="o">-</span> <span class="mi">5000000</span> <span class="n">number</span>  <span class="o">|</span>     <span class="o">|</span> <span class="o">-</span> <span class="mi">10</span> <span class="n">tokens</span> <span class="n">SMS</span>   <span class="o">|</span>
<span class="o">+--------+----------+</span>     <span class="o">+--------+----------+</span>
         <span class="o">|</span>                         <span class="o">|</span>
         <span class="n">v</span>                         <span class="o">|</span> <span class="n">exhausted</span>
<span class="o">+-------------------+</span>              <span class="o">|</span>
<span class="o">|</span>  <span class="n">Updated</span> <span class="n">Balance</span>  <span class="o">|&lt;-------------+</span>
<span class="o">|</span>  <span class="mi">145</span><span class="p">,</span><span class="mi">082</span><span class="p">,</span><span class="mi">000</span>      <span class="o">|</span>   <span class="n">overflow</span> <span class="n">charges</span>
<span class="o">+-------------------+</span>

<span class="n">All</span> <span class="n">transactions</span> <span class="n">recorded</span> <span class="ow">in</span> <span class="n">billing</span> <span class="n">ledger</span>
<span class="k">with</span> <span class="n">signed</span> <span class="n">deltas</span> <span class="ow">and</span> <span class="n">balance</span> <span class="n">snapshots</span><span class="o">.</span>
</pre></div>
</div>
</section>
<section id="balance-monitoring">
<h3>Balance Monitoring<a class="headerlink" href="#balance-monitoring" title="Link to this heading"></a></h3>
<p>Monitor balance and token usage to avoid service interruption.</p>
<p><strong>Balance Check Flow</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Before</span> <span class="n">Service</span> <span class="n">Execution</span><span class="p">:</span>
<span class="o">+--------------------------------------------+</span>
<span class="o">|</span> <span class="mf">1.</span> <span class="n">Identify</span> <span class="n">service</span> <span class="nb">type</span>                   <span class="o">|</span>
<span class="o">|</span> <span class="mf">2.</span> <span class="n">If</span> <span class="n">token</span><span class="o">-</span><span class="n">eligible</span><span class="p">:</span> <span class="n">check</span> <span class="n">balance_token</span>  <span class="o">|</span>
<span class="o">|</span>    <span class="o">-</span> <span class="n">If</span> <span class="n">tokens</span> <span class="n">available</span> <span class="o">-&gt;</span> <span class="n">proceed</span>         <span class="o">|</span>
<span class="o">|</span>    <span class="o">-</span> <span class="n">If</span> <span class="n">no</span> <span class="n">tokens</span> <span class="o">-&gt;</span> <span class="n">check</span> <span class="n">balance_credit</span>   <span class="o">|</span>
<span class="o">|</span> <span class="mf">3.</span> <span class="n">If</span> <span class="n">credit</span><span class="o">-</span><span class="n">only</span><span class="p">:</span> <span class="n">check</span> <span class="n">balance_credit</span>    <span class="o">|</span>
<span class="o">|</span>    <span class="o">-</span> <span class="n">If</span> <span class="n">balance</span> <span class="o">&gt;=</span> <span class="n">cost</span> <span class="o">-&gt;</span> <span class="n">proceed</span>          <span class="o">|</span>
<span class="o">|</span>    <span class="o">-</span> <span class="n">If</span> <span class="n">balance</span> <span class="o">&lt;</span> <span class="n">cost</span> <span class="o">-&gt;</span> <span class="n">deny</span> <span class="n">service</span>      <span class="o">|</span>
<span class="o">+--------------------------------------------+</span>
</pre></div>
</div>
</section>
<section id="common-scenarios">
<h3>Common Scenarios<a class="headerlink" href="#common-scenarios" title="Link to this heading"></a></h3>
<p><strong>Scenario 1: Token-Based Monthly Usage</strong></p>
<p>Track token consumption via the billing ledger.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Monthly</span> <span class="n">Usage</span> <span class="p">(</span><span class="n">Free</span> <span class="n">Plan</span><span class="p">,</span> <span class="mi">100</span> <span class="n">tokens</span><span class="p">):</span>
<span class="o">+--------------------------------------------+</span>
<span class="o">|</span> <span class="n">Week</span> <span class="mi">1</span><span class="p">:</span>                                    <span class="o">|</span>
<span class="o">|</span> <span class="o">-</span> <span class="mi">10</span> <span class="n">VN</span> <span class="n">calls</span> <span class="p">(</span><span class="n">avg</span> <span class="mi">3</span> <span class="nb">min</span><span class="p">)</span> <span class="o">=</span> <span class="mi">30</span> <span class="n">tokens</span>      <span class="o">|</span>
<span class="o">|</span> <span class="o">-</span> <span class="mi">5</span> <span class="n">SMS</span> <span class="o">=</span> <span class="mi">50</span> <span class="n">tokens</span>                        <span class="o">|</span>
<span class="o">|</span> <span class="n">balance_token</span><span class="p">:</span> <span class="mi">20</span>                          <span class="o">|</span>
<span class="o">|</span>                                            <span class="o">|</span>
<span class="o">|</span> <span class="n">Week</span> <span class="mi">2</span><span class="p">:</span>                                    <span class="o">|</span>
<span class="o">|</span> <span class="o">-</span> <span class="mi">5</span> <span class="n">VN</span> <span class="n">calls</span> <span class="p">(</span><span class="n">avg</span> <span class="mi">2</span> <span class="nb">min</span><span class="p">)</span> <span class="o">=</span> <span class="mi">10</span> <span class="n">tokens</span>       <span class="o">|</span>
<span class="o">|</span> <span class="o">-</span> <span class="mi">1</span> <span class="n">SMS</span> <span class="o">=</span> <span class="mi">10</span> <span class="n">tokens</span>                        <span class="o">|</span>
<span class="o">|</span> <span class="n">balance_token</span><span class="p">:</span> <span class="mi">0</span>                           <span class="o">|</span>
<span class="o">|</span>                                            <span class="o">|</span>
<span class="o">|</span> <span class="n">Week</span> <span class="mi">3</span> <span class="p">(</span><span class="n">tokens</span> <span class="n">exhausted</span><span class="p">):</span>                 <span class="o">|</span>
<span class="o">|</span> <span class="o">-</span> <span class="mi">5</span> <span class="n">VN</span> <span class="n">calls</span> <span class="p">(</span><span class="n">avg</span> <span class="mi">3</span> <span class="nb">min</span><span class="p">)</span> <span class="o">=</span> <span class="n">overflow</span>        <span class="o">|</span>
<span class="o">|</span>   <span class="mi">5</span> <span class="n">x</span> <span class="mi">3</span> <span class="n">x</span> <span class="mi">1</span><span class="p">,</span><span class="mi">000</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span><span class="mi">000</span> <span class="n">micros</span> <span class="n">credit</span>    <span class="o">|</span>
<span class="o">|</span> <span class="o">-</span> <span class="mi">2</span> <span class="n">SMS</span> <span class="o">=</span> <span class="n">overflow</span> <span class="n">to</span> <span class="n">credit</span>               <span class="o">|</span>
<span class="o">|</span>   <span class="mi">2</span> <span class="n">x</span> <span class="mi">8</span><span class="p">,</span><span class="mi">000</span> <span class="o">=</span> <span class="mi">16</span><span class="p">,</span><span class="mi">000</span> <span class="n">micros</span> <span class="n">credit</span> <span class="n">charge</span>  <span class="o">|</span>
<span class="o">+--------------------------------------------+</span>
</pre></div>
</div>
<p><strong>Scenario 2: Mixed Token and Credit Usage</strong></p>
<p>Plan for costs across token-eligible and credit-only services.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Campaign: Customer Outreach
+--------------------------------------------+
| VN Calls: 200 calls (avg 3 min)            |
| - Tokens needed: 200 x 3 = 600             |
| - If 400 tokens available:                 |
|   - 400 tokens consumed                    |
|   - 200 overflow x 3 min x 1,000 micros    |
|     = 600,000 micros ($0.60)               |
|                                            |
| PSTN Calls: 50 calls (avg 2 min)           |
| - Credit: 50 x 2 x 6,000 = 600,000 micros |
|   ($0.60)                                  |
|                                            |
| SMS: 100 messages (no tokens remaining)    |
| - Credit: 100 x 8,000 = 800,000 micros    |
|   ($0.80)                                  |
|                                            |
| Total credit: 2,000,000 micros ($2.00)     |
+--------------------------------------------+
</pre></div>
</div>
</section>
<section id="best-practices">
<h3>Best Practices<a class="headerlink" href="#best-practices" title="Link to this heading"></a></h3>
<p><strong>1. Token Monitoring</strong></p>
<ul class="simple">
<li><p>Check <code class="docutils literal notranslate"><span class="pre">balance_token</span></code> on the account regularly</p></li>
<li><p>Plan upgrades to higher tiers if tokens are consistently exhausted before the next top-up</p></li>
<li><p>Review billing ledger entries to understand consumption patterns</p></li>
</ul>
<p><strong>2. Balance Monitoring</strong></p>
<ul class="simple">
<li><p>Maintain credit balance for PSTN calls, number purchases, and token overflow</p></li>
<li><p>Set up low balance alerts</p></li>
<li><p>Plan for buffer above minimum needed</p></li>
</ul>
<p><strong>3. Cost Estimation</strong></p>
<ul class="simple">
<li><p>Separate estimates into token-eligible and credit-only services</p></li>
<li><p>Account for token overflow in budget planning</p></li>
<li><p>Include retry costs in estimates</p></li>
<li><p>Note all credit amounts are in micros (divide by 1,000,000 for USD)</p></li>
</ul>
<p><strong>4. Security</strong></p>
<ul class="simple">
<li><p>Restrict balance add permissions to admins</p></li>
<li><p>Monitor for unusual usage patterns via the billing ledger</p></li>
<li><p>Review billing history regularly for anomalies</p></li>
</ul>
<p><strong>5. Plan Selection</strong></p>
<ul class="simple">
<li><p>Choose plan tier based on expected VN call and SMS volume</p></li>
<li><p>Compare token allocation cost vs. credit-only cost at each tier</p></li>
<li><p>Consider upgrading if monthly overflow charges are significant</p></li>
</ul>
</section>
<section id="troubleshooting">
<h3>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Link to this heading"></a></h3>
<p><strong>Balance Issues</strong></p>
<p><strong>Token Issues</strong></p>
<p><strong>Billing Issues</strong></p>
</section>
<section id="related-documentation">
<h3>Related Documentation<a class="headerlink" href="#related-documentation" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference internal" href="customer_overview.html#customer-overview"><span class="std std-ref">Customer Overview</span></a> - Account management</p></li>
<li><p><a class="reference internal" href="call_overview.html#call-overview"><span class="std std-ref">Call Overview</span></a> - Voice call costs</p></li>
<li><p><a class="reference internal" href="message_overview.html#message-overview"><span class="std std-ref">Message Overview</span></a> - SMS costs</p></li>
<li><p><a class="reference internal" href="number_overview.html#number-overview"><span class="std std-ref">Number Overview</span></a> - Number provisioning costs</p></li>
</ul>
</section>
</section>
<section id="tutorial">
<span id="billing-account-tutorial"></span><h2>Tutorial<a class="headerlink" href="#tutorial" title="Link to this heading"></a></h2>
<p>Before managing billing accounts, you need:</p>
<ul class="simple">
<li><p>An authentication token. Obtain one via <code class="docutils literal notranslate"><span class="pre">POST</span> <span class="pre">/auth/login</span></code> or use an access key from <code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">/accesskeys</span></code>.</p></li>
<li><p>The billing account ID (UUID). Obtain it via <code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">/billing_accounts</span></code> which lists all billing accounts for the authenticated customer.</p></li>
<li><p>(For adding balance) Admin-level permissions on the account.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>AI Implementation Hint</strong></p>
<p>The <code class="docutils literal notranslate"><span class="pre">balance</span></code> field in billing account responses is a float representing USD (e.g., <code class="docutils literal notranslate"><span class="pre">69.77263</span></code> = $69.77). When estimating costs, multiply the per-unit rate by billable units. Call durations are ceiling-rounded to the next whole minute for billing purposes (e.g., a 2 minute 15 second call is billed as 3 minutes).</p>
</div>
<section id="check-account-balance">
<h3>Check Account Balance<a class="headerlink" href="#check-account-balance" title="Link to this heading"></a></h3>
<p>Check your billing account balance before initiating calls or sending messages to ensure sufficient funds.</p>
<p><strong>Get Billing Account:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ curl --location --request GET &#39;https://api.voipbin.net/v1.0/billing_accounts/&lt;billing-account-id&gt;?token=&lt;YOUR_AUTH_TOKEN&gt;&#39;

{
    &quot;id&quot;: &quot;62918cd8-0cd7-11ee-8571-b738bed3a5c4&quot;,
    &quot;customer_id&quot;: &quot;5e4a0680-804e-11ec-8477-2fea5968d85b&quot;,
    &quot;name&quot;: &quot;Primary Account&quot;,
    &quot;detail&quot;: &quot;Main billing account&quot;,
    &quot;plan_type&quot;: &quot;free&quot;,
    &quot;balance&quot;: 69.77263,
    &quot;payment_type&quot;: &quot;&quot;,
    &quot;payment_method&quot;: &quot;&quot;,
    &quot;tm_create&quot;: &quot;2013-06-17 00:00:00.000000&quot;,
    &quot;tm_update&quot;: &quot;2023-06-30 19:18:08.466742&quot;,
    &quot;tm_delete&quot;: &quot;9999-01-01 00:00:00.000000&quot;
}
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">balance</span></code> field shows the remaining credit balance in USD.</p>
<p><strong>List All Billing Accounts:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ curl --location --request GET &#39;https://api.voipbin.net/v1.0/billing_accounts?token=&lt;YOUR_AUTH_TOKEN&gt;&#39;

{
    &quot;result&quot;: [
        {
            &quot;id&quot;: &quot;62918cd8-0cd7-11ee-8571-b738bed3a5c4&quot;,
            &quot;customer_id&quot;: &quot;5e4a0680-804e-11ec-8477-2fea5968d85b&quot;,
            &quot;name&quot;: &quot;Primary Account&quot;,
            &quot;detail&quot;: &quot;Main billing account&quot;,
            &quot;plan_type&quot;: &quot;free&quot;,
            &quot;balance&quot;: 69.77263,
            &quot;payment_type&quot;: &quot;&quot;,
            &quot;payment_method&quot;: &quot;&quot;,
            &quot;tm_create&quot;: &quot;2013-06-17 00:00:00.000000&quot;,
            &quot;tm_update&quot;: &quot;2023-06-30 19:18:08.466742&quot;,
            &quot;tm_delete&quot;: &quot;9999-01-01 00:00:00.000000&quot;
        }
    ]
}
</pre></div>
</div>
</section>
<section id="add-balance-admin-only">
<h3>Add Balance (Admin Only)<a class="headerlink" href="#add-balance-admin-only" title="Link to this heading"></a></h3>
<p>Only users with admin permissions can add balance to accounts. This ensures account security and prevents unauthorized access.</p>
<p><strong>Add Balance:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ curl --location --request POST &#39;https://api.voipbin.net/v1.0/billing_accounts/&lt;billing-account-id&gt;/balance?token=&lt;YOUR_AUTH_TOKEN&gt;&#39; \
    --header &#39;Content-Type: application/json&#39; \
    --data-raw &#39;{
        &quot;amount&quot;: 100.00
    }&#39;

{
    &quot;id&quot;: &quot;62918cd8-0cd7-11ee-8571-b738bed3a5c4&quot;,
    &quot;customer_id&quot;: &quot;5e4a0680-804e-11ec-8477-2fea5968d85b&quot;,
    &quot;name&quot;: &quot;Primary Account&quot;,
    &quot;detail&quot;: &quot;Main billing account&quot;,
    &quot;plan_type&quot;: &quot;free&quot;,
    &quot;balance&quot;: 169.77263,
    &quot;payment_type&quot;: &quot;&quot;,
    &quot;payment_method&quot;: &quot;&quot;,
    &quot;tm_create&quot;: &quot;2013-06-17 00:00:00.000000&quot;,
    &quot;tm_update&quot;: &quot;2023-06-30 19:20:15.123456&quot;,
    &quot;tm_delete&quot;: &quot;9999-01-01 00:00:00.000000&quot;
}
</pre></div>
</div>
<p><strong>Important:</strong> This operation requires admin permissions. Regular users will receive a permission error.</p>
</section>
<section id="understanding-service-rates">
<h3>Understanding Service Rates<a class="headerlink" href="#understanding-service-rates" title="Link to this heading"></a></h3>
<p>VoIPBIN uses a hybrid billing model: token-eligible services consume tokens first, then overflow to credits. Credit-only services always charge the credit balance directly. All calls are billed per minute with ceiling rounding.</p>
<p>For the complete rate table, see <a class="reference internal" href="billing_account_overview.html#billing-account-rate-structure"><span class="std std-ref">Rate Structure</span></a>.</p>
<p><strong>Calculate VN Call Cost (with tokens):</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># Example: 5 minute VN call with tokens available
Duration: 5 minutes
Token cost: 5 x 1 = 5 tokens
Credit cost: $0.00 (covered by tokens)
</pre></div>
</div>
<p><strong>Calculate VN Call Cost (tokens exhausted):</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># Example: 5 minute VN call with no tokens remaining
Duration: 5 minutes
Credit cost: 5 x $0.001 = $0.005
</pre></div>
</div>
<p><strong>Calculate PSTN Call Cost:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># Example: 2 minute 30 second PSTN outgoing call
Duration: 2 min 30 sec -&gt; 3 minutes (ceiling-rounded)
Credit cost: 3 x $0.0060 = $0.018
</pre></div>
</div>
<p><strong>Calculate SMS Cost (with tokens):</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># Example: 10 messages with tokens available
Token cost: 10 x 10 = 100 tokens
Credit cost: $0.00 (covered by tokens)
</pre></div>
</div>
<p><strong>Calculate SMS Cost (tokens exhausted):</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># Example: 10 messages with no tokens remaining
Credit cost: 10 x $0.008 = $0.08
</pre></div>
</div>
</section>
<section id="check-balance-before-call">
<h3>Check Balance Before Call<a class="headerlink" href="#check-balance-before-call" title="Link to this heading"></a></h3>
<p>Programmatically verify balance before initiating calls to ensure successful completion.</p>
<p><strong>Python Example:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="k">def</span> <span class="nf">check_balance_and_call</span><span class="p">(</span><span class="n">billing_account_id</span><span class="p">,</span> <span class="n">call_duration_minutes</span><span class="p">,</span> <span class="n">call_type</span><span class="o">=</span><span class="s2">&quot;vn&quot;</span><span class="p">):</span>
    <span class="n">base_url</span> <span class="o">=</span> <span class="s2">&quot;https://api.voipbin.net/v1.0&quot;</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;token&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;YOUR_AUTH_TOKEN&gt;&quot;</span><span class="p">}</span>

    <span class="c1"># Get billing account</span>
    <span class="n">account</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/billing_accounts/</span><span class="si">{</span><span class="n">billing_account_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">params</span><span class="o">=</span><span class="n">params</span>
    <span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

    <span class="n">current_balance</span> <span class="o">=</span> <span class="n">account</span><span class="p">[</span><span class="s1">&#39;balance&#39;</span><span class="p">]</span>
    <span class="n">duration</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">call_duration_minutes</span><span class="p">)</span>  <span class="c1"># ceiling-rounded</span>

    <span class="k">if</span> <span class="n">call_type</span> <span class="o">==</span> <span class="s2">&quot;vn&quot;</span><span class="p">:</span>
        <span class="c1"># VN call: estimate credit cost for overflow scenario</span>
        <span class="n">estimated_cost</span> <span class="o">=</span> <span class="n">duration</span> <span class="o">*</span> <span class="mf">0.001</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;VN call cost (if tokens exhausted): </span><span class="si">{</span><span class="n">duration</span><span class="si">}</span><span class="s2"> min x $0.001 = $</span><span class="si">{</span><span class="n">estimated_cost</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">can_proceed</span> <span class="o">=</span> <span class="n">current_balance</span> <span class="o">&gt;=</span> <span class="n">estimated_cost</span>

    <span class="k">elif</span> <span class="n">call_type</span> <span class="o">==</span> <span class="s2">&quot;pstn&quot;</span><span class="p">:</span>
        <span class="c1"># PSTN call: always credit</span>
        <span class="n">estimated_cost</span> <span class="o">=</span> <span class="n">duration</span> <span class="o">*</span> <span class="mf">0.006</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PSTN call cost: </span><span class="si">{</span><span class="n">duration</span><span class="si">}</span><span class="s2"> min x $0.006 = $</span><span class="si">{</span><span class="n">estimated_cost</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">can_proceed</span> <span class="o">=</span> <span class="n">current_balance</span> <span class="o">&gt;=</span> <span class="n">estimated_cost</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">can_proceed</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Insufficient balance: $</span><span class="si">{</span><span class="n">current_balance</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Balance OK: $</span><span class="si">{</span><span class="n">current_balance</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">True</span>

<span class="c1"># Check for a 10 minute VN call</span>
<span class="n">check_balance_and_call</span><span class="p">(</span><span class="s2">&quot;62918cd8-0cd7-11ee-8571-b738bed3a5c4&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;vn&quot;</span><span class="p">)</span>

<span class="c1"># Check for a 5 minute PSTN call</span>
<span class="n">check_balance_and_call</span><span class="p">(</span><span class="s2">&quot;62918cd8-0cd7-11ee-8571-b738bed3a5c4&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;pstn&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Node.js Example:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>const axios = require(&#39;axios&#39;);

async function checkBalanceAndCall(billingAccountId, callDurationMinutes, callType = &#39;vn&#39;) {
    try {
        const baseUrl = &#39;https://api.voipbin.net/v1.0&#39;;
        const params = { token: &#39;&lt;YOUR_AUTH_TOKEN&gt;&#39; };

        // Get billing account
        const accountResponse = await axios.get(
            `${baseUrl}/billing_accounts/${billingAccountId}`,
            { params }
        );
        const account = accountResponse.data;

        const currentBalance = account.balance;
        const duration = Math.ceil(callDurationMinutes);  // ceiling-rounded

        let canProceed = false;

        if (callType === &#39;vn&#39;) {
            // VN call: estimate credit cost for overflow scenario
            const estimatedCost = duration * 0.001;
            console.log(`VN call cost (if tokens exhausted): $${estimatedCost.toFixed(4)}`);
            canProceed = currentBalance &gt;= estimatedCost;
        } else if (callType === &#39;pstn&#39;) {
            // PSTN call: always credit
            const estimatedCost = duration * 0.006;
            console.log(`PSTN call cost: $${estimatedCost.toFixed(4)}`);
            canProceed = currentBalance &gt;= estimatedCost;
        }

        if (!canProceed) {
            console.log(`Insufficient balance: $${currentBalance.toFixed(2)}`);
            return null;
        }

        console.log(`Balance OK: $${currentBalance.toFixed(2)}`);
        return true;

    } catch (error) {
        console.error(&#39;Error:&#39;, error.message);
        return null;
    }
}

// Check for a 10 minute VN call
checkBalanceAndCall(&#39;62918cd8-0cd7-11ee-8571-b738bed3a5c4&#39;, 10, &#39;vn&#39;);
</pre></div>
</div>
</section>
<section id="monitor-balance-with-webhooks">
<h3>Monitor Balance with Webhooks<a class="headerlink" href="#monitor-balance-with-webhooks" title="Link to this heading"></a></h3>
<p>Set up webhooks to receive notifications when balance changes or falls below a threshold.</p>
<p><strong>Create Webhook for Billing Events:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ curl --location --request POST &#39;https://api.voipbin.net/v1.0/webhooks?token=&lt;YOUR_AUTH_TOKEN&gt;&#39; \
    --header &#39;Content-Type: application/json&#39; \
    --data-raw &#39;{
        &quot;name&quot;: &quot;Balance Monitoring Webhook&quot;,
        &quot;uri&quot;: &quot;https://your-server.com/webhook/billing&quot;,
        &quot;method&quot;: &quot;POST&quot;,
        &quot;event_types&quot;: [
            &quot;billing_account.updated&quot;,
            &quot;billing_account.low_balance&quot;
        ]
    }&#39;
</pre></div>
</div>
<p><strong>Webhook Payload Example:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">POST</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">your</span><span class="o">-</span><span class="n">server</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">webhook</span><span class="o">/</span><span class="n">billing</span>

<span class="p">{</span>
    <span class="s2">&quot;event_type&quot;</span><span class="p">:</span> <span class="s2">&quot;billing_account.updated&quot;</span><span class="p">,</span>
    <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2023-06-30T19:20:15.000000Z&quot;</span><span class="p">,</span>
    <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;62918cd8-0cd7-11ee-8571-b738bed3a5c4&quot;</span><span class="p">,</span>
        <span class="s2">&quot;customer_id&quot;</span><span class="p">:</span> <span class="s2">&quot;5e4a0680-804e-11ec-8477-2fea5968d85b&quot;</span><span class="p">,</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Primary Account&quot;</span><span class="p">,</span>
        <span class="s2">&quot;balance&quot;</span><span class="p">:</span> <span class="mf">15.50</span><span class="p">,</span>
        <span class="s2">&quot;previous_balance&quot;</span><span class="p">:</span> <span class="mf">25.50</span><span class="p">,</span>
        <span class="s2">&quot;change&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">10.00</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Process Webhook with Low Balance Alert:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Python Flask example</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">jsonify</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="n">LOW_BALANCE_THRESHOLD</span> <span class="o">=</span> <span class="mf">20.00</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/webhook/billing&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">billing_webhook</span><span class="p">():</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span>
    <span class="n">event_type</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;event_type&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">event_type</span> <span class="o">==</span> <span class="s1">&#39;billing_account.updated&#39;</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">payload</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
        <span class="n">balance</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;balance&#39;</span><span class="p">]</span>
        <span class="n">account_id</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>

        <span class="c1"># Check if balance is low</span>
        <span class="k">if</span> <span class="n">balance</span> <span class="o">&lt;</span> <span class="n">LOW_BALANCE_THRESHOLD</span><span class="p">:</span>
            <span class="n">send_low_balance_alert</span><span class="p">(</span><span class="n">account_id</span><span class="p">,</span> <span class="n">balance</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;received&#39;</span><span class="p">}),</span> <span class="mi">200</span>

<span class="k">def</span> <span class="nf">send_low_balance_alert</span><span class="p">(</span><span class="n">account_id</span><span class="p">,</span> <span class="n">balance</span><span class="p">):</span>
    <span class="n">subject</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Low Balance Alert: $</span><span class="si">{</span><span class="n">balance</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">body</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    Your billing account credit balance is low.</span>

<span class="s2">    Account ID: </span><span class="si">{</span><span class="n">account_id</span><span class="si">}</span>
<span class="s2">    Current Balance: $</span><span class="si">{</span><span class="n">balance</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span>
<span class="s2">    Threshold: $</span><span class="si">{</span><span class="n">LOW_BALANCE_THRESHOLD</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span>

<span class="s2">    Note: Token-eligible services (VN calls, SMS) will continue</span>
<span class="s2">    working as long as monthly tokens are available. Credit balance</span>
<span class="s2">    is needed for PSTN calls, number purchases, and token overflow.</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sending low balance alert: </span><span class="si">{</span><span class="n">subject</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="common-use-cases">
<h3>Common Use Cases<a class="headerlink" href="#common-use-cases" title="Link to this heading"></a></h3>
<p><strong>1. Pre-Campaign Cost Estimation:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">estimate_campaign_cost</span><span class="p">(</span><span class="n">pstn_calls</span><span class="p">,</span> <span class="n">pstn_avg_minutes</span><span class="p">,</span> <span class="n">sms_count</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Estimate campaign cost considering credits.&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">math</span>

    <span class="c1"># PSTN calls: always credit</span>
    <span class="n">pstn_total_minutes</span> <span class="o">=</span> <span class="n">pstn_calls</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">pstn_avg_minutes</span><span class="p">)</span>
    <span class="n">pstn_credit</span> <span class="o">=</span> <span class="n">pstn_total_minutes</span> <span class="o">*</span> <span class="mf">0.006</span>

    <span class="c1"># SMS: credit cost when tokens exhausted</span>
    <span class="n">sms_credit</span> <span class="o">=</span> <span class="n">sms_count</span> <span class="o">*</span> <span class="mf">0.008</span>

    <span class="n">total_credit</span> <span class="o">=</span> <span class="n">pstn_credit</span> <span class="o">+</span> <span class="n">sms_credit</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;pstn_credit&#39;</span><span class="p">:</span> <span class="n">pstn_credit</span><span class="p">,</span>
        <span class="s1">&#39;sms_credit&#39;</span><span class="p">:</span> <span class="n">sms_credit</span><span class="p">,</span>
        <span class="s1">&#39;total_credit_needed&#39;</span><span class="p">:</span> <span class="n">total_credit</span>
    <span class="p">}</span>

<span class="c1"># Example: mixed campaign</span>
<span class="n">costs</span> <span class="o">=</span> <span class="n">estimate_campaign_cost</span><span class="p">(</span>
    <span class="n">pstn_calls</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">pstn_avg_minutes</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">sms_count</span><span class="o">=</span><span class="mi">200</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PSTN credit: $</span><span class="si">{</span><span class="n">costs</span><span class="p">[</span><span class="s1">&#39;pstn_credit&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SMS credit: $</span><span class="si">{</span><span class="n">costs</span><span class="p">[</span><span class="s1">&#39;sms_credit&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total credit needed: $</span><span class="si">{</span><span class="n">costs</span><span class="p">[</span><span class="s1">&#39;total_credit_needed&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>2. Plan Tier Comparison:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">recommend_plan</span><span class="p">(</span><span class="n">monthly_vn_minutes</span><span class="p">,</span> <span class="n">monthly_sms</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Recommend the most cost-effective plan tier.&quot;&quot;&quot;</span>
    <span class="n">plans</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;free&#39;</span><span class="p">:</span>         <span class="p">{</span><span class="s1">&#39;tokens&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>    <span class="s1">&#39;cost&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
        <span class="s1">&#39;basic&#39;</span><span class="p">:</span>        <span class="p">{</span><span class="s1">&#39;tokens&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>   <span class="s1">&#39;cost&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span>
        <span class="s1">&#39;professional&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;tokens&#39;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>  <span class="s1">&#39;cost&#39;</span><span class="p">:</span> <span class="mi">25</span><span class="p">},</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="n">plan_name</span><span class="p">,</span> <span class="n">plan</span> <span class="ow">in</span> <span class="n">plans</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">vn_tokens</span> <span class="o">=</span> <span class="n">monthly_vn_minutes</span> <span class="o">*</span> <span class="mi">1</span>
        <span class="n">sms_tokens</span> <span class="o">=</span> <span class="n">monthly_sms</span> <span class="o">*</span> <span class="mi">10</span>
        <span class="n">total_tokens</span> <span class="o">=</span> <span class="n">vn_tokens</span> <span class="o">+</span> <span class="n">sms_tokens</span>

        <span class="k">if</span> <span class="n">total_tokens</span> <span class="o">&lt;=</span> <span class="n">plan</span><span class="p">[</span><span class="s1">&#39;tokens&#39;</span><span class="p">]:</span>
            <span class="n">overflow_credit</span> <span class="o">=</span> <span class="mf">0.00</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">overflow</span> <span class="o">=</span> <span class="n">total_tokens</span> <span class="o">-</span> <span class="n">plan</span><span class="p">[</span><span class="s1">&#39;tokens&#39;</span><span class="p">]</span>
            <span class="c1"># Simplified: assume overflow split proportionally</span>
            <span class="n">overflow_credit</span> <span class="o">=</span> <span class="n">overflow</span> <span class="o">*</span> <span class="mf">0.001</span>  <span class="c1"># approximate</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">plan_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">plan</span><span class="p">[</span><span class="s1">&#39;tokens&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> tokens, &quot;</span>
              <span class="sa">f</span><span class="s2">&quot;need </span><span class="si">{</span><span class="n">total_tokens</span><span class="si">}</span><span class="s2">, overflow credit: $</span><span class="si">{</span><span class="n">overflow_credit</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">recommend_plan</span><span class="p">(</span><span class="n">monthly_vn_minutes</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">monthly_sms</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id1">
<h3>Best Practices<a class="headerlink" href="#id1" title="Link to this heading"></a></h3>
<p><strong>1. Balance Verification:</strong></p>
<ul class="simple">
<li><p>Always check credit balance before high-cost operations</p></li>
<li><p>For PSTN calls and number purchases: check credit balance directly</p></li>
<li><p>Add a buffer (10-20%) to estimated credit costs for safety</p></li>
</ul>
<p><strong>2. Monitoring:</strong></p>
<ul class="simple">
<li><p>Set up webhooks for real-time balance updates</p></li>
<li><p>Monitor credit balance during campaigns</p></li>
<li><p>Generate regular cost reports for analysis</p></li>
</ul>
<p><strong>3. Cost Management:</strong></p>
<ul class="simple">
<li><p>Separate estimates into token-eligible and credit-only services</p></li>
<li><p>Calculate worst-case costs assuming full token overflow</p></li>
<li><p>Generate regular cost reports for analysis</p></li>
</ul>
<p><strong>4. Security:</strong></p>
<ul class="simple">
<li><p>Protect admin tokens used for balance operations</p></li>
<li><p>Implement role-based access for balance management</p></li>
<li><p>Audit balance changes regularly</p></li>
</ul>
</section>
<section id="balance-management-workflow">
<h3>Balance Management Workflow<a class="headerlink" href="#balance-management-workflow" title="Link to this heading"></a></h3>
<p><strong>1. Initial Setup:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check current balance</span>
<span class="n">GET</span> <span class="o">/</span><span class="n">v1</span><span class="mf">.0</span><span class="o">/</span><span class="n">billing_accounts</span><span class="o">/&lt;</span><span class="n">account</span><span class="o">-</span><span class="nb">id</span><span class="o">&gt;</span>

<span class="c1"># Set up webhook for balance monitoring</span>
<span class="n">POST</span> <span class="o">/</span><span class="n">v1</span><span class="mf">.0</span><span class="o">/</span><span class="n">webhooks</span>
<span class="o">-&gt;</span> <span class="n">Configure</span> <span class="n">billing_account</span><span class="o">.</span><span class="n">updated</span> <span class="n">events</span>
</pre></div>
</div>
<p><strong>2. Before Operations:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Determine service type</span>
<span class="k">if</span> <span class="n">service_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;pstn_call&#39;</span><span class="p">,</span> <span class="s1">&#39;number&#39;</span><span class="p">]:</span>
    <span class="c1"># Always check credit balance</span>
    <span class="n">check_credit_balance</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>3. During Operations:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Monitor via webhooks</span>
<span class="o">-&gt;</span> <span class="n">Receive</span> <span class="n">balance</span> <span class="n">update</span> <span class="n">events</span>
</pre></div>
</div>
<p><strong>4. After Operations:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Review credit charges</span>
<span class="n">actual_credit</span> <span class="o">=</span> <span class="n">initial_balance</span> <span class="o">-</span> <span class="n">current_balance</span>
</pre></div>
</div>
</section>
<section id="id2">
<h3>Troubleshooting<a class="headerlink" href="#id2" title="Link to this heading"></a></h3>
<p><strong>Common Issues:</strong></p>
<p><strong>Insufficient balance error:</strong></p>
<ul class="simple">
<li><p>Check credit balance: <code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">/v1.0/billing_accounts/&lt;account-id&gt;</span></code></p></li>
<li><p>PSTN calls and number purchases require credit balance</p></li>
</ul>
<p><strong>Unexpected credit charges:</strong></p>
<ul class="simple">
<li><p>Verify call durations are ceiling-rounded to the next whole minute</p></li>
<li><p>Review PSTN call history (always charged to credit)</p></li>
</ul>
<p><strong>Permission denied when adding balance:</strong></p>
<ul class="simple">
<li><p>Ensure user has admin permissions</p></li>
<li><p>Verify authentication token is valid</p></li>
<li><p>Check user role in account settings</p></li>
</ul>
<p>For more information about billing account management, see <a class="reference internal" href="billing_account_overview.html#billing-account-overview"><span class="std std-ref">Billing Account Overview</span></a>.</p>
</section>
</section>
<section id="struct">
<span id="billing-account-struct"></span><h2>Struct<a class="headerlink" href="#struct" title="Link to this heading"></a></h2>
<section id="billing-account-struct-billing-account">
<span id="id3"></span><h3>Billing account<a class="headerlink" href="#billing-account-struct-billing-account" title="Link to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;62918cd8-0cd7-11ee-8571-b738bed3a5c4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;customer_id&quot;</span><span class="p">:</span> <span class="s2">&quot;5e4a0680-804e-11ec-8477-2fea5968d85b&quot;</span><span class="p">,</span>
    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;detail&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;plan_type&quot;</span><span class="p">:</span> <span class="s2">&quot;free&quot;</span><span class="p">,</span>
    <span class="s2">&quot;balance_credit&quot;</span><span class="p">:</span> <span class="mi">69772630</span><span class="p">,</span>
    <span class="s2">&quot;balance_token&quot;</span><span class="p">:</span> <span class="mi">650</span><span class="p">,</span>
    <span class="s2">&quot;payment_type&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;payment_method&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tm_last_topup&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-01-01T00:00:00Z&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tm_next_topup&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-02-01T00:00:00Z&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tm_create&quot;</span><span class="p">:</span> <span class="s2">&quot;2013-06-17 00:00:00.000000&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tm_update&quot;</span><span class="p">:</span> <span class="s2">&quot;2023-06-30 19:18:08.466742&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tm_delete&quot;</span><span class="p">:</span> <span class="n">null</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">id</span></code> (UUID): The billing account’s unique identifier. Returned when listing billing accounts via <code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">/billing_accounts</span></code> or retrieving a specific account via <code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">/billing_accounts/{id}</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">customer_id</span></code> (UUID): The customer that owns this billing account. Obtained from the <code class="docutils literal notranslate"><span class="pre">id</span></code> field of <code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">/customers</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code> (String): The billing account’s display name. Optional.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">detail</span></code> (String): An optional description of the billing account.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">plan_type</span></code> (enum string): The plan tier of the account. Determines resource creation limits and monthly token allocations. Values: <code class="docutils literal notranslate"><span class="pre">free</span></code>, <code class="docutils literal notranslate"><span class="pre">basic</span></code>, <code class="docutils literal notranslate"><span class="pre">professional</span></code>, <code class="docutils literal notranslate"><span class="pre">unlimited</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">balance_credit</span></code> (Integer, int64 micros): Credit balance in micros. 1 USD = 1,000,000 micros. Example: <code class="docutils literal notranslate"><span class="pre">69772630</span></code> = $69.77. Used for PSTN calls, number purchases, and token overflow charges.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">balance_token</span></code> (Integer, int64): Current token balance. Tokens are consumed by VN calls (1 token/minute) and SMS (10 tokens/message). Replenished monthly via automated top-up.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">payment_type</span></code> (String): Payment type. Reserved for future use.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">payment_method</span></code> (String): Payment method. Reserved for future use.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tm_last_topup</span></code> (string, ISO 8601): Timestamp of the last token top-up.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tm_next_topup</span></code> (string, ISO 8601): Timestamp of the next scheduled token top-up.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tm_create</span></code> (string, ISO 8601): Timestamp when the billing account was created.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tm_update</span></code> (string, ISO 8601): Timestamp when the billing account was last updated.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tm_delete</span></code> (string, ISO 8601 or null): Timestamp when the billing account was deleted. <code class="docutils literal notranslate"><span class="pre">null</span></code> indicates the account is active.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>AI Implementation Hint</strong></p>
<p>Unlike other VoIPBIN resources that use <code class="docutils literal notranslate"><span class="pre">9999-01-01</span> <span class="pre">00:00:00.000000</span></code> as the sentinel for “not deleted,” the billing account’s <code class="docutils literal notranslate"><span class="pre">tm_delete</span></code> field uses <code class="docutils literal notranslate"><span class="pre">null</span></code> to indicate an active account. Always check for <code class="docutils literal notranslate"><span class="pre">null</span></code> rather than the sentinel timestamp when determining if a billing account is active. The <code class="docutils literal notranslate"><span class="pre">balance_credit</span></code> field is in micros (int64) – divide by 1,000,000 to get USD.</p>
</div>
</section>
<section id="billing-ledger-entry">
<span id="billing-account-struct-billing"></span><h3>Billing (Ledger Entry)<a class="headerlink" href="#billing-ledger-entry" title="Link to this heading"></a></h3>
<p>Each billing record is an immutable ledger entry recording a single transaction. The ledger tracks both the delta (change in balance) and a post-transaction snapshot.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;69cacd9e-f542-11ee-ab6d-afb3c2c93e56&quot;</span><span class="p">,</span>
    <span class="s2">&quot;customer_id&quot;</span><span class="p">:</span> <span class="s2">&quot;5e4a0680-804e-11ec-8477-2fea5968d85b&quot;</span><span class="p">,</span>
    <span class="s2">&quot;account_id&quot;</span><span class="p">:</span> <span class="s2">&quot;62918cd8-0cd7-11ee-8571-b738bed3a5c4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;transaction_type&quot;</span><span class="p">:</span> <span class="s2">&quot;usage&quot;</span><span class="p">,</span>
    <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;end&quot;</span><span class="p">,</span>
    <span class="s2">&quot;reference_type&quot;</span><span class="p">:</span> <span class="s2">&quot;call&quot;</span><span class="p">,</span>
    <span class="s2">&quot;reference_id&quot;</span><span class="p">:</span> <span class="s2">&quot;a1b2c3d4-5678-abcd-ef12-345678901234&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cost_type&quot;</span><span class="p">:</span> <span class="s2">&quot;call_pstn_outgoing&quot;</span><span class="p">,</span>
    <span class="s2">&quot;usage_duration&quot;</span><span class="p">:</span> <span class="mi">135</span><span class="p">,</span>
    <span class="s2">&quot;billable_units&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s2">&quot;rate_token_per_unit&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;rate_credit_per_unit&quot;</span><span class="p">:</span> <span class="mi">6000</span><span class="p">,</span>
    <span class="s2">&quot;amount_token&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;amount_credit&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">18000</span><span class="p">,</span>
    <span class="s2">&quot;balance_token_snapshot&quot;</span><span class="p">:</span> <span class="mi">650</span><span class="p">,</span>
    <span class="s2">&quot;balance_credit_snapshot&quot;</span><span class="p">:</span> <span class="mi">69754630</span><span class="p">,</span>
    <span class="s2">&quot;idempotency_key&quot;</span><span class="p">:</span> <span class="s2">&quot;b2c3d4e5-6789-bcde-f123-456789012345&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tm_billing_start&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-01-15T10:30:00Z&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tm_billing_end&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-01-15T10:32:15Z&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tm_create&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-01-15T10:32:15Z&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tm_update&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-01-15T10:32:15Z&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tm_delete&quot;</span><span class="p">:</span> <span class="n">null</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">id</span></code> (UUID): The unique identifier of this ledger entry. Returned when listing billings via <code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">/billings</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">customer_id</span></code> (UUID): The customer that owns this billing account. Obtained from the <code class="docutils literal notranslate"><span class="pre">id</span></code> field of <code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">/customers</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">account_id</span></code> (UUID): The billing account this entry belongs to. Obtained from the <code class="docutils literal notranslate"><span class="pre">id</span></code> field of <code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">/billing_accounts</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">transaction_type</span></code> (enum string): The nature of the transaction. Values: <code class="docutils literal notranslate"><span class="pre">usage</span></code> (service consumption), <code class="docutils literal notranslate"><span class="pre">top_up</span></code> (token replenishment), <code class="docutils literal notranslate"><span class="pre">adjustment</span></code> (manual correction), <code class="docutils literal notranslate"><span class="pre">refund</span></code> (credit return).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">status</span></code> (enum string): The billing entry status. Values: <code class="docutils literal notranslate"><span class="pre">progressing</span></code> (in progress), <code class="docutils literal notranslate"><span class="pre">end</span></code> (completed), <code class="docutils literal notranslate"><span class="pre">pending</span></code> (awaiting processing), <code class="docutils literal notranslate"><span class="pre">finished</span></code> (finalized).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reference_type</span></code> (enum string): The source of the transaction. Values: <code class="docutils literal notranslate"><span class="pre">call</span></code>, <code class="docutils literal notranslate"><span class="pre">call_extension</span></code>, <code class="docutils literal notranslate"><span class="pre">sms</span></code>, <code class="docutils literal notranslate"><span class="pre">number</span></code>, <code class="docutils literal notranslate"><span class="pre">number_renew</span></code>, <code class="docutils literal notranslate"><span class="pre">credit_free_tier</span></code>, <code class="docutils literal notranslate"><span class="pre">monthly_allowance</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reference_id</span></code> (UUID): The ID of the originating resource (e.g., call ID, number ID). Obtained from the <code class="docutils literal notranslate"><span class="pre">id</span></code> field of the corresponding resource endpoint (e.g., <code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">/calls/{id}</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cost_type</span></code> (enum string): Classification of the billing cost. Values include: <code class="docutils literal notranslate"><span class="pre">call_pstn_outgoing</span></code>, <code class="docutils literal notranslate"><span class="pre">call_pstn_incoming</span></code>, <code class="docutils literal notranslate"><span class="pre">call_vn</span></code>, <code class="docutils literal notranslate"><span class="pre">call_extension</span></code>, <code class="docutils literal notranslate"><span class="pre">call_direct_ext</span></code>, <code class="docutils literal notranslate"><span class="pre">sms</span></code>, <code class="docutils literal notranslate"><span class="pre">number</span></code>, <code class="docutils literal notranslate"><span class="pre">number_renew</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">usage_duration</span></code> (Integer): Actual usage duration in seconds (for calls). Not applicable for non-call services.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">billable_units</span></code> (Integer): Number of billable units after ceiling rounding (e.g., 135 seconds becomes 3 minutes for call billing).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rate_token_per_unit</span></code> (Integer, int64): Token rate per billable unit. Set to <code class="docutils literal notranslate"><span class="pre">0</span></code> for credit-only services.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rate_credit_per_unit</span></code> (Integer, int64 micros): Credit rate per billable unit in micros. Example: <code class="docutils literal notranslate"><span class="pre">6000</span></code> = $0.006.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">amount_token</span></code> (Integer, int64): Token delta for this transaction. Negative for usage, positive for top-up.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">amount_credit</span></code> (Integer, int64 micros): Credit delta in micros for this transaction. Negative for usage, positive for top-up/refund.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">balance_token_snapshot</span></code> (Integer, int64): The token balance immediately after this transaction was applied.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">balance_credit_snapshot</span></code> (Integer, int64 micros): The credit balance in micros immediately after this transaction was applied.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">idempotency_key</span></code> (UUID): Unique key to prevent duplicate billing entries for the same event.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tm_billing_start</span></code> (string, ISO 8601): Timestamp marking the start of the billing period for this transaction.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tm_billing_end</span></code> (string, ISO 8601): Timestamp marking the end of the billing period for this transaction.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tm_create</span></code> (string, ISO 8601): Timestamp when this ledger entry was created.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tm_update</span></code> (string, ISO 8601): Timestamp when this ledger entry was last updated.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tm_delete</span></code> (string, ISO 8601 or null): Timestamp when this ledger entry was deleted. <code class="docutils literal notranslate"><span class="pre">null</span></code> indicates the entry is active.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>AI Implementation Hint</strong></p>
<p>All monetary fields (<code class="docutils literal notranslate"><span class="pre">rate_credit_per_unit</span></code>, <code class="docutils literal notranslate"><span class="pre">amount_credit</span></code>, <code class="docutils literal notranslate"><span class="pre">balance_credit_snapshot</span></code>) are in micros (int64). Divide by 1,000,000 to convert to USD. The <code class="docutils literal notranslate"><span class="pre">amount_token</span></code> and <code class="docutils literal notranslate"><span class="pre">amount_credit</span></code> fields are signed: negative values represent charges/consumption, positive values represent top-ups or refunds. Call durations are ceiling-rounded to the next whole minute for billing (e.g., 135 seconds = 3 billable minutes).</p>
</div>
</section>
</section>
</section>

</main>
                        <nav aria-label="Page navigation" class="py-4 my-5 clearfix font-weight-bold border-top">
    <a class="float-left" href="customer.html" title="Previous">
        <span aria-hidden="true">←&nbsp;</span>Customer
    </a>
    <a class="float-right" href="storage.html" title="Next">
        Storage <span aria-hidden="true">&nbsp;→</span>
    </a>
</nav>
                    </div>
                    
                    <nav class="col-12 col-lg-3 pb-4">
                        <div class="sticky-top toc page-toc" aria-labelledby="page-toc-heading">
                            <p class="font-weight-bold" id="page-toc-heading">Page contents</p>
                            <ul>
<li><a class="reference internal" href="#">Billing Account</a><ul>
<li><a class="reference internal" href="#overview">Overview</a><ul>
<li><a class="reference internal" href="#how-billing-works">How Billing Works</a></li>
<li><a class="reference internal" href="#plan-tiers">Plan Tiers</a></li>
<li><a class="reference internal" href="#rate-structure">Rate Structure</a></li>
<li><a class="reference internal" href="#managing-balance">Managing Balance</a></li>
<li><a class="reference internal" href="#balance-lifecycle">Balance Lifecycle</a></li>
<li><a class="reference internal" href="#balance-monitoring">Balance Monitoring</a></li>
<li><a class="reference internal" href="#common-scenarios">Common Scenarios</a></li>
<li><a class="reference internal" href="#best-practices">Best Practices</a></li>
<li><a class="reference internal" href="#troubleshooting">Troubleshooting</a></li>
<li><a class="reference internal" href="#related-documentation">Related Documentation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tutorial">Tutorial</a><ul>
<li><a class="reference internal" href="#check-account-balance">Check Account Balance</a></li>
<li><a class="reference internal" href="#add-balance-admin-only">Add Balance (Admin Only)</a></li>
<li><a class="reference internal" href="#understanding-service-rates">Understanding Service Rates</a></li>
<li><a class="reference internal" href="#check-balance-before-call">Check Balance Before Call</a></li>
<li><a class="reference internal" href="#monitor-balance-with-webhooks">Monitor Balance with Webhooks</a></li>
<li><a class="reference internal" href="#common-use-cases">Common Use Cases</a></li>
<li><a class="reference internal" href="#id1">Best Practices</a></li>
<li><a class="reference internal" href="#balance-management-workflow">Balance Management Workflow</a></li>
<li><a class="reference internal" href="#id2">Troubleshooting</a></li>
</ul>
</li>
<li><a class="reference internal" href="#struct">Struct</a><ul>
<li><a class="reference internal" href="#billing-account-struct-billing-account">Billing account</a></li>
<li><a class="reference internal" href="#billing-ledger-entry">Billing (Ledger Entry)</a></li>
</ul>
</li>
</ul>
</li>
</ul>

                        </div>
                    </nav>
                    
                </div>
            </div>
        </div>
    </div>
    <footer class="container-fluid bg-primary text-light">
        <div class="container">
            <div class="row">
        <div class="col p-4">
            
                <nav aria-label="Footer">
                    <ul class="nav justify-content-center mb-2">
                        
                            
                            
                            <li class="nav-item"><a class="nav-link text-light"  href="http://voipbin.net">About Us</a></li>
                        
                            
                            
                            <li class="nav-item"><a class="nav-link text-light"  href="http://voipbin.net">Contact</a></li>
                        
                    </ul>
                </nav>
            
            <div class="text-center">
                    &copy; Copyright 2026, VoIPBIN
            </div>
            <div class="text-center text-white-50 font-italic mt-3">
                <small>
                    Created using
                    <a class="text-white" href="https://github.com/wagtail/sphinx_wagtail_theme" rel="nofollow" target="_blank">
                        Sphinx Wagtail Theme 6.5.0
                    </a>
                    and
                    <a class="text-white" href="https://www.sphinx-doc.org/" rel="nofollow" target="_blank">
                        Sphinx 7.2.6
                    </a>
                </small>
            </div>
        </div>
    </div>
        </div>
    </footer>
        <script src="_static/jquery.js?v=8dae8fb0"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=5929fcd5"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="_static/copybutton.js?v=f281be69"></script>
        <script type="text/javascript" src="_static/dist/theme.js"></script>
        <script type="text/javascript" src="_static/dist/vendor.js"></script>
        <script type="text/javascript" src="_static/searchtools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script type="text/javascript">
            document.addEventListener('DOMContentLoaded', function() { Search.loadIndex("searchindex.js"); });
        </script>
        <script type="text/javascript" id="searchindexloader"></script>
    </body>
</html>