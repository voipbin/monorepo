; NOTICE

; stasis contexts
; stasis contexts are for the calls table.
; all key and value are must be lower case.
; ----------------------------------------
; call-in: stasis context for incoming calls.
; call-out: stasis context for outgoing calls.
; call-svc: stasis context for the call from the svc-*.

; stasis variables
; stasis variables are will be used for calls table.
; all keys are must be lower case.
; --------------------------------------------------
; type: channel's type.
; context: channel's context.
; domain: Requested domain name. Sets by kamailio. sip-service.voipbin.net, ...
; source: request source ip.
; direction: channel's direction. incoming for this case.
; transport: receive request's transport type. tcp/udp/tls/wss
; sip_call_id: SIP's Call-ID header
; sip_pai: SIP's P-Asserted-Identity header
; sip_privacy: SIP's Privacy header


[general]
static=yes
writeprotect=no
clearglobalvars=no

[globals]
CONSOLE=Console/dsp   ; Console interface for demo
IAXINFO=guest         ; IAXtel username/password
TRUNK=DAHDI/G2        ; Trunk interface
TRUNKMSD=1            ; MSD digits to strip (usually 1 or 0)

; call incoming handler
[call-in]
exten => _[+0-9a-zA-Z].,1,NoOp(call-in)
 same => n,Stasis(voipbin,context_type=call,context=call-in,domain=${PJSIP_HEADER(read,VB-Domain)},source=${PJSIP_HEADER(read,VB-Source)},direction=incoming,transport=${PJSIP_HEADER(read,VB-Transport)},sip_call_id=${PJSIP_HEADER(read,Call-ID)},sip_pai=${PJSIP_HEADER(read,P-Asserted-Identity)},sip_privacy=${PJSIP_HEADER(read,Privacy)})
 same => n,Hangup()

; call outgoing handler
[call-out]
exten => _[+0-9a-zA-Z].,1,NoOp(call-out)
 same => n,Hangup()

; Service stasis handler
; put the channel into the stasis state.
[svc-stasis]
exten => s,1,NoOp(svc-stasis)
 same => n,Stasis(voipbin,type=call,context=call-svc)
 same => n,Hangup()

; Service streamecho handler
[svc-stream_echo]
exten => s,1,NoOp(svc-streamecho)
 same => n,Answer()
 same => n,StreamEcho(1)
 same => n,Hangup()

; Service echo handler
[svc-echo]
exten => s,1,NoOp(svc-echo)
 same => n,Answer()
 same => n,Echo()
 same => n,Hangup()

; Service AMD handler
[svc-amd]
exten => s,1,NoOp(svc-amd)
 same => n,Answer()
 same => n,AMD()
 same => n,Stasis(voipbin,type=call,context=call-svc,context_from=svc-amd,amd_status=${AMDSTATUS},amd_cause=${AMDCAUSE})
 same => n,Hangup()

; test
[test]
exten => _[+0-9a-zA-Z].,1,NoOp(test)
 same => n,Set(TIMEOUT(absolute)=600)
 same => n,Stasis(test)
